import{r as te,ck as Ks,cj as Bu,E as Oe,j as Y,e as ge,cr as jt,cs as xt,s as Ye,ct as dt,cu as Lt,cv as js,cw as Jr,a1 as Ws,cx as $e,cy as Nu,cz as pt,cA as Yn,cB as Gs,cC as Hs,cD as mr,cE as Ku,cF as ju,cG as Wu,cH as Gu,cI as Vs,cJ as Hu,cK as $s,cL as zs,cM as ba,cN as qi,cO as Vu,cP as Ys,cQ as $u,cR as zu,cS as Yu,cT as Xn,cU as Sa,cV as Li,cW as Xu,cX as Qu,cY as Zu,F as ur,cZ as Ju,c_ as qu,c$ as Xs,d0 as ed,d1 as Ri,aR as Tn,d2 as td,bY as rd,d3 as Qs,d4 as Zs,d5 as nd,d6 as Aa,d7 as id,d8 as ad,aT as nr,d9 as sr,da as ea,db as sd,dc as od,aY as di,c6 as _a,dd as Ci,de as bn,aS as ld,aU as ud,df as dd,dg as cd,dh as fd,di as hd}from"./sanity.de8d7df8.js";import{M as Nn,V as vd,B as ta,O as Yt,P as gd,_ as xa,U as Js,R as qs,E as md,q as pd,F as Ed}from"./VideoSource.styled-4cf7a892.esm.83241451.js";function yd(t,e){t.indexOf(e)===-1&&t.push(e)}const eo=(t,e,n)=>Math.min(Math.max(n,t),e),wt={duration:.3,delay:0,endDelay:0,repeat:0,easing:"ease"},Kn=t=>typeof t=="number",Rr=t=>Array.isArray(t)&&!Kn(t[0]),Td=(t,e,n)=>{const i=e-t;return((n-t)%i+i)%i+t};function bd(t,e){return Rr(t)?t[Td(0,t.length,e)]:t}const to=(t,e,n)=>-n*t+n*e+t,ro=()=>{},lr=t=>t,ra=(t,e,n)=>e-t===0?1:(n-t)/(e-t);function no(t,e){const n=t[t.length-1];for(let i=1;i<=e;i++){const r=ra(0,e,i);t.push(to(n,1,r))}}function Sd(t){const e=[0];return no(e,t-1),e}function Ad(t,e=Sd(t.length),n=lr){const i=t.length,r=i-e.length;return r>0&&no(e,r),D=>{let c=0;for(;c<i-2&&!(D<e[c+1]);c++);let p=eo(0,1,ra(e[c],e[c+1],D));return p=bd(n,c)(p),to(t[c],t[c+1],p)}}const io=t=>Array.isArray(t)&&Kn(t[0]),Oi=t=>typeof t=="object"&&Boolean(t.createAnimation),Mr=t=>typeof t=="function",_d=t=>typeof t=="string",qr={ms:t=>t*1e3,s:t=>t/1e3},ao=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,xd=1e-7,Dd=12;function Id(t,e,n,i,r){let D,c,p=0;do c=e+(n-e)/2,D=ao(c,i,r)-t,D>0?n=c:e=c;while(Math.abs(D)>xd&&++p<Dd);return c}function zr(t,e,n,i){if(t===e&&n===i)return lr;const r=D=>Id(D,0,1,t,n);return D=>D===0||D===1?D:ao(r(D),e,i)}const Ld=(t,e="end")=>n=>{n=e==="end"?Math.min(n,.999):Math.max(n,.001);const i=n*t,r=e==="end"?Math.floor(i):Math.ceil(i);return eo(0,1,r/t)},Da={ease:zr(.25,.1,.25,1),"ease-in":zr(.42,0,1,1),"ease-in-out":zr(.42,0,.58,1),"ease-out":zr(0,0,.58,1)},Rd=/\((.*?)\)/;function Ia(t){if(Mr(t))return t;if(io(t))return zr(...t);if(Da[t])return Da[t];if(t.startsWith("steps")){const e=Rd.exec(t);if(e){const n=e[1].split(",");return Ld(parseFloat(n[0]),n[1].trim())}}return lr}class so{constructor(e,n=[0,1],{easing:i,duration:r=wt.duration,delay:D=wt.delay,endDelay:c=wt.endDelay,repeat:p=wt.repeat,offset:w,direction:M="normal"}={}){if(this.startTime=null,this.rate=1,this.t=0,this.cancelTimestamp=null,this.easing=lr,this.duration=0,this.totalDuration=0,this.repeat=0,this.playState="idle",this.finished=new Promise((C,S)=>{this.resolve=C,this.reject=S}),i=i||wt.easing,Oi(i)){const C=i.createAnimation(n);i=C.easing,n=C.keyframes||n,r=C.duration||r}this.repeat=p,this.easing=Rr(i)?lr:Ia(i),this.updateDuration(r);const O=Ad(n,w,Rr(i)?i.map(Ia):lr);this.tick=C=>{var S;D=D;let b=0;this.pauseTime!==void 0?b=this.pauseTime:b=(C-this.startTime)*this.rate,this.t=b,b/=1e3,b=Math.max(b-D,0),this.playState==="finished"&&this.pauseTime===void 0&&(b=this.totalDuration);const I=b/this.duration;let L=Math.floor(I),_=I%1;!_&&I>=1&&(_=1),_===1&&L--;const x=L%2;(M==="reverse"||M==="alternate"&&x||M==="alternate-reverse"&&!x)&&(_=1-_);const l=b>=this.totalDuration?1:Math.min(_,1),a=O(this.easing(l));e(a),this.pauseTime===void 0&&(this.playState==="finished"||b>=this.totalDuration+c)?(this.playState="finished",(S=this.resolve)===null||S===void 0||S.call(this,a)):this.playState!=="idle"&&(this.frameRequestId=requestAnimationFrame(this.tick))},this.play()}play(){const e=performance.now();this.playState="running",this.pauseTime!==void 0?this.startTime=e-this.pauseTime:this.startTime||(this.startTime=e),this.cancelTimestamp=this.startTime,this.pauseTime=void 0,this.frameRequestId=requestAnimationFrame(this.tick)}pause(){this.playState="paused",this.pauseTime=this.t}finish(){this.playState="finished",this.tick(0)}stop(){var e;this.playState="idle",this.frameRequestId!==void 0&&cancelAnimationFrame(this.frameRequestId),(e=this.reject)===null||e===void 0||e.call(this,!1)}cancel(){this.stop(),this.tick(this.cancelTimestamp)}reverse(){this.rate*=-1}commitStyles(){}updateDuration(e){this.duration=e,this.totalDuration=e*(this.repeat+1)}get currentTime(){return this.t}set currentTime(e){this.pauseTime!==void 0||this.rate===0?this.pauseTime=e:this.startTime=performance.now()-e/this.rate}get playbackRate(){return this.rate}set playbackRate(e){this.rate=e}}class Cd{setAnimation(e){this.animation=e,e==null||e.finished.then(()=>this.clearAnimation()).catch(()=>{})}clearAnimation(){this.animation=this.generator=void 0}}const ci=new WeakMap;function oo(t){return ci.has(t)||ci.set(t,{transforms:[],values:new Map}),ci.get(t)}function Od(t,e){return t.has(e)||t.set(e,new Cd),t.get(e)}const Md=["","X","Y","Z"],Pd=["translate","scale","rotate","skew"],jn={x:"translateX",y:"translateY",z:"translateZ"},La={syntax:"<angle>",initialValue:"0deg",toDefaultUnit:t=>t+"deg"},wd={translate:{syntax:"<length-percentage>",initialValue:"0px",toDefaultUnit:t=>t+"px"},rotate:La,scale:{syntax:"<number>",initialValue:1,toDefaultUnit:lr},skew:La},sn=new Map,na=t=>`--motion-${t}`,Wn=["x","y","z"];Pd.forEach(t=>{Md.forEach(e=>{Wn.push(t+e),sn.set(na(t+e),wd[t])})});const kd=(t,e)=>Wn.indexOf(t)-Wn.indexOf(e),Ud=new Set(Wn),lo=t=>Ud.has(t),Fd=(t,e)=>{jn[e]&&(e=jn[e]);const{transforms:n}=oo(t);yd(n,e),t.style.transform=Bd(n)},Bd=t=>t.sort(kd).reduce(Nd,"").trim(),Nd=(t,e)=>`${t} ${e}(var(${na(e)}))`,Mi=t=>t.startsWith("--"),Ra=new Set;function Kd(t){if(!Ra.has(t)){Ra.add(t);try{const{syntax:e,initialValue:n}=sn.has(t)?sn.get(t):{};CSS.registerProperty({name:t,inherits:!1,syntax:e,initialValue:n})}catch{}}}const fi=(t,e)=>document.createElement("div").animate(t,e),Ca={cssRegisterProperty:()=>typeof CSS<"u"&&Object.hasOwnProperty.call(CSS,"registerProperty"),waapi:()=>Object.hasOwnProperty.call(Element.prototype,"animate"),partialKeyframes:()=>{try{fi({opacity:[1]})}catch{return!1}return!0},finished:()=>Boolean(fi({opacity:[0,1]},{duration:.001}).finished),linearEasing:()=>{try{fi({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0}},hi={},xr={};for(const t in Ca)xr[t]=()=>(hi[t]===void 0&&(hi[t]=Ca[t]()),hi[t]);const jd=.015,Wd=(t,e)=>{let n="";const i=Math.round(e/jd);for(let r=0;r<i;r++)n+=t(ra(0,i-1,r))+", ";return n.substring(0,n.length-2)},Oa=(t,e)=>Mr(t)?xr.linearEasing()?`linear(${Wd(t,e)})`:wt.easing:io(t)?Gd(t):t,Gd=([t,e,n,i])=>`cubic-bezier(${t}, ${e}, ${n}, ${i})`;function Hd(t,e){for(let n=0;n<t.length;n++)t[n]===null&&(t[n]=n?t[n-1]:e());return t}const Vd=t=>Array.isArray(t)?t:[t];function Pi(t){return jn[t]&&(t=jn[t]),lo(t)?na(t):t}const Sn={get:(t,e)=>{e=Pi(e);let n=Mi(e)?t.style.getPropertyValue(e):getComputedStyle(t)[e];if(!n&&n!==0){const i=sn.get(e);i&&(n=i.initialValue)}return n},set:(t,e,n)=>{e=Pi(e),Mi(e)?t.style.setProperty(e,n):t.style[e]=n}};function uo(t,e=!0){if(!(!t||t.playState==="finished"))try{t.stop?t.stop():(e&&t.commitStyles(),t.cancel())}catch{}}function $d(t,e){var n;let i=(e==null?void 0:e.toDefaultUnit)||lr;const r=t[t.length-1];if(_d(r)){const D=((n=r.match(/(-?[\d.]+)([a-z%]*)/))===null||n===void 0?void 0:n[2])||"";D&&(i=c=>c+D)}return i}function zd(){return window.__MOTION_DEV_TOOLS_RECORD}function Yd(t,e,n,i={},r){const D=zd(),c=i.record!==!1&&D;let p,{duration:w=wt.duration,delay:M=wt.delay,endDelay:O=wt.endDelay,repeat:C=wt.repeat,easing:S=wt.easing,persist:b=!1,direction:I,offset:L,allowWebkitAcceleration:_=!1}=i;const x=oo(t),l=lo(e);let a=xr.waapi();l&&Fd(t,e);const d=Pi(e),y=Od(x.values,d),E=sn.get(d);return uo(y.animation,!(Oi(S)&&y.generator)&&i.record!==!1),()=>{const u=()=>{var g,f;return(f=(g=Sn.get(t,d))!==null&&g!==void 0?g:E==null?void 0:E.initialValue)!==null&&f!==void 0?f:0};let s=Hd(Vd(n),u);const o=$d(s,E);if(Oi(S)){const g=S.createAnimation(s,e!=="opacity",u,d,y);S=g.easing,s=g.keyframes||s,w=g.duration||w}if(Mi(d)&&(xr.cssRegisterProperty()?Kd(d):a=!1),l&&!xr.linearEasing()&&(Mr(S)||Rr(S)&&S.some(Mr))&&(a=!1),a){E&&(s=s.map(v=>Kn(v)?E.toDefaultUnit(v):v)),s.length===1&&(!xr.partialKeyframes()||c)&&s.unshift(u());const g={delay:qr.ms(M),duration:qr.ms(w),endDelay:qr.ms(O),easing:Rr(S)?void 0:Oa(S,w),direction:I,iterations:C+1,fill:"both"};p=t.animate({[d]:s,offset:L,easing:Rr(S)?S.map(v=>Oa(v,w)):void 0},g),p.finished||(p.finished=new Promise((v,T)=>{p.onfinish=v,p.oncancel=T}));const f=s[s.length-1];p.finished.then(()=>{b||(Sn.set(t,d,f),p.cancel())}).catch(ro),_||(p.playbackRate=1.000001)}else if(r&&l)s=s.map(g=>typeof g=="string"?parseFloat(g):g),s.length===1&&s.unshift(parseFloat(u())),p=new r(g=>{Sn.set(t,d,o?o(g):g)},s,Object.assign(Object.assign({},i),{duration:w,easing:S}));else{const g=s[s.length-1];Sn.set(t,d,E&&Kn(g)?E.toDefaultUnit(g):g)}return c&&D(t,e,s,{duration:w,delay:M,easing:S,repeat:C,offset:L},"motion-one"),y.setAnimation(p),p}}const Xd=(t,e)=>t[e]?Object.assign(Object.assign({},t),t[e]):Object.assign({},t);function Qd(t,e){var n;return typeof t=="string"?e?((n=e[t])!==null&&n!==void 0||(e[t]=document.querySelectorAll(t)),t=e[t]):t=document.querySelectorAll(t):t instanceof Element&&(t=[t]),Array.from(t||[])}const Zd=t=>t(),co=(t,e,n=wt.duration)=>new Proxy({animations:t.map(Zd).filter(Boolean),duration:n,options:e},qd),Jd=t=>t.animations[0],qd={get:(t,e)=>{const n=Jd(t);switch(e){case"duration":return t.duration;case"currentTime":return qr.s((n==null?void 0:n[e])||0);case"playbackRate":case"playState":return n==null?void 0:n[e];case"finished":return t.finished||(t.finished=Promise.all(t.animations.map(ec)).catch(ro)),t.finished;case"stop":return()=>{t.animations.forEach(i=>uo(i))};case"forEachNative":return i=>{t.animations.forEach(r=>i(r,t))};default:return typeof(n==null?void 0:n[e])>"u"?void 0:()=>t.animations.forEach(i=>i[e]())}},set:(t,e,n)=>{switch(e){case"currentTime":n=qr.ms(n);case"currentTime":case"playbackRate":for(let i=0;i<t.animations.length;i++)t.animations[i][e]=n;return!0}return!1}},ec=t=>t.finished;function tc(t,e,n){return Mr(t)?t(e,n):t}function rc(t){return function(n,i,r={}){n=Qd(n);const D=n.length,c=[];for(let p=0;p<D;p++){const w=n[p];for(const M in i){const O=Xd(r,M);O.delay=tc(O.delay,p,D);const C=Yd(w,M,i[M],O,t);c.push(C)}}return co(c,r,r.duration)}}const nc=rc(so);/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function fo(t,e,n,i){function r(D){return D instanceof n?D:new n(function(c){c(D)})}return new(n||(n=Promise))(function(D,c){function p(O){try{M(i.next(O))}catch(C){c(C)}}function w(O){try{M(i.throw(O))}catch(C){c(C)}}function M(O){O.done?D(O.value):r(O.value).then(p,w)}M((i=i.apply(t,e||[])).next())})}function ho(t,e){var n={label:0,sent:function(){if(D[0]&1)throw D[1];return D[1]},trys:[],ops:[]},i,r,D,c;return c={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function p(M){return function(O){return w([M,O])}}function w(M){if(i)throw new TypeError("Generator is already executing.");for(;n;)try{if(i=1,r&&(D=M[0]&2?r.return:M[0]?r.throw||((D=r.return)&&D.call(r),0):r.next)&&!(D=D.call(r,M[1])).done)return D;switch(r=0,D&&(M=[M[0]&2,D.value]),M[0]){case 0:case 1:D=M;break;case 4:return n.label++,{value:M[1],done:!1};case 5:n.label++,r=M[1],M=[0];continue;case 7:M=n.ops.pop(),n.trys.pop();continue;default:if(D=n.trys,!(D=D.length>0&&D[D.length-1])&&(M[0]===6||M[0]===2)){n=0;continue}if(M[0]===3&&(!D||M[1]>D[0]&&M[1]<D[3])){n.label=M[1];break}if(M[0]===6&&n.label<D[1]){n.label=D[1],D=M;break}if(D&&n.label<D[2]){n.label=D[2],n.ops.push(M);break}D[2]&&n.ops.pop(),n.trys.pop();continue}M=e.call(t,n)}catch(O){M=[6,O],r=0}finally{i=D=0}if(M[0]&5)throw M[1];return{value:M[0]?M[1]:void 0,done:!0}}}var zt=function(){},_t=zt(),Ln=Object,gt=function(t){return t===_t},or=function(t){return typeof t=="function"},dr=function(t,e){return Ln.assign({},t,e)},ia="undefined",aa=function(){return typeof window!=ia},ic=function(){return typeof document!=ia},ac=function(){return aa()&&typeof window.requestAnimationFrame!=ia},An=new WeakMap,sc=0,on=function(t){var e=typeof t,n=t&&t.constructor,i=n==Date,r,D;if(Ln(t)===t&&!i&&n!=RegExp){if(r=An.get(t),r)return r;if(r=++sc+"~",An.set(t,r),n==Array){for(r="@",D=0;D<t.length;D++)r+=on(t[D])+",";An.set(t,r)}if(n==Ln){r="#";for(var c=Ln.keys(t).sort();!gt(D=c.pop());)gt(t[D])||(r+=D+":"+on(t[D])+",");An.set(t,r)}}else r=i?t.toJSON():e=="symbol"?t.toString():e=="string"?JSON.stringify(t):""+t;return r},wi=!0,oc=function(){return wi},vo=aa(),sa=ic(),ki=vo&&window.addEventListener?window.addEventListener.bind(window):zt,lc=sa?document.addEventListener.bind(document):zt,Ui=vo&&window.removeEventListener?window.removeEventListener.bind(window):zt,uc=sa?document.removeEventListener.bind(document):zt,dc=function(){var t=sa&&document.visibilityState;return gt(t)||t!=="hidden"},cc=function(t){return lc("visibilitychange",t),ki("focus",t),function(){uc("visibilitychange",t),Ui("focus",t)}},fc=function(t){var e=function(){wi=!0,t()},n=function(){wi=!1};return ki("online",e),ki("offline",n),function(){Ui("online",e),Ui("offline",n)}},hc={isOnline:oc,isVisible:dc},vc={initFocus:cc,initReconnect:fc},Qn=!aa()||"Deno"in window,gc=function(t){return ac()?window.requestAnimationFrame(t):setTimeout(t,1)},Rn=Qn?te.exports.useEffect:te.exports.useLayoutEffect,vi=typeof navigator<"u"&&navigator.connection,Ma=!Qn&&vi&&(["slow-2g","2g"].includes(vi.effectiveType)||vi.saveData),go=function(t){if(or(t))try{t=t()}catch{t=""}var e=[].concat(t);t=typeof t=="string"?t:(Array.isArray(t)?t.length:t)?on(t):"";var n=t?"$swr$"+t:"";return[t,e,n]},gr=new WeakMap,mo=0,po=1,Eo=2,en=function(t,e,n,i,r,D,c){c===void 0&&(c=!0);var p=gr.get(t),w=p[0],M=p[1],O=p[3],C=w[e],S=M[e];if(c&&S)for(var b=0;b<S.length;++b)S[b](n,i,r);return D&&(delete O[e],C&&C[0])?C[0](Eo).then(function(){return t.get(e)}):t.get(e)},mc=0,Fi=function(){return++mc},yo=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return fo(void 0,void 0,void 0,function(){var n,i,r,D,c,p,w,M,O,C,S,b,I,L,_,x,l,a,d,y,E;return ho(this,function(u){switch(u.label){case 0:if(n=t[0],i=t[1],r=t[2],D=t[3],c=typeof D=="boolean"?{revalidate:D}:D||{},p=gt(c.populateCache)?!0:c.populateCache,w=c.revalidate!==!1,M=c.rollbackOnError!==!1,O=c.optimisticData,C=go(i),S=C[0],b=C[2],!S)return[2];if(I=gr.get(n),L=I[2],t.length<3)return[2,en(n,S,n.get(S),_t,_t,w,!0)];if(_=r,l=Fi(),L[S]=[l,0],a=!gt(O),d=n.get(S),a&&(y=or(O)?O(d):O,n.set(S,y),en(n,S,y)),or(_))try{_=_(n.get(S))}catch(s){x=s}return _&&or(_.then)?[4,_.catch(function(s){x=s})]:[3,2];case 1:if(_=u.sent(),l!==L[S][0]){if(x)throw x;return[2,_]}else x&&a&&M&&(p=!0,_=d,n.set(S,d));u.label=2;case 2:return p&&(x||(or(p)&&(_=p(_,d)),n.set(S,_)),n.set(b,dr(n.get(b),{error:x}))),L[S][1]=Fi(),[4,en(n,S,_,x,_t,w,!!p)];case 3:if(E=u.sent(),x)throw x;return[2,p?E:_]}})})},Pa=function(t,e){for(var n in t)t[n][0]&&t[n][0](e)},pc=function(t,e){if(!gr.has(t)){var n=dr(vc,e),i={},r=yo.bind(_t,t),D=zt;if(gr.set(t,[i,{},{},{},r]),!Qn){var c=n.initFocus(setTimeout.bind(_t,Pa.bind(_t,i,mo))),p=n.initReconnect(setTimeout.bind(_t,Pa.bind(_t,i,po)));D=function(){c&&c(),p&&p(),gr.delete(t)}}return[t,r,D]}return[t,gr.get(t)[4]]},Ec=function(t,e,n,i,r){var D=n.errorRetryCount,c=r.retryCount,p=~~((Math.random()+.5)*(1<<(c<8?c:8)))*n.errorRetryInterval;!gt(D)&&c>D||setTimeout(i,p,r)},To=pc(new Map),yc=To[0],Tc=To[1],bc=dr({onLoadingSlow:zt,onSuccess:zt,onError:zt,onErrorRetry:Ec,onDiscarded:zt,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:Ma?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:Ma?5e3:3e3,compare:function(t,e){return on(t)==on(e)},isPaused:function(){return!1},cache:yc,mutate:Tc,fallback:{}},hc),Sc=function(t,e){var n=dr(t,e);if(e){var i=t.use,r=t.fallback,D=e.use,c=e.fallback;i&&D&&(n.use=i.concat(D)),r&&c&&(n.fallback=dr(r,c))}return n},Ac=te.exports.createContext({}),_c=function(t,e){var n=te.exports.useState({})[1],i=te.exports.useRef(t),r=te.exports.useRef({data:!1,error:!1,isValidating:!1}),D=te.exports.useCallback(function(c){var p=!1,w=i.current;for(var M in c){var O=M;w[O]!==c[O]&&(w[O]=c[O],r.current[O]&&(p=!0))}p&&!e.current&&n({})},[]);return Rn(function(){i.current=t}),[i,r.current,D]},xc=function(t){return or(t[1])?[t[0],t[1],t[2]||{}]:[t[0],null,(t[1]===null?t[2]:t[1])||{}]},Dc=function(){return dr(bc,te.exports.useContext(Ac))},Ic=function(t){return function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var r=Dc(),D=xc(n),c=D[0],p=D[1],w=D[2],M=Sc(r,w),O=t,C=M.use;if(C)for(var S=C.length;S-- >0;)O=C[S](O);return O(c,p||M.fetcher,M)}},wa=function(t,e,n){var i=e[t]||(e[t]=[]);return i.push(n),function(){var r=i.indexOf(n);r>=0&&(i[r]=i[i.length-1],i.pop())}},gi={dedupe:!0},Lc=function(t,e,n){var i=n.cache,r=n.compare,D=n.fallbackData,c=n.suspense,p=n.revalidateOnMount,w=n.refreshInterval,M=n.refreshWhenHidden,O=n.refreshWhenOffline,C=gr.get(i),S=C[0],b=C[1],I=C[2],L=C[3],_=go(t),x=_[0],l=_[1],a=_[2],d=te.exports.useRef(!1),y=te.exports.useRef(!1),E=te.exports.useRef(x),u=te.exports.useRef(e),s=te.exports.useRef(n),o=function(){return s.current},g=function(){return o().isVisible()&&o().isOnline()},f=function(ee){return i.set(a,dr(i.get(a),ee))},v=i.get(x),T=gt(D)?n.fallback[x]:D,m=gt(v)?T:v,h=i.get(a)||{},A=h.error,R=!d.current,P=function(){return R&&!gt(p)?p:o().isPaused()?!1:c?gt(m)?!1:n.revalidateIfStale:gt(m)||n.revalidateIfStale},k=function(){return!x||!e?!1:h.isValidating?!0:R&&P()},j=k(),K=_c({data:m,error:A,isValidating:j},y),W=K[0],H=K[1],$=K[2],z=te.exports.useCallback(function(ee){return fo(void 0,void 0,void 0,function(){var re,ne,ae,ce,fe,se,ve,le,ue,Ce,be,Le,Ue;return ho(this,function(we){switch(we.label){case 0:if(re=u.current,!x||!re||y.current||o().isPaused())return[2,!1];ce=!0,fe=ee||{},se=!L[x]||!fe.dedupe,ve=function(){return!y.current&&x===E.current&&d.current},le=function(){var Ke=L[x];Ke&&Ke[1]===ae&&delete L[x]},ue={isValidating:!1},Ce=function(){f({isValidating:!1}),ve()&&$(ue)},f({isValidating:!0}),$({isValidating:!0}),we.label=1;case 1:return we.trys.push([1,3,,4]),se&&(en(i,x,W.current.data,W.current.error,!0),n.loadingTimeout&&!i.get(x)&&setTimeout(function(){ce&&ve()&&o().onLoadingSlow(x,n)},n.loadingTimeout),L[x]=[re.apply(void 0,l),Fi()]),Ue=L[x],ne=Ue[0],ae=Ue[1],[4,ne];case 2:return ne=we.sent(),se&&setTimeout(le,n.dedupingInterval),!L[x]||L[x][1]!==ae?(se&&ve()&&o().onDiscarded(x),[2,!1]):(f({error:_t}),ue.error=_t,be=I[x],!gt(be)&&(ae<=be[0]||ae<=be[1]||be[1]===0)?(Ce(),se&&ve()&&o().onDiscarded(x),[2,!1]):(r(W.current.data,ne)?ue.data=W.current.data:ue.data=ne,r(i.get(x),ne)||i.set(x,ne),se&&ve()&&o().onSuccess(ne,x,n),[3,4]));case 3:return Le=we.sent(),le(),o().isPaused()||(f({error:Le}),ue.error=Le,se&&ve()&&(o().onError(Le,x,n),(typeof n.shouldRetryOnError=="boolean"&&n.shouldRetryOnError||or(n.shouldRetryOnError)&&n.shouldRetryOnError(Le))&&g()&&o().onErrorRetry(Le,x,n,z,{retryCount:(fe.retryCount||0)+1,dedupe:!0}))),[3,4];case 4:return ce=!1,Ce(),ve()&&se&&en(i,x,ue.data,ue.error,!1),[2,!0]}})})},[x]),J=te.exports.useCallback(yo.bind(_t,i,function(){return E.current}),[]);if(Rn(function(){u.current=e,s.current=n}),Rn(function(){if(!!x){var ee=x!==E.current,re=z.bind(_t,gi),ne=function(ve,le,ue){$(dr({error:le,isValidating:ue},r(W.current.data,ve)?_t:{data:ve}))},ae=0,ce=function(ve){if(ve==mo){var le=Date.now();o().revalidateOnFocus&&le>ae&&g()&&(ae=le+o().focusThrottleInterval,re())}else if(ve==po)o().revalidateOnReconnect&&g()&&re();else if(ve==Eo)return z()},fe=wa(x,b,ne),se=wa(x,S,ce);return y.current=!1,E.current=x,d.current=!0,ee&&$({data:m,error:A,isValidating:j}),P()&&(gt(m)||Qn?re():gc(re)),function(){y.current=!0,fe(),se()}}},[x,z]),Rn(function(){var ee;function re(){var ae=or(w)?w(m):w;ae&&ee!==-1&&(ee=setTimeout(ne,ae))}function ne(){!W.current.error&&(M||o().isVisible())&&(O||o().isOnline())?z(gi).then(re):re()}return re(),function(){ee&&(clearTimeout(ee),ee=-1)}},[w,M,O,z]),te.exports.useDebugValue(m),c&&gt(m)&&x)throw u.current=e,s.current=n,y.current=!1,gt(A)?z(gi):A;return{mutate:J,get data(){return H.data=!0,m},get error(){return H.error=!0,A},get isValidating(){return H.isValidating=!0,j}}},Rc=Ic(Lc),Cc=Object.create,bo=Object.defineProperty,Oc=Object.getOwnPropertyDescriptor,Mc=Object.getOwnPropertyNames,Pc=Object.getPrototypeOf,wc=Object.prototype.hasOwnProperty,un=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),kc=(t,e,n,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Mc(e))!wc.call(t,r)&&r!==n&&bo(t,r,{get:()=>e[r],enumerable:!(i=Oc(e,r))||i.enumerable});return t},Uc=(t,e,n)=>(n=t!=null?Cc(Pc(t)):{},kc(e||!t||!t.__esModule?bo(n,"default",{value:t,enumerable:!0}):n,t)),Fc=un((t,e)=>{var n;typeof window<"u"?n=window:typeof global<"u"?n=global:typeof self<"u"?n=self:n={},e.exports=n}),Bc=un((t,e)=>{e.exports=i;var n=Object.prototype.toString;function i(r){if(!r)return!1;var D=n.call(r);return D==="[object Function]"||typeof r=="function"&&D!=="[object RegExp]"||typeof window<"u"&&(r===window.setTimeout||r===window.alert||r===window.confirm||r===window.prompt)}}),Nc=un((t,e)=>{var n=function(r){return r.replace(/^\s+|\s+$/g,"")},i=function(r){return Object.prototype.toString.call(r)==="[object Array]"};e.exports=function(r){if(!r)return{};for(var D={},c=n(r).split(`
`),p=0;p<c.length;p++){var w=c[p],M=w.indexOf(":"),O=n(w.slice(0,M)).toLowerCase(),C=n(w.slice(M+1));typeof D[O]>"u"?D[O]=C:i(D[O])?D[O].push(C):D[O]=[D[O],C]}return D}}),Kc=un((t,e)=>{e.exports=i;var n=Object.prototype.hasOwnProperty;function i(){for(var r={},D=0;D<arguments.length;D++){var c=arguments[D];for(var p in c)n.call(c,p)&&(r[p]=c[p])}return r}}),jc=un((t,e)=>{var n=Fc(),i=Bc(),r=Nc(),D=Kc();e.exports=M,e.exports.default=M,M.XMLHttpRequest=n.XMLHttpRequest||S,M.XDomainRequest="withCredentials"in new M.XMLHttpRequest?M.XMLHttpRequest:n.XDomainRequest,c(["get","put","post","patch","head","delete"],function(b){M[b==="delete"?"del":b]=function(I,L,_){return L=w(I,L,_),L.method=b.toUpperCase(),O(L)}});function c(b,I){for(var L=0;L<b.length;L++)I(b[L])}function p(b){for(var I in b)if(b.hasOwnProperty(I))return!1;return!0}function w(b,I,L){var _=b;return i(I)?(L=I,typeof b=="string"&&(_={uri:b})):_=D(I,{uri:b}),_.callback=L,_}function M(b,I,L){return I=w(b,I,L),O(I)}function O(b){if(typeof b.callback>"u")throw new Error("callback argument missing");var I=!1,L=function(h,A,R){I||(I=!0,b.callback(h,A,R))};function _(){d.readyState===4&&setTimeout(a,0)}function x(){var h=void 0;if(d.response?h=d.response:h=d.responseText||C(d),v)try{h=JSON.parse(h)}catch{}return h}function l(h){return clearTimeout(T),h instanceof Error||(h=new Error(""+(h||"Unknown XMLHttpRequest Error"))),h.statusCode=0,L(h,m)}function a(){if(!E){var h;clearTimeout(T),b.useXDR&&d.status===void 0?h=200:h=d.status===1223?204:d.status;var A=m,R=null;return h!==0?(A={body:x(),statusCode:h,method:s,headers:{},url:u,rawRequest:d},d.getAllResponseHeaders&&(A.headers=r(d.getAllResponseHeaders()))):R=new Error("Internal XMLHttpRequest Error"),L(R,A,A.body)}}var d=b.xhr||null;d||(b.cors||b.useXDR?d=new M.XDomainRequest:d=new M.XMLHttpRequest);var y,E,u=d.url=b.uri||b.url,s=d.method=b.method||"GET",o=b.body||b.data,g=d.headers=b.headers||{},f=!!b.sync,v=!1,T,m={body:void 0,headers:{},statusCode:0,method:s,url:u,rawRequest:d};if("json"in b&&b.json!==!1&&(v=!0,g.accept||g.Accept||(g.Accept="application/json"),s!=="GET"&&s!=="HEAD"&&(g["content-type"]||g["Content-Type"]||(g["Content-Type"]="application/json"),o=JSON.stringify(b.json===!0?o:b.json))),d.onreadystatechange=_,d.onload=a,d.onerror=l,d.onprogress=function(){},d.onabort=function(){E=!0},d.ontimeout=l,d.open(s,u,!f,b.username,b.password),f||(d.withCredentials=!!b.withCredentials),!f&&b.timeout>0&&(T=setTimeout(function(){if(!E){E=!0,d.abort("timeout");var h=new Error("XMLHttpRequest timeout");h.code="ETIMEDOUT",l(h)}},b.timeout)),d.setRequestHeader)for(y in g)g.hasOwnProperty(y)&&d.setRequestHeader(y,g[y]);else if(b.headers&&!p(b.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in b&&(d.responseType=b.responseType),"beforeSend"in b&&typeof b.beforeSend=="function"&&b.beforeSend(d),d.send(o||null),d}function C(b){try{if(b.responseType==="document")return b.responseXML;var I=b.responseXML&&b.responseXML.documentElement.nodeName==="parsererror";if(b.responseType===""&&!I)return b.responseXML}catch{}return null}function S(){}});function oa(t,e,...n){if(!t)throw new TypeError(So(e,n))}function So(t,e){let n=0;return t.replace(/%[os]/gu,()=>Ao(e[n++]))}function Ao(t){return typeof t!="object"||t===null?String(t):Object.prototype.toString.call(t)}var Wc;function Gc(t){try{let e=t instanceof Error?t:new Error(Ao(t));if(typeof dispatchEvent=="function"&&typeof ErrorEvent=="function")dispatchEvent(new ErrorEvent("error",{error:e,message:e.message}));else if(typeof process<"u"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)}catch{}}var Kt=typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:typeof globalThis<"u"?globalThis:void 0,Hc,qt=class{constructor(t,e){this.code=t,this.message=e}warn(...t){var e;try{let n=((e=new Error().stack)!==null&&e!==void 0?e:"").replace(/^(?:.+?\n){2}/gu,`
`);console.warn(this.message,...t,n)}catch{}}},Vc=new qt("W01","Unable to initialize event under dispatching."),$c=new qt("W02","Assigning any falsy value to 'cancelBubble' property has no effect."),zc=new qt("W03","Assigning any truthy value to 'returnValue' property has no effect."),Yc=new qt("W04","Unable to preventDefault on non-cancelable events."),Xc=new qt("W05","Unable to preventDefault inside passive event listener invocation."),Qc=new qt("W06","An event listener wasn't added because it has been added already: %o, %o"),mi=new qt("W07","The %o option value was abandoned because the event listener wasn't added as duplicated."),ka=new qt("W08","The 'callback' argument must be a function or an object that has 'handleEvent' method: %o");new qt("W09","Event attribute handler must be a function: %o");var er=class{static get NONE(){return Ua}static get CAPTURING_PHASE(){return Fa}static get AT_TARGET(){return Ba}static get BUBBLING_PHASE(){return Na}constructor(t,e){Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});let n=e!=null?e:{};Bi.set(this,{type:String(t),bubbles:Boolean(n.bubbles),cancelable:Boolean(n.cancelable),composed:Boolean(n.composed),target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1,inPassiveListenerFlag:!1,dispatchFlag:!1,timeStamp:Date.now()})}get type(){return Ve(this).type}get target(){return Ve(this).target}get srcElement(){return Ve(this).target}get currentTarget(){return Ve(this).currentTarget}composedPath(){let t=Ve(this).currentTarget;return t?[t]:[]}get NONE(){return Ua}get CAPTURING_PHASE(){return Fa}get AT_TARGET(){return Ba}get BUBBLING_PHASE(){return Na}get eventPhase(){return Ve(this).dispatchFlag?2:0}stopPropagation(){Ve(this).stopPropagationFlag=!0}get cancelBubble(){return Ve(this).stopPropagationFlag}set cancelBubble(t){t?Ve(this).stopPropagationFlag=!0:$c.warn()}stopImmediatePropagation(){let t=Ve(this);t.stopPropagationFlag=t.stopImmediatePropagationFlag=!0}get bubbles(){return Ve(this).bubbles}get cancelable(){return Ve(this).cancelable}get returnValue(){return!Ve(this).canceledFlag}set returnValue(t){t?zc.warn():Ka(Ve(this))}preventDefault(){Ka(Ve(this))}get defaultPrevented(){return Ve(this).canceledFlag}get composed(){return Ve(this).composed}get isTrusted(){return!1}get timeStamp(){return Ve(this).timeStamp}initEvent(t,e=!1,n=!1){let i=Ve(this);if(i.dispatchFlag){Vc.warn();return}Bi.set(this,{...i,type:String(t),bubbles:Boolean(e),cancelable:Boolean(n),target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1})}},Ua=0,Fa=1,Ba=2,Na=3,Bi=new WeakMap;function Ve(t,e="this"){let n=Bi.get(t);return oa(n!=null,"'%s' must be an object that Event constructor created, but got another one: %o",e,t),n}function Ka(t){if(t.inPassiveListenerFlag){Xc.warn();return}if(!t.cancelable){Yc.warn();return}t.canceledFlag=!0}Object.defineProperty(er,"NONE",{enumerable:!0});Object.defineProperty(er,"CAPTURING_PHASE",{enumerable:!0});Object.defineProperty(er,"AT_TARGET",{enumerable:!0});Object.defineProperty(er,"BUBBLING_PHASE",{enumerable:!0});var pi=Object.getOwnPropertyNames(er.prototype);for(let t=0;t<pi.length;++t)pi[t]!=="constructor"&&Object.defineProperty(er.prototype,pi[t],{enumerable:!0});typeof Kt<"u"&&typeof Kt.Event<"u"&&Object.setPrototypeOf(er.prototype,Kt.Event.prototype);function Zc(t){return Kt.DOMException?new Kt.DOMException(t,"InvalidStateError"):(br==null&&(br=class _o extends Error{constructor(n){super(n),Error.captureStackTrace&&Error.captureStackTrace(this,_o)}get code(){return 11}get name(){return"InvalidStateError"}},Object.defineProperties(br.prototype,{code:{enumerable:!0},name:{enumerable:!0}}),Wa(br),Wa(br.prototype)),new br(t))}var br,ja={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};function Wa(t){let e=Object.keys(ja);for(let n=0;n<e.length;++n){let i=e[n],r=ja[i];Object.defineProperty(t,i,{get(){return r},configurable:!0,enumerable:!0})}}var Zn=class extends er{static wrap(t){return new(Do(t))(t)}constructor(t){super(t.type,{bubbles:t.bubbles,cancelable:t.cancelable,composed:t.composed}),t.cancelBubble&&super.stopPropagation(),t.defaultPrevented&&super.preventDefault(),xo.set(this,{original:t});let e=Object.keys(t);for(let n=0;n<e.length;++n){let i=e[n];i in this||Object.defineProperty(this,i,Io(t,i))}}stopPropagation(){super.stopPropagation();let{original:t}=ir(this);"stopPropagation"in t&&t.stopPropagation()}get cancelBubble(){return super.cancelBubble}set cancelBubble(t){super.cancelBubble=t;let{original:e}=ir(this);"cancelBubble"in e&&(e.cancelBubble=t)}stopImmediatePropagation(){super.stopImmediatePropagation();let{original:t}=ir(this);"stopImmediatePropagation"in t&&t.stopImmediatePropagation()}get returnValue(){return super.returnValue}set returnValue(t){super.returnValue=t;let{original:e}=ir(this);"returnValue"in e&&(e.returnValue=t)}preventDefault(){super.preventDefault();let{original:t}=ir(this);"preventDefault"in t&&t.preventDefault()}get timeStamp(){let{original:t}=ir(this);return"timeStamp"in t?t.timeStamp:super.timeStamp}},xo=new WeakMap;function ir(t){let e=xo.get(t);return oa(e!=null,"'this' is expected an Event object, but got",t),e}var Gn=new WeakMap;Gn.set(Object.prototype,Zn);typeof Kt<"u"&&typeof Kt.Event<"u"&&Gn.set(Kt.Event.prototype,Zn);function Do(t){let e=Object.getPrototypeOf(t);if(e==null)return Zn;let n=Gn.get(e);return n==null&&(n=Jc(Do(e),e),Gn.set(e,n)),n}function Jc(t,e){class n extends t{}let i=Object.keys(e);for(let r=0;r<i.length;++r)Object.defineProperty(n.prototype,i[r],Io(e,i[r]));return n}function Io(t,e){let n=Object.getOwnPropertyDescriptor(t,e);return{get(){let i=ir(this).original,r=i[e];return typeof r=="function"?r.bind(i):r},set(i){let r=ir(this).original;r[e]=i},configurable:n.configurable,enumerable:n.enumerable}}function qc(t,e,n,i,r,D){return{callback:t,flags:(e?1:0)|(n?2:0)|(i?4:0),signal:r,signalListener:D}}function ef(t){t.flags|=8}function Lo(t){return(t.flags&1)===1}function Ro(t){return(t.flags&2)===2}function Co(t){return(t.flags&4)===4}function tf(t){return(t.flags&8)===8}function rf({callback:t},e,n){try{typeof t=="function"?t.call(e,n):typeof t.handleEvent=="function"&&t.handleEvent(n)}catch(i){Gc(i)}}function Oo({listeners:t},e,n){for(let i=0;i<t.length;++i)if(t[i].callback===e&&Lo(t[i])===n)return i;return-1}function nf(t,e,n,i,r,D){let c;D&&(c=Mo.bind(null,t,e,n),D.addEventListener("abort",c));let p=qc(e,n,i,r,D,c);return t.cow?(t.cow=!1,t.listeners=[...t.listeners,p]):t.listeners.push(p),p}function Mo(t,e,n){let i=Oo(t,e,n);return i!==-1?Po(t,i):!1}function Po(t,e,n=!1){let i=t.listeners[e];return ef(i),i.signal&&i.signal.removeEventListener("abort",i.signalListener),t.cow&&!n?(t.cow=!1,t.listeners=t.listeners.filter((r,D)=>D!==e),!1):(t.listeners.splice(e,1),!0)}function af(){return Object.create(null)}function sf(t,e){var n;return(n=t[e])!==null&&n!==void 0?n:t[e]={attrCallback:void 0,attrListener:void 0,cow:!1,listeners:[]}}var Jn=class{constructor(){wo.set(this,af())}addEventListener(t,e,n){let i=Ei(this),{callback:r,capture:D,once:c,passive:p,signal:w,type:M}=of(t,e,n);if(r==null||(w==null?void 0:w.aborted))return;let O=sf(i,M),C=Oo(O,r,D);if(C!==-1){uf(O.listeners[C],p,c,w);return}nf(O,r,D,p,c,w)}removeEventListener(t,e,n){let i=Ei(this),{callback:r,capture:D,type:c}=lf(t,e,n),p=i[c];r!=null&&p&&Mo(p,r,D)}dispatchEvent(t){let e=Ei(this)[String(t.type)];if(e==null)return!0;let n=t instanceof er?t:Zn.wrap(t),i=Ve(n,"event");if(i.dispatchFlag)throw Zc("This event has been in dispatching.");if(i.dispatchFlag=!0,i.target=i.currentTarget=this,!i.stopPropagationFlag){let{cow:r,listeners:D}=e;e.cow=!0;for(let c=0;c<D.length;++c){let p=D[c];if(!tf(p)&&(Co(p)&&Po(e,c,!r)&&(c-=1),i.inPassiveListenerFlag=Ro(p),rf(p,this,n),i.inPassiveListenerFlag=!1,i.stopImmediatePropagationFlag))break}r||(e.cow=!1)}return i.target=null,i.currentTarget=null,i.stopImmediatePropagationFlag=!1,i.stopPropagationFlag=!1,i.dispatchFlag=!1,!i.canceledFlag}},wo=new WeakMap;function Ei(t,e="this"){let n=wo.get(t);return oa(n!=null,"'%s' must be an object that EventTarget constructor created, but got another one: %o",e,t),n}function of(t,e,n){var i;return ko(e),typeof n=="object"&&n!==null?{type:String(t),callback:e!=null?e:void 0,capture:Boolean(n.capture),passive:Boolean(n.passive),once:Boolean(n.once),signal:(i=n.signal)!==null&&i!==void 0?i:void 0}:{type:String(t),callback:e!=null?e:void 0,capture:Boolean(n),passive:!1,once:!1,signal:void 0}}function lf(t,e,n){return ko(e),typeof n=="object"&&n!==null?{type:String(t),callback:e!=null?e:void 0,capture:Boolean(n.capture)}:{type:String(t),callback:e!=null?e:void 0,capture:Boolean(n)}}function ko(t){if(!(typeof t=="function"||typeof t=="object"&&t!==null&&typeof t.handleEvent=="function")){if(t==null||typeof t=="object"){ka.warn(t);return}throw new TypeError(So(ka.message,[t]))}}function uf(t,e,n,i){Qc.warn(Lo(t)?"capture":"bubble",t.callback),Ro(t)!==e&&mi.warn("passive"),Co(t)!==n&&mi.warn("once"),t.signal!==i&&mi.warn("signal")}var yi=Object.getOwnPropertyNames(Jn.prototype);for(let t=0;t<yi.length;++t)yi[t]!=="constructor"&&Object.defineProperty(Jn.prototype,yi[t],{enumerable:!0});typeof Kt<"u"&&typeof Kt.EventTarget<"u"&&Object.setPrototypeOf(Jn.prototype,Kt.EventTarget.prototype);var df=Uc(jc()),cf=[200,201,202,204,308],ff=[408,502,503,504],hf=class{constructor(t){this.endpoint=t.endpoint,this.file=t.file,this.headers=t.headers||{},this.method=t.method||"PUT",this.chunkSize=t.chunkSize||30720,this.attempts=t.attempts||5,this.delayBeforeAttempt=t.delayBeforeAttempt||1,this.retryCodes=t.retryCodes||ff,this.dynamicChunkSize=t.dynamicChunkSize||!1,this.maxFileBytes=(t.maxFileSize||0)*1024,this.chunkCount=0,this.chunkByteSize=this.chunkSize*1024,this.totalChunks=Math.ceil(this.file.size/this.chunkByteSize),this.attemptCount=0,this.offline=!1,this.paused=!1,this.success=!1,this.nextChunkRangeStart=0,this.maxChunkSize=t.maxChunkSize||512e3,this.minChunkSize=t.minChunkSize||256,this.reader=new FileReader,this.eventTarget=new Jn,this.validateOptions(),this.getEndpoint().then(()=>this.sendChunks()),typeof window<"u"&&(window.addEventListener("online",()=>{!this.offline||(this.offline=!1,this.dispatch("online"),this.sendChunks())}),window.addEventListener("offline",()=>{this.offline=!0,this.dispatch("offline")}))}on(t,e){this.eventTarget.addEventListener(t,e)}abort(){var t;this.pause(),(t=this.currentXhr)==null||t.abort()}pause(){this.paused=!0}resume(){this.paused&&(this.paused=!1,this.sendChunks())}dispatch(t,e){let n=new CustomEvent(t,{detail:e});this.eventTarget.dispatchEvent(n)}validateOptions(){if(!this.endpoint||typeof this.endpoint!="function"&&typeof this.endpoint!="string")throw new TypeError("endpoint must be defined as a string or a function that returns a promise");if(!(this.file instanceof File))throw new TypeError("file must be a File object");if(this.headers&&typeof this.headers!="object")throw new TypeError("headers must be null or an object");if(this.chunkSize&&(typeof this.chunkSize!="number"||this.chunkSize<256||this.chunkSize%256!==0||this.chunkSize<this.minChunkSize||this.chunkSize>this.maxChunkSize))throw new TypeError(`chunkSize must be a positive number in multiples of 256, between ${this.minChunkSize} and ${this.maxChunkSize}`);if(this.maxChunkSize&&(typeof this.maxChunkSize!="number"||this.maxChunkSize<256||this.maxChunkSize%256!==0||this.maxChunkSize<this.chunkSize||this.maxChunkSize<this.minChunkSize))throw new TypeError(`maxChunkSize must be a positive number in multiples of 256, and larger than or equal to both ${this.minChunkSize} and ${this.chunkSize}`);if(this.minChunkSize&&(typeof this.minChunkSize!="number"||this.minChunkSize<256||this.minChunkSize%256!==0||this.minChunkSize>this.chunkSize||this.minChunkSize>this.maxChunkSize))throw new TypeError(`minChunkSize must be a positive number in multiples of 256, and smaller than ${this.chunkSize} and ${this.maxChunkSize}`);if(this.maxFileBytes>0&&this.maxFileBytes<this.file.size)throw new Error(`file size exceeds maximum (${this.file.size} > ${this.maxFileBytes})`);if(this.attempts&&(typeof this.attempts!="number"||this.attempts<=0))throw new TypeError("retries must be a positive number");if(this.delayBeforeAttempt&&(typeof this.delayBeforeAttempt!="number"||this.delayBeforeAttempt<0))throw new TypeError("delayBeforeAttempt must be a positive number")}getEndpoint(){return typeof this.endpoint=="string"?(this.endpointValue=this.endpoint,Promise.resolve(this.endpoint)):this.endpoint(this.file).then(t=>(this.endpointValue=t,this.endpointValue))}getChunk(){return new Promise(t=>{let e=this.totalChunks===1?this.file.size:this.chunkByteSize;this.reader.onload=()=>{this.reader.result!==null&&(this.chunk=new Blob([this.reader.result],{type:"application/octet-stream"})),t()},this.reader.readAsArrayBuffer(this.file.slice(this.nextChunkRangeStart,this.nextChunkRangeStart+e))})}xhrPromise(t){let e=n=>{n.upload.onprogress=i=>{var r;let D=this.totalChunks-this.chunkCount,c=(this.file.size-this.nextChunkRangeStart)/this.file.size/D,p=this.nextChunkRangeStart/this.file.size,w=i.loaded/((r=i.total)!=null?r:this.chunkByteSize)*c;this.dispatch("progress",Math.min((p+w)*100,100))}};return new Promise((n,i)=>{this.currentXhr=(0,df.default)({...t,beforeSend:e},(r,D)=>(this.currentXhr=void 0,r?i(r):n(D)))})}async sendChunk(){let t=this.nextChunkRangeStart,e=t+this.chunk.size-1,n={...this.headers,"Content-Type":this.file.type,"Content-Range":`bytes ${t}-${e}/${this.file.size}`};return this.dispatch("attempt",{chunkNumber:this.chunkCount,totalChunks:this.totalChunks,chunkSize:this.chunkSize}),this.xhrPromise({headers:n,url:this.endpointValue,method:this.method,body:this.chunk})}manageRetries(){if(this.attemptCount<this.attempts){setTimeout(()=>this.sendChunks(),this.delayBeforeAttempt*1e3),this.dispatch("attemptFailure",{message:`An error occured uploading chunk ${this.chunkCount}. ${this.attempts-this.attemptCount} retries left.`,chunkNumber:this.chunkCount,attemptsLeft:this.attempts-this.attemptCount});return}this.dispatch("error",{message:`An error occured uploading chunk ${this.chunkCount}. No more retries, stopping upload`,chunk:this.chunkCount,attempts:this.attemptCount})}sendChunks(){this.paused||this.offline||this.success||this.getChunk().then(()=>(this.attemptCount=this.attemptCount+1,this.lastChunkStart=new Date,this.sendChunk())).then(t=>{if(cf.includes(t.statusCode)){let e=(new Date().getTime()-this.lastChunkStart.getTime())/1e3;if(this.dispatch("chunkSuccess",{chunk:this.chunkCount,chunkSize:this.chunkSize,attempts:this.attemptCount,timeInterval:e,response:t}),this.attemptCount=0,this.chunkCount=this.chunkCount+1,this.nextChunkRangeStart=this.nextChunkRangeStart+this.chunkByteSize,this.chunkCount<this.totalChunks){if(this.dynamicChunkSize){e<10?this.chunkSize=Math.min(this.chunkSize*2,this.maxChunkSize):e>30&&(this.chunkSize=Math.max(this.chunkSize/2,this.minChunkSize)),this.chunkSize=Math.ceil(this.chunkSize/256)*256,this.chunkByteSize=this.chunkSize*1024;let n=(this.file.size-this.nextChunkRangeStart)/this.chunkByteSize;this.totalChunks=Math.ceil(this.chunkCount+n)}this.sendChunks()}else this.success=!0,this.dispatch("success")}else if(this.retryCodes.includes(t.statusCode)){if(this.paused||this.offline)return;this.manageRetries()}else{if(this.paused||this.offline)return;this.dispatch("error",{message:`Server responded with ${t.statusCode}. Stopping upload.`,chunkNumber:this.chunkCount,attempts:this.attemptCount})}}).catch(t=>{this.paused||this.offline||this.manageRetries()})}},vf=t=>new hf(t);function gf(t,e={}){return co([()=>{const n=new so(t,[0,1],e);return n.finished.catch(()=>{}),n}],e,e.duration)}function mf(t,e,n){return(Mr(t)?gf:nc)(t,e,n)}var Uo={exports:{}};/*!
 * mux-embed
 * @version 4.16.0
 * @copyright 2022 Mux, Inc
 */(function(t,e){(function(){var n;n=function(){return function(){var i={80:function(c,p,w){c.exports=w(728).default},728:function(c,p,w){w.d(p,{default:function(){return Uu}});var M=w(48),O=w.n(M),C=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(N){var U=16*Math.random()|0;return(N==="x"?U:3&U|8).toString(16)})},S=function(){return("000000"+(Math.random()*Math.pow(36,6)<<0).toString(36)).slice(-6)},b=function(N){return N&&N.nodeName!==void 0?(N.muxId||(N.muxId=N.id||S()),N.muxId):N},I=function(N){var U;N&&N.nodeName!==void 0?N=b(U=N):U=document.querySelector(N);var B=U&&U.nodeName?U.nodeName.toLowerCase():"";return[U,N,B]},L=w(640),_=w.n(L),x=_().methodFactory;_().methodFactory=function(N,U,B){var F=x(N,U,B);return function(){for(var G=["[mux]"],Q=0;Q<arguments.length;Q++)G.push(arguments[Q]);F.apply(void 0,G)}},_().setLevel(_().getLevel());var l=_();function a(){return(O().doNotTrack||O().navigator&&O().navigator.doNotTrack)==="1"}var d={now:function(){var N=O().performance,U=N&&N.timing,B=U&&U.navigationStart,F=typeof B=="number"&&typeof N.now=="function"?B+N.now():Date.now();return Math.round(F)}},y=w(678),E=w.n(y),u=function(N){return s(N)[0]},s=function(N){if(typeof N!="string"||N==="")return["localhost"];var U,B=(N.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/)||[])[4];return B&&(U=(B.match(/[^\.]+\.[^\.]+$/)||[])[0]),[B,U]},o={exists:function(){var N=O().performance;return(N&&N.timing)!==void 0},domContentLoadedEventEnd:function(){var N=O().performance,U=N&&N.timing;return U&&U.domContentLoadedEventEnd},navigationStart:function(){var N=O().performance,U=N&&N.timing;return U&&U.navigationStart}};function g(N,U,B){B=B===void 0?1:B,N[U]=N[U]||0,N[U]+=B}var f=["x-cdn","content-type","x-request-id"];function v(N){var U={};return(N=N||"").trim().split(/[\r\n]+/).forEach(function(B){if(B){var F=B.split(": "),G=F.shift();G&&(f.indexOf(G.toLowerCase())>=0||G.toLowerCase().indexOf("x-litix-")===0)&&(U[G]=F.join(": "))}}),U}var T=function(N){var U={};for(var B in N){var F=N[B];F["DATA-ID"].search("io.litix.data.")!==-1&&(U[F["DATA-ID"].replace("io.litix.data.","")]=F.VALUE)}return U};function m(N,U){var B=Object.keys(N);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(N);U&&(F=F.filter(function(G){return Object.getOwnPropertyDescriptor(N,G).enumerable})),B.push.apply(B,F)}return B}function h(N){for(var U=1;U<arguments.length;U++){var B=arguments[U]!=null?arguments[U]:{};U%2?m(Object(B),!0).forEach(function(F){A(N,F,B[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(B)):m(Object(B)).forEach(function(F){Object.defineProperty(N,F,Object.getOwnPropertyDescriptor(B,F))})}return N}function A(N,U,B){return U in N?Object.defineProperty(N,U,{value:B,enumerable:!0,configurable:!0,writable:!0}):N[U]=B,N}var R=function(N){if(!N)return{};var U=o.navigationStart(),B=N.loading,F=B?B.start:N.trequest,G=B?B.first:N.tfirst,Q=B?B.end:N.tload;return{bytesLoaded:N.total,requestStart:Math.round(U+F),responseStart:Math.round(U+G),responseEnd:Math.round(U+Q)}},P=function(N){if(N&&typeof N.getAllResponseHeaders=="function")return v(N.getAllResponseHeaders())};function k(N,U){var B=Object.keys(N);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(N);U&&(F=F.filter(function(G){return Object.getOwnPropertyDescriptor(N,G).enumerable})),B.push.apply(B,F)}return B}function j(N){for(var U=1;U<arguments.length;U++){var B=arguments[U]!=null?arguments[U]:{};U%2?k(Object(B),!0).forEach(function(F){K(N,F,B[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(B)):k(Object(B)).forEach(function(F){Object.defineProperty(N,F,Object.getOwnPropertyDescriptor(B,F))})}return N}function K(N,U,B){return U in N?Object.defineProperty(N,U,{value:B,enumerable:!0,configurable:!0,writable:!0}):N[U]=B,N}var W=function(N,U){if(!N||typeof N.getRequests!="function")return{};var B=N.getRequests({state:"executed"});if(B.length===0)return{};var F,G=B[B.length-1],Q=u(G.url),V=G.url,q=G.bytesLoaded,Z=new Date(G.requestStartDate).getTime(),ie=new Date(G.firstByteDate).getTime(),he=new Date(G.requestEndDate).getTime(),ye=isNaN(G.duration)?0:G.duration,Se=typeof U.getMetricsFor=="function"?U.getMetricsFor(G.mediaType).HttpList:U.getDashMetrics().getHttpRequests(G.mediaType);return Se.length>0&&(F=v(Se[Se.length-1]._responseHeaders||"")),{requestStart:Z,requestResponseStart:ie,requestResponseEnd:he,requestBytesLoaded:q,requestResponseHeaders:F,requestMediaDuration:ye,requestHostname:Q,requestUrl:V}},H=function(N,U){var B=U.getQualityFor(N),F=U.getCurrentTrackFor(N).bitrateList;return F?{currentLevel:B,renditionWidth:F[B].width||null,renditionHeight:F[B].height||null,renditionBitrate:F[B].bandwidth}:{}},$=function(N){var U;return(U=N.match(/.*codecs\*?="(.*)"/))===null||U===void 0?void 0:U[1]};function z(N,U){for(var B=0;B<U.length;B++){var F=U[B];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(N,F.key,F)}}var J=0,ee=function(){function N(){(function(F,G){if(!(F instanceof G))throw new TypeError("Cannot call a class as a function")})(this,N)}var U,B;return U=N,B=[{key:"on",value:function(F,G,Q){return G._eventEmitterGuid=G._eventEmitterGuid||++J,this._listeners=this._listeners||{},this._listeners[F]=this._listeners[F]||[],Q&&(G=G.bind(Q)),this._listeners[F].push(G),G}},{key:"off",value:function(F,G){var Q=this._listeners&&this._listeners[F];Q&&Q.forEach(function(V,q){V._eventEmitterGuid===G._eventEmitterGuid&&Q.splice(q,1)})}},{key:"one",value:function(F,G,Q){var V=this;G._eventEmitterGuid=G._eventEmitterGuid||++J;var q=function Z(){V.off(F,Z),G.apply(Q||this,arguments)};q._eventEmitterGuid=G._eventEmitterGuid,this.on(F,q)}},{key:"emit",value:function(F,G){var Q=this;if(this._listeners){G=G||{};var V=this._listeners["before*"]||[],q=this._listeners[F]||[],Z=this._listeners["after"+F]||[],ie=function(he,ye){(he=he.slice()).forEach(function(Se){Se.call(Q,{type:F},ye)})};ie(V,G),ie(q,G),ie(Z,G)}}}],B&&z(U.prototype,B),Object.defineProperty(U,"prototype",{writable:!1}),N}(),re=ee;function ne(N,U){for(var B=0;B<U.length;B++){var F=U[B];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(N,F.key,F)}}var ae=function(){function N(F){var G=this;(function(Q,V){if(!(Q instanceof V))throw new TypeError("Cannot call a class as a function")})(this,N),this.pm=F,this._playbackHeartbeatInterval=null,this._playheadShouldBeProgressing=!1,F.on("playing",function(){G._playheadShouldBeProgressing=!0}),F.on("play",this._startPlaybackHeartbeatInterval.bind(this)),F.on("playing",this._startPlaybackHeartbeatInterval.bind(this)),F.on("adbreakstart",this._startPlaybackHeartbeatInterval.bind(this)),F.on("adplay",this._startPlaybackHeartbeatInterval.bind(this)),F.on("adplaying",this._startPlaybackHeartbeatInterval.bind(this)),F.on("seeking",this._startPlaybackHeartbeatInterval.bind(this)),F.on("devicewake",this._startPlaybackHeartbeatInterval.bind(this)),F.on("viewstart",this._startPlaybackHeartbeatInterval.bind(this)),F.on("rebufferstart",this._startPlaybackHeartbeatInterval.bind(this)),F.on("pause",this._stopPlaybackHeartbeatInterval.bind(this)),F.on("ended",this._stopPlaybackHeartbeatInterval.bind(this)),F.on("viewend",this._stopPlaybackHeartbeatInterval.bind(this)),F.on("error",this._stopPlaybackHeartbeatInterval.bind(this)),F.on("aderror",this._stopPlaybackHeartbeatInterval.bind(this)),F.on("adpause",this._stopPlaybackHeartbeatInterval.bind(this)),F.on("adended",this._stopPlaybackHeartbeatInterval.bind(this)),F.on("adbreakend",this._stopPlaybackHeartbeatInterval.bind(this)),F.on("seeked",function(){F.data.player_is_paused?G._stopPlaybackHeartbeatInterval():G._startPlaybackHeartbeatInterval()}),F.on("timeupdate",function(){G._playbackHeartbeatInterval!==null&&F.emit("playbackheartbeat")}),F.on("devicesleep",function(Q,V){G._playbackHeartbeatInterval!==null&&(O().clearInterval(G._playbackHeartbeatInterval),F.emit("playbackheartbeatend",{viewer_time:V.viewer_time}),G._playbackHeartbeatInterval=null)})}var U,B;return U=N,(B=[{key:"_startPlaybackHeartbeatInterval",value:function(){var F=this;this._playbackHeartbeatInterval===null&&(this.pm.emit("playbackheartbeat"),this._playbackHeartbeatInterval=O().setInterval(function(){F.pm.emit("playbackheartbeat")},this.pm.playbackHeartbeatTime))}},{key:"_stopPlaybackHeartbeatInterval",value:function(){this._playheadShouldBeProgressing=!1,this._playbackHeartbeatInterval!==null&&(O().clearInterval(this._playbackHeartbeatInterval),this.pm.emit("playbackheartbeatend"),this._playbackHeartbeatInterval=null)}}])&&ne(U.prototype,B),Object.defineProperty(U,"prototype",{writable:!1}),N}();function ce(N,U){for(var B=0;B<U.length;B++){var F=U[B];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(N,F.key,F)}}function fe(N,U,B){return U&&ce(N.prototype,U),B&&ce(N,B),Object.defineProperty(N,"prototype",{writable:!1}),N}var se=fe(function N(U){var B=this;(function(F,G){if(!(F instanceof G))throw new TypeError("Cannot call a class as a function")})(this,N),U.on("viewinit",function(){B.viewErrored=!1}),U.on("error",function(){try{var F=U.errorTranslator({player_error_code:U.data.player_error_code,player_error_message:U.data.player_error_message});F?(U.data.player_error_code=F.player_error_code,U.data.player_error_message=F.player_error_message,B.viewErrored=!0):(delete U.data.player_error_code,delete U.data.player_error_message)}catch(G){U.mux.log.warn("Exception in error translator callback.",G),B.viewErrored=!0}})});function ve(N,U){for(var B=0;B<U.length;B++){var F=U[B];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(N,F.key,F)}}var le=function(){function N(F){(function(G,Q){if(!(G instanceof Q))throw new TypeError("Cannot call a class as a function")})(this,N),this.pm=F,this._watchTimeTrackerLastCheckedTime=null,F.on("playbackheartbeat",this._updateWatchTime.bind(this)),F.on("playbackheartbeatend",this._clearWatchTimeState.bind(this))}var U,B;return U=N,(B=[{key:"_updateWatchTime",value:function(F,G){var Q=G.viewer_time;this._watchTimeTrackerLastCheckedTime===null&&(this._watchTimeTrackerLastCheckedTime=Q),g(this.pm.data,"view_watch_time",Q-this._watchTimeTrackerLastCheckedTime),this._watchTimeTrackerLastCheckedTime=Q}},{key:"_clearWatchTimeState",value:function(F,G){this._updateWatchTime(F,G),this._watchTimeTrackerLastCheckedTime=null}}])&&ve(U.prototype,B),Object.defineProperty(U,"prototype",{writable:!1}),N}();function ue(N,U){for(var B=0;B<U.length;B++){var F=U[B];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(N,F.key,F)}}var Ce=function(){function N(F){(function(G,Q){if(!(G instanceof Q))throw new TypeError("Cannot call a class as a function")})(this,N),this.pm=F,this._playbackTimeTrackerLastPlayheadPosition=-1,F.on("playbackheartbeat",this._updatePlaybackTime.bind(this)),F.on("playbackheartbeatend",this._clearPlaybackTimeState.bind(this)),F.on("seeking",this._clearPlaybackTimeState.bind(this))}var U,B;return U=N,(B=[{key:"_updatePlaybackTime",value:function(){var F=this.pm.data.player_playhead_time;if(this._playbackTimeTrackerLastPlayheadPosition>=0&&F>this._playbackTimeTrackerLastPlayheadPosition){var G=F-this._playbackTimeTrackerLastPlayheadPosition;G<=1e3&&g(this.pm.data,"view_content_playback_time",G)}this._playbackTimeTrackerLastPlayheadPosition=F}},{key:"_clearPlaybackTimeState",value:function(){this._updatePlaybackTime(),this._playbackTimeTrackerLastPlayheadPosition=-1}}])&&ue(U.prototype,B),Object.defineProperty(U,"prototype",{writable:!1}),N}();function be(N,U){for(var B=0;B<U.length;B++){var F=U[B];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(N,F.key,F)}}var Le=function(){function N(F){(function(Q,V){if(!(Q instanceof V))throw new TypeError("Cannot call a class as a function")})(this,N),this.pm=F;var G=this._updatePlayheadTime.bind(this);F.on("playbackheartbeat",G),F.on("playbackheartbeatend",G),F.on("timeupdate",G),F.on("destroy",function(){F.off("timeupdate",G)})}var U,B;return U=N,(B=[{key:"_updateMaxPlayheadPosition",value:function(){this.pm.data.view_max_playhead_position=this.pm.data.view_max_playhead_position===void 0?this.pm.data.player_playhead_time:Math.max(this.pm.data.view_max_playhead_position,this.pm.data.player_playhead_time)}},{key:"_updatePlayheadTime",value:function(F,G){var Q=this,V=function(){Q.pm.currentFragmentPDT&&Q.pm.currentFragmentStart&&(Q.pm.data.player_program_time=Q.pm.currentFragmentPDT+Q.pm.data.player_playhead_time-Q.pm.currentFragmentStart)};if(G&&G.player_playhead_time)this.pm.data.player_playhead_time=G.player_playhead_time,V(),this._updateMaxPlayheadPosition();else if(this.pm.getPlayheadTime){var q=this.pm.getPlayheadTime();q!==void 0&&(this.pm.data.player_playhead_time=q,V(),this._updateMaxPlayheadPosition())}}}])&&be(U.prototype,B),Object.defineProperty(U,"prototype",{writable:!1}),N}();function Ue(N,U){for(var B=0;B<U.length;B++){var F=U[B];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(N,F.key,F)}}function we(N,U,B){return U&&Ue(N.prototype,U),B&&Ue(N,B),Object.defineProperty(N,"prototype",{writable:!1}),N}var Ke=we(function N(U){if(function(Q,V){if(!(Q instanceof V))throw new TypeError("Cannot call a class as a function")}(this,N),!U.disableRebufferTracking){var B,F=function(Q,V){G(V),B=void 0},G=function(Q){if(B){var V=Q.viewer_time-B;g(U.data,"view_rebuffer_duration",V),B=Q.viewer_time}U.data.view_watch_time>=0&&U.data.view_rebuffer_count>0&&(U.data.view_rebuffer_frequency=U.data.view_rebuffer_count/U.data.view_watch_time,U.data.view_rebuffer_percentage=U.data.view_rebuffer_duration/U.data.view_watch_time)};U.on("playbackheartbeat",function(Q,V){return G(V)}),U.on("rebufferstart",function(Q,V){B||(g(U.data,"view_rebuffer_count",1),B=V.viewer_time,U.one("rebufferend",F))}),U.on("viewinit",function(){B=void 0,U.off("rebufferend",F)})}});function ze(N,U){for(var B=0;B<U.length;B++){var F=U[B];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(N,F.key,F)}}var je=function(){function N(F){var G=this;(function(Q,V){if(!(Q instanceof V))throw new TypeError("Cannot call a class as a function")})(this,N),this.pm=F,F.disableRebufferTracking||F.disablePlayheadRebufferTracking||(this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null,F.on("playbackheartbeat",this._checkIfRebuffering.bind(this)),F.on("playbackheartbeatend",this._cleanupRebufferTracker.bind(this)),F.on("seeking",function(){G._cleanupRebufferTracker(null,{viewer_time:d.now()})}))}var U,B;return U=N,B=[{key:"_checkIfRebuffering",value:function(F,G){if(this.pm.seekingTracker.isSeeking||this.pm.adTracker.isAdBreak||!this.pm.playbackHeartbeat._playheadShouldBeProgressing)this._cleanupRebufferTracker(F,G);else if(this._lastCheckedTime!==null)if(this._lastPlayheadTime===this.pm.data.player_playhead_time){var Q=G.viewer_time-this._lastPlayheadTimeUpdatedTime;typeof this.pm.sustainedRebufferThreshold=="number"&&Q>=this.pm.sustainedRebufferThreshold&&(this._rebuffering||(this._rebuffering=!0,this.pm.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}))),this._lastCheckedTime=G.viewer_time}else this._cleanupRebufferTracker(F,G,!0);else this._prepareRebufferTrackerState(G.viewer_time)}},{key:"_clearRebufferTrackerState",value:function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null}},{key:"_prepareRebufferTrackerState",value:function(F){this._lastCheckedTime=F,this._lastPlayheadTime=this.pm.data.player_playhead_time,this._lastPlayheadTimeUpdatedTime=F}},{key:"_cleanupRebufferTracker",value:function(F,G){var Q=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(this._rebuffering)this._rebuffering=!1,this.pm.emit("rebufferend",{viewer_time:G.viewer_time});else{if(this._lastCheckedTime===null)return;var V=this.pm.data.player_playhead_time-this._lastPlayheadTime,q=G.viewer_time-this._lastPlayheadTimeUpdatedTime;typeof this.pm.minimumRebufferDuration=="number"&&V>0&&q-V>this.pm.minimumRebufferDuration&&(this.pm.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}),this.pm.emit("rebufferend",{viewer_time:this._lastPlayheadTimeUpdatedTime+q-V}))}Q?this._prepareRebufferTrackerState(G.viewer_time):this._clearRebufferTrackerState()}}],B&&ze(U.prototype,B),Object.defineProperty(U,"prototype",{writable:!1}),N}(),Qe=je;function ct(N,U){for(var B=0;B<U.length;B++){var F=U[B];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(N,F.key,F)}}var Et=function(){function N(F){var G=this;(function(Q,V){if(!(Q instanceof V))throw new TypeError("Cannot call a class as a function")})(this,N),this.pm=F,F.on("viewinit",function(){var Q=F.data,V=Q.view_id;if(!Q.view_program_changed){var q=function(Z,ie){var he=ie.viewer_time;Z.type==="playing"&&F.data.view_time_to_first_frame===void 0?G.calculateTimeToFirstFrame(he||d.now(),V):Z.type!=="adplaying"||F.data.view_time_to_first_frame!==void 0&&!G._inPrerollPosition()||G.calculateTimeToFirstFrame(he||d.now(),V)};F.one("playing",q),F.one("adplaying",q),F.one("viewend",function(){F.off("playing",q),F.off("adplaying",q)})}})}var U,B;return U=N,(B=[{key:"_inPrerollPosition",value:function(){return this.pm.data.view_content_playback_time===void 0||this.pm.data.view_content_playback_time<=1e3}},{key:"calculateTimeToFirstFrame",value:function(F,G){G===this.pm.data.view_id&&(this.pm.watchTimeTracker._updateWatchTime(null,{viewer_time:F}),this.pm.data.view_time_to_first_frame=this.pm.data.view_watch_time,(this.pm.data.player_autoplay_on||this.pm.data.video_is_autoplay)&&this.NAVIGATION_START&&(this.pm.data.view_aggregate_startup_time=this.pm.data.view_start+this.pm.data.view_watch_time-this.NAVIGATION_START))}}])&&ct(U.prototype,B),Object.defineProperty(U,"prototype",{writable:!1}),N}();function ot(N,U){for(var B=0;B<U.length;B++){var F=U[B];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(N,F.key,F)}}function lt(N,U,B){return U&&ot(N.prototype,U),B&&ot(N,B),Object.defineProperty(N,"prototype",{writable:!1}),N}var yt=lt(function N(U){var B=this;(function(F,G){if(!(F instanceof G))throw new TypeError("Cannot call a class as a function")})(this,N),U.on("viewinit",function(){B._lastPlayheadPosition=-1}),["pause","rebufferstart","seeking","error","adbreakstart","hb"].forEach(function(F){U.on(F,function(){if(B._lastPlayheadPosition>=0&&U.data.player_playhead_time>=0&&B._lastPlayerWidth>=0&&B._lastSourceWidth>0&&B._lastPlayerHeight>=0&&B._lastSourceHeight>0){var G=U.data.player_playhead_time-B._lastPlayheadPosition;if(G<0)return void(B._lastPlayheadPosition=-1);var Q=Math.min(B._lastPlayerWidth/B._lastSourceWidth,B._lastPlayerHeight/B._lastSourceHeight),V=Math.max(0,Q-1),q=Math.max(0,1-Q);U.data.view_max_upscale_percentage=Math.max(U.data.view_max_upscale_percentage||0,V),U.data.view_max_downscale_percentage=Math.max(U.data.view_max_downscale_percentage||0,q),g(U.data,"view_total_content_playback_time",G),g(U.data,"view_total_upscaling",V*G),g(U.data,"view_total_downscaling",q*G)}B._lastPlayheadPosition=-1})}),["playing","hb"].forEach(function(F){U.on(F,function(){B._lastPlayheadPosition=U.data.player_playhead_time,B._lastPlayerWidth=U.data.player_width,B._lastPlayerHeight=U.data.player_height,B._lastSourceWidth=U.data.video_source_width,B._lastSourceHeight=U.data.video_source_height})})});function ut(N,U){for(var B=0;B<U.length;B++){var F=U[B];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(N,F.key,F)}}function kt(N,U,B){return U&&ut(N.prototype,U),B&&ut(N,B),Object.defineProperty(N,"prototype",{writable:!1}),N}var Be=kt(function N(U){var B=this;(function(F,G){if(!(F instanceof G))throw new TypeError("Cannot call a class as a function")})(this,N),this.isSeeking=!1,U.on("seeking",function(F,G){E()(U.data,G),B._lastSeekingTime=d.now(),B.isSeeking===!1&&(B.isSeeking=!0,U.send("seeking"))}),U.on("seeked",function(){B.isSeeking=!1;var F=B._lastSeekingTime||d.now(),G=d.now()-F;g(U.data,"view_seek_count",1),g(U.data,"view_seek_duration",G);var Q=U.data.view_max_seek_time||0;U.data.view_max_seek_time=Math.max(Q,G)}),U.on("viewend",function(){B.isSeeking=!1})});function We(N,U){return function(B){if(Array.isArray(B))return B}(N)||function(B,F){var G=B==null?null:typeof Symbol<"u"&&B[Symbol.iterator]||B["@@iterator"];if(G!=null){var Q,V,q=[],Z=!0,ie=!1;try{for(G=G.call(B);!(Z=(Q=G.next()).done)&&(q.push(Q.value),!F||q.length!==F);Z=!0);}catch(he){ie=!0,V=he}finally{try{Z||G.return==null||G.return()}finally{if(ie)throw V}}return q}}(N,U)||function(B,F){if(B){if(typeof B=="string")return ft(B,F);var G=Object.prototype.toString.call(B).slice(8,-1);return G==="Object"&&B.constructor&&(G=B.constructor.name),G==="Map"||G==="Set"?Array.from(B):G==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(G)?ft(B,F):void 0}}(N,U)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function ft(N,U){(U==null||U>N.length)&&(U=N.length);for(var B=0,F=new Array(U);B<U;B++)F[B]=N[B];return F}function Fe(N,U){for(var B=0;B<U.length;B++){var F=U[B];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(N,F.key,F)}}var Ge=function(N,U){N.push(U),N.sort(function(B,F){return B.viewer_time-F.viewer_time})},ht=["adbreakstart","adrequest","adresponse","adplay","adplaying","adpause","adended","adbreakend","aderror"],Ut=function(){function N(F){var G=this;(function(V,q){if(!(V instanceof q))throw new TypeError("Cannot call a class as a function")})(this,N),this.pm=F,F.on("viewinit",function(){G.isAdBreak=!1,G._currentAdRequestNumber=0,G._currentAdResponseNumber=0,G._adRequests=[],G._adResponses=[],G._adHasPlayed=!1,G._wouldBeNewAdPlay=!0,G._prerollPlayTime=void 0}),ht.forEach(function(V){return F.on(V,G._updateAdData.bind(G))});var Q=function(){G.isAdBreak=!1};F.on("adbreakstart",function(){G.isAdBreak=!0}),F.on("play",Q),F.on("playing",Q),F.on("viewend",Q),F.on("adrequest",function(V,q){q=E()({ad_request_id:"generatedAdRequestId"+G._currentAdRequestNumber++},q),Ge(G._adRequests,q),g(F.data,"view_ad_request_count"),G.inPrerollPosition()&&(F.data.view_preroll_requested=!0,G._adHasPlayed||g(F.data,"view_preroll_request_count"))}),F.on("adresponse",function(V,q){q=E()({ad_request_id:"generatedAdRequestId"+G._currentAdResponseNumber++},q),Ge(G._adResponses,q);var Z=G.findAdRequest(q.ad_request_id);Z&&g(F.data,"view_ad_request_time",Math.max(0,q.viewer_time-Z.viewer_time))}),F.on("adplay",function(V,q){G._adHasPlayed=!0,G._wouldBeNewAdPlay&&(G._wouldBeNewAdPlay=!1,g(F.data,"view_ad_played_count")),G.inPrerollPosition()&&!F.data.view_preroll_played&&(F.data.view_preroll_played=!0,G._adRequests.length>0&&(F.data.view_preroll_request_time=Math.max(0,q.viewer_time-G._adRequests[0].viewer_time)),F.data.view_start&&(F.data.view_startup_preroll_request_time=Math.max(0,q.viewer_time-F.data.view_start)),G._prerollPlayTime=q.viewer_time)}),F.on("adplaying",function(V,q){G.inPrerollPosition()&&F.data.view_preroll_load_time===void 0&&G._prerollPlayTime!==void 0&&(F.data.view_preroll_load_time=q.viewer_time-G._prerollPlayTime,F.data.view_startup_preroll_load_time=q.viewer_time-G._prerollPlayTime)}),F.on("adended",function(){G._wouldBeNewAdPlay=!0}),F.on("aderror",function(){G._wouldBeNewAdPlay=!0})}var U,B;return U=N,(B=[{key:"inPrerollPosition",value:function(){return this.pm.data.view_content_playback_time===void 0||this.pm.data.view_content_playback_time<=1e3}},{key:"findAdRequest",value:function(F){for(var G=0;G<this._adRequests.length;G++)if(this._adRequests[G].ad_request_id===F)return this._adRequests[G]}},{key:"_updateAdData",value:function(F,G){if(this.inPrerollPosition()){if(!this.pm.data.view_preroll_ad_tag_hostname&&G.ad_tag_url){var Q=We(s(G.ad_tag_url),2),V=Q[0],q=Q[1];this.pm.data.view_preroll_ad_tag_domain=q,this.pm.data.view_preroll_ad_tag_hostname=V}if(!this.pm.data.view_preroll_ad_asset_hostname&&G.ad_asset_url){var Z=We(s(G.ad_asset_url),2),ie=Z[0],he=Z[1];this.pm.data.view_preroll_ad_asset_domain=he,this.pm.data.view_preroll_ad_asset_hostname=ie}}}}])&&Fe(U.prototype,B),Object.defineProperty(U,"prototype",{writable:!1}),N}();function Wt(N,U){for(var B=0;B<U.length;B++){var F=U[B];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(N,F.key,F)}}function tr(N,U,B){return U&&Wt(N.prototype,U),B&&Wt(N,B),Object.defineProperty(N,"prototype",{writable:!1}),N}var Ct=tr(function N(U){var B,F;(function(q,Z){if(!(q instanceof Z))throw new TypeError("Cannot call a class as a function")})(this,N);var G=function(){U.disableRebufferTracking||B&&(g(U.data,"view_waiting_rebuffer_duration",d.now()-B),B=!1,O().clearInterval(F))},Q=!1,V=function(){Q=!1,G()};U.on("waiting",function(){Q&&(U.disableRebufferTracking||(g(U.data,"view_waiting_rebuffer_count",1),B=d.now(),F=O().setInterval(function(){if(B){var q=d.now();g(U.data,"view_waiting_rebuffer_duration",q-B),B=q}},250)))}),U.on("playing",function(){G(),Q=!0}),U.on("pause",V),U.on("seeking",V)});function pr(N,U){for(var B=0;B<U.length;B++){var F=U[B];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(N,F.key,F)}}function Qt(N,U,B){return U&&pr(N.prototype,U),B&&pr(N,B),Object.defineProperty(N,"prototype",{writable:!1}),N}var Ft=Qt(function N(U){var B=this;(function(Q,V){if(!(Q instanceof V))throw new TypeError("Cannot call a class as a function")})(this,N);var F=function(){B.lastWallClockTime=d.now(),U.on("before*",G)},G=function(Q){var V=d.now(),q=B.lastWallClockTime;B.lastWallClockTime=V,V-q>3e4&&(U.emit("devicesleep",{viewer_time:q}),E()(U.data,{viewer_time:q}),U.send("devicesleep"),U.emit("devicewake",{viewer_time:V}),E()(U.data,{viewer_time:V}),U.send("devicewake"))};U.one("playbackheartbeat",F),U.on("playbackheartbeatend",function(){U.off("before*",G),U.one("playbackheartbeat",F)})}),Zt=w(375),Jt=w(655),fr=w.n(Jt),Er="muxData",hn=function(){var N;try{N=Zt.parse(fr().get(Er)||"")}catch{N={}}return N},Ur=function(N){try{fr().set(Er,Zt.stringify(N),{expires:7300})}catch{}},Fr=function(){var N=hn();return N.mux_viewer_id=N.mux_viewer_id||C(),N.msn=N.msn||Math.random(),Ur(N),{mux_viewer_id:N.mux_viewer_id,mux_sample_number:N.msn}};function Dt(N,U){var B=U.beaconCollectionDomain,F=U.beaconDomain;if(B)return"https://"+B;var G=F||"litix.io";return(N=N||"inferred").match(/^[a-z0-9]+$/)?"https://"+N+"."+G:"https://img.litix.io/a.gif"}var Br=function(){var N;switch(Nr()){case"cellular":N="cellular";break;case"ethernet":N="wired";break;case"wifi":N="wifi";break;case void 0:break;default:N="other"}return N},Nr=function(){var N=O().navigator,U=N&&(N.connection||N.mozConnection||N.webkitConnection);return U&&U.type};Br.getConnectionFromAPI=Nr;var ti=Br,ri=gn({a:"env",b:"beacon",c:"custom",d:"ad",e:"event",f:"experiment",i:"internal",m:"mux",n:"response",p:"player",q:"request",r:"retry",s:"session",t:"timestamp",u:"viewer",v:"video",w:"page",x:"view",y:"sub"}),vn=gn({ad:"ad",ag:"aggregate",ap:"api",al:"application",ar:"architecture",as:"asset",au:"autoplay",av:"average",bi:"bitrate",br:"break",bw:"browser",by:"bytes",ca:"cached",cb:"cancel",cc:"codec",cd:"code",cg:"category",ch:"changed",cn:"config",co:"count",ce:"counter",cp:"complete",cr:"creative",ct:"content",cu:"current",cx:"connection",cz:"context",dg:"downscaling",dm:"domain",dn:"cdn",do:"downscale",dr:"drm",dp:"dropped",du:"duration",dv:"device",ec:"encoding",ed:"edge",en:"end",eg:"engine",em:"embed",er:"error",es:"errorcode",et:"errortext",ee:"event",ev:"events",ex:"expires",ep:"experiments",fi:"first",fm:"family",ft:"format",fp:"fps",fq:"frequency",fr:"frame",fs:"fullscreen",hb:"holdback",he:"headers",ho:"host",hn:"hostname",ht:"height",id:"id",ii:"init",in:"instance",ip:"ip",is:"is",ke:"key",la:"language",lb:"labeled",le:"level",li:"live",ld:"loaded",lo:"load",ls:"lists",lt:"latency",ma:"max",md:"media",me:"message",mf:"manifest",mi:"mime",ml:"midroll",mm:"min",mn:"manufacturer",mo:"model",mx:"mux",ne:"newest",nm:"name",no:"number",on:"on",os:"os",pa:"paused",pb:"playback",pd:"producer",pe:"percentage",pf:"played",pg:"program",ph:"playhead",pi:"plugin",pl:"preroll",pn:"playing",po:"poster",pr:"preload",ps:"position",pt:"part",py:"property",ra:"rate",rd:"requested",re:"rebuffer",rf:"rendition",rm:"remote",ro:"ratio",rp:"response",rq:"request",rs:"requests",sa:"sample",se:"session",sk:"seek",sm:"stream",so:"source",sq:"sequence",sr:"series",st:"start",su:"startup",sv:"server",sw:"software",ta:"tag",tc:"tech",te:"text",tg:"target",th:"throughput",ti:"time",tl:"total",to:"to",tt:"title",ty:"type",ug:"upscaling",up:"upscale",ur:"url",us:"user",va:"variant",vd:"viewed",vi:"video",ve:"version",vw:"view",vr:"viewer",wd:"width",wa:"watch",wt:"waiting"});function gn(N){var U={};for(var B in N)N.hasOwnProperty(B)&&(U[N[B]]=B);return U}function Kr(N){var U={},B={};return Object.keys(N).forEach(function(F){var G=!1;if(N.hasOwnProperty(F)&&N[F]!==void 0){var Q=F.split("_"),V=Q[0],q=ri[V];q||(l.info("Data key word `"+Q[0]+"` not expected in "+F),q=V+"_"),Q.splice(1).forEach(function(Z){Z==="url"&&(G=!0),vn[Z]?q+=vn[Z]:Number(Z)&&Math.floor(Number(Z))===Number(Z)?q+=Z:(l.info("Data key word `"+Z+"` not expected in "+F),q+="_"+Z+"_")}),G?B[q]=N[F]:U[q]=N[F]}}),E()(U,B)}var jr={maxBeaconSize:300,maxQueueLength:3600,baseTimeBetweenBeacons:1e4,maxPayloadKBSize:500},mn=["hb","requestcompleted","requestfailed","requestcanceled"],ni="https://img.litix.io",Bt=function(N){var U=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._beaconUrl=N||ni,this._eventQueue=[],this._postInFlight=!1,this._failureCount=0,this._sendTimeout=!1,this._options=E()({},jr,U)};Bt.prototype.queueEvent=function(N,U){var B=E()({},U);return(this._eventQueue.length<=this._options.maxQueueLength||N==="eventrateexceeded")&&(this._eventQueue.push(B),this._sendTimeout||this._startBeaconSending(),this._eventQueue.length<=this._options.maxQueueLength)},Bt.prototype.flushEvents=function(){var N=arguments.length>0&&arguments[0]!==void 0&&arguments[0];N&&this._eventQueue.length===1?this._eventQueue.pop():(this._eventQueue.length&&this._sendBeaconQueue(),this._startBeaconSending())},Bt.prototype.destroy=function(){var N=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.destroyed=!0,N?this._clearBeaconQueue():this.flushEvents(),O().clearTimeout(this._sendTimeout)},Bt.prototype._clearBeaconQueue=function(){var N=this._eventQueue.length>this._options.maxBeaconSize?this._eventQueue.length-this._options.maxBeaconSize:0,U=this._eventQueue.slice(N);N>0&&E()(U[U.length-1],Kr({mux_view_message:"event queue truncated"}));var B=this._createPayload(U);ca(this._beaconUrl,B,!0,function(){})},Bt.prototype._sendBeaconQueue=function(){var N=this;if(!this._postInFlight){var U=this._eventQueue.slice(0,this._options.maxBeaconSize);this._eventQueue=this._eventQueue.slice(this._options.maxBeaconSize),this._postInFlight=!0;var B=this._createPayload(U),F=d.now();ca(this._beaconUrl,B,!1,function(G,Q){Q?(N._eventQueue=U.concat(N._eventQueue),N._failureCount+=1,l.info("Error sending beacon: "+Q)):N._failureCount=0,N._roundTripTime=d.now()-F,N._postInFlight=!1})}},Bt.prototype._getNextBeaconTime=function(){if(!this._failureCount)return this._options.baseTimeBetweenBeacons;var N=Math.pow(2,this._failureCount-1);return(1+(N*=Math.random()))*this._options.baseTimeBetweenBeacons},Bt.prototype._startBeaconSending=function(){var N=this;O().clearTimeout(this._sendTimeout),this.destroyed||(this._sendTimeout=O().setTimeout(function(){N._eventQueue.length&&N._sendBeaconQueue(),N._startBeaconSending()},this._getNextBeaconTime()))},Bt.prototype._createPayload=function(N){var U,B,F,G=this,Q={transmission_timestamp:Math.round(d.now())};this._roundTripTime&&(Q.rtt_ms=Math.round(this._roundTripTime));var V=function(){U=JSON.stringify({metadata:Q,events:B||N}),F=U.length/1024},q=function(){return F<=G._options.maxPayloadKBSize};return V(),q()||(l.info("Payload size is too big ("+F+" kb). Removing unnecessary events."),B=N.filter(function(Z){return mn.indexOf(Z.e)===-1}),V()),q()||(l.info("Payload size still too big ("+F+" kb). Cropping fields.."),B.forEach(function(Z){for(var ie in Z){var he=Z[ie];typeof he=="string"&&he.length>51200&&(Z[ie]=he.substring(0,51200))}}),V()),U};var ca=function(N,U,B,F){if(B&&navigator&&navigator.sendBeacon&&navigator.sendBeacon(N,U))F();else if(O().fetch)O().fetch(N,{method:"POST",body:U,headers:{"Content-Type":"text/plain"},keepalive:!0}).then(function(Q){return F(null,Q.ok?null:"Error")}).catch(function(Q){return F(null,Q)});else{if(O().XMLHttpRequest){var G=new(O()).XMLHttpRequest;return G.onreadystatechange=function(){if(G.readyState===4)return F(null,G.status!==200?"error":void 0)},G.open("POST",N),G.setRequestHeader("Content-Type","text/plain"),void G.send(U)}F()}},Jl=Bt;function ql(N,U){return function(B){if(Array.isArray(B))return B}(N)||function(B,F){var G=B==null?null:typeof Symbol<"u"&&B[Symbol.iterator]||B["@@iterator"];if(G!=null){var Q,V,q=[],Z=!0,ie=!1;try{for(G=G.call(B);!(Z=(Q=G.next()).done)&&(q.push(Q.value),!F||q.length!==F);Z=!0);}catch(he){ie=!0,V=he}finally{try{Z||G.return==null||G.return()}finally{if(ie)throw V}}return q}}(N,U)||function(B,F){if(B){if(typeof B=="string")return fa(B,F);var G=Object.prototype.toString.call(B).slice(8,-1);return G==="Object"&&B.constructor&&(G=B.constructor.name),G==="Map"||G==="Set"?Array.from(B):G==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(G)?fa(B,F):void 0}}(N,U)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function fa(N,U){(U==null||U>N.length)&&(U=N.length);for(var B=0,F=new Array(U);B<U;B++)F[B]=N[B];return F}function ha(N,U){var B=Object.keys(N);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(N);U&&(F=F.filter(function(G){return Object.getOwnPropertyDescriptor(N,G).enumerable})),B.push.apply(B,F)}return B}function yr(N){for(var U=1;U<arguments.length;U++){var B=arguments[U]!=null?arguments[U]:{};U%2?ha(Object(B),!0).forEach(function(F){pn(N,F,B[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(B)):ha(Object(B)).forEach(function(F){Object.defineProperty(N,F,Object.getOwnPropertyDescriptor(B,F))})}return N}function Wr(N){return Wr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(U){return typeof U}:function(U){return U&&typeof Symbol=="function"&&U.constructor===Symbol&&U!==Symbol.prototype?"symbol":typeof U},Wr(N)}function eu(N,U){if(!(N instanceof U))throw new TypeError("Cannot call a class as a function")}function tu(N,U){for(var B=0;B<U.length;B++){var F=U[B];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(N,F.key,F)}}function pn(N,U,B){return U in N?Object.defineProperty(N,U,{value:B,enumerable:!0,configurable:!0,writable:!0}):N[U]=B,N}var ru=["env_key","view_id","view_sequence_number","player_sequence_number","beacon_domain","player_playhead_time","viewer_time","mux_api_version","event","video_id","player_instance_id"],nu=["viewstart","error","ended","viewend"],iu=function(){function N(F,G){var Q,V,q,Z,ie,he,ye,Se,oe,Te,_e,it,Je,at,Ie,qe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};eu(this,N),pn(this,"previousBeaconData",null),pn(this,"lastEventTime",0),pn(this,"rateLimited",!1),this.mux=F,this.envKey=G,this.options=qe,this.eventQueue=new Jl(Dt(this.envKey,this.options)),this.sampleRate=(Q=this.options.sampleRate)!==null&&Q!==void 0?Q:1,this.disableCookies=(V=this.options.disableCookies)!==null&&V!==void 0&&V,this.respectDoNotTrack=(q=this.options.respectDoNotTrack)!==null&&q!==void 0&&q,this.previousBeaconData=null,this.lastEventTime=0,this.rateLimited=!1,this.pageLevelData={mux_api_version:this.mux.API_VERSION,mux_embed:this.mux.NAME,mux_embed_version:this.mux.VERSION,viewer_application_name:(Z=this.options.platform)===null||Z===void 0?void 0:Z.name,viewer_application_version:(ie=this.options.platform)===null||ie===void 0?void 0:ie.version,viewer_application_engine:(he=this.options.platform)===null||he===void 0?void 0:he.layout,viewer_device_name:(ye=this.options.platform)===null||ye===void 0?void 0:ye.product,viewer_device_category:"",viewer_device_manufacturer:(Se=this.options.platform)===null||Se===void 0?void 0:Se.manufacturer,viewer_os_family:(oe=this.options.platform)===null||oe===void 0||(Te=oe.os)===null||Te===void 0?void 0:Te.family,viewer_os_architecture:(_e=this.options.platform)===null||_e===void 0||(it=_e.os)===null||it===void 0?void 0:it.architecture,viewer_os_version:(Je=this.options.platform)===null||Je===void 0||(at=Je.os)===null||at===void 0?void 0:at.version,viewer_connection_type:ti(),page_url:O()===null||O()===void 0||(Ie=O().location)===null||Ie===void 0?void 0:Ie.href},this.viewerData=this.disableCookies?{}:Fr()}var U,B;return U=N,(B=[{key:"send",value:function(F,G){var Q;if(F){if(this.respectDoNotTrack&&a())return l.info("Not sending `"+F+"` because Do Not Track is enabled");if(!G||Wr(G)!=="object")return l.error("A data object was expected in send() but was not provided");var V,q,Z=this.disableCookies?{}:(V=hn(),q=d.now(),V.session_start&&(V.sst=V.session_start,delete V.session_start),V.session_id&&(V.sid=V.session_id,delete V.session_id),V.session_expires&&(V.sex=V.session_expires,delete V.session_expires),(!V.sex||V.sex<q)&&(V.sid=C(),V.sst=q),V.sex=q+15e5,Ur(V),{session_id:V.sid,session_start:V.sst,session_expires:V.sex}),ie=yr(yr(yr(yr(yr({},this.pageLevelData),G),Z),this.viewerData),{},{event:F,env_key:this.envKey});ie.user_id&&(ie.viewer_user_id=ie.user_id,delete ie.user_id);var he=((Q=ie.mux_sample_number)!==null&&Q!==void 0?Q:0)>=this.sampleRate,ye=Kr(this._deduplicateBeaconData(F,ie));if(this.lastEventTime=this.mux.utils.now(),he)return l.info("Not sending event due to sample rate restriction",F,ie,ye);if(this.envKey||l.info("Missing environment key (envKey) - beacons will be dropped if the video source is not a valid mux video URL",F,ie,ye),!this.rateLimited){if(l.info("Sending event",F,ie,ye),this.rateLimited=!this.eventQueue.queueEvent(F,ye),this.mux.WINDOW_UNLOADING&&F==="viewend")this.eventQueue.destroy(!0);else if(this.mux.WINDOW_HIDDEN&&F==="hb"?this.eventQueue.flushEvents(!0):nu.indexOf(F)>=0&&this.eventQueue.flushEvents(),this.rateLimited)return ie.event="eventrateexceeded",ye=Kr(ie),this.eventQueue.queueEvent(ie.event,ye),l.error("Beaconing disabled due to rate limit.")}}}},{key:"destroy",value:function(){this.eventQueue.destroy(!1)}},{key:"_deduplicateBeaconData",value:function(F,G){var Q=this,V={},q=G.view_id;if(!q||F==="viewstart"||F==="viewend"||!this.previousBeaconData||this.mux.utils.now()-this.lastEventTime>=6e5)V=yr({},G),q&&(this.previousBeaconData=V),q&&F==="viewend"&&(this.previousBeaconData=null);else{var Z=F.indexOf("request")===0;Object.entries(G).forEach(function(ie){var he=ql(ie,2),ye=he[0],Se=he[1];Q.previousBeaconData&&(Se!==Q.previousBeaconData[ye]||ru.indexOf(ye)>-1||Q.objectHasChanged(Z,ye,Se,Q.previousBeaconData[ye])||Q.eventRequiresKey(F,ye))&&(V[ye]=Se,Q.previousBeaconData[ye]=Se)})}return V}},{key:"objectHasChanged",value:function(F,G,Q,V){return!(!F||G.indexOf("request_")!==0||G!=="request_response_headers"&&Wr(Q)==="object"&&Wr(V)==="object"&&Object.keys(Q||{}).length===Object.keys(V||{}).length)}},{key:"eventRequiresKey",value:function(F,G){return F==="renditionchange"&&G.indexOf("video_source_")===0}}])&&tu(U.prototype,B),Object.defineProperty(U,"prototype",{writable:!1}),N}();function va(N,U){for(var B=0;B<U.length;B++){var F=U[B];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(N,F.key,F)}}function au(N,U,B){return U&&va(N.prototype,U),B&&va(N,B),Object.defineProperty(N,"prototype",{writable:!1}),N}var su=au(function N(U){(function(ie,he){if(!(ie instanceof he))throw new TypeError("Cannot call a class as a function")})(this,N);var B=0,F=0,G=0,Q=0,V=0,q=0,Z=0;U.on("requestcompleted",function(ie,he){var ye,Se,oe=he.request_start,Te=he.request_response_start,_e=he.request_response_end,it=he.request_bytes_loaded;if(Q++,Te?(ye=Te-oe,Se=_e-Te):Se=_e-oe,Se>0&&it>0){var Je=it/Se*8e3;V++,F+=it,G+=Se,U.data.view_min_request_throughput=Math.min(U.data.view_min_request_throughput||1/0,Je),U.data.view_average_request_throughput=F/G*8e3,U.data.view_request_count=Q,ye>0&&(B+=ye,U.data.view_max_request_latency=Math.max(U.data.view_max_request_latency||0,ye),U.data.view_average_request_latency=B/V)}}),U.on("requestfailed",function(ie,he){Q++,q++,U.data.view_request_count=Q,U.data.view_request_failed_count=q}),U.on("requestcanceled",function(ie,he){Q++,Z++,U.data.view_request_count=Q,U.data.view_request_canceled_count=Z})});function ga(N,U){for(var B=0;B<U.length;B++){var F=U[B];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(N,F.key,F)}}function ou(N,U,B){return U&&ga(N.prototype,U),B&&ga(N,B),Object.defineProperty(N,"prototype",{writable:!1}),N}var lu=ou(function N(U){var B=this;(function(F,G){if(!(F instanceof G))throw new TypeError("Cannot call a class as a function")})(this,N),U.on("before*",function(F,G){var Q=G.viewer_time,V=d.now(),q=B._lastEventTime;if(B._lastEventTime=V,q&&V-q>36e5){var Z=Object.keys(U.data).reduce(function(ie,he){return he.indexOf("video_")===0?E()(ie,function(ye,Se,oe){return Se in ye?Object.defineProperty(ye,Se,{value:oe,enumerable:!0,configurable:!0,writable:!0}):ye[Se]=oe,ye}({},he,U.data[he])):ie},{});U.mux.log.info("Received event after at least an hour inactivity, creating a new view"),U.emit("viewinit",E()({viewer_time:Q},Z)),U.playbackHeartbeat._playheadShouldBeProgressing&&F.type!=="play"&&F.type!=="adbreakstart"&&(U.emit("play",{viewer_time:Q}),F.type!=="playing"&&U.emit("playing",{viewer_time:Q}))}})});function ii(N){return ii=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(U){return typeof U}:function(U){return U&&typeof Symbol=="function"&&U.constructor===Symbol&&U!==Symbol.prototype?"symbol":typeof U},ii(N)}function uu(N,U){return function(B){if(Array.isArray(B))return B}(N)||function(B,F){var G=B==null?null:typeof Symbol<"u"&&B[Symbol.iterator]||B["@@iterator"];if(G!=null){var Q,V,q=[],Z=!0,ie=!1;try{for(G=G.call(B);!(Z=(Q=G.next()).done)&&(q.push(Q.value),!F||q.length!==F);Z=!0);}catch(he){ie=!0,V=he}finally{try{Z||G.return==null||G.return()}finally{if(ie)throw V}}return q}}(N,U)||function(B,F){if(B){if(typeof B=="string")return ma(B,F);var G=Object.prototype.toString.call(B).slice(8,-1);return G==="Object"&&B.constructor&&(G=B.constructor.name),G==="Map"||G==="Set"?Array.from(B):G==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(G)?ma(B,F):void 0}}(N,U)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function ma(N,U){(U==null||U>N.length)&&(U=N.length);for(var B=0,F=new Array(U);B<U;B++)F[B]=N[B];return F}function du(N,U){for(var B=0;B<U.length;B++){var F=U[B];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(N,F.key,F)}}function ai(N,U){return ai=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(B,F){return B.__proto__=F,B},ai(N,U)}function cu(N){var U=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var B,F=En(N);if(U){var G=En(this).constructor;B=Reflect.construct(F,arguments,G)}else B=F.apply(this,arguments);return fu(this,B)}}function fu(N,U){if(U&&(ii(U)==="object"||typeof U=="function"))return U;if(U!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ze(N)}function Ze(N){if(N===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return N}function En(N){return En=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(U){return U.__proto__||Object.getPrototypeOf(U)},En(N)}var hu=["viewstart","ended","loadstart","pause","play","playing","ratechange","waiting","adplay","adpause","adended","aderror","adplaying","adrequest","adresponse","adbreakstart","adbreakend","adfirstquartile","admidpoint","adthirdquartile","rebufferstart","rebufferend","seeked","error","hb","requestcompleted","requestfailed","requestcanceled","renditionchange"],vu=function(N){(function(Q,V){if(typeof V!="function"&&V!==null)throw new TypeError("Super expression must either be null or a function");Q.prototype=Object.create(V&&V.prototype,{constructor:{value:Q,writable:!0,configurable:!0}}),Object.defineProperty(Q,"prototype",{writable:!1}),V&&ai(Q,V)})(G,N);var U,B,F=cu(G);function G(Q,V,q){var Z;(function(oe,Te){if(!(oe instanceof Te))throw new TypeError("Cannot call a class as a function")})(this,G),(Z=F.call(this)).DOM_CONTENT_LOADED_EVENT_END=o.domContentLoadedEventEnd(),Z.NAVIGATION_START=o.navigationStart(),Z.mux=Q,Z.id=V,(q=E()({debug:!1,minimumRebufferDuration:250,sustainedRebufferThreshold:1e3,playbackHeartbeatTime:25,beaconDomain:"litix.io",sampleRate:1,disableCookies:!1,respectDoNotTrack:!1,disableRebufferTracking:!1,disablePlayheadRebufferTracking:!1,errorTranslator:function(oe){return oe}},q)).data=q.data||{},q.data.property_key&&(q.data.env_key=q.data.property_key,delete q.data.property_key),l.setLevel(q.debug?"debug":"warn"),Z.getPlayheadTime=q.getPlayheadTime,Z.getStateData=q.getStateData||function(){return{}},Z.getAdData=q.getAdData||function(){},Z.minimumRebufferDuration=q.minimumRebufferDuration,Z.sustainedRebufferThreshold=q.sustainedRebufferThreshold,Z.playbackHeartbeatTime=q.playbackHeartbeatTime,Z.disableRebufferTracking=q.disableRebufferTracking,Z.disableRebufferTracking&&Z.mux.log.warn("Disabling rebuffer tracking. This should only be used in specific circumstances as a last resort when your player is known to unreliably track rebuffering."),Z.disablePlayheadRebufferTracking=q.disablePlayheadRebufferTracking,Z.errorTranslator=q.errorTranslator,Z.playbackEventDispatcher=new iu(Q,q.data.env_key,q),Z.data={player_instance_id:C(),mux_sample_rate:q.sampleRate,beacon_domain:q.beaconCollectionDomain?q.beaconCollectionDomain:q.beaconDomain},Z.data.view_sequence_number=1,Z.data.player_sequence_number=1,Z.oldEmit=Z.emit,Z.emit=function(oe,Te){Te=E()({viewer_time:this.mux.utils.now()},Te),this.oldEmit(oe,Te)};var ie=function(){this.data.view_start===void 0&&(this.data.view_start=this.mux.utils.now(),this.emit("viewstart"))}.bind(Ze(Z));Z.on("viewinit",function(oe,Te){this._resetVideoData(),this._resetViewData(),this._resetErrorData(),this._updateStateData(),E()(this.data,Te),this._initializeViewData(),this.one("play",ie),this.one("adbreakstart",ie)});var he=function(oe){this.emit("viewend"),this.send("viewend"),this.emit("viewinit",oe)}.bind(Ze(Z));if(Z.on("videochange",function(oe,Te){he(Te)}),Z.on("programchange",function(oe,Te){this.data.player_is_paused&&this.mux.log.warn("The `programchange` event is intended to be used when the content changes mid playback without the video source changing, however the video is not currently playing. If the video source is changing please use the videochange event otherwise you will lose startup time information."),he(E()(Te,{view_program_changed:!0})),ie(),this.emit("play"),this.emit("playing")}),Z.on("fragmentchange",function(oe,Te){this.currentFragmentPDT=Te.currentFragmentPDT,this.currentFragmentStart=Te.currentFragmentStart}),Z.on("destroy",Z.destroy),typeof window<"u"&&typeof window.addEventListener=="function"&&typeof window.removeEventListener=="function"){var ye=function(){var oe=Z.data.view_start!==void 0;Z.mux.WINDOW_HIDDEN=document.visibilityState==="hidden",oe&&Z.mux.WINDOW_HIDDEN&&(Z.data.player_is_paused||Z.emit("hb"))};window.addEventListener("visibilitychange",ye,!1);var Se=function(oe){oe.persisted||Z.destroy()};window.addEventListener("pagehide",Se,!1),Z.on("destroy",function(){window.removeEventListener("visibilitychange",ye),window.removeEventListener("pagehide",Se)})}return Z.on("playerready",function(oe,Te){E()(this.data,Te)}),hu.forEach(function(oe){Z.on(oe,function(Te,_e){oe.indexOf("ad")!==0&&this._updateStateData(),E()(this.data,_e),this._sanitizeData()}),Z.on("after"+oe,function(){(oe!=="error"||this.errorTracker.viewErrored)&&this.send(oe)})}),Z.on("viewend",function(oe,Te){E()(Z.data,Te)}),Z.one("playerready",function(oe){var Te=this.mux.utils.now();this.data.player_init_time&&(this.data.player_startup_time=Te-this.data.player_init_time),!this.mux.PLAYER_TRACKED&&this.NAVIGATION_START&&(this.mux.PLAYER_TRACKED=!0,(this.data.player_init_time||this.DOM_CONTENT_LOADED_EVENT_END)&&(this.data.page_load_time=Math.min(this.data.player_init_time||1/0,this.DOM_CONTENT_LOADED_EVENT_END||1/0)-this.NAVIGATION_START)),this.send("playerready"),delete this.data.player_startup_time,delete this.data.page_load_time}),Z.longResumeTracker=new lu(Ze(Z)),Z.errorTracker=new se(Ze(Z)),new Ft(Ze(Z)),Z.seekingTracker=new Be(Ze(Z)),Z.playheadTime=new Le(Ze(Z)),Z.playbackHeartbeat=new ae(Ze(Z)),new yt(Ze(Z)),Z.watchTimeTracker=new le(Ze(Z)),new Ce(Ze(Z)),Z.adTracker=new Ut(Ze(Z)),new Qe(Ze(Z)),new Ke(Ze(Z)),new Et(Ze(Z)),new Ct(Ze(Z)),new su(Ze(Z)),q.hlsjs&&Z.addHLSJS(q),q.dashjs&&Z.addDashJS(q),Z.emit("viewinit",q.data),Z}return U=G,B=[{key:"destroy",value:function(){this._destroyed||(this._destroyed=!0,this.data.view_start!==void 0&&(this.emit("viewend"),this.send("viewend")),this.playbackEventDispatcher.destroy(),this.removeHLSJS(),this.removeDashJS(),window.clearTimeout(this._heartBeatTimeout))}},{key:"send",value:function(Q){var V=E()({},this.data);if(V.video_source_is_live===void 0&&(V.player_source_duration===1/0||V.video_source_duration===1/0?V.video_source_is_live=!0:(V.player_source_duration>0||V.video_source_duration>0)&&(V.video_source_is_live=!1)),V.video_source_is_live||["player_program_time","player_manifest_newest_program_time","player_live_edge_program_time","player_program_time","video_holdback","video_part_holdback","video_target_duration","video_part_target_duration"].forEach(function(he){V[he]=void 0}),V.video_source_url=V.video_source_url||V.player_source_url,V.video_source_url){var q=uu(s(V.video_source_url),2),Z=q[0],ie=q[1];V.video_source_domain=ie,V.video_source_hostname=Z}delete V.ad_request_id,this.playbackEventDispatcher.send(Q,V),this.data.view_sequence_number++,this.data.player_sequence_number++,this._restartHeartBeat()}},{key:"_updateStateData",value:function(){E()(this.data,this.getStateData()),this.playheadTime._updatePlayheadTime(),this._sanitizeData()}},{key:"_sanitizeData",value:function(){var Q=this;["player_width","player_height","video_source_width","video_source_height","player_playhead_time","video_source_bitrate"].forEach(function(V){var q=parseInt(Q.data[V],10);Q.data[V]=isNaN(q)?void 0:q}),["player_source_url","video_source_url"].forEach(function(V){if(Q.data[V]){var q=Q.data[V].toLowerCase();q.indexOf("data:")!==0&&q.indexOf("blob:")!==0||(Q.data[V]="MSE style URL")}})}},{key:"_resetVideoData",value:function(Q,V){var q=this;Object.keys(this.data).forEach(function(Z){Z.indexOf("video_")===0&&delete q.data[Z]})}},{key:"_resetViewData",value:function(){var Q=this;Object.keys(this.data).forEach(function(V){V.indexOf("view_")===0&&delete Q.data[V]}),this.data.view_sequence_number=1}},{key:"_resetErrorData",value:function(Q,V){delete this.data.player_error_code,delete this.data.player_error_message}},{key:"_initializeViewData",value:function(){var Q=this,V=this.data.view_id=C(),q=function(){V===Q.data.view_id&&g(Q.data,"player_view_count",1)};this.data.player_is_paused?this.one("play",q):q()}},{key:"_restartHeartBeat",value:function(){var Q=this;window.clearTimeout(this._heartBeatTimeout),this.errorTracker.viewErrored||(this._heartBeatTimeout=window.setTimeout(function(){Q.data.player_is_paused||Q.emit("hb")},1e4))}},{key:"addHLSJS",value:function(Q){Q.hlsjs?this.hlsjs?this.mux.log.warn("An instance of HLS.js is already being monitored for this player."):(this.hlsjs=Q.hlsjs,function(V,q,Z){var ie=arguments.length>4?arguments[4]:void 0,he=V.log,ye=V.utils.secondsToMs,Se=function(Re){var Ee,xe=parseInt(ie.version);return xe===1&&Re.programDateTime!==null&&(Ee=Re.programDateTime),xe===0&&Re.pdt!==null&&(Ee=Re.pdt),Ee};if(o.exists()){var oe=function(Re,Ee){return V.emit(q,Re,Ee)},Te=function(Re,Ee){var xe=Ee.levels,pe=Ee.audioTracks,De=Ee.url,Ne=Ee.stats,He=Ee.networkDetails,Tt=Ee.sessionData,vt={},Mt={};xe.forEach(function(Ht,Vr){vt[Vr]={width:Ht.width,height:Ht.height,bitrate:Ht.bitrate,attrs:Ht.attrs}}),pe.forEach(function(Ht,Vr){Mt[Vr]={name:Ht.name,language:Ht.lang,bitrate:Ht.bitrate}});var bt=R(Ne),Gt=bt.bytesLoaded,tt=bt.requestStart,Pt=bt.responseStart,ui=bt.responseEnd;oe("requestcompleted",h(h({},T(Tt)),{},{request_event_type:Re,request_bytes_loaded:Gt,request_start:tt,request_response_start:Pt,request_response_end:ui,request_type:"manifest",request_hostname:u(De),request_response_headers:P(He),request_rendition_lists:{media:vt,audio:Mt,video:{}}}))};Z.on(ie.Events.MANIFEST_LOADED,Te);var _e=function(Re,Ee){var xe=Ee.details,pe=Ee.level,De=Ee.networkDetails,Ne=Ee.stats,He=R(Ne),Tt=He.bytesLoaded,vt=He.requestStart,Mt=He.responseStart,bt=He.responseEnd,Gt=xe.fragments[xe.fragments.length-1],tt=Se(Gt)+ye(Gt.duration);oe("requestcompleted",{request_event_type:Re,request_bytes_loaded:Tt,request_start:vt,request_response_start:Mt,request_response_end:bt,request_current_level:pe,request_type:"manifest",request_hostname:u(xe.url),request_response_headers:P(De),video_holdback:xe.holdBack&&ye(xe.holdBack),video_part_holdback:xe.partHoldBack&&ye(xe.partHoldBack),video_part_target_duration:xe.partTarget&&ye(xe.partTarget),video_target_duration:xe.targetduration&&ye(xe.targetduration),video_source_is_live:xe.live,player_manifest_newest_program_time:isNaN(tt)?void 0:tt})};Z.on(ie.Events.LEVEL_LOADED,_e);var it=function(Re,Ee){var xe=Ee.details,pe=Ee.networkDetails,De=Ee.stats,Ne=R(De),He=Ne.bytesLoaded,Tt=Ne.requestStart,vt=Ne.responseStart,Mt=Ne.responseEnd;oe("requestcompleted",{request_event_type:Re,request_bytes_loaded:He,request_start:Tt,request_response_start:vt,request_response_end:Mt,request_type:"manifest",request_hostname:u(xe.url),request_response_headers:P(pe)})};Z.on(ie.Events.AUDIO_TRACK_LOADED,it);var Je=function(Re,Ee){var xe=Ee.stats,pe=Ee.networkDetails,De=Ee.frag;xe=xe||De.stats;var Ne=R(xe),He=Ne.bytesLoaded,Tt=Ne.requestStart,vt=Ne.responseStart,Mt=Ne.responseEnd,bt=P(pe),Gt=bt==null?void 0:bt["x-request-id"],tt={request_event_type:Re,request_bytes_loaded:He,request_start:Tt,request_response_start:vt,request_response_end:Mt,request_hostname:pe?u(pe.responseURL):void 0,request_id:Gt,request_response_headers:bt,request_media_duration:De.duration,request_url:pe==null?void 0:pe.responseURL};De.type==="main"?(tt.request_type="media",tt.request_current_level=De.level,tt.request_video_width=(Z.levels[De.level]||{}).width,tt.request_video_height=(Z.levels[De.level]||{}).height,tt.request_labeled_bitrate=(Z.levels[De.level]||{}).bitrate):tt.request_type=De.type,oe("requestcompleted",tt)};Z.on(ie.Events.FRAG_LOADED,Je);var at=function(Re,Ee){var xe=Ee.frag,pe=xe.start,De={currentFragmentPDT:Se(xe),currentFragmentStart:ye(pe)};oe("fragmentchange",De)};Z.on(ie.Events.FRAG_CHANGED,at);var Ie=function(Re,Ee){var xe=Ee.type,pe=Ee.details,De=Ee.response,Ne=Ee.fatal,He=Ee.context,Tt=Ee.frag;if(pe===ie.ErrorDetails.MANIFEST_LOAD_ERROR||pe===ie.ErrorDetails.MANIFEST_LOAD_TIMEOUT||pe===ie.ErrorDetails.FRAG_LOAD_ERROR||pe===ie.ErrorDetails.FRAG_LOAD_TIMEOUT||pe===ie.ErrorDetails.LEVEL_LOAD_ERROR||pe===ie.ErrorDetails.LEVEL_LOAD_TIMEOUT){var vt=Tt&&Tt.url||He&&He.url||"";oe("requestfailed",{request_error:pe,request_url:vt,request_hostname:u(vt),request_type:pe===ie.ErrorDetails.FRAG_LOAD_ERROR||pe===ie.ErrorDetails.FRAG_LOAD_TIMEOUT?"media":"manifest",request_error_code:De&&De.code,request_error_text:De&&De.text})}Ne&&oe("error",{player_error_code:xe,player_error_message:pe})};Z.on(ie.Events.ERROR,Ie);var qe=function(Re,Ee){var xe=Ee.frag,pe=xe&&xe._url||"";oe("requestcanceled",{request_event_type:Re,request_url:pe,request_type:"media",request_hostname:u(pe)})};Z.on(ie.Events.FRAG_LOAD_EMERGENCY_ABORTED,qe);var et=function(Re,Ee){var xe=Ee.level,pe=Z.levels[xe];if(pe&&pe.attrs&&pe.attrs.BANDWIDTH){var De,Ne=pe.attrs.BANDWIDTH,He=parseFloat(pe.attrs["FRAME-RATE"]);isNaN(He)||(De=He),Ne?oe("renditionchange",{video_source_fps:De,video_source_bitrate:Ne,video_source_width:pe.width,video_source_height:pe.height,video_source_rendition_name:pe.name,video_source_codec:pe==null?void 0:pe.videoCodec}):he.warn("missing BANDWIDTH from HLS manifest parsed by HLS.js")}};Z.on(ie.Events.LEVEL_SWITCHED,et),Z._stopMuxMonitor=function(){Z.off(ie.Events.MANIFEST_LOADED,Te),Z.off(ie.Events.LEVEL_LOADED,_e),Z.off(ie.Events.AUDIO_TRACK_LOADED,it),Z.off(ie.Events.FRAG_LOADED,Je),Z.off(ie.Events.FRAG_CHANGED,at),Z.off(ie.Events.ERROR,Ie),Z.off(ie.Events.FRAG_LOAD_EMERGENCY_ABORTED,qe),Z.off(ie.Events.LEVEL_SWITCHED,et),Z.off(ie.Events.DESTROYING,Z._stopMuxMonitor),delete Z._stopMuxMonitor},Z.on(ie.Events.DESTROYING,Z._stopMuxMonitor)}else he.warn("performance timing not supported. Not tracking HLS.js.")}(this.mux,this.id,Q.hlsjs,{},Q.Hls||window.Hls)):this.mux.log.warn("You must pass a valid hlsjs instance in order to track it.")}},{key:"removeHLSJS",value:function(){var Q;this.hlsjs&&((Q=this.hlsjs)&&typeof Q._stopMuxMonitor=="function"&&Q._stopMuxMonitor(),this.hlsjs=void 0)}},{key:"addDashJS",value:function(Q){Q.dashjs?this.dashjs?this.mux.log.warn("An instance of Dash.js is already being monitored for this player."):(this.dashjs=Q.dashjs,function(V,q,Z){var ie=V.log;if(Z&&Z.on){var he=function(Ie,qe){return V.emit(q,Ie,qe)},ye=function(Ie){var qe=Ie.type,et=(Ie.data||{}).url;he("requestcompleted",{request_event_type:qe,request_start:0,request_response_start:0,request_response_end:0,request_bytes_loaded:-1,request_type:"manifest",request_hostname:u(et),request_url:et})};Z.on("manifestLoaded",ye);var Se={},oe=function(Ie){var qe=Ie.type,et=Ie.fragmentModel,Re=(Ie.chunk||{}).mediaInfo||{},Ee=Re.type,xe=Re.bitrateList,pe={};(xe=xe||[]).forEach(function(tt,Pt){pe[Pt]={},pe[Pt].width=tt.width,pe[Pt].height=tt.height,pe[Pt].bitrate=tt.bandwidth,pe[Pt].attrs={}}),Ee==="video"?Se.video=pe:Ee==="audio"?Se.audio=pe:Se.media=pe;var De=W(et,Z),Ne=De.requestStart,He=De.requestResponseStart,Tt=De.requestResponseEnd,vt=De.requestResponseHeaders,Mt=De.requestMediaDuration,bt=De.requestHostname,Gt=De.requestUrl;he("requestcompleted",{request_event_type:qe,request_start:Ne,request_response_start:He,request_response_end:Tt,request_bytes_loaded:-1,request_type:Ee+"_init",request_response_headers:vt,request_hostname:bt,request_url:Gt,request_media_duration:Mt,request_rendition_lists:Se})};Z.on("initFragmentLoaded",oe);var Te=function(Ie){var qe=Ie.type,et=Ie.fragmentModel,Re=Ie.chunk||{},Ee=Re.mediaInfo,xe=Re.start,pe=(Ee||{}).type,De=W(et,Z),Ne=De.requestStart,He=De.requestResponseStart,Tt=De.requestResponseEnd,vt=De.requestBytesLoaded,Mt=De.requestResponseHeaders,bt=De.requestMediaDuration,Gt=De.requestHostname,tt=De.requestUrl,Pt=H(pe,Z),ui=Pt.currentLevel,Ht=Pt.renditionWidth,Vr=Pt.renditionHeight,Fu=Pt.renditionBitrate;he("requestcompleted",{request_event_type:qe,request_start:Ne,request_response_start:He,request_response_end:Tt,request_bytes_loaded:vt,request_type:pe,request_response_headers:Mt,request_hostname:Gt,request_url:tt,request_media_start_time:xe,request_media_duration:bt,request_current_level:ui,request_labeled_bitrate:Fu,request_video_width:Ht,request_video_height:Vr})};Z.on("mediaFragmentLoaded",Te);var _e={video:void 0,audio:void 0,totalBitrate:void 0},it=function(){if(_e.video&&typeof _e.video.bitrate=="number"){if(_e.video.width&&_e.video.height){var Ie=_e.video.bitrate;return _e.audio&&typeof _e.audio.bitrate=="number"&&(Ie+=_e.audio.bitrate),Ie!==_e.totalBitrate?(_e.totalBitrate=Ie,{video_source_bitrate:Ie,video_source_height:_e.video.height,video_source_width:_e.video.width,video_source_codec:$(_e.video.codec)}):void 0}ie.warn("have bitrate info for video but missing width/height")}},Je=function(Ie,qe,et){if(typeof Ie.newQuality=="number"){var Re=Ie.mediaType;if(Re==="audio"||Re==="video"){var Ee=Z.getBitrateInfoListFor(Re).find(function(pe){return pe.qualityIndex===Ie.newQuality});if(Ee&&typeof Ee.bitrate=="number"){_e[Re]=j(j({},Ee),{},{codec:Z.getCurrentTrackFor(Re).codec});var xe=it();xe&&he("renditionchange",xe)}else ie.warn("missing bitrate info for ".concat(Re))}}else ie.warn("missing evt.newQuality in qualityChangeRendered event",Ie)};Z.on("qualityChangeRendered",Je);var at=function(Ie){var qe=Ie.error,et=Ie.event,Re=(et=et||{}).request||{},Ee=O().event&&O().event.currentTarget||{};he("requestfailed",{request_error:qe+"_"+et.id+"_"+Re.type,request_url:et.url,request_hostname:u(et.url),request_type:Re.mediaType,request_error_code:Ee.status,request_error_type:Ee.statusText})};Z.on("error",at),Z._stopMuxMonitor=function(){Z.off("manifestLoaded",ye),Z.off("initFragmentLoaded",oe),Z.off("mediaFragmentLoaded",Te),Z.off("qualityChangeRendered",Je),Z.off("error",at),delete Z._stopMuxMonitor}}else ie.warn("Invalid dash.js player reference. Monitoring blocked.")}(this.mux,this.id,Q.dashjs)):this.mux.log.warn("You must pass a valid dashjs instance in order to track it.")}},{key:"removeDashJS",value:function(){var Q;this.dashjs&&((Q=this.dashjs)&&typeof Q._stopMuxMonitor=="function"&&Q._stopMuxMonitor(),this.dashjs=void 0)}}],B&&du(U.prototype,B),Object.defineProperty(U,"prototype",{writable:!1}),G}(re),gu=vu,mu=w(153),Gr=w.n(mu);function si(N){return si=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(U){return typeof U}:function(U){return U&&typeof Symbol=="function"&&U.constructor===Symbol&&U!==Symbol.prototype?"symbol":typeof U},si(N)}function pa(N,U){return function(B){if(Array.isArray(B))return B}(N)||function(B,F){var G=B==null?null:typeof Symbol<"u"&&B[Symbol.iterator]||B["@@iterator"];if(G!=null){var Q,V,q=[],Z=!0,ie=!1;try{for(G=G.call(B);!(Z=(Q=G.next()).done)&&(q.push(Q.value),!F||q.length!==F);Z=!0);}catch(he){ie=!0,V=he}finally{try{Z||G.return==null||G.return()}finally{if(ie)throw V}}return q}}(N,U)||function(B,F){if(B){if(typeof B=="string")return Ea(B,F);var G=Object.prototype.toString.call(B).slice(8,-1);return G==="Object"&&B.constructor&&(G=B.constructor.name),G==="Map"||G==="Set"?Array.from(B):G==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(G)?Ea(B,F):void 0}}(N,U)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Ea(N,U){(U==null||U>N.length)&&(U=N.length);for(var B=0,F=new Array(U);B<U;B++)F[B]=N[B];return F}var Tr,pu=["loadstart","pause","play","playing","seeking","seeked","timeupdate","ratechange","stalled","waiting","error","ended"],Eu={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"};O()&&O().WeakMap&&(Tr=new WeakMap);var yu="#EXT-X-TARGETDURATION",Tu="#EXT-X-PART-INF",bu="#EXT-X-SERVER-CONTROL",Su="#EXTINF",Au="#EXT-X-PROGRAM-DATE-TIME",_u="#EXT-X-VERSION",xu="#EXT-X-SESSION-DATA",yn=function(N){return this.buffer="",this.manifest={segments:[],serverControl:{},sessionData:{}},this.currentUri={},this.process(N),this.manifest};yn.prototype.process=function(N){var U;for(this.buffer+=N,U=this.buffer.indexOf(`
`);U>-1;U=this.buffer.indexOf(`
`))this.processLine(this.buffer.substring(0,U)),this.buffer=this.buffer.substring(U+1)},yn.prototype.processLine=function(N){var U=N.indexOf(":"),B=Ru(N,U),F=B[0],G=B.length===2?li(B[1]):void 0;if(F[0]!=="#")this.currentUri.uri=F,this.manifest.segments.push(this.currentUri),this.manifest.targetDuration&&!("duration"in this.currentUri)&&(this.currentUri.duration=this.manifest.targetDuration),this.currentUri={};else switch(F){case yu:if(!isFinite(G)||G<0)return;this.manifest.targetDuration=G,this.setHoldBack();break;case Tu:oi(this.manifest,B),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),this.setHoldBack();break;case bu:oi(this.manifest,B),this.setHoldBack();break;case Su:G===0?this.currentUri.duration=.01:G>0&&(this.currentUri.duration=G);break;case Au:var Q=G,V=new Date(Q);this.manifest.dateTimeString||(this.manifest.dateTimeString=Q,this.manifest.dateTimeObject=V),this.currentUri.dateTimeString=Q,this.currentUri.dateTimeObject=V;break;case _u:oi(this.manifest,B);break;case xu:var q=Cu(B[1]),Z=T(q);E()(this.manifest.sessionData,Z)}},yn.prototype.setHoldBack=function(){var N=this.manifest,U=N.serverControl,B=N.targetDuration,F=N.partTargetDuration;if(U){var G="holdBack",Q="partHoldBack",V=B&&3*B,q=F&&2*F;B&&!U.hasOwnProperty(G)&&(U[G]=V),V&&U[G]<V&&(U[G]=V),F&&!U.hasOwnProperty(Q)&&(U[Q]=3*F),F&&U[Q]<q&&(U[Q]=q)}};var oi=function(N,U){var B,F=ya(U[0].replace("#EXT-X-",""));Lu(U[1])?(B={},B=E()(Iu(U[1]),B)):B=li(U[1]),N[F]=B},ya=function(N){return N.toLowerCase().replace(/-(\w)/g,function(U){return U[1].toUpperCase()})},li=function(N){if(N.toLowerCase()==="yes"||N.toLowerCase()==="no")return N.toLowerCase()==="yes";var U=N.indexOf(":")!==-1?N:parseFloat(N);return isNaN(U)?N:U},Du=function(N){var U={},B=N.split("=");return B.length>1&&(U[ya(B[0])]=li(B[1])),U},Iu=function(N){for(var U=N.split(","),B={},F=0;U.length>F;F++){var G=U[F],Q=Du(G);B=E()(Q,B)}return B},Lu=function(N){return N.indexOf("=")>-1},Ru=function(N,U){return U===-1?[N]:[N.substring(0,U),N.substring(U+1)]},Cu=function(N){var U={};if(N){var B=N.search(",");return[N.slice(0,B),N.slice(B+1)].forEach(function(F,G){for(var Q=F.replace(/['"]+/g,"").split("="),V=0;V<Q.length;V++)Q[V]==="DATA-ID"&&(U["DATA-ID"]=Q[1-V]),Q[V]==="VALUE"&&(U.VALUE=Q[1-V])}),{data:U}}},Ou=yn,Mu={safeCall:function(N,U,B,F){var G=F;if(N&&typeof N[U]=="function")try{G=N[U].apply(N,B)}catch(Q){l.info("safeCall error",Q)}return G},safeIncrement:g,getComputedStyle:function(N,U){var B;if(N&&U&&O()&&typeof O().getComputedStyle=="function")return Tr&&Tr.has(N)&&(B=Tr.get(N)),B||(B=O().getComputedStyle(N,null),Tr&&Tr.set(N,B)),B.getPropertyValue(U)},secondsToMs:function(N){return Math.floor(1e3*N)},assign:E(),headersStringToObject:v,extractHostnameAndDomain:s,extractHostname:u,manifestParser:Ou,generateShortID:S,generateUUID:C,now:d.now},Pu={PLAYER_READY:"playerready",VIEW_INIT:"viewinit",VIDEO_CHANGE:"videochange",PLAY:"play",PAUSE:"pause",PLAYING:"playing",TIME_UPDATE:"timeupdate",SEEKING:"seeking",SEEKED:"seeked",REBUFFER_START:"rebufferstart",REBUFFER_END:"rebufferend",ERROR:"error",ENDED:"ended",RENDITION_CHANGE:"renditionchange",ORIENTATION_CHANGE:"orientationchange",AD_REQUEST:"adrequest",AD_RESPONSE:"adresponse",AD_BREAK_START:"adbreakstart",AD_PLAY:"adplay",AD_PLAYING:"adplaying",AD_PAUSE:"adpause",AD_FIRST_QUARTILE:"adfirstquartile",AD_MID_POINT:"admidpoint",AD_THIRD_QUARTILE:"adthirdquartile",AD_ENDED:"adended",AD_BREAK_END:"adbreakend",AD_ERROR:"aderror",REQUEST_COMPLETED:"requestcompleted",REQUEST_FAILED:"requestfailed",REQUEST_CANCELLED:"requestcanceled"};function wu(N,U){return function(B){if(Array.isArray(B))return B}(N)||function(B,F){var G=B==null?null:typeof Symbol<"u"&&B[Symbol.iterator]||B["@@iterator"];if(G!=null){var Q,V,q=[],Z=!0,ie=!1;try{for(G=G.call(B);!(Z=(Q=G.next()).done)&&(q.push(Q.value),!F||q.length!==F);Z=!0);}catch(he){ie=!0,V=he}finally{try{Z||G.return==null||G.return()}finally{if(ie)throw V}}return q}}(N,U)||function(B,F){if(B){if(typeof B=="string")return Ta(B,F);var G=Object.prototype.toString.call(B).slice(8,-1);return G==="Object"&&B.constructor&&(G=B.constructor.name),G==="Map"||G==="Set"?Array.from(B):G==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(G)?Ta(B,F):void 0}}(N,U)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Ta(N,U){(U==null||U>N.length)&&(U=N.length);for(var B=0,F=new Array(U);B<U;B++)F[B]=N[B];return F}var Ot={},Hr=function N(U){var B=arguments;typeof U=="string"?N.hasOwnProperty(U)?O().setTimeout(function(){B=Array.prototype.splice.call(B,1),N[U].apply(null,B)},0):l.warn("`"+U+"` is an unknown task"):typeof U=="function"?O().setTimeout(function(){U(N)},0):l.warn("`"+U+"` is invalid.")},ku={loaded:d.now(),NAME:"mux-embed",VERSION:"4.16.0",API_VERSION:"2.1",PLAYER_TRACKED:!1,monitor:function(N,U){return function(B,F,G){var Q=pa(I(F),3),V=Q[0],q=Q[1],Z=Q[2],ie=B.log,he=B.utils.getComputedStyle,ye=B.utils.secondsToMs;if(!V)return ie.error("No element was found with the `"+q+"` query selector.");if(Z!=="video"&&Z!=="audio")return ie.error("The element of `"+q+"` was not a media element.");V.mux&&(V.mux.destroy(),delete V.mux,ie.warn("Already monitoring this video element, replacing existing event listeners")),(G=E()({automaticErrorTracking:!0},G)).data=E()({player_software:"HTML5 Video Element",player_mux_plugin_name:"VideoElementMonitor",player_mux_plugin_version:B.VERSION},G.data),G.getPlayheadTime=function(){return ye(V.currentTime)},G.getStateData=function(){var oe,Te,_e=this.hlsjs&&this.hlsjs.url,it=this.dashjs&&si(this.dashjs.getSource==="function")&&this.dashjs.getSource(),Je={player_is_paused:V.paused,player_playhead_time:ye(V.currentTime),player_width:parseInt(he(V,"width")),player_height:parseInt(he(V,"height")),player_autoplay_on:V.autoplay,player_preload_on:V.preload,player_language_code:V.lang,player_is_fullscreen:Gr()&&!!(Gr().fullscreenElement||Gr().webkitFullscreenElement||Gr().mozFullScreenElement||Gr().msFullscreenElement),video_poster_url:V.poster,video_source_url:_e||it||V.currentSrc,video_source_duration:ye(V.duration),video_source_height:V.videoHeight,video_source_width:V.videoWidth,view_dropped_frame_count:(oe=V)===null||oe===void 0||(Te=oe.getVideoPlaybackQuality)===null||Te===void 0?void 0:Te.call(oe).droppedVideoFrames},at=G.getPlayheadTime();if(V.getStartDate&&at>0){var Ie=V.getStartDate();if(Ie&&typeof Ie.getTime=="function"&&Ie.getTime()){var qe=Ie.getTime();if(Je.player_program_time=qe+at,V.seekable.length>0){var et=qe+V.seekable.end(V.seekable.length-1);Je.player_live_edge_program_time=et}}}return Je},V.mux=V.mux||{},V.mux.deleted=!1,V.mux.emit=function(oe,Te){B.emit(q,oe,Te)};var Se=function(){ie.error("The monitor for this video element has already been destroyed.")};V.mux.destroy=function(){Object.keys(V.mux.listeners).forEach(function(oe){V.removeEventListener(oe,V.mux.listeners[oe],!1)}),delete V.mux.listeners,V.mux.destroy=Se,V.mux.swapElement=Se,V.mux.emit=Se,V.mux.addHLSJS=Se,V.mux.addDashJS=Se,V.mux.removeHLSJS=Se,V.mux.removeDashJS=Se,V.mux.deleted=!0,B.emit(q,"destroy")},V.mux.swapElement=function(oe){var Te=pa(I(oe),3),_e=Te[0],it=Te[1],Je=Te[2];return _e?Je!=="video"&&Je!=="audio"?B.log.error("The element of `"+it+"` was not a media element."):(_e.muxId=V.muxId,delete V.muxId,_e.mux=_e.mux||{},_e.mux.listeners=E()({},V.mux.listeners),delete V.mux.listeners,Object.keys(_e.mux.listeners).forEach(function(at){V.removeEventListener(at,_e.mux.listeners[at],!1),_e.addEventListener(at,_e.mux.listeners[at],!1)}),_e.mux.swapElement=V.mux.swapElement,_e.mux.destroy=V.mux.destroy,delete V.mux,void(V=_e)):B.log.error("No element was found with the `"+it+"` query selector.")},V.mux.addHLSJS=function(oe){B.addHLSJS(q,oe)},V.mux.addDashJS=function(oe){B.addDashJS(q,oe)},V.mux.removeHLSJS=function(){B.removeHLSJS(q)},V.mux.removeDashJS=function(){B.removeDashJS(q)},B.init(q,G),B.emit(q,"playerready"),V.paused||(B.emit(q,"play"),V.readyState>2&&B.emit(q,"playing")),V.mux.listeners={},pu.forEach(function(oe){(oe!=="error"||G.automaticErrorTracking)&&(V.mux.listeners[oe]=function(){var Te={};if(oe==="error"){if(!V.error||V.error.code===1)return;Te.player_error_code=V.error.code,Te.player_error_message=Eu[V.error.code]||V.error.message}B.emit(q,oe,Te)},V.addEventListener(oe,V.mux.listeners[oe],!1))})}(Hr,N,U)},destroyMonitor:function(N){var U=wu(I(N),1)[0];U&&U.mux&&typeof U.mux.destroy=="function"?U.mux.destroy():l.error("A video element monitor for `"+N+"` has not been initialized via `mux.monitor`.")},addHLSJS:function(N,U){var B=b(N);Ot[B]?Ot[B].addHLSJS(U):l.error("A monitor for `"+B+"` has not been initialized.")},addDashJS:function(N,U){var B=b(N);Ot[B]?Ot[B].addDashJS(U):l.error("A monitor for `"+B+"` has not been initialized.")},removeHLSJS:function(N){var U=b(N);Ot[U]?Ot[U].removeHLSJS():l.error("A monitor for `"+U+"` has not been initialized.")},removeDashJS:function(N){var U=b(N);Ot[U]?Ot[U].removeDashJS():l.error("A monitor for `"+U+"` has not been initialized.")},init:function(N,U){a()&&U&&U.respectDoNotTrack&&l.info("The browser's Do Not Track flag is enabled - Mux beaconing is disabled.");var B=b(N);Ot[B]=new gu(Hr,B,U)},emit:function(N,U,B){var F=b(N);Ot[F]?(Ot[F].emit(U,B),U==="destroy"&&delete Ot[F]):l.error("A monitor for `"+F+"` has not been initialized.")},checkDoNotTrack:a,log:l,utils:Mu,events:Pu,WINDOW_HIDDEN:!1,WINDOW_UNLOADING:!1};Object.assign(Hr,ku),O()!==void 0&&typeof O().addEventListener=="function"&&O().addEventListener("pagehide",function(N){N.persisted||(Hr.WINDOW_UNLOADING=!0)},!1);var Uu=Hr},655:function(c,p,w){var M,O;function C(S){return C=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(b){return typeof b}:function(b){return b&&typeof Symbol=="function"&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},C(S);/*!
 * JavaScript Cookie v2.1.3
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */}(function(S){var b=!1;if((O=typeof(M=S)=="function"?M.call(p,w,p,c):M)===void 0||(c.exports=O),b=!0,C(p)==="object"&&(c.exports=S(),b=!0),!b){var I=window.Cookies,L=window.Cookies=S();L.noConflict=function(){return window.Cookies=I,L}}})(function(){var S=function(){for(var b=0,I={};b<arguments.length;b++){var L=arguments[b];for(var _ in L)I[_]=L[_]}return I};return function b(I){function L(_,x,l){var a;if(typeof document<"u"){if(arguments.length>1){if(typeof(l=S({path:"/"},L.defaults,l)).expires=="number"){var d=new Date;d.setMilliseconds(d.getMilliseconds()+864e5*l.expires),l.expires=d}try{a=JSON.stringify(x),/^[\{\[]/.test(a)&&(x=a)}catch{}return x=I.write?I.write(x,_):encodeURIComponent(String(x)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),_=(_=(_=encodeURIComponent(String(_))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape),document.cookie=[_,"=",x,l.expires?"; expires="+l.expires.toUTCString():"",l.path?"; path="+l.path:"",l.domain?"; domain="+l.domain:"",l.secure?"; secure":""].join("")}_||(a={});for(var y=document.cookie?document.cookie.split("; "):[],E=/(%[0-9A-Z]{2})+/g,u=0;u<y.length;u++){var s=y[u].split("="),o=s.slice(1).join("=");o.charAt(0)==='"'&&(o=o.slice(1,-1));try{var g=s[0].replace(E,decodeURIComponent);if(o=I.read?I.read(o,g):I(o,g)||o.replace(E,decodeURIComponent),this.json)try{o=JSON.parse(o)}catch{}if(_===g){a=o;break}_||(a[g]=o)}catch{}}return a}}return L.set=L,L.get=function(_){return L.call(L,_)},L.getJSON=function(){return L.apply({json:!0},[].slice.call(arguments))},L.defaults={},L.remove=function(_,x){L(_,"",S(x,{expires:-1}))},L.withConverter=b,L}(function(){})})},153:function(c,p,w){var M,O=w.g!==void 0?w.g:typeof window<"u"?window:{},C=w(558);typeof document<"u"?M=document:(M=O["__GLOBAL_DOCUMENT_CACHE@4"])||(M=O["__GLOBAL_DOCUMENT_CACHE@4"]=C),c.exports=M},48:function(c,p,w){var M;M=typeof window<"u"?window:w.g!==void 0?w.g:typeof self<"u"?self:{},c.exports=M},678:function(c){var p=9007199254740991,w="[object Arguments]",M="[object Function]",O="[object GeneratorFunction]",C=/^(?:0|[1-9]\d*)$/;function S(A,R,P){switch(P.length){case 0:return A.call(R);case 1:return A.call(R,P[0]);case 2:return A.call(R,P[0],P[1]);case 3:return A.call(R,P[0],P[1],P[2])}return A.apply(R,P)}var b,I,L=Object.prototype,_=L.hasOwnProperty,x=L.toString,l=L.propertyIsEnumerable,a=(b=Object.keys,I=Object,function(A){return b(I(A))}),d=Math.max,y=!l.call({valueOf:1},"valueOf");function E(A,R){var P=f(A)||function(W){return function(H){return function($){return!!$&&typeof $=="object"}(H)&&v(H)}(W)&&_.call(W,"callee")&&(!l.call(W,"callee")||x.call(W)==w)}(A)?function(W,H){for(var $=-1,z=Array(W);++$<W;)z[$]=H($);return z}(A.length,String):[],k=P.length,j=!!k;for(var K in A)!R&&!_.call(A,K)||j&&(K=="length"||s(K,k))||P.push(K);return P}function u(A,R,P){var k=A[R];_.call(A,R)&&g(k,P)&&(P!==void 0||R in A)||(A[R]=P)}function s(A,R){return!!(R=R==null?p:R)&&(typeof A=="number"||C.test(A))&&A>-1&&A%1==0&&A<R}function o(A){var R=A&&A.constructor;return A===(typeof R=="function"&&R.prototype||L)}function g(A,R){return A===R||A!=A&&R!=R}var f=Array.isArray;function v(A){return A!=null&&function(R){return typeof R=="number"&&R>-1&&R%1==0&&R<=p}(A.length)&&!function(R){var P=T(R)?x.call(R):"";return P==M||P==O}(A)}function T(A){var R=typeof A;return!!A&&(R=="object"||R=="function")}var m,h=(m=function(A,R){if(y||o(R)||v(R))(function(k,j,K,W){K||(K={});for(var H=-1,$=j.length;++H<$;){var z=j[H],J=W?W(K[z],k[z],z,K,k):void 0;u(K,z,J===void 0?k[z]:J)}})(R,function(k){return v(k)?E(k):function(j){if(!o(j))return a(j);var K=[];for(var W in Object(j))_.call(j,W)&&W!="constructor"&&K.push(W);return K}(k)}(R),A);else for(var P in R)_.call(R,P)&&u(A,P,R[P])},function(A,R){return R=d(R===void 0?A.length-1:R,0),function(){for(var P=arguments,k=-1,j=d(P.length-R,0),K=Array(j);++k<j;)K[k]=P[R+k];k=-1;for(var W=Array(R+1);++k<R;)W[k]=P[k];return W[R]=K,S(A,this,W)}}(function(A,R){var P=-1,k=R.length,j=k>1?R[k-1]:void 0,K=k>2?R[2]:void 0;for(j=m.length>3&&typeof j=="function"?(k--,j):void 0,K&&function(H,$,z){if(!T(z))return!1;var J=typeof $;return!!(J=="number"?v(z)&&s($,z.length):J=="string"&&$ in z)&&g(z[$],H)}(R[0],R[1],K)&&(j=k<3?void 0:j,k=1),A=Object(A);++P<k;){var W=R[P];W&&m(A,W,P,j)}return A}));c.exports=h},640:function(c,p,w){var M,O;(function(C,S){M=function(){var b=function(){},I="undefined",L=typeof window!==I&&typeof window.navigator!==I&&/Trident\/|MSIE /.test(window.navigator.userAgent),_=["trace","debug","info","warn","error"];function x(f,v){var T=f[v];if(typeof T.bind=="function")return T.bind(f);try{return Function.prototype.bind.call(T,f)}catch{return function(){return Function.prototype.apply.apply(T,[f,arguments])}}}function l(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function a(f){return f==="debug"&&(f="log"),typeof console!==I&&(f==="trace"&&L?l:console[f]!==void 0?x(console,f):console.log!==void 0?x(console,"log"):b)}function d(f,v){for(var T=0;T<_.length;T++){var m=_[T];this[m]=T<f?b:this.methodFactory(m,f,v)}this.log=this.debug}function y(f,v,T){return function(){typeof console!==I&&(d.call(this,v,T),this[f].apply(this,arguments))}}function E(f,v,T){return a(f)||y.apply(this,arguments)}function u(f,v,T){var m,h=this;v=v==null?"WARN":v;var A="loglevel";function R(K){var W=(_[K]||"silent").toUpperCase();if(typeof window!==I&&A){try{return void(window.localStorage[A]=W)}catch{}try{window.document.cookie=encodeURIComponent(A)+"="+W+";"}catch{}}}function P(){var K;if(typeof window!==I&&A){try{K=window.localStorage[A]}catch{}if(typeof K===I)try{var W=window.document.cookie,H=W.indexOf(encodeURIComponent(A)+"=");H!==-1&&(K=/^([^;]+)/.exec(W.slice(H))[1])}catch{}return h.levels[K]===void 0&&(K=void 0),K}}function k(){if(typeof window!==I&&A){try{return void window.localStorage.removeItem(A)}catch{}try{window.document.cookie=encodeURIComponent(A)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}typeof f=="string"?A+=":"+f:typeof f=="symbol"&&(A=void 0),h.name=f,h.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},h.methodFactory=T||E,h.getLevel=function(){return m},h.setLevel=function(K,W){if(typeof K=="string"&&h.levels[K.toUpperCase()]!==void 0&&(K=h.levels[K.toUpperCase()]),!(typeof K=="number"&&K>=0&&K<=h.levels.SILENT))throw"log.setLevel() called with invalid level: "+K;if(m=K,W!==!1&&R(K),d.call(h,K,f),typeof console===I&&K<h.levels.SILENT)return"No console available for logging"},h.setDefaultLevel=function(K){v=K,P()||h.setLevel(K,!1)},h.resetLevel=function(){h.setLevel(v,!1),k()},h.enableAll=function(K){h.setLevel(h.levels.TRACE,K)},h.disableAll=function(K){h.setLevel(h.levels.SILENT,K)};var j=P();j==null&&(j=v),h.setLevel(j,!1)}var s=new u,o={};s.getLogger=function(f){if(typeof f!="symbol"&&typeof f!="string"||f==="")throw new TypeError("You must supply a name when creating a logger.");var v=o[f];return v||(v=o[f]=new u(f,s.getLevel(),s.methodFactory)),v};var g=typeof window!==I?window.log:void 0;return s.noConflict=function(){return typeof window!==I&&window.log===s&&(window.log=g),s},s.getLoggers=function(){return o},s.default=s,s},(O=typeof M=="function"?M.call(p,w,p,c):M)===void 0||(c.exports=O)})()},375:function(c,p){var w=Object.prototype.hasOwnProperty;function M(C){try{return decodeURIComponent(C.replace(/\+/g," "))}catch{return null}}function O(C){try{return encodeURIComponent(C)}catch{return null}}p.stringify=function(C,S){S=S||"";var b,I,L=[];for(I in typeof S!="string"&&(S="?"),C)if(w.call(C,I)){if((b=C[I])||b!=null&&!isNaN(b)||(b=""),I=O(I),b=O(b),I===null||b===null)continue;L.push(I+"="+b)}return L.length?S+L.join("&"):""},p.parse=function(C){for(var S,b=/([^=?#&]+)=?([^&]*)/g,I={};S=b.exec(C);){var L=M(S[1]),_=M(S[2]);L===null||_===null||L in I||(I[L]=_)}return I}},558:function(){}},r={};function D(c){var p=r[c];if(p!==void 0)return p.exports;var w=r[c]={exports:{}};return i[c].call(w.exports,w,w.exports,D),w.exports}return D.n=function(c){var p=c&&c.__esModule?function(){return c.default}:function(){return c};return D.d(p,{a:p}),p},D.d=function(c,p){for(var w in p)D.o(p,w)&&!D.o(c,w)&&Object.defineProperty(c,w,{enumerable:!0,get:p[w]})},D.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),D.o=function(c,p){return Object.prototype.hasOwnProperty.call(c,p)},D(80)}()},t.exports=n()})()})(Uo);const Fo=Ks(Uo.exports);var Bo={exports:{}};(function(t,e){typeof window<"u"&&function(i,r){t.exports=r()}(Bu,function(){return function(n){var i={};function r(D){if(i[D])return i[D].exports;var c=i[D]={i:D,l:!1,exports:{}};return n[D].call(c.exports,c,c.exports,r),c.l=!0,c.exports}return r.m=n,r.c=i,r.d=function(D,c,p){r.o(D,c)||Object.defineProperty(D,c,{enumerable:!0,get:p})},r.r=function(D){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(D,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(D,"__esModule",{value:!0})},r.t=function(D,c){if(c&1&&(D=r(D)),c&8||c&4&&typeof D=="object"&&D&&D.__esModule)return D;var p=Object.create(null);if(r.r(p),Object.defineProperty(p,"default",{enumerable:!0,value:D}),c&2&&typeof D!="string")for(var w in D)r.d(p,w,function(M){return D[M]}.bind(null,w));return p},r.n=function(D){var c=D&&D.__esModule?function(){return D.default}:function(){return D};return r.d(c,"a",c),c},r.o=function(D,c){return Object.prototype.hasOwnProperty.call(D,c)},r.p="/dist/",r(r.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(n,i,r){var D=Object.prototype.hasOwnProperty,c="~";function p(){}Object.create&&(p.prototype=Object.create(null),new p().__proto__||(c=!1));function w(S,b,I){this.fn=S,this.context=b,this.once=I||!1}function M(S,b,I,L,_){if(typeof I!="function")throw new TypeError("The listener must be a function");var x=new w(I,L||S,_),l=c?c+b:b;return S._events[l]?S._events[l].fn?S._events[l]=[S._events[l],x]:S._events[l].push(x):(S._events[l]=x,S._eventsCount++),S}function O(S,b){--S._eventsCount===0?S._events=new p:delete S._events[b]}function C(){this._events=new p,this._eventsCount=0}C.prototype.eventNames=function(){var b=[],I,L;if(this._eventsCount===0)return b;for(L in I=this._events)D.call(I,L)&&b.push(c?L.slice(1):L);return Object.getOwnPropertySymbols?b.concat(Object.getOwnPropertySymbols(I)):b},C.prototype.listeners=function(b){var I=c?c+b:b,L=this._events[I];if(!L)return[];if(L.fn)return[L.fn];for(var _=0,x=L.length,l=new Array(x);_<x;_++)l[_]=L[_].fn;return l},C.prototype.listenerCount=function(b){var I=c?c+b:b,L=this._events[I];return L?L.fn?1:L.length:0},C.prototype.emit=function(b,I,L,_,x,l){var a=c?c+b:b;if(!this._events[a])return!1;var d=this._events[a],y=arguments.length,E,u;if(d.fn){switch(d.once&&this.removeListener(b,d.fn,void 0,!0),y){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,I),!0;case 3:return d.fn.call(d.context,I,L),!0;case 4:return d.fn.call(d.context,I,L,_),!0;case 5:return d.fn.call(d.context,I,L,_,x),!0;case 6:return d.fn.call(d.context,I,L,_,x,l),!0}for(u=1,E=new Array(y-1);u<y;u++)E[u-1]=arguments[u];d.fn.apply(d.context,E)}else{var s=d.length,o;for(u=0;u<s;u++)switch(d[u].once&&this.removeListener(b,d[u].fn,void 0,!0),y){case 1:d[u].fn.call(d[u].context);break;case 2:d[u].fn.call(d[u].context,I);break;case 3:d[u].fn.call(d[u].context,I,L);break;case 4:d[u].fn.call(d[u].context,I,L,_);break;default:if(!E)for(o=1,E=new Array(y-1);o<y;o++)E[o-1]=arguments[o];d[u].fn.apply(d[u].context,E)}}return!0},C.prototype.on=function(b,I,L){return M(this,b,I,L,!1)},C.prototype.once=function(b,I,L){return M(this,b,I,L,!0)},C.prototype.removeListener=function(b,I,L,_){var x=c?c+b:b;if(!this._events[x])return this;if(!I)return O(this,x),this;var l=this._events[x];if(l.fn)l.fn===I&&(!_||l.once)&&(!L||l.context===L)&&O(this,x);else{for(var a=0,d=[],y=l.length;a<y;a++)(l[a].fn!==I||_&&!l[a].once||L&&l[a].context!==L)&&d.push(l[a]);d.length?this._events[x]=d.length===1?d[0]:d:O(this,x)}return this},C.prototype.removeAllListeners=function(b){var I;return b?(I=c?c+b:b,this._events[I]&&O(this,I)):(this._events=new p,this._eventsCount=0),this},C.prototype.off=C.prototype.removeListener,C.prototype.addListener=C.prototype.on,C.prefixed=c,C.EventEmitter=C,n.exports=C},"./node_modules/url-toolkit/src/url-toolkit.js":function(n,i,r){(function(D){var c=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,p=/^(?=([^\/?#]*))\1([^]*)$/,w=/(?:\/|^)\.(?=\/)/g,M=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,O={buildAbsoluteURL:function(C,S,b){if(b=b||{},C=C.trim(),S=S.trim(),!S){if(!b.alwaysNormalize)return C;var I=O.parseURL(C);if(!I)throw new Error("Error trying to parse base URL.");return I.path=O.normalizePath(I.path),O.buildURLFromParts(I)}var L=O.parseURL(S);if(!L)throw new Error("Error trying to parse relative URL.");if(L.scheme)return b.alwaysNormalize?(L.path=O.normalizePath(L.path),O.buildURLFromParts(L)):S;var _=O.parseURL(C);if(!_)throw new Error("Error trying to parse base URL.");if(!_.netLoc&&_.path&&_.path[0]!=="/"){var x=p.exec(_.path);_.netLoc=x[1],_.path=x[2]}_.netLoc&&!_.path&&(_.path="/");var l={scheme:_.scheme,netLoc:L.netLoc,path:null,params:L.params,query:L.query,fragment:L.fragment};if(!L.netLoc&&(l.netLoc=_.netLoc,L.path[0]!=="/"))if(!L.path)l.path=_.path,L.params||(l.params=_.params,L.query||(l.query=_.query));else{var a=_.path,d=a.substring(0,a.lastIndexOf("/")+1)+L.path;l.path=O.normalizePath(d)}return l.path===null&&(l.path=b.alwaysNormalize?O.normalizePath(L.path):L.path),O.buildURLFromParts(l)},parseURL:function(C){var S=c.exec(C);return S?{scheme:S[1]||"",netLoc:S[2]||"",path:S[3]||"",params:S[4]||"",query:S[5]||"",fragment:S[6]||""}:null},normalizePath:function(C){for(C=C.split("").reverse().join("").replace(w,"");C.length!==(C=C.replace(M,"")).length;);return C.split("").reverse().join("")},buildURLFromParts:function(C){return C.scheme+C.netLoc+C.path+C.params+C.query+C.fragment}};n.exports=O})()},"./node_modules/webworkify-webpack/index.js":function(n,i,r){function D(b){var I={};function L(x){if(I[x])return I[x].exports;var l=I[x]={i:x,l:!1,exports:{}};return b[x].call(l.exports,l,l.exports,L),l.l=!0,l.exports}L.m=b,L.c=I,L.i=function(x){return x},L.d=function(x,l,a){L.o(x,l)||Object.defineProperty(x,l,{configurable:!1,enumerable:!0,get:a})},L.r=function(x){Object.defineProperty(x,"__esModule",{value:!0})},L.n=function(x){var l=x&&x.__esModule?function(){return x.default}:function(){return x};return L.d(l,"a",l),l},L.o=function(x,l){return Object.prototype.hasOwnProperty.call(x,l)},L.p="/",L.oe=function(x){throw console.error(x),x};var _=L(L.s=ENTRY_MODULE);return _.default||_}var c="[\\.|\\-|\\+|\\w|/|@]+",p="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+c+").*?\\)";function w(b){return(b+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function M(b){return!isNaN(1*b)}function O(b,I,L){var _={};_[L]=[];var x=I.toString(),l=x.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!l)return _;for(var a=l[1],d=new RegExp("(\\\\n|\\W)"+w(a)+p,"g"),y;y=d.exec(x);)y[3]!=="dll-reference"&&_[L].push(y[3]);for(d=new RegExp("\\("+w(a)+'\\("(dll-reference\\s('+c+'))"\\)\\)'+p,"g");y=d.exec(x);)b[y[2]]||(_[L].push(y[1]),b[y[2]]=r(y[1]).m),_[y[2]]=_[y[2]]||[],_[y[2]].push(y[4]);for(var E=Object.keys(_),u=0;u<E.length;u++)for(var s=0;s<_[E[u]].length;s++)M(_[E[u]][s])&&(_[E[u]][s]=1*_[E[u]][s]);return _}function C(b){var I=Object.keys(b);return I.reduce(function(L,_){return L||b[_].length>0},!1)}function S(b,I){for(var L={main:[I]},_={main:[]},x={main:{}};C(L);)for(var l=Object.keys(L),a=0;a<l.length;a++){var d=l[a],y=L[d],E=y.pop();if(x[d]=x[d]||{},!(x[d][E]||!b[d][E])){x[d][E]=!0,_[d]=_[d]||[],_[d].push(E);for(var u=O(b,b[d][E],d),s=Object.keys(u),o=0;o<s.length;o++)L[s[o]]=L[s[o]]||[],L[s[o]]=L[s[o]].concat(u[s[o]])}}return _}n.exports=function(b,I){I=I||{};var L={main:r.m},_=I.all?{main:Object.keys(L.main)}:S(L,b),x="";Object.keys(_).filter(function(E){return E!=="main"}).forEach(function(E){for(var u=0;_[E][u];)u++;_[E].push(u),L[E][u]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",x=x+"var "+E+" = ("+D.toString().replace("ENTRY_MODULE",JSON.stringify(u))+")({"+_[E].map(function(s){return""+JSON.stringify(s)+": "+L[E][s].toString()}).join(",")+`});
`}),x=x+"new (("+D.toString().replace("ENTRY_MODULE",JSON.stringify(b))+")({"+_.main.map(function(E){return""+JSON.stringify(E)+": "+L.main[E].toString()}).join(",")+"}))(self);";var l=new window.Blob([x],{type:"text/javascript"});if(I.bare)return l;var a=window.URL||window.webkitURL||window.mozURL||window.msURL,d=a.createObjectURL(l),y=new window.Worker(d);return y.objectURL=d,y}},"./src/config.ts":function(n,i,r){r.r(i),r.d(i,"hlsDefaultConfig",function(){return o}),r.d(i,"mergeConfig",function(){return f}),r.d(i,"enableStreamingMode",function(){return v});var D=r("./src/controller/abr-controller.ts"),c=r("./src/controller/audio-stream-controller.ts"),p=r("./src/controller/audio-track-controller.ts"),w=r("./src/controller/subtitle-stream-controller.ts"),M=r("./src/controller/subtitle-track-controller.ts"),O=r("./src/controller/buffer-controller.ts"),C=r("./src/controller/timeline-controller.ts"),S=r("./src/controller/cap-level-controller.ts"),b=r("./src/controller/fps-controller.ts"),I=r("./src/controller/eme-controller.ts"),L=r("./src/controller/cmcd-controller.ts"),_=r("./src/utils/xhr-loader.ts"),x=r("./src/utils/fetch-loader.ts"),l=r("./src/utils/cues.ts"),a=r("./src/utils/mediakeys-helper.ts"),d=r("./src/utils/logger.ts");function y(){return y=Object.assign?Object.assign.bind():function(T){for(var m=1;m<arguments.length;m++){var h=arguments[m];for(var A in h)Object.prototype.hasOwnProperty.call(h,A)&&(T[A]=h[A])}return T},y.apply(this,arguments)}function E(T,m){var h=Object.keys(T);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(T);m&&(A=A.filter(function(R){return Object.getOwnPropertyDescriptor(T,R).enumerable})),h.push.apply(h,A)}return h}function u(T){for(var m=1;m<arguments.length;m++){var h=arguments[m]!=null?arguments[m]:{};m%2?E(Object(h),!0).forEach(function(A){s(T,A,h[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties(T,Object.getOwnPropertyDescriptors(h)):E(Object(h)).forEach(function(A){Object.defineProperty(T,A,Object.getOwnPropertyDescriptor(h,A))})}return T}function s(T,m,h){return m in T?Object.defineProperty(T,m,{value:h,enumerable:!0,configurable:!0,writable:!0}):T[m]=h,T}var o=u(u({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:_.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:D.default,bufferController:O.default,capLevelController:S.default,fpsController:b.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:a.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},g()),{},{subtitleStreamController:w.SubtitleStreamController,subtitleTrackController:M.default,timelineController:C.TimelineController,audioStreamController:c.default,audioTrackController:p.default,emeController:I.default,cmcdController:L.default});function g(){return{cueHandler:l.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function f(T,m){if((m.liveSyncDurationCount||m.liveMaxLatencyDurationCount)&&(m.liveSyncDuration||m.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(m.liveMaxLatencyDurationCount!==void 0&&(m.liveSyncDurationCount===void 0||m.liveMaxLatencyDurationCount<=m.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(m.liveMaxLatencyDuration!==void 0&&(m.liveSyncDuration===void 0||m.liveMaxLatencyDuration<=m.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return y({},T,m)}function v(T){var m=T.loader;if(m!==x.default&&m!==_.default)d.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),T.progressive=!1;else{var h=Object(x.fetchSupported)();h&&(T.loader=x.default,T.progressive=!0,T.enableSoftwareAES=!0,d.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(n,i,r){r.r(i);var D=r("./src/polyfills/number.ts"),c=r("./src/utils/ewma-bandwidth-estimator.ts"),p=r("./src/events.ts"),w=r("./src/utils/buffer-helper.ts"),M=r("./src/errors.ts"),O=r("./src/types/loader.ts"),C=r("./src/utils/logger.ts");function S(L,_){for(var x=0;x<_.length;x++){var l=_[x];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(L,l.key,l)}}function b(L,_,x){return _&&S(L.prototype,_),x&&S(L,x),Object.defineProperty(L,"prototype",{writable:!1}),L}var I=function(){function L(x){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=x;var l=x.config;this.bwEstimator=new c.default(l.abrEwmaSlowVoD,l.abrEwmaFastVoD,l.abrEwmaDefaultEstimate),this.registerListeners()}var _=L.prototype;return _.registerListeners=function(){var l=this.hls;l.on(p.Events.FRAG_LOADING,this.onFragLoading,this),l.on(p.Events.FRAG_LOADED,this.onFragLoaded,this),l.on(p.Events.FRAG_BUFFERED,this.onFragBuffered,this),l.on(p.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.on(p.Events.ERROR,this.onError,this)},_.unregisterListeners=function(){var l=this.hls;l.off(p.Events.FRAG_LOADING,this.onFragLoading,this),l.off(p.Events.FRAG_LOADED,this.onFragLoaded,this),l.off(p.Events.FRAG_BUFFERED,this.onFragBuffered,this),l.off(p.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.off(p.Events.ERROR,this.onError,this)},_.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},_.onFragLoading=function(l,a){var d=a.frag;if(d.type===O.PlaylistLevelType.MAIN&&!this.timer){var y;this.fragCurrent=d,this.partCurrent=(y=a.part)!=null?y:null,this.timer=self.setInterval(this.onCheck,100)}},_.onLevelLoaded=function(l,a){var d=this.hls.config;a.details.live?this.bwEstimator.update(d.abrEwmaSlowLive,d.abrEwmaFastLive):this.bwEstimator.update(d.abrEwmaSlowVoD,d.abrEwmaFastVoD)},_._abandonRulesCheck=function(){var l=this.fragCurrent,a=this.partCurrent,d=this.hls,y=d.autoLevelEnabled,E=d.config,u=d.media;if(!(!l||!u)){var s=a?a.stats:l.stats,o=a?a.duration:l.duration;if(s.aborted){C.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!y||u.paused||!u.playbackRate||!u.readyState)){var g=performance.now()-s.loading.start,f=Math.abs(u.playbackRate);if(!(g<=500*o/f)){var v=d.levels,T=d.minAutoLevel,m=v[l.level],h=s.total||Math.max(s.loaded,Math.round(o*m.maxBitrate/8)),A=Math.max(1,s.bwEstimate?s.bwEstimate/8:s.loaded*1e3/g),R=(h-s.loaded)/A,P=u.currentTime,k=(w.BufferHelper.bufferInfo(u,P,E.maxBufferHole).end-P)/f;if(!(k>=2*o/f||R<=k)){var j=Number.POSITIVE_INFINITY,K;for(K=l.level-1;K>T;K--){var W=v[K].maxBitrate;if(j=o*W/(8*.8*A),j<k)break}if(!(j>=R)){var H=this.bwEstimator.getEstimate();C.logger.warn("Fragment "+l.sn+(a?" part "+a.index:"")+" of level "+l.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+K+`
      Current BW estimate: `+(Object(D.isFiniteNumber)(H)?(H/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+R.toFixed(3)+` s
      Estimated load time for the next fragment: `+j.toFixed(3)+` s
      Time to underbuffer: `+k.toFixed(3)+" s"),d.nextLoadLevel=K,this.bwEstimator.sample(g,s.loaded),this.clearTimer(),l.loader&&(this.fragCurrent=this.partCurrent=null,l.loader.abort()),d.trigger(p.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:l,part:a,stats:s})}}}}}},_.onFragLoaded=function(l,a){var d=a.frag,y=a.part;if(d.type===O.PlaylistLevelType.MAIN&&Object(D.isFiniteNumber)(d.sn)){var E=y?y.stats:d.stats,u=y?y.duration:d.duration;if(this.clearTimer(),this.lastLoadedFragLevel=d.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var s=this.hls.levels[d.level],o=(s.loaded?s.loaded.bytes:0)+E.loaded,g=(s.loaded?s.loaded.duration:0)+u;s.loaded={bytes:o,duration:g},s.realBitrate=Math.round(8*o/g)}if(d.bitrateTest){var f={stats:E,frag:d,part:y,id:d.type};this.onFragBuffered(p.Events.FRAG_BUFFERED,f)}}},_.onFragBuffered=function(l,a){var d=a.frag,y=a.part,E=y?y.stats:d.stats;if(!E.aborted&&!(d.type!==O.PlaylistLevelType.MAIN||d.sn==="initSegment")){var u=E.parsing.end-E.loading.start;this.bwEstimator.sample(u,E.loaded),E.bwEstimate=this.bwEstimator.getEstimate(),d.bitrateTest?this.bitrateTestDelay=u/1e3:this.bitrateTestDelay=0}},_.onError=function(l,a){switch(a.details){case M.ErrorDetails.FRAG_LOAD_ERROR:case M.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}},_.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},_.getNextABRAutoLevel=function(){var l=this.fragCurrent,a=this.partCurrent,d=this.hls,y=d.maxAutoLevel,E=d.config,u=d.minAutoLevel,s=d.media,o=a?a.duration:l?l.duration:0,g=s?s.currentTime:0,f=s&&s.playbackRate!==0?Math.abs(s.playbackRate):1,v=this.bwEstimator?this.bwEstimator.getEstimate():E.abrEwmaDefaultEstimate,T=(w.BufferHelper.bufferInfo(s,g,E.maxBufferHole).end-g)/f,m=this.findBestLevel(v,u,y,T,E.abrBandWidthFactor,E.abrBandWidthUpFactor);if(m>=0)return m;C.logger.trace((T?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var h=o?Math.min(o,E.maxStarvationDelay):E.maxStarvationDelay,A=E.abrBandWidthFactor,R=E.abrBandWidthUpFactor;if(!T){var P=this.bitrateTestDelay;if(P){var k=o?Math.min(o,E.maxLoadingDelay):E.maxLoadingDelay;h=k-P,C.logger.trace("bitrate test took "+Math.round(1e3*P)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*h)+" ms"),A=R=1}}return m=this.findBestLevel(v,u,y,T+h,A,R),Math.max(m,0)},_.findBestLevel=function(l,a,d,y,E,u){for(var s,o=this.fragCurrent,g=this.partCurrent,f=this.lastLoadedFragLevel,v=this.hls.levels,T=v[f],m=!!(T!=null&&(s=T.details)!==null&&s!==void 0&&s.live),h=T==null?void 0:T.codecSet,A=g?g.duration:o?o.duration:0,R=d;R>=a;R--){var P=v[R];if(!(!P||h&&P.codecSet!==h)){var k=P.details,j=(g?k==null?void 0:k.partTarget:k==null?void 0:k.averagetargetduration)||A,K=void 0;R<=f?K=E*l:K=u*l;var W=v[R].maxBitrate,H=W*j/K;if(C.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+R+"/"+Math.round(K)+"/"+W+"/"+j+"/"+y+"/"+H),K>W&&(!H||m&&!this.bitrateTestDelay||H<y))return R}}return-1},b(L,[{key:"nextAutoLevel",get:function(){var l=this._nextAutoLevel,a=this.bwEstimator;if(l!==-1&&!a.canEstimate())return l;var d=this.getNextABRAutoLevel();return l!==-1&&this.hls.levels[d].loadError?l:(l!==-1&&(d=Math.min(l,d)),d)},set:function(l){this._nextAutoLevel=l}}]),L}();i.default=I},"./src/controller/audio-stream-controller.ts":function(n,i,r){r.r(i);var D=r("./src/polyfills/number.ts"),c=r("./src/controller/base-stream-controller.ts"),p=r("./src/events.ts"),w=r("./src/utils/buffer-helper.ts"),M=r("./src/controller/fragment-tracker.ts"),O=r("./src/types/level.ts"),C=r("./src/types/loader.ts"),S=r("./src/loader/fragment.ts"),b=r("./src/demux/chunk-cache.ts"),I=r("./src/demux/transmuxer-interface.ts"),L=r("./src/types/transmuxer.ts"),_=r("./src/controller/fragment-finders.ts"),x=r("./src/utils/discontinuities.ts"),l=r("./src/errors.ts");function a(){return a=Object.assign?Object.assign.bind():function(s){for(var o=1;o<arguments.length;o++){var g=arguments[o];for(var f in g)Object.prototype.hasOwnProperty.call(g,f)&&(s[f]=g[f])}return s},a.apply(this,arguments)}function d(s,o){s.prototype=Object.create(o.prototype),s.prototype.constructor=s,y(s,o)}function y(s,o){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(f,v){return f.__proto__=v,f},y(s,o)}var E=100,u=function(s){d(o,s);function o(f,v){var T;return T=s.call(this,f,v,"[audio-stream-controller]")||this,T.videoBuffer=null,T.videoTrackCC=-1,T.waitingVideoCC=-1,T.audioSwitch=!1,T.trackId=-1,T.waitingData=null,T.mainDetails=null,T.bufferFlushed=!1,T.cachedTrackLoadedData=null,T._registerListeners(),T}var g=o.prototype;return g.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},g._registerListeners=function(){var v=this.hls;v.on(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),v.on(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.on(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.on(p.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.on(p.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),v.on(p.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),v.on(p.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),v.on(p.Events.ERROR,this.onError,this),v.on(p.Events.BUFFER_RESET,this.onBufferReset,this),v.on(p.Events.BUFFER_CREATED,this.onBufferCreated,this),v.on(p.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),v.on(p.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),v.on(p.Events.FRAG_BUFFERED,this.onFragBuffered,this)},g._unregisterListeners=function(){var v=this.hls;v.off(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),v.off(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.off(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.off(p.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.off(p.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),v.off(p.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),v.off(p.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),v.off(p.Events.ERROR,this.onError,this),v.off(p.Events.BUFFER_RESET,this.onBufferReset,this),v.off(p.Events.BUFFER_CREATED,this.onBufferCreated,this),v.off(p.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),v.off(p.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),v.off(p.Events.FRAG_BUFFERED,this.onFragBuffered,this)},g.onInitPtsFound=function(v,T){var m=T.frag,h=T.id,A=T.initPTS;if(h==="main"){var R=m.cc;this.initPTS[m.cc]=A,this.log("InitPTS for cc: "+R+" found from main: "+A),this.videoTrackCC=R,this.state===c.State.WAITING_INIT_PTS&&this.tick()}},g.startLoad=function(v){if(!this.levels){this.startPosition=v,this.state=c.State.STOPPED;return}var T=this.lastCurrentTime;this.stopLoad(),this.setInterval(E),this.fragLoadError=0,T>0&&v===-1?(this.log("Override startPosition with lastCurrentTime @"+T.toFixed(3)),v=T,this.state=c.State.IDLE):(this.loadedmetadata=!1,this.state=c.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=v,this.tick()},g.doTick=function(){switch(this.state){case c.State.IDLE:this.doTickIdle();break;case c.State.WAITING_TRACK:{var v,T=this.levels,m=this.trackId,h=T==null||(v=T[m])===null||v===void 0?void 0:v.details;if(h){if(this.waitForCdnTuneIn(h))break;this.state=c.State.WAITING_INIT_PTS}break}case c.State.FRAG_LOADING_WAITING_RETRY:{var A,R=performance.now(),P=this.retryDate;(!P||R>=P||(A=this.media)!==null&&A!==void 0&&A.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=c.State.IDLE);break}case c.State.WAITING_INIT_PTS:{var k=this.waitingData;if(k){var j=k.frag,K=k.part,W=k.cache,H=k.complete;if(this.initPTS[j.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=c.State.FRAG_LOADING;var $=W.flush(),z={frag:j,part:K,payload:$,networkDetails:null};this._handleFragmentLoadProgress(z),H&&s.prototype._handleFragmentLoadComplete.call(this,z)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+j.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var J=this.getLoadPosition(),ee=w.BufferHelper.bufferInfo(this.mediaBuffer,J,this.config.maxBufferHole),re=Object(_.fragmentWithinToleranceTest)(ee.end,this.config.maxFragLookUpTolerance,j);re<0&&(this.log("Waiting fragment cc ("+j.cc+") @ "+j.start+" cancelled because another fragment at "+ee.end+" is needed"),this.clearWaitingFragment())}}else this.state=c.State.IDLE}}this.onTickEnd()},g.clearWaitingFragment=function(){var v=this.waitingData;v&&(this.fragmentTracker.removeFragment(v.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=c.State.IDLE)},g.resetLoadingState=function(){this.clearWaitingFragment(),s.prototype.resetLoadingState.call(this)},g.onTickEnd=function(){var v=this.media;if(!(!v||!v.readyState)){var T=this.mediaBuffer?this.mediaBuffer:v,m=T.buffered;!this.loadedmetadata&&m.length&&(this.loadedmetadata=!0),this.lastCurrentTime=v.currentTime}},g.doTickIdle=function(){var v,T,m=this.hls,h=this.levels,A=this.media,R=this.trackId,P=m.config;if(!(!h||!h[R])&&!(!A&&(this.startFragRequested||!P.startFragPrefetch))){var k=h[R],j=k.details;if(!j||j.live&&this.levelLastLoaded!==R||this.waitForCdnTuneIn(j)){this.state=c.State.WAITING_TRACK;return}var K=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&K&&(this.bufferFlushed=!1,this.afterBufferFlushed(K,S.ElementaryStreamTypes.AUDIO,C.PlaylistLevelType.AUDIO));var W=this.getFwdBufferInfo(K,C.PlaylistLevelType.AUDIO);if(W!==null){var H=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,C.PlaylistLevelType.MAIN),$=W.len,z=this.getMaxBufferLength(H==null?void 0:H.len),J=this.audioSwitch;if(!($>=z&&!J)){if(!J&&this._streamEnded(W,j)){m.trigger(p.Events.BUFFER_EOS,{type:"audio"}),this.state=c.State.ENDED;return}var ee=j.fragments,re=ee[0].start,ne=W.end;if(J&&A){var ae=this.getLoadPosition();ne=ae,j.PTSKnown&&ae<re&&(W.end>re||W.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),A.currentTime=re+.05)}if(!(H&&ne>H.end+j.targetduration)&&!((!H||!H.len)&&W.len)){var ce=this.getNextFragment(ne,j);if(!ce){this.bufferFlushed=!0;return}((v=ce.decryptdata)===null||v===void 0?void 0:v.keyFormat)==="identity"&&!((T=ce.decryptdata)!==null&&T!==void 0&&T.key)?this.loadKey(ce,j):this.loadFragment(ce,j,ne)}}}}},g.getMaxBufferLength=function(v){var T=s.prototype.getMaxBufferLength.call(this);return v?Math.max(T,v):T},g.onMediaDetaching=function(){this.videoBuffer=null,s.prototype.onMediaDetaching.call(this)},g.onAudioTracksUpdated=function(v,T){var m=T.audioTracks;this.resetTransmuxer(),this.levels=m.map(function(h){return new O.Level(h)})},g.onAudioTrackSwitching=function(v,T){var m=!!T.url;this.trackId=T.id;var h=this.fragCurrent;h!=null&&h.loader&&h.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),m?this.setInterval(E):this.resetTransmuxer(),m?(this.audioSwitch=!0,this.state=c.State.IDLE):this.state=c.State.STOPPED,this.tick()},g.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},g.onLevelLoaded=function(v,T){this.mainDetails=T.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(p.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},g.onAudioTrackLoaded=function(v,T){var m;if(this.mainDetails==null){this.cachedTrackLoadedData=T;return}var h=this.levels,A=T.details,R=T.id;if(!h){this.warn("Audio tracks were reset while loading level "+R);return}this.log("Track "+R+" loaded ["+A.startSN+","+A.endSN+"],duration:"+A.totalduration);var P=h[R],k=0;if(A.live||(m=P.details)!==null&&m!==void 0&&m.live){var j=this.mainDetails;if(A.fragments[0]||(A.deltaUpdateFailed=!0),A.deltaUpdateFailed||!j)return;!P.details&&A.hasProgramDateTime&&j.hasProgramDateTime?(Object(x.alignMediaPlaylistByPDT)(A,j),k=A.fragments[0].start):k=this.alignPlaylists(A,P.details)}P.details=A,this.levelLastLoaded=R,!this.startFragRequested&&(this.mainDetails||!A.live)&&this.setStartPosition(P.details,k),this.state===c.State.WAITING_TRACK&&!this.waitForCdnTuneIn(A)&&(this.state=c.State.IDLE),this.tick()},g._handleFragmentLoadProgress=function(v){var T,m=v.frag,h=v.part,A=v.payload,R=this.config,P=this.trackId,k=this.levels;if(!k){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+m.sn+" of level "+m.level+" will not be buffered");return}var j=k[P];console.assert(j,"Audio track is defined on fragment load progress");var K=j.details;console.assert(K,"Audio track details are defined on fragment load progress");var W=R.defaultAudioCodec||j.audioCodec||"mp4a.40.2",H=this.transmuxer;H||(H=this.transmuxer=new I.default(this.hls,C.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var $=this.initPTS[m.cc],z=(T=m.initSegment)===null||T===void 0?void 0:T.data;if($!==void 0){var J=!1,ee=h?h.index:-1,re=ee!==-1,ne=new L.ChunkMetadata(m.level,m.sn,m.stats.chunkCount,A.byteLength,ee,re);H.push(A,z,W,"",m,h,K.totalduration,J,ne,$)}else{this.log("Unknown video PTS for cc "+m.cc+", waiting for video PTS before demuxing audio frag "+m.sn+" of ["+K.startSN+" ,"+K.endSN+"],track "+P);var ae=this.waitingData=this.waitingData||{frag:m,part:h,cache:new b.default,complete:!1},ce=ae.cache;ce.push(new Uint8Array(A)),this.waitingVideoCC=this.videoTrackCC,this.state=c.State.WAITING_INIT_PTS}},g._handleFragmentLoadComplete=function(v){if(this.waitingData){this.waitingData.complete=!0;return}s.prototype._handleFragmentLoadComplete.call(this,v)},g.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},g.onBufferCreated=function(v,T){var m=T.tracks.audio;m&&(this.mediaBuffer=m.buffer||null),T.tracks.video&&(this.videoBuffer=T.tracks.video.buffer||null)},g.onFragBuffered=function(v,T){var m=T.frag,h=T.part;if(m.type===C.PlaylistLevelType.AUDIO){if(this.fragContextChanged(m)){this.warn("Fragment "+m.sn+(h?" p: "+h.index:"")+" of level "+m.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}m.sn!=="initSegment"&&(this.fragPrevious=m,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(p.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(m,h)}},g.onError=function(v,T){switch(T.details){case l.ErrorDetails.FRAG_LOAD_ERROR:case l.ErrorDetails.FRAG_LOAD_TIMEOUT:case l.ErrorDetails.KEY_LOAD_ERROR:case l.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(C.PlaylistLevelType.AUDIO,T);break;case l.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case l.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==c.State.ERROR&&this.state!==c.State.STOPPED&&(this.state=T.fatal?c.State.ERROR:c.State.IDLE,this.warn(T.details+" while loading frag, switching to "+this.state+" state"));break;case l.ErrorDetails.BUFFER_FULL_ERROR:if(T.parent==="audio"&&(this.state===c.State.PARSING||this.state===c.State.PARSED)){var m=!0,h=this.getFwdBufferInfo(this.mediaBuffer,C.PlaylistLevelType.AUDIO);h&&h.len>.5&&(m=!this.reduceMaxBufferLength(h.len)),m&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,s.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},g.onBufferFlushed=function(v,T){var m=T.type;m===S.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},g._handleTransmuxComplete=function(v){var T,m="audio",h=this.hls,A=v.remuxResult,R=v.chunkMeta,P=this.getCurrentContext(R);if(!P){this.warn("The loading context changed while buffering fragment "+R.sn+" of level "+R.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(R.level);return}var k=P.frag,j=P.part,K=P.level.details,W=A.audio,H=A.text,$=A.id3,z=A.initSegment;if(!(this.fragContextChanged(k)||!K)){if(this.state=c.State.PARSING,this.audioSwitch&&W&&this.completeAudioSwitch(),z!=null&&z.tracks&&(this._bufferInitSegment(z.tracks,k,R),h.trigger(p.Events.FRAG_PARSING_INIT_SEGMENT,{frag:k,id:m,tracks:z.tracks})),W){var J=W.startPTS,ee=W.endPTS,re=W.startDTS,ne=W.endDTS;j&&(j.elementaryStreams[S.ElementaryStreamTypes.AUDIO]={startPTS:J,endPTS:ee,startDTS:re,endDTS:ne}),k.setElementaryStreamInfo(S.ElementaryStreamTypes.AUDIO,J,ee,re,ne),this.bufferFragmentData(W,k,j,R)}if($!=null&&(T=$.samples)!==null&&T!==void 0&&T.length){var ae=a({id:m,frag:k,details:K},$);h.trigger(p.Events.FRAG_PARSING_METADATA,ae)}if(H){var ce=a({id:m,frag:k,details:K},H);h.trigger(p.Events.FRAG_PARSING_USERDATA,ce)}}},g._bufferInitSegment=function(v,T,m){if(this.state===c.State.PARSING){v.video&&delete v.video;var h=v.audio;if(!!h){h.levelCodec=h.codec,h.id="audio",this.log("Init audio buffer, container:"+h.container+", codecs[parsed]=["+h.codec+"]"),this.hls.trigger(p.Events.BUFFER_CODECS,v);var A=h.initSegment;if(A!=null&&A.byteLength){var R={type:"audio",frag:T,part:null,chunkMeta:m,parent:T.type,data:A};this.hls.trigger(p.Events.BUFFER_APPENDING,R)}this.tick()}}},g.loadFragment=function(v,T,m){var h=this.fragmentTracker.getState(v);this.fragCurrent=v,(this.audioSwitch||h===M.FragmentState.NOT_LOADED||h===M.FragmentState.PARTIAL)&&(v.sn==="initSegment"?this._loadInitSegment(v):T.live&&!Object(D.isFiniteNumber)(this.initPTS[v.cc])?(this.log("Waiting for video PTS in continuity counter "+v.cc+" of live stream before loading audio fragment "+v.sn+" of level "+this.trackId),this.state=c.State.WAITING_INIT_PTS):(this.startFragRequested=!0,s.prototype.loadFragment.call(this,v,T,m)))},g.completeAudioSwitch=function(){var v=this.hls,T=this.media,m=this.trackId;T&&(this.log("Switching audio track : flushing all audio"),s.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,v.trigger(p.Events.AUDIO_TRACK_SWITCHED,{id:m})},o}(c.default);i.default=u},"./src/controller/audio-track-controller.ts":function(n,i,r){r.r(i);var D=r("./src/events.ts"),c=r("./src/errors.ts"),p=r("./src/controller/base-playlist-controller.ts"),w=r("./src/types/loader.ts");function M(I,L){for(var _=0;_<L.length;_++){var x=L[_];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(I,x.key,x)}}function O(I,L,_){return L&&M(I.prototype,L),_&&M(I,_),Object.defineProperty(I,"prototype",{writable:!1}),I}function C(I,L){I.prototype=Object.create(L.prototype),I.prototype.constructor=I,S(I,L)}function S(I,L){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(x,l){return x.__proto__=l,x},S(I,L)}var b=function(I){C(L,I);function L(x){var l;return l=I.call(this,x,"[audio-track-controller]")||this,l.tracks=[],l.groupId=null,l.tracksInGroup=[],l.trackId=-1,l.trackName="",l.selectDefaultTrack=!0,l.registerListeners(),l}var _=L.prototype;return _.registerListeners=function(){var l=this.hls;l.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),l.on(D.Events.LEVEL_LOADING,this.onLevelLoading,this),l.on(D.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),l.on(D.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),l.on(D.Events.ERROR,this.onError,this)},_.unregisterListeners=function(){var l=this.hls;l.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),l.off(D.Events.LEVEL_LOADING,this.onLevelLoading,this),l.off(D.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),l.off(D.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),l.off(D.Events.ERROR,this.onError,this)},_.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,I.prototype.destroy.call(this)},_.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},_.onManifestParsed=function(l,a){this.tracks=a.audioTracks||[]},_.onAudioTrackLoaded=function(l,a){var d=a.id,y=a.details,E=this.tracksInGroup[d];if(!E){this.warn("Invalid audio track id "+d);return}var u=E.details;E.details=a.details,this.log("audioTrack "+d+" loaded ["+y.startSN+"-"+y.endSN+"]"),d===this.trackId&&(this.retryCount=0,this.playlistLoaded(d,a,u))},_.onLevelLoading=function(l,a){this.switchLevel(a.level)},_.onLevelSwitching=function(l,a){this.switchLevel(a.level)},_.switchLevel=function(l){var a=this.hls.levels[l];if(!!(a!=null&&a.audioGroupIds)){var d=a.audioGroupIds[a.urlId];if(this.groupId!==d){this.groupId=d;var y=this.tracks.filter(function(u){return!d||u.groupId===d});this.selectDefaultTrack&&!y.some(function(u){return u.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=y;var E={audioTracks:y};this.log("Updating audio tracks, "+y.length+' track(s) found in "'+d+'" group-id'),this.hls.trigger(D.Events.AUDIO_TRACKS_UPDATED,E),this.selectInitialTrack()}}},_.onError=function(l,a){I.prototype.onError.call(this,l,a),!(a.fatal||!a.context)&&a.context.type===w.PlaylistContextType.AUDIO_TRACK&&a.context.id===this.trackId&&a.context.groupId===this.groupId&&this.retryLoadingOrFail(a)},_.setAudioTrack=function(l){var a=this.tracksInGroup;if(l<0||l>=a.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var d=a[this.trackId];this.log("Now switching to audio-track index "+l);var y=a[l],E=y.id,u=y.groupId,s=u===void 0?"":u,o=y.name,g=y.type,f=y.url;if(this.trackId=l,this.trackName=o,this.selectDefaultTrack=!1,this.hls.trigger(D.Events.AUDIO_TRACK_SWITCHING,{id:E,groupId:s,name:o,type:g,url:f}),!(y.details&&!y.details.live)){var v=this.switchParams(y.url,d==null?void 0:d.details);this.loadPlaylist(v)}},_.selectInitialTrack=function(){var l=this.tracksInGroup;console.assert(l.length,"Initial audio track should be selected when tracks are known");var a=this.trackName,d=this.findTrackId(a)||this.findTrackId();d!==-1?this.setAudioTrack(d):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(D.Events.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},_.findTrackId=function(l){for(var a=this.tracksInGroup,d=0;d<a.length;d++){var y=a[d];if((!this.selectDefaultTrack||y.default)&&(!l||l===y.name))return y.id}return-1},_.loadPlaylist=function(l){var a=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(a)){var d=a.id,y=a.groupId,E=a.url;if(l)try{E=l.addDirectives(E)}catch(u){this.warn("Could not construct new URL with HLS Delivery Directives: "+u)}this.log("loading audio-track playlist for id: "+d),this.clearTimer(),this.hls.trigger(D.Events.AUDIO_TRACK_LOADING,{url:E,id:d,groupId:y,deliveryDirectives:l||null})}},O(L,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(l){this.selectDefaultTrack=!1,this.setAudioTrack(l)}}]),L}(p.default);i.default=b},"./src/controller/base-playlist-controller.ts":function(n,i,r){r.r(i),r.d(i,"default",function(){return O});var D=r("./src/polyfills/number.ts"),c=r("./src/types/level.ts"),p=r("./src/controller/level-helper.ts"),w=r("./src/utils/logger.ts"),M=r("./src/errors.ts"),O=function(){function C(b,I){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=w.logger.log.bind(w.logger,I+":"),this.warn=w.logger.warn.bind(w.logger,I+":"),this.hls=b}var S=C.prototype;return S.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},S.onError=function(I,L){L.fatal&&L.type===M.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},S.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},S.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},S.stopLoad=function(){this.canLoad=!1,this.clearTimer()},S.switchParams=function(I,L){var _=L==null?void 0:L.renditionReports;if(_)for(var x=0;x<_.length;x++){var l=_[x],a=""+l.URI;if(a===I.slice(-a.length)){var d=parseInt(l["LAST-MSN"]),y=parseInt(l["LAST-PART"]);if(L&&this.hls.config.lowLatencyMode){var E=Math.min(L.age-L.partTarget,L.targetduration);y!==void 0&&E>L.partTarget&&(y+=1)}if(Object(D.isFiniteNumber)(d))return new c.HlsUrlParameters(d,Object(D.isFiniteNumber)(y)?y:void 0,c.HlsSkip.No)}}},S.loadPlaylist=function(I){},S.shouldLoadTrack=function(I){return this.canLoad&&I&&!!I.url&&(!I.details||I.details.live)},S.playlistLoaded=function(I,L,_){var x=this,l=L.details,a=L.stats,d=a.loading.end?Math.max(0,self.performance.now()-a.loading.end):0;if(l.advancedDateTime=Date.now()-d,l.live||_!=null&&_.live){if(l.reloaded(_),_&&this.log("live playlist "+I+" "+(l.advanced?"REFRESHED "+l.lastPartSn+"-"+l.lastPartIndex:"MISSED")),_&&l.fragments.length>0&&Object(p.mergeDetails)(_,l),!this.canLoad||!l.live)return;var y,E=void 0,u=void 0;if(l.canBlockReload&&l.endSN&&l.advanced){var s=this.hls.config.lowLatencyMode,o=l.lastPartSn,g=l.endSN,f=l.lastPartIndex,v=f!==-1,T=o===g,m=s?0:f;v?(E=T?g+1:o,u=T?m:f+1):E=g+1;var h=l.age,A=h+l.ageHeader,R=Math.min(A-l.partTarget,l.targetduration*1.5);if(R>0){if(_&&R>_.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+_.tuneInGoal+" to: "+R+" with playlist age: "+l.age),R=0;else{var P=Math.floor(R/l.targetduration);if(E+=P,u!==void 0){var k=Math.round(R%l.targetduration/l.partTarget);u+=k}this.log("CDN Tune-in age: "+l.ageHeader+"s last advanced "+h.toFixed(2)+"s goal: "+R+" skip sn "+P+" to part "+u)}l.tuneInGoal=R}if(y=this.getDeliveryDirectives(l,L.deliveryDirectives,E,u),s||!T){this.loadPlaylist(y);return}}else y=this.getDeliveryDirectives(l,L.deliveryDirectives,E,u);var j=Object(p.computeReloadInterval)(l,a);E!==void 0&&l.canBlockReload&&(j-=l.partTarget||1),this.log("reload live playlist "+I+" in "+Math.round(j)+" ms"),this.timer=self.setTimeout(function(){return x.loadPlaylist(y)},j)}else this.clearTimer()},S.getDeliveryDirectives=function(I,L,_,x){var l=Object(c.getSkipValue)(I,_);return L!=null&&L.skip&&I.deltaUpdateFailed&&(_=L.msn,x=L.part,l=c.HlsSkip.No),new c.HlsUrlParameters(_,x,l)},S.retryLoadingOrFail=function(I){var L=this,_=this.hls.config,x=this.retryCount<_.levelLoadingMaxRetry;if(x){var l;if(this.retryCount++,I.details.indexOf("LoadTimeOut")>-1&&(l=I.context)!==null&&l!==void 0&&l.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+I.details+'"'),this.loadPlaylist();else{var a=Math.min(Math.pow(2,this.retryCount)*_.levelLoadingRetryDelay,_.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return L.loadPlaylist()},a),this.warn("retry playlist loading #"+this.retryCount+" in "+a+' ms after "'+I.details+'"')}}else this.warn('cannot recover from error "'+I.details+'"'),this.clearTimer(),I.fatal=!0;return x},C}()},"./src/controller/base-stream-controller.ts":function(n,i,r){r.r(i),r.d(i,"State",function(){return g}),r.d(i,"default",function(){return f});var D=r("./src/polyfills/number.ts"),c=r("./src/task-loop.ts"),p=r("./src/controller/fragment-tracker.ts"),w=r("./src/utils/buffer-helper.ts"),M=r("./src/utils/logger.ts"),O=r("./src/events.ts"),C=r("./src/errors.ts"),S=r("./src/types/transmuxer.ts"),b=r("./src/utils/mp4-tools.ts"),I=r("./src/utils/discontinuities.ts"),L=r("./src/controller/fragment-finders.ts"),_=r("./src/controller/level-helper.ts"),x=r("./src/loader/fragment-loader.ts"),l=r("./src/crypt/decrypter.ts"),a=r("./src/utils/time-ranges.ts"),d=r("./src/types/loader.ts");function y(v,T){for(var m=0;m<T.length;m++){var h=T[m];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(v,h.key,h)}}function E(v,T,m){return T&&y(v.prototype,T),m&&y(v,m),Object.defineProperty(v,"prototype",{writable:!1}),v}function u(v){if(v===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return v}function s(v,T){v.prototype=Object.create(T.prototype),v.prototype.constructor=v,o(v,T)}function o(v,T){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,A){return h.__proto__=A,h},o(v,T)}var g={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},f=function(v){s(T,v);function T(h,A,R){var P;return P=v.call(this)||this,P.hls=void 0,P.fragPrevious=null,P.fragCurrent=null,P.fragmentTracker=void 0,P.transmuxer=null,P._state=g.STOPPED,P.media=null,P.mediaBuffer=null,P.config=void 0,P.bitrateTest=!1,P.lastCurrentTime=0,P.nextLoadPosition=0,P.startPosition=0,P.loadedmetadata=!1,P.fragLoadError=0,P.retryDate=0,P.levels=null,P.fragmentLoader=void 0,P.levelLastLoaded=null,P.startFragRequested=!1,P.decrypter=void 0,P.initPTS=[],P.onvseeking=null,P.onvended=null,P.logPrefix="",P.log=void 0,P.warn=void 0,P.logPrefix=R,P.log=M.logger.log.bind(M.logger,R+":"),P.warn=M.logger.warn.bind(M.logger,R+":"),P.hls=h,P.fragmentLoader=new x.default(h.config),P.fragmentTracker=A,P.config=h.config,P.decrypter=new l.default(h,h.config),h.on(O.Events.KEY_LOADED,P.onKeyLoaded,u(P)),h.on(O.Events.LEVEL_SWITCHING,P.onLevelSwitching,u(P)),P}var m=T.prototype;return m.doTick=function(){this.onTickEnd()},m.onTickEnd=function(){},m.startLoad=function(A){},m.stopLoad=function(){this.fragmentLoader.abort();var A=this.fragCurrent;A&&this.fragmentTracker.removeFragment(A),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=g.STOPPED},m._streamEnded=function(A,R){var P=this.fragCurrent,k=this.fragmentTracker;if(!R.live&&P&&this.media&&P.sn>=R.endSN&&!A.nextStart){var j=R.partList;if(j!=null&&j.length){var K=j[j.length-1],W=w.BufferHelper.isBuffered(this.media,K.start+K.duration/2);return W}var H=k.getState(P);return H===p.FragmentState.PARTIAL||H===p.FragmentState.OK}return!1},m.onMediaAttached=function(A,R){var P=this.media=this.mediaBuffer=R.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),P.addEventListener("seeking",this.onvseeking),P.addEventListener("ended",this.onvended);var k=this.config;this.levels&&k.autoStartLoad&&this.state===g.STOPPED&&this.startLoad(k.startPosition)},m.onMediaDetaching=function(){var A=this.media;A!=null&&A.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),A&&this.onvseeking&&this.onvended&&(A.removeEventListener("seeking",this.onvseeking),A.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},m.onMediaSeeking=function(){var A=this.config,R=this.fragCurrent,P=this.media,k=this.mediaBuffer,j=this.state,K=P?P.currentTime:0,W=w.BufferHelper.bufferInfo(k||P,K,A.maxBufferHole);if(this.log("media seeking to "+(Object(D.isFiniteNumber)(K)?K.toFixed(3):K)+", state: "+j),j===g.ENDED)this.resetLoadingState();else if(R&&!W.len){var H=A.maxFragLookUpTolerance,$=R.start-H,z=R.start+R.duration+H,J=K>z;(K<$||J)&&(J&&R.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),R.loader.abort()),this.resetLoadingState())}P&&(this.lastCurrentTime=K),!this.loadedmetadata&&!W.len&&(this.nextLoadPosition=this.startPosition=K),this.tickImmediate()},m.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},m.onKeyLoaded=function(A,R){if(!(this.state!==g.KEY_LOADING||R.frag!==this.fragCurrent||!this.levels)){this.state=g.IDLE;var P=this.levels[R.frag.level].details;P&&this.loadFragment(R.frag,P,R.frag.start)}},m.onLevelSwitching=function(A,R){this.fragLoadError=0},m.onHandlerDestroying=function(){this.stopLoad(),v.prototype.onHandlerDestroying.call(this)},m.onHandlerDestroyed=function(){this.state=g.STOPPED,this.hls.off(O.Events.KEY_LOADED,this.onKeyLoaded,this),this.hls.off(O.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,v.prototype.onHandlerDestroyed.call(this)},m.loadKey=function(A,R){this.log("Loading key for "+A.sn+" of ["+R.startSN+"-"+R.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+A.level),this.state=g.KEY_LOADING,this.fragCurrent=A,this.hls.trigger(O.Events.KEY_LOADING,{frag:A})},m.loadFragment=function(A,R,P){this._loadFragForPlayback(A,R,P)},m._loadFragForPlayback=function(A,R,P){var k=this,j=function(W){if(k.fragContextChanged(A)){k.warn("Fragment "+A.sn+(W.part?" p: "+W.part.index:"")+" of level "+A.level+" was dropped during download."),k.fragmentTracker.removeFragment(A);return}A.stats.chunkCount++,k._handleFragmentLoadProgress(W)};this._doFragLoad(A,R,P,j).then(function(K){if(!!K){k.fragLoadError=0;var W=k.state;if(k.fragContextChanged(A)){(W===g.FRAG_LOADING||!k.fragCurrent&&W===g.PARSING)&&(k.fragmentTracker.removeFragment(A),k.state=g.IDLE);return}"payload"in K&&(k.log("Loaded fragment "+A.sn+" of level "+A.level),k.hls.trigger(O.Events.FRAG_LOADED,K)),k._handleFragmentLoadComplete(K)}}).catch(function(K){k.state===g.STOPPED||k.state===g.ERROR||(k.warn(K),k.resetFragmentLoading(A))})},m.flushMainBuffer=function(A,R,P){if(P===void 0&&(P=null),!!(A-R)){var k={startOffset:A,endOffset:R,type:P};this.fragLoadError=0,this.hls.trigger(O.Events.BUFFER_FLUSHING,k)}},m._loadInitSegment=function(A){var R=this;this._doFragLoad(A).then(function(P){if(!P||R.fragContextChanged(A)||!R.levels)throw new Error("init load aborted");return P}).then(function(P){var k=R.hls,j=P.payload,K=A.decryptdata;if(j&&j.byteLength>0&&K&&K.key&&K.iv&&K.method==="AES-128"){var W=self.performance.now();return R.decrypter.webCryptoDecrypt(new Uint8Array(j),K.key.buffer,K.iv.buffer).then(function(H){var $=self.performance.now();return k.trigger(O.Events.FRAG_DECRYPTED,{frag:A,payload:H,stats:{tstart:W,tdecrypt:$}}),P.payload=H,P})}return P}).then(function(P){var k=R.fragCurrent,j=R.hls,K=R.levels;if(!K)throw new Error("init load aborted, missing levels");var W=K[A.level].details;console.assert(W,"Level details are defined when init segment is loaded");var H=A.stats;R.state=g.IDLE,R.fragLoadError=0,A.data=new Uint8Array(P.payload),H.parsing.start=H.buffering.start=self.performance.now(),H.parsing.end=H.buffering.end=self.performance.now(),P.frag===k&&j.trigger(O.Events.FRAG_BUFFERED,{stats:H,frag:k,part:null,id:A.type}),R.tick()}).catch(function(P){R.state===g.STOPPED||R.state===g.ERROR||(R.warn(P),R.resetFragmentLoading(A))})},m.fragContextChanged=function(A){var R=this.fragCurrent;return!A||!R||A.level!==R.level||A.sn!==R.sn||A.urlId!==R.urlId},m.fragBufferedComplete=function(A,R){var P=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+A.type+" sn: "+A.sn+(R?" part: "+R.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+A.level+" "+(P?a.default.toString(w.BufferHelper.getBuffered(P)):"(detached)")),this.state=g.IDLE,P&&(!this.loadedmetadata&&P.buffered.length&&this.fragCurrent===this.fragPrevious&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},m.seekToStartPos=function(){},m._handleFragmentLoadComplete=function(A){var R=this.transmuxer;if(!!R){var P=A.frag,k=A.part,j=A.partsLoaded,K=!j||j.length===0||j.some(function(H){return!H}),W=new S.ChunkMetadata(P.level,P.sn,P.stats.chunkCount+1,0,k?k.index:-1,!K);R.flush(W)}},m._handleFragmentLoadProgress=function(A){},m._doFragLoad=function(A,R,P,k){var j=this;if(P===void 0&&(P=null),!this.levels)throw new Error("frag load aborted, missing levels");if(P=Math.max(A.start,P||0),this.config.lowLatencyMode&&R){var K=R.partList;if(K&&k){P>A.end&&R.fragmentHint&&(A=R.fragmentHint);var W=this.getNextPart(K,A,P);if(W>-1){var H=K[W];return this.log("Loading part sn: "+A.sn+" p: "+H.index+" cc: "+A.cc+" of playlist ["+R.startSN+"-"+R.endSN+"] parts [0-"+W+"-"+(K.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+A.level+", target: "+parseFloat(P.toFixed(3))),this.nextLoadPosition=H.start+H.duration,this.state=g.FRAG_LOADING,this.hls.trigger(O.Events.FRAG_LOADING,{frag:A,part:K[W],targetBufferTime:P}),this.doFragPartsLoad(A,K,W,k).catch(function($){return j.handleFragLoadError($)})}else if(!A.url||this.loadedEndOfParts(K,P))return Promise.resolve(null)}}return this.log("Loading fragment "+A.sn+" cc: "+A.cc+" "+(R?"of ["+R.startSN+"-"+R.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+A.level+", target: "+parseFloat(P.toFixed(3))),Object(D.isFiniteNumber)(A.sn)&&!this.bitrateTest&&(this.nextLoadPosition=A.start+A.duration),this.state=g.FRAG_LOADING,this.hls.trigger(O.Events.FRAG_LOADING,{frag:A,targetBufferTime:P}),this.fragmentLoader.load(A,k).catch(function($){return j.handleFragLoadError($)})},m.doFragPartsLoad=function(A,R,P,k){var j=this;return new Promise(function(K,W){var H=[],$=function z(J){var ee=R[J];j.fragmentLoader.loadPart(A,ee,k).then(function(re){H[ee.index]=re;var ne=re.part;j.hls.trigger(O.Events.FRAG_LOADED,re);var ae=R[J+1];if(ae&&ae.fragment===A)z(J+1);else return K({frag:A,part:ne,partsLoaded:H})}).catch(W)};$(P)})},m.handleFragLoadError=function(A){var R=A.data;return R&&R.details===C.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(R.frag,R.part):this.hls.trigger(O.Events.ERROR,R),null},m._handleTransmuxerFlush=function(A){var R=this.getCurrentContext(A);if(!R||this.state!==g.PARSING){this.fragCurrent||(this.state=g.IDLE);return}var P=R.frag,k=R.part,j=R.level,K=self.performance.now();P.stats.parsing.end=K,k&&(k.stats.parsing.end=K),this.updateLevelTiming(P,k,j,A.partial)},m.getCurrentContext=function(A){var R=this.levels,P=A.level,k=A.sn,j=A.part;if(!R||!R[P])return this.warn("Levels object was unset while buffering fragment "+k+" of level "+P+". The current chunk will not be buffered."),null;var K=R[P],W=j>-1?Object(_.getPartWith)(K,k,j):null,H=W?W.fragment:Object(_.getFragmentWithSN)(K,k,this.fragCurrent);return H?{frag:H,part:W,level:K}:null},m.bufferFragmentData=function(A,R,P,k){if(!(!A||this.state!==g.PARSING)){var j=A.data1,K=A.data2,W=j;if(j&&K&&(W=Object(b.appendUint8Array)(j,K)),!(!W||!W.length)){var H={type:A.type,frag:R,part:P,chunkMeta:k,parent:R.type,data:W};this.hls.trigger(O.Events.BUFFER_APPENDING,H),A.dropped&&A.independent&&!P&&this.flushBufferGap(R)}}},m.flushBufferGap=function(A){var R=this.media;if(!!R){if(!w.BufferHelper.isBuffered(R,R.currentTime)){this.flushMainBuffer(0,A.start);return}var P=R.currentTime,k=w.BufferHelper.bufferInfo(R,P,0),j=A.duration,K=Math.min(this.config.maxFragLookUpTolerance*2,j*.25),W=Math.max(Math.min(A.start-K,k.end-K),P+K);A.start-W>K&&this.flushMainBuffer(W,A.start)}},m.getFwdBufferInfo=function(A,R){var P=this.config,k=this.getLoadPosition();if(!Object(D.isFiniteNumber)(k))return null;var j=w.BufferHelper.bufferInfo(A,k,P.maxBufferHole);if(j.len===0&&j.nextStart!==void 0){var K=this.fragmentTracker.getBufferedFrag(k,R);if(K&&j.nextStart<K.end)return w.BufferHelper.bufferInfo(A,k,Math.max(j.nextStart,P.maxBufferHole))}return j},m.getMaxBufferLength=function(A){var R=this.config,P;return A?P=Math.max(8*R.maxBufferSize/A,R.maxBufferLength):P=R.maxBufferLength,Math.min(P,R.maxMaxBufferLength)},m.reduceMaxBufferLength=function(A){var R=this.config,P=A||R.maxBufferLength;return R.maxMaxBufferLength>=P?(R.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+R.maxMaxBufferLength+"s"),!0):!1},m.getNextFragment=function(A,R){var P=R.fragments,k=P.length;if(!k)return null;var j=this.config,K=P[0].start,W;if(R.live){var H=j.initialLiveManifestSize;if(k<H)return this.warn("Not enough fragments to start playback (have: "+k+", need: "+H+")"),null;!R.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(W=this.getInitialLiveFragment(R,P),this.startPosition=W?this.hls.liveSyncPosition||W.start:A)}else A<=K&&(W=P[0]);if(!W){var $=j.lowLatencyMode?R.partEnd:R.fragmentEnd;W=this.getFragmentAtPosition(A,$,R)}return this.mapToInitFragWhenRequired(W)},m.mapToInitFragWhenRequired=function(A){return A!=null&&A.initSegment&&!(A!=null&&A.initSegment.data)&&!this.bitrateTest?A.initSegment:A},m.getNextPart=function(A,R,P){for(var k=-1,j=!1,K=!0,W=0,H=A.length;W<H;W++){var $=A[W];if(K=K&&!$.independent,k>-1&&P<$.start)break;var z=$.loaded;!z&&(j||$.independent||K)&&$.fragment===R&&(k=W),j=z}return k},m.loadedEndOfParts=function(A,R){var P=A[A.length-1];return P&&R>P.start&&P.loaded},m.getInitialLiveFragment=function(A,R){var P=this.fragPrevious,k=null;if(P){if(A.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+P.programDateTime),k=Object(L.findFragmentByPDT)(R,P.endProgramDateTime,this.config.maxFragLookUpTolerance)),!k){var j=P.sn+1;if(j>=A.startSN&&j<=A.endSN){var K=R[j-A.startSN];P.cc===K.cc&&(k=K,this.log("Live playlist, switching playlist, load frag with next SN: "+k.sn))}k||(k=Object(L.findFragWithCC)(R,P.cc),k&&this.log("Live playlist, switching playlist, load frag with same CC: "+k.sn))}}else{var W=this.hls.liveSyncPosition;W!==null&&(k=this.getFragmentAtPosition(W,this.bitrateTest?A.fragmentEnd:A.edge,A))}return k},m.getFragmentAtPosition=function(A,R,P){var k=this.config,j=this.fragPrevious,K=P.fragments,W=P.endSN,H=P.fragmentHint,$=k.maxFragLookUpTolerance,z=!!(k.lowLatencyMode&&P.partList&&H);z&&H&&!this.bitrateTest&&(K=K.concat(H),W=H.sn);var J;if(A<R){var ee=A>R-$?0:$;J=Object(L.findFragmentByPTS)(j,K,A,ee)}else J=K[K.length-1];if(J){var re=J.sn-P.startSN;if(j&&J.sn===j.sn&&!z){var ne=j&&J.level===j.level;if(ne){var ae=K[re+1];J.sn<W&&this.fragmentTracker.getState(ae)!==p.FragmentState.OK?(this.log("SN "+J.sn+" just loaded, load next one: "+ae.sn),J=ae):J=null}}}return J},m.synchronizeToLiveEdge=function(A){var R=this.config,P=this.media;if(!!P){var k=this.hls.liveSyncPosition,j=P.currentTime,K=A.fragments[0].start,W=A.edge,H=j>=K-R.maxFragLookUpTolerance&&j<=W;if(k!==null&&P.duration>k&&(j<k||!H)){var $=R.liveMaxLatencyDuration!==void 0?R.liveMaxLatencyDuration:R.liveMaxLatencyDurationCount*A.targetduration;(!H&&P.readyState<4||j<W-$)&&(this.loadedmetadata||(this.nextLoadPosition=k),P.readyState&&(this.warn("Playback: "+j.toFixed(3)+" is located too far from the end of live sliding playlist: "+W+", reset currentTime to : "+k.toFixed(3)),P.currentTime=k))}}},m.alignPlaylists=function(A,R){var P=this.levels,k=this.levelLastLoaded,j=this.fragPrevious,K=k!==null?P[k]:null,W=A.fragments.length;if(!W)return this.warn("No fragments in live playlist"),0;var H=A.fragments[0].start,$=!R,z=A.alignedSliding&&Object(D.isFiniteNumber)(H);if($||!z&&!H){Object(I.alignStream)(j,K,A);var J=A.fragments[0].start;return this.log("Live playlist sliding: "+J.toFixed(2)+" start-sn: "+(R?R.startSN:"na")+"->"+A.startSN+" prev-sn: "+(j?j.sn:"na")+" fragments: "+W),J}return H},m.waitForCdnTuneIn=function(A){var R=3;return A.live&&A.canBlockReload&&A.partTarget&&A.tuneInGoal>Math.max(A.partHoldBack,A.partTarget*R)},m.setStartPosition=function(A,R){var P=this.startPosition;if(P<R&&(P=-1),P===-1||this.lastCurrentTime===-1){var k=A.startTimeOffset;Object(D.isFiniteNumber)(k)?(P=R+k,k<0&&(P+=A.totalduration),P=Math.min(Math.max(R,P),R+A.totalduration),this.log("Start time offset "+k+" found in playlist, adjust startPosition to "+P),this.startPosition=P):A.live?P=this.hls.liveSyncPosition||R:this.startPosition=P=0,this.lastCurrentTime=P}this.nextLoadPosition=P},m.getLoadPosition=function(){var A=this.media,R=0;return this.loadedmetadata&&A?R=A.currentTime:this.nextLoadPosition&&(R=this.nextLoadPosition),R},m.handleFragLoadAborted=function(A,R){this.transmuxer&&A.sn!=="initSegment"&&A.stats.aborted&&(this.warn("Fragment "+A.sn+(R?" part"+R.index:"")+" of level "+A.level+" was aborted"),this.resetFragmentLoading(A))},m.resetFragmentLoading=function(A){(!this.fragCurrent||!this.fragContextChanged(A)&&this.state!==g.FRAG_LOADING_WAITING_RETRY)&&(this.state=g.IDLE)},m.onFragmentOrKeyLoadError=function(A,R){if(!R.fatal){var P=R.frag;if(!(!P||P.type!==A)){var k=this.fragCurrent;console.assert(k&&P.sn===k.sn&&P.level===k.level&&P.urlId===k.urlId,"Frag load error must match current frag to retry");var j=this.config;if(this.fragLoadError+1<=j.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var K=Math.min(Math.pow(2,this.fragLoadError)*j.fragLoadingRetryDelay,j.fragLoadingMaxRetryTimeout);this.warn("Fragment "+P.sn+" of "+A+" "+P.level+" failed to load, retrying in "+K+"ms"),this.retryDate=self.performance.now()+K,this.fragLoadError++,this.state=g.FRAG_LOADING_WAITING_RETRY}else R.levelRetry?(A===d.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=g.IDLE):(M.logger.error(R.details+" reaches max retry, redispatch as fatal ..."),R.fatal=!0,this.hls.stopLoad(),this.state=g.ERROR)}}},m.afterBufferFlushed=function(A,R,P){if(!!A){var k=w.BufferHelper.getBuffered(A);this.fragmentTracker.detectEvictedFragments(R,k,P),this.state===g.ENDED&&this.resetLoadingState()}},m.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=g.IDLE},m.resetStartWhenNotLoaded=function(A){if(!this.loadedmetadata){this.startFragRequested=!1;var R=this.levels?this.levels[A].details:null;R!=null&&R.live?(this.startPosition=-1,this.setStartPosition(R,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},m.updateLevelTiming=function(A,R,P,k){var j=this,K=P.details;console.assert(!!K,"level.details must be defined");var W=Object.keys(A.elementaryStreams).reduce(function(H,$){var z=A.elementaryStreams[$];if(z){var J=z.endPTS-z.startPTS;if(J<=0)return j.warn("Could not parse fragment "+A.sn+" "+$+" duration reliably ("+J+")"),H||!1;var ee=k?0:Object(_.updateFragPTSDTS)(K,A,z.startPTS,z.endPTS,z.startDTS,z.endDTS);return j.hls.trigger(O.Events.LEVEL_PTS_UPDATED,{details:K,level:P,drift:ee,type:$,frag:A,start:z.startPTS,end:z.endPTS}),!0}return H},!1);W||(this.warn("Found no media in fragment "+A.sn+" of level "+P.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=g.PARSED,this.hls.trigger(O.Events.FRAG_PARSED,{frag:A,part:R})},m.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},E(T,[{key:"state",get:function(){return this._state},set:function(A){var R=this._state;R!==A&&(this._state=A,this.log(R+"->"+A))}}]),T}(c.default)},"./src/controller/buffer-controller.ts":function(n,i,r){r.r(i),r.d(i,"default",function(){return L});var D=r("./src/polyfills/number.ts"),c=r("./src/events.ts"),p=r("./src/utils/logger.ts"),w=r("./src/errors.ts"),M=r("./src/utils/buffer-helper.ts"),O=r("./src/utils/mediasource-helper.ts"),C=r("./src/loader/fragment.ts"),S=r("./src/controller/buffer-operation-queue.ts"),b=Object(O.getMediaSource)(),I=/([ha]vc.)(?:\.[^.,]+)+/,L=function(){function _(l){var a=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var d=a.hls,y=a.media,E=a.mediaSource;p.logger.log("[buffer-controller]: Media source opened"),y&&(a.updateMediaElementDuration(),d.trigger(c.Events.MEDIA_ATTACHED,{media:y})),E&&E.removeEventListener("sourceopen",a._onMediaSourceOpen),a.checkPendingTracks()},this._onMediaSourceClose=function(){p.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){p.logger.log("[buffer-controller]: Media source ended")},this.hls=l,this._initSourceBuffer(),this.registerListeners()}var x=_.prototype;return x.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},x.destroy=function(){this.unregisterListeners(),this.details=null},x.registerListeners=function(){var a=this.hls;a.on(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),a.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(c.Events.BUFFER_RESET,this.onBufferReset,this),a.on(c.Events.BUFFER_APPENDING,this.onBufferAppending,this),a.on(c.Events.BUFFER_CODECS,this.onBufferCodecs,this),a.on(c.Events.BUFFER_EOS,this.onBufferEos,this),a.on(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),a.on(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this),a.on(c.Events.FRAG_PARSED,this.onFragParsed,this),a.on(c.Events.FRAG_CHANGED,this.onFragChanged,this)},x.unregisterListeners=function(){var a=this.hls;a.off(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),a.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(c.Events.BUFFER_RESET,this.onBufferReset,this),a.off(c.Events.BUFFER_APPENDING,this.onBufferAppending,this),a.off(c.Events.BUFFER_CODECS,this.onBufferCodecs,this),a.off(c.Events.BUFFER_EOS,this.onBufferEos,this),a.off(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),a.off(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this),a.off(c.Events.FRAG_PARSED,this.onFragParsed,this),a.off(c.Events.FRAG_CHANGED,this.onFragChanged,this)},x._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new S.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},x.onManifestParsed=function(a,d){var y=2;(d.audio&&!d.video||!d.altAudio)&&(y=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=y,this.details=null,p.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},x.onMediaAttaching=function(a,d){var y=this.media=d.media;if(y&&b){var E=this.mediaSource=new b;E.addEventListener("sourceopen",this._onMediaSourceOpen),E.addEventListener("sourceended",this._onMediaSourceEnded),E.addEventListener("sourceclose",this._onMediaSourceClose),y.src=self.URL.createObjectURL(E),this._objectUrl=y.src}},x.onMediaDetaching=function(){var a=this.media,d=this.mediaSource,y=this._objectUrl;if(d){if(p.logger.log("[buffer-controller]: media source detaching"),d.readyState==="open")try{d.endOfStream()}catch(E){p.logger.warn("[buffer-controller]: onMediaDetaching: "+E.message+" while calling endOfStream")}this.onBufferReset(),d.removeEventListener("sourceopen",this._onMediaSourceOpen),d.removeEventListener("sourceended",this._onMediaSourceEnded),d.removeEventListener("sourceclose",this._onMediaSourceClose),a&&(y&&self.URL.revokeObjectURL(y),a.src===y?(a.removeAttribute("src"),a.load()):p.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(c.Events.MEDIA_DETACHED,void 0)},x.onBufferReset=function(){var a=this;this.getSourceBufferTypes().forEach(function(d){var y=a.sourceBuffer[d];try{y&&(a.removeBufferListeners(d),a.mediaSource&&a.mediaSource.removeSourceBuffer(y),a.sourceBuffer[d]=void 0)}catch(E){p.logger.warn("[buffer-controller]: Failed to reset the "+d+" buffer",E)}}),this._initSourceBuffer()},x.onBufferCodecs=function(a,d){var y=this,E=this.getSourceBufferTypes().length;Object.keys(d).forEach(function(u){if(E){var s=y.tracks[u];if(s&&typeof s.buffer.changeType=="function"){var o=d[u],g=o.id,f=o.codec,v=o.levelCodec,T=o.container,m=o.metadata,h=(s.levelCodec||s.codec).replace(I,"$1"),A=(v||f).replace(I,"$1");if(h!==A){var R=T+";codecs="+(v||f);y.appendChangeType(u,R),p.logger.log("[buffer-controller]: switching codec "+h+" to "+A),y.tracks[u]={buffer:s.buffer,codec:f,container:T,levelCodec:v,metadata:m,id:g}}}}else y.pendingTracks[u]=d[u]}),!E&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},x.appendChangeType=function(a,d){var y=this,E=this.operationQueue,u={execute:function(){var o=y.sourceBuffer[a];o&&(p.logger.log("[buffer-controller]: changing "+a+" sourceBuffer type to "+d),o.changeType(d)),E.shiftAndExecuteNext(a)},onStart:function(){},onComplete:function(){},onError:function(o){p.logger.warn("[buffer-controller]: Failed to change "+a+" SourceBuffer type",o)}};E.append(u,a)},x.onBufferAppending=function(a,d){var y=this,E=this.hls,u=this.operationQueue,s=this.tracks,o=d.data,g=d.type,f=d.frag,v=d.part,T=d.chunkMeta,m=T.buffering[g],h=self.performance.now();m.start=h;var A=f.stats.buffering,R=v?v.stats.buffering:null;A.start===0&&(A.start=h),R&&R.start===0&&(R.start=h);var P=s.audio,k=g==="audio"&&T.id===1&&(P==null?void 0:P.container)==="audio/mpeg",j={execute:function(){if(m.executeStart=self.performance.now(),k){var W=y.sourceBuffer[g];if(W){var H=f.start-W.timestampOffset;Math.abs(H)>=.1&&(p.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+f.start+" (delta: "+H+") sn: "+f.sn+")"),W.timestampOffset=f.start)}}y.appendExecutor(o,g)},onStart:function(){},onComplete:function(){var W=self.performance.now();m.executeEnd=m.end=W,A.first===0&&(A.first=W),R&&R.first===0&&(R.first=W);var H=y.sourceBuffer,$={};for(var z in H)$[z]=M.BufferHelper.getBuffered(H[z]);y.appendError=0,y.hls.trigger(c.Events.BUFFER_APPENDED,{type:g,frag:f,part:v,chunkMeta:T,parent:f.type,timeRanges:$})},onError:function(W){p.logger.error("[buffer-controller]: Error encountered while trying to append to the "+g+" SourceBuffer",W);var H={type:w.ErrorTypes.MEDIA_ERROR,parent:f.type,details:w.ErrorDetails.BUFFER_APPEND_ERROR,err:W,fatal:!1};W.code===DOMException.QUOTA_EXCEEDED_ERR?H.details=w.ErrorDetails.BUFFER_FULL_ERROR:(y.appendError++,H.details=w.ErrorDetails.BUFFER_APPEND_ERROR,y.appendError>E.config.appendErrorMaxRetry&&(p.logger.error("[buffer-controller]: Failed "+E.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),H.fatal=!0,E.stopLoad())),E.trigger(c.Events.ERROR,H)}};u.append(j,g)},x.onBufferFlushing=function(a,d){var y=this,E=this.operationQueue,u=function(o){return{execute:y.removeExecutor.bind(y,o,d.startOffset,d.endOffset),onStart:function(){},onComplete:function(){y.hls.trigger(c.Events.BUFFER_FLUSHED,{type:o})},onError:function(f){p.logger.warn("[buffer-controller]: Failed to remove from "+o+" SourceBuffer",f)}}};d.type?E.append(u(d.type),d.type):this.getSourceBufferTypes().forEach(function(s){E.append(u(s),s)})},x.onFragParsed=function(a,d){var y=this,E=d.frag,u=d.part,s=[],o=u?u.elementaryStreams:E.elementaryStreams;o[C.ElementaryStreamTypes.AUDIOVIDEO]?s.push("audiovideo"):(o[C.ElementaryStreamTypes.AUDIO]&&s.push("audio"),o[C.ElementaryStreamTypes.VIDEO]&&s.push("video"));var g=function(){var v=self.performance.now();E.stats.buffering.end=v,u&&(u.stats.buffering.end=v);var T=u?u.stats:E.stats;y.hls.trigger(c.Events.FRAG_BUFFERED,{frag:E,part:u,stats:T,id:E.type})};s.length===0&&p.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+E.type+" level: "+E.level+" sn: "+E.sn),this.blockBuffers(g,s)},x.onFragChanged=function(a,d){this.flushBackBuffer()},x.onBufferEos=function(a,d){var y=this,E=this.getSourceBufferTypes().reduce(function(u,s){var o=y.sourceBuffer[s];return(!d.type||d.type===s)&&o&&!o.ended&&(o.ended=!0,p.logger.log("[buffer-controller]: "+s+" sourceBuffer now EOS")),u&&!!(!o||o.ended)},!0);E&&this.blockBuffers(function(){var u=y.mediaSource;!u||u.readyState!=="open"||u.endOfStream()})},x.onLevelUpdated=function(a,d){var y=d.details;!y.fragments.length||(this.details=y,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},x.flushBackBuffer=function(){var a=this.hls,d=this.details,y=this.media,E=this.sourceBuffer;if(!(!y||d===null)){var u=this.getSourceBufferTypes();if(!!u.length){var s=d.live&&a.config.liveBackBufferLength!==null?a.config.liveBackBufferLength:a.config.backBufferLength;if(!(!Object(D.isFiniteNumber)(s)||s<0)){var o=y.currentTime,g=d.levelTargetDuration,f=Math.max(s,g),v=Math.floor(o/g)*g-f;u.forEach(function(T){var m=E[T];if(m){var h=M.BufferHelper.getBuffered(m);h.length>0&&v>h.start(0)&&(a.trigger(c.Events.BACK_BUFFER_REACHED,{bufferEnd:v}),d.live&&a.trigger(c.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:v}),a.trigger(c.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:v,type:T}))}})}}}},x.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var a=this.details,d=this.hls,y=this.media,E=this.mediaSource,u=a.fragments[0].start+a.totalduration,s=y.duration,o=Object(D.isFiniteNumber)(E.duration)?E.duration:0;a.live&&d.config.liveDurationInfinity?(p.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),E.duration=1/0,this.updateSeekableRange(a)):(u>o&&u>s||!Object(D.isFiniteNumber)(s))&&(p.logger.log("[buffer-controller]: Updating Media Source duration to "+u.toFixed(3)),E.duration=u)}},x.updateSeekableRange=function(a){var d=this.mediaSource,y=a.fragments,E=y.length;if(E&&a.live&&d!==null&&d!==void 0&&d.setLiveSeekableRange){var u=Math.max(0,y[0].start),s=Math.max(u,u+a.totalduration);d.setLiveSeekableRange(u,s)}},x.checkPendingTracks=function(){var a=this.bufferCodecEventsExpected,d=this.operationQueue,y=this.pendingTracks,E=Object.keys(y).length;if(E&&!a||E===2){this.createSourceBuffers(y),this.pendingTracks={};var u=this.getSourceBufferTypes();if(u.length===0){this.hls.trigger(c.Events.ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}u.forEach(function(s){d.executeNext(s)})}},x.createSourceBuffers=function(a){var d=this.sourceBuffer,y=this.mediaSource;if(!y)throw Error("createSourceBuffers called when mediaSource was null");var E=0;for(var u in a)if(!d[u]){var s=a[u];if(!s)throw Error("source buffer exists for track "+u+", however track does not");var o=s.levelCodec||s.codec,g=s.container+";codecs="+o;p.logger.log("[buffer-controller]: creating sourceBuffer("+g+")");try{var f=d[u]=y.addSourceBuffer(g),v=u;this.addBufferListener(v,"updatestart",this._onSBUpdateStart),this.addBufferListener(v,"updateend",this._onSBUpdateEnd),this.addBufferListener(v,"error",this._onSBUpdateError),this.tracks[u]={buffer:f,codec:o,container:s.container,levelCodec:s.levelCodec,metadata:s.metadata,id:s.id},E++}catch(T){p.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+T.message),this.hls.trigger(c.Events.ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:T,mimeType:g})}}E&&this.hls.trigger(c.Events.BUFFER_CREATED,{tracks:this.tracks})},x._onSBUpdateStart=function(a){var d=this.operationQueue,y=d.current(a);y.onStart()},x._onSBUpdateEnd=function(a){var d=this.operationQueue,y=d.current(a);y.onComplete(),d.shiftAndExecuteNext(a)},x._onSBUpdateError=function(a,d){p.logger.error("[buffer-controller]: "+a+" SourceBuffer error",d),this.hls.trigger(c.Events.ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var y=this.operationQueue.current(a);y&&y.onError(d)},x.removeExecutor=function(a,d,y){var E=this.media,u=this.mediaSource,s=this.operationQueue,o=this.sourceBuffer,g=o[a];if(!E||!u||!g){p.logger.warn("[buffer-controller]: Attempting to remove from the "+a+" SourceBuffer, but it does not exist"),s.shiftAndExecuteNext(a);return}var f=Object(D.isFiniteNumber)(E.duration)?E.duration:1/0,v=Object(D.isFiniteNumber)(u.duration)?u.duration:1/0,T=Math.max(0,d),m=Math.min(y,f,v);m>T?(p.logger.log("[buffer-controller]: Removing ["+T+","+m+"] from the "+a+" SourceBuffer"),console.assert(!g.updating,a+" sourceBuffer must not be updating"),g.remove(T,m)):s.shiftAndExecuteNext(a)},x.appendExecutor=function(a,d){var y=this.operationQueue,E=this.sourceBuffer,u=E[d];if(!u){p.logger.warn("[buffer-controller]: Attempting to append to the "+d+" SourceBuffer, but it does not exist"),y.shiftAndExecuteNext(d);return}u.ended=!1,console.assert(!u.updating,d+" sourceBuffer must not be updating"),u.appendBuffer(a)},x.blockBuffers=function(a,d){var y=this;if(d===void 0&&(d=this.getSourceBufferTypes()),!d.length){p.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(a);return}var E=this.operationQueue,u=d.map(function(s){return E.appendBlocker(s)});Promise.all(u).then(function(){a(),d.forEach(function(s){var o=y.sourceBuffer[s];(!o||!o.updating)&&E.shiftAndExecuteNext(s)})})},x.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},x.addBufferListener=function(a,d,y){var E=this.sourceBuffer[a];if(!!E){var u=y.bind(this,a);this.listeners[a].push({event:d,listener:u}),E.addEventListener(d,u)}},x.removeBufferListeners=function(a){var d=this.sourceBuffer[a];!d||this.listeners[a].forEach(function(y){d.removeEventListener(y.event,y.listener)})},_}()},"./src/controller/buffer-operation-queue.ts":function(n,i,r){r.r(i),r.d(i,"default",function(){return c});var D=r("./src/utils/logger.ts"),c=function(){function p(M){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=M}var w=p.prototype;return w.append=function(O,C){var S=this.queues[C];S.push(O),S.length===1&&this.buffers[C]&&this.executeNext(C)},w.insertAbort=function(O,C){var S=this.queues[C];S.unshift(O),this.executeNext(C)},w.appendBlocker=function(O){var C,S=new Promise(function(I){C=I}),b={execute:C,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(b,O),S},w.executeNext=function(O){var C=this.buffers,S=this.queues,b=C[O],I=S[O];if(I.length){var L=I[0];try{L.execute()}catch(_){D.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),L.onError(_),(!b||!b.updating)&&(I.shift(),this.executeNext(O))}}},w.shiftAndExecuteNext=function(O){this.queues[O].shift(),this.executeNext(O)},w.current=function(O){return this.queues[O][0]},p}()},"./src/controller/cap-level-controller.ts":function(n,i,r){r.r(i);var D=r("./src/events.ts");function c(M,O){for(var C=0;C<O.length;C++){var S=O[C];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(M,S.key,S)}}function p(M,O,C){return O&&c(M.prototype,O),C&&c(M,C),Object.defineProperty(M,"prototype",{writable:!1}),M}var w=function(){function M(C){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=C,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var O=M.prototype;return O.setStreamController=function(S){this.streamController=S},O.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},O.registerListeners=function(){var S=this.hls;S.on(D.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),S.on(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),S.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),S.on(D.Events.BUFFER_CODECS,this.onBufferCodecs,this),S.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},O.unregisterListener=function(){var S=this.hls;S.off(D.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),S.off(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),S.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),S.off(D.Events.BUFFER_CODECS,this.onBufferCodecs,this),S.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},O.onFpsDropLevelCapping=function(S,b){M.isLevelAllowed(b.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(b.droppedLevel)},O.onMediaAttaching=function(S,b){this.media=b.media instanceof HTMLVideoElement?b.media:null},O.onManifestParsed=function(S,b){var I=this.hls;this.restrictedLevels=[],this.firstLevel=b.firstLevel,I.config.capLevelToPlayerSize&&b.video&&this.startCapping()},O.onBufferCodecs=function(S,b){var I=this.hls;I.config.capLevelToPlayerSize&&b.video&&this.startCapping()},O.onMediaDetaching=function(){this.stopCapping()},O.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var S=this.hls.levels;if(S.length){var b=this.hls;b.autoLevelCapping=this.getMaxLevel(S.length-1),b.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=b.autoLevelCapping}}},O.getMaxLevel=function(S){var b=this,I=this.hls.levels;if(!I.length)return-1;var L=I.filter(function(_,x){return M.isLevelAllowed(x,b.restrictedLevels)&&x<=S});return this.clientRect=null,M.getMaxLevelByMediaSize(L,this.mediaWidth,this.mediaHeight)},O.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},O.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},O.getDimensions=function(){if(this.clientRect)return this.clientRect;var S=this.media,b={width:0,height:0};if(S){var I=S.getBoundingClientRect();b.width=I.width,b.height=I.height,!b.width&&!b.height&&(b.width=I.right-I.left||S.width||0,b.height=I.bottom-I.top||S.height||0)}return this.clientRect=b,b},M.isLevelAllowed=function(S,b){return b===void 0&&(b=[]),b.indexOf(S)===-1},M.getMaxLevelByMediaSize=function(S,b,I){if(!S||!S.length)return-1;for(var L=function(d,y){return y?d.width!==y.width||d.height!==y.height:!0},_=S.length-1,x=0;x<S.length;x+=1){var l=S[x];if((l.width>=b||l.height>=I)&&L(l,S[x+1])){_=x;break}}return _},p(M,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var S=1;if(!this.hls.config.ignoreDevicePixelRatio)try{S=self.devicePixelRatio}catch{}return S}}]),M}();i.default=w},"./src/controller/cmcd-controller.ts":function(n,i,r){r.r(i),r.d(i,"default",function(){return L});var D=r("./src/events.ts"),c=r("./src/types/cmcd.ts"),p=r("./src/utils/buffer-helper.ts"),w=r("./src/utils/logger.ts");function M(_,x){for(var l=0;l<x.length;l++){var a=x[l];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(_,a.key,a)}}function O(_,x,l){return x&&M(_.prototype,x),l&&M(_,l),Object.defineProperty(_,"prototype",{writable:!1}),_}function C(_,x){var l=typeof Symbol<"u"&&_[Symbol.iterator]||_["@@iterator"];if(l)return(l=l.call(_)).next.bind(l);if(Array.isArray(_)||(l=S(_))||x&&_&&typeof _.length=="number"){l&&(_=l);var a=0;return function(){return a>=_.length?{done:!0}:{done:!1,value:_[a++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function S(_,x){if(!!_){if(typeof _=="string")return b(_,x);var l=Object.prototype.toString.call(_).slice(8,-1);if(l==="Object"&&_.constructor&&(l=_.constructor.name),l==="Map"||l==="Set")return Array.from(_);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return b(_,x)}}function b(_,x){(x==null||x>_.length)&&(x=_.length);for(var l=0,a=new Array(x);l<x;l++)a[l]=_[l];return a}function I(){return I=Object.assign?Object.assign.bind():function(_){for(var x=1;x<arguments.length;x++){var l=arguments[x];for(var a in l)Object.prototype.hasOwnProperty.call(l,a)&&(_[a]=l[a])}return _},I.apply(this,arguments)}var L=function(){function _(l){var a=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){a.initialized&&(a.starved=!0),a.buffering=!0},this.onPlaying=function(){a.initialized||(a.initialized=!0),a.buffering=!1},this.applyPlaylistData=function(E){try{a.apply(E,{ot:c.CMCDObjectType.MANIFEST,su:!a.initialized})}catch(u){w.logger.warn("Could not generate manifest CMCD data.",u)}},this.applyFragmentData=function(E){try{var u=E.frag,s=a.hls.levels[u.level],o=a.getObjectType(u),g={d:u.duration*1e3,ot:o};(o===c.CMCDObjectType.VIDEO||o===c.CMCDObjectType.AUDIO||o==c.CMCDObjectType.MUXED)&&(g.br=s.bitrate/1e3,g.tb=a.getTopBandwidth(o)/1e3,g.bl=a.getBufferLength(o)),a.apply(E,g)}catch(f){w.logger.warn("Could not generate segment CMCD data.",f)}},this.hls=l;var d=this.config=l.config,y=d.cmcd;y!=null&&(d.pLoader=this.createPlaylistLoader(),d.fLoader=this.createFragmentLoader(),this.sid=y.sessionId||_.uuid(),this.cid=y.contentId,this.useHeaders=y.useHeaders===!0,this.registerListeners())}var x=_.prototype;return x.registerListeners=function(){var a=this.hls;a.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(D.Events.MEDIA_DETACHED,this.onMediaDetached,this),a.on(D.Events.BUFFER_CREATED,this.onBufferCreated,this)},x.unregisterListeners=function(){var a=this.hls;a.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(D.Events.MEDIA_DETACHED,this.onMediaDetached,this),a.off(D.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},x.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},x.onMediaAttached=function(a,d){this.media=d.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},x.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},x.onBufferCreated=function(a,d){var y,E;this.audioBuffer=(y=d.tracks.audio)===null||y===void 0?void 0:y.buffer,this.videoBuffer=(E=d.tracks.video)===null||E===void 0?void 0:E.buffer},x.createData=function(){var a;return{v:c.CMCDVersion,sf:c.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(a=this.media)===null||a===void 0?void 0:a.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},x.apply=function(a,d){d===void 0&&(d={}),I(d,this.createData());var y=d.ot===c.CMCDObjectType.INIT||d.ot===c.CMCDObjectType.VIDEO||d.ot===c.CMCDObjectType.MUXED;if(this.starved&&y&&(d.bs=!0,d.su=!0,this.starved=!1),d.su==null&&(d.su=this.buffering),this.useHeaders){var E=_.toHeaders(d);if(!Object.keys(E).length)return;a.headers||(a.headers={}),I(a.headers,E)}else{var u=_.toQuery(d);if(!u)return;a.url=_.appendQueryToUri(a.url,u)}},x.getObjectType=function(a){var d=a.type;if(d==="subtitle")return c.CMCDObjectType.TIMED_TEXT;if(a.sn==="initSegment")return c.CMCDObjectType.INIT;if(d==="audio")return c.CMCDObjectType.AUDIO;if(d==="main")return this.hls.audioTracks.length?c.CMCDObjectType.VIDEO:c.CMCDObjectType.MUXED},x.getTopBandwidth=function(a){var d=0,y,E=this.hls;if(a===c.CMCDObjectType.AUDIO)y=E.audioTracks;else{var u=E.maxAutoLevel,s=u>-1?u+1:E.levels.length;y=E.levels.slice(0,s)}for(var o=C(y),g;!(g=o()).done;){var f=g.value;f.bitrate>d&&(d=f.bitrate)}return d>0?d:NaN},x.getBufferLength=function(a){var d=this.hls.media,y=a===c.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!y||!d)return NaN;var E=p.BufferHelper.bufferInfo(y,d.currentTime,this.config.maxBufferHole);return E.len*1e3},x.createPlaylistLoader=function(){var a=this.config.pLoader,d=this.applyPlaylistData,y=a||this.config.loader;return function(){function E(s){this.loader=void 0,this.loader=new y(s)}var u=E.prototype;return u.destroy=function(){this.loader.destroy()},u.abort=function(){this.loader.abort()},u.load=function(o,g,f){d(o),this.loader.load(o,g,f)},O(E,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),E}()},x.createFragmentLoader=function(){var a=this.config.fLoader,d=this.applyFragmentData,y=a||this.config.loader;return function(){function E(s){this.loader=void 0,this.loader=new y(s)}var u=E.prototype;return u.destroy=function(){this.loader.destroy()},u.abort=function(){this.loader.abort()},u.load=function(o,g,f){d(o),this.loader.load(o,g,f)},O(E,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),E}()},_.uuid=function(){var a=URL.createObjectURL(new Blob),d=a.toString();return URL.revokeObjectURL(a),d.slice(d.lastIndexOf("/")+1)},_.serialize=function(a){for(var d=[],y=function(k){return!Number.isNaN(k)&&k!=null&&k!==""&&k!==!1},E=function(k){return Math.round(k)},u=function(k){return E(k/100)*100},s=function(k){return encodeURIComponent(k)},o={br:E,d:E,bl:u,dl:u,mtp:u,nor:s,rtp:u,tb:E},g=Object.keys(a||{}).sort(),f=C(g),v;!(v=f()).done;){var T=v.value,m=a[T];if(!!y(m)&&!(T==="v"&&m===1)&&!(T=="pr"&&m===1)){var h=o[T];h&&(m=h(m));var A=typeof m,R=void 0;T==="ot"||T==="sf"||T==="st"?R=T+"="+m:A==="boolean"?R=T:A==="number"?R=T+"="+m:R=T+"="+JSON.stringify(m),d.push(R)}}return d.join(",")},_.toHeaders=function(a){for(var d=Object.keys(a),y={},E=["Object","Request","Session","Status"],u=[{},{},{},{}],s={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},o=0,g=d;o<g.length;o++){var f=g[o],v=s[f]!=null?s[f]:1;u[v][f]=a[f]}for(var T=0;T<u.length;T++){var m=_.serialize(u[T]);m&&(y["CMCD-"+E[T]]=m)}return y},_.toQuery=function(a){return"CMCD="+encodeURIComponent(_.serialize(a))},_.appendQueryToUri=function(a,d){if(!d)return a;var y=a.includes("?")?"&":"?";return""+a+y+d},_}()},"./src/controller/eme-controller.ts":function(n,i,r){r.r(i);var D=r("./src/events.ts"),c=r("./src/errors.ts"),p=r("./src/utils/logger.ts"),w=r("./src/utils/mediakeys-helper.ts");function M(L,_){for(var x=0;x<_.length;x++){var l=_[x];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(L,l.key,l)}}function O(L,_,x){return _&&M(L.prototype,_),x&&M(L,x),Object.defineProperty(L,"prototype",{writable:!1}),L}var C=3,S=function(_,x,l){var a={audioCapabilities:[],videoCapabilities:[]};return _.forEach(function(d){a.audioCapabilities.push({contentType:'audio/mp4; codecs="'+d+'"',robustness:l.audioRobustness||""})}),x.forEach(function(d){a.videoCapabilities.push({contentType:'video/mp4; codecs="'+d+'"',robustness:l.videoRobustness||""})}),[a]},b=function(_,x,l,a){switch(_){case w.KeySystems.WIDEVINE:return S(x,l,a);default:throw new Error("Unknown key-system: "+_)}},I=function(){function L(x){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=x,this._config=x.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var _=L.prototype;return _.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},_._registerListeners=function(){this.hls.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(D.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this)},_._unregisterListeners=function(){this.hls.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(D.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this)},_.getLicenseServerUrl=function(l){switch(l){case w.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+l+'"')},_._attemptKeySystemAccess=function(l,a,d){var y=this,E=b(l,a,d,this._drmSystemOptions);p.logger.log("Requesting encrypted media key-system access");var u=this.requestMediaKeySystemAccess(l,E);this.mediaKeysPromise=u.then(function(s){return y._onMediaKeySystemAccessObtained(l,s)}),u.catch(function(s){p.logger.error('Failed to obtain key-system "'+l+'" access:',s)})},_._onMediaKeySystemAccessObtained=function(l,a){var d=this;p.logger.log('Access for key-system "'+l+'" obtained');var y={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:a,mediaKeySystemDomain:l};this._mediaKeysList.push(y);var E=Promise.resolve().then(function(){return a.createMediaKeys()}).then(function(u){return y.mediaKeys=u,p.logger.log('Media-keys created for key-system "'+l+'"'),d._onMediaKeysCreated(),u});return E.catch(function(u){p.logger.error("Failed to create media-keys:",u)}),E},_._onMediaKeysCreated=function(){var l=this;this._mediaKeysList.forEach(function(a){a.mediaKeysSession||(a.mediaKeysSession=a.mediaKeys.createSession(),l._onNewMediaKeySession(a.mediaKeysSession))})},_._onNewMediaKeySession=function(l){var a=this;p.logger.log("New key-system session "+l.sessionId),l.addEventListener("message",function(d){a._onKeySessionMessage(l,d.message)},!1)},_._onKeySessionMessage=function(l,a){p.logger.log("Got EME message event, creating license request"),this._requestLicense(a,function(d){p.logger.log("Received license data (length: "+(d&&d.byteLength)+"), updating key-session"),l.update(d).catch(function(y){p.logger.warn("Updating key-session failed: "+y)})})},_.onMediaEncrypted=function(l){var a=this;if(p.logger.log('Media is encrypted using "'+l.initDataType+'" init data type'),!this.mediaKeysPromise){p.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(D.Events.ERROR,{type:c.ErrorTypes.KEY_SYSTEM_ERROR,details:c.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var d=function(E){!a._media||(a._attemptSetMediaKeys(E),a._generateRequestWithPreferredKeySession(l.initDataType,l.initData))};this.mediaKeysPromise.then(d).catch(d)},_._attemptSetMediaKeys=function(l){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var a=this._mediaKeysList[0];if(!a||!a.mediaKeys){p.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(D.Events.ERROR,{type:c.ErrorTypes.KEY_SYSTEM_ERROR,details:c.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}p.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(a.mediaKeys),this._hasSetMediaKeys=!0}},_._generateRequestWithPreferredKeySession=function(l,a){var d=this,y=this._mediaKeysList[0];if(!y){p.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(D.Events.ERROR,{type:c.ErrorTypes.KEY_SYSTEM_ERROR,details:c.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(y.mediaKeysSessionInitialized){p.logger.warn("Key-Session already initialized but requested again");return}var E=y.mediaKeysSession;if(!E){p.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(D.Events.ERROR,{type:c.ErrorTypes.KEY_SYSTEM_ERROR,details:c.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!a){p.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(D.Events.ERROR,{type:c.ErrorTypes.KEY_SYSTEM_ERROR,details:c.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}p.logger.log('Generating key-session request for "'+l+'" init data type'),y.mediaKeysSessionInitialized=!0,E.generateRequest(l,a).then(function(){p.logger.debug("Key-session generation succeeded")}).catch(function(u){p.logger.error("Error generating key-session request:",u),d.hls.trigger(D.Events.ERROR,{type:c.ErrorTypes.KEY_SYSTEM_ERROR,details:c.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},_._createLicenseXhr=function(l,a,d){var y=new XMLHttpRequest;y.responseType="arraybuffer",y.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,y,l,a,d);var E=this._licenseXhrSetup;if(E)try{E.call(this.hls,y,l),E=void 0}catch(u){p.logger.error(u)}try{y.readyState||y.open("POST",l,!0),E&&E.call(this.hls,y,l)}catch(u){throw new Error("issue setting up KeySystem license XHR "+u)}return y},_._onLicenseRequestReadyStageChange=function(l,a,d,y){switch(l.readyState){case 4:if(l.status===200){this._requestLicenseFailureCount=0,p.logger.log("License request succeeded");var E=l.response,u=this._licenseResponseCallback;if(u)try{E=u.call(this.hls,l,a)}catch(o){p.logger.error(o)}y(E)}else{if(p.logger.error("License Request XHR failed ("+a+"). Status: "+l.status+" ("+l.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>C){this.hls.trigger(D.Events.ERROR,{type:c.ErrorTypes.KEY_SYSTEM_ERROR,details:c.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var s=C-this._requestLicenseFailureCount+1;p.logger.warn("Retrying license request, "+s+" attempts left"),this._requestLicense(d,y)}break}},_._generateLicenseRequestChallenge=function(l,a){switch(l.mediaKeySystemDomain){case w.KeySystems.WIDEVINE:return a}throw new Error("unsupported key-system: "+l.mediaKeySystemDomain)},_._requestLicense=function(l,a){p.logger.log("Requesting content license for key-system");var d=this._mediaKeysList[0];if(!d){p.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(D.Events.ERROR,{type:c.ErrorTypes.KEY_SYSTEM_ERROR,details:c.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var y=this.getLicenseServerUrl(d.mediaKeySystemDomain),E=this._createLicenseXhr(y,l,a);p.logger.log("Sending license request to URL: "+y);var u=this._generateLicenseRequestChallenge(d,l);E.send(u)}catch(s){p.logger.error("Failure requesting DRM license: "+s),this.hls.trigger(D.Events.ERROR,{type:c.ErrorTypes.KEY_SYSTEM_ERROR,details:c.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},_.onMediaAttached=function(l,a){if(!!this._emeEnabled){var d=a.media;this._media=d,d.addEventListener("encrypted",this._onMediaEncrypted)}},_.onMediaDetached=function(){var l=this._media,a=this._mediaKeysList;!l||(l.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(a.map(function(d){if(d.mediaKeysSession)return d.mediaKeysSession.close().catch(function(){})})).then(function(){return l.setMediaKeys(null)}).catch(function(){}))},_.onManifestParsed=function(l,a){if(!!this._emeEnabled){var d=a.levels.map(function(E){return E.audioCodec}).filter(function(E){return!!E}),y=a.levels.map(function(E){return E.videoCodec}).filter(function(E){return!!E});this._attemptKeySystemAccess(w.KeySystems.WIDEVINE,d,y)}},O(L,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),L}();i.default=I},"./src/controller/fps-controller.ts":function(n,i,r){r.r(i);var D=r("./src/events.ts"),c=r("./src/utils/logger.ts"),p=function(){function w(O){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=O,this.registerListeners()}var M=w.prototype;return M.setStreamController=function(C){this.streamController=C},M.registerListeners=function(){this.hls.on(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},M.unregisterListeners=function(){this.hls.off(D.Events.MEDIA_ATTACHING,this.onMediaAttaching)},M.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},M.onMediaAttaching=function(C,S){var b=this.hls.config;if(b.capLevelOnFPSDrop){var I=S.media instanceof self.HTMLVideoElement?S.media:null;this.media=I,I&&typeof I.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),b.fpsDroppedMonitoringPeriod)}},M.checkFPS=function(C,S,b){var I=performance.now();if(S){if(this.lastTime){var L=I-this.lastTime,_=b-this.lastDroppedFrames,x=S-this.lastDecodedFrames,l=1e3*_/L,a=this.hls;if(a.trigger(D.Events.FPS_DROP,{currentDropped:_,currentDecoded:x,totalDroppedFrames:b}),l>0&&_>a.config.fpsDroppedMonitoringThreshold*x){var d=a.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(a.autoLevelCapping===-1||a.autoLevelCapping>=d)&&(d=d-1,a.trigger(D.Events.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:a.currentLevel}),a.autoLevelCapping=d,this.streamController.nextLevelSwitch())}}this.lastTime=I,this.lastDroppedFrames=b,this.lastDecodedFrames=S}},M.checkFPSInterval=function(){var C=this.media;if(C)if(this.isVideoPlaybackQualityAvailable){var S=C.getVideoPlaybackQuality();this.checkFPS(C,S.totalVideoFrames,S.droppedVideoFrames)}else this.checkFPS(C,C.webkitDecodedFrameCount,C.webkitDroppedFrameCount)},w}();i.default=p},"./src/controller/fragment-finders.ts":function(n,i,r){r.r(i),r.d(i,"findFragmentByPDT",function(){return p}),r.d(i,"findFragmentByPTS",function(){return w}),r.d(i,"fragmentWithinToleranceTest",function(){return M}),r.d(i,"pdtWithinToleranceTest",function(){return O}),r.d(i,"findFragWithCC",function(){return C});var D=r("./src/polyfills/number.ts"),c=r("./src/utils/binary-search.ts");function p(S,b,I){if(b===null||!Array.isArray(S)||!S.length||!Object(D.isFiniteNumber)(b))return null;var L=S[0].programDateTime;if(b<(L||0))return null;var _=S[S.length-1].endProgramDateTime;if(b>=(_||0))return null;I=I||0;for(var x=0;x<S.length;++x){var l=S[x];if(O(b,I,l))return l}return null}function w(S,b,I,L){I===void 0&&(I=0),L===void 0&&(L=0);var _=null;if(S?_=b[S.sn-b[0].sn+1]||null:I===0&&b[0].start===0&&(_=b[0]),_&&M(I,L,_)===0)return _;var x=c.default.search(b,M.bind(null,I,L));return x||_}function M(S,b,I){S===void 0&&(S=0),b===void 0&&(b=0);var L=Math.min(b,I.duration+(I.deltaPTS?I.deltaPTS:0));return I.start+I.duration-L<=S?1:I.start-L>S&&I.start?-1:0}function O(S,b,I){var L=Math.min(b,I.duration+(I.deltaPTS?I.deltaPTS:0))*1e3,_=I.endProgramDateTime||0;return _-L>S}function C(S,b){return c.default.search(S,function(I){return I.cc<b?1:I.cc>b?-1:0})}},"./src/controller/fragment-tracker.ts":function(n,i,r){r.r(i),r.d(i,"FragmentState",function(){return p}),r.d(i,"FragmentTracker",function(){return w});var D=r("./src/events.ts"),c=r("./src/types/loader.ts"),p;(function(C){C.NOT_LOADED="NOT_LOADED",C.APPENDING="APPENDING",C.PARTIAL="PARTIAL",C.OK="OK"})(p||(p={}));var w=function(){function C(b){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=b,this._registerListeners()}var S=C.prototype;return S._registerListeners=function(){var I=this.hls;I.on(D.Events.BUFFER_APPENDED,this.onBufferAppended,this),I.on(D.Events.FRAG_BUFFERED,this.onFragBuffered,this),I.on(D.Events.FRAG_LOADED,this.onFragLoaded,this)},S._unregisterListeners=function(){var I=this.hls;I.off(D.Events.BUFFER_APPENDED,this.onBufferAppended,this),I.off(D.Events.FRAG_BUFFERED,this.onFragBuffered,this),I.off(D.Events.FRAG_LOADED,this.onFragLoaded,this)},S.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},S.getAppendedFrag=function(I,L){if(L===c.PlaylistLevelType.MAIN){var _=this.activeFragment,x=this.activeParts;if(!_)return null;if(x)for(var l=x.length;l--;){var a=x[l],d=a?a.end:_.appendedPTS;if(a.start<=I&&d!==void 0&&I<=d)return l>9&&(this.activeParts=x.slice(l-9)),a}else if(_.start<=I&&_.appendedPTS!==void 0&&I<=_.appendedPTS)return _}return this.getBufferedFrag(I,L)},S.getBufferedFrag=function(I,L){for(var _=this.fragments,x=Object.keys(_),l=x.length;l--;){var a=_[x[l]];if((a==null?void 0:a.body.type)===L&&a.buffered){var d=a.body;if(d.start<=I&&I<=d.end)return d}}return null},S.detectEvictedFragments=function(I,L,_){var x=this;Object.keys(this.fragments).forEach(function(l){var a=x.fragments[l];if(!!a){if(!a.buffered){a.body.type===_&&x.removeFragment(a.body);return}var d=a.range[I];!d||d.time.some(function(y){var E=!x.isTimeBuffered(y.startPTS,y.endPTS,L);return E&&x.removeFragment(a.body),E})}})},S.detectPartialFragments=function(I){var L=this,_=this.timeRanges,x=I.frag,l=I.part;if(!(!_||x.sn==="initSegment")){var a=O(x),d=this.fragments[a];!d||(Object.keys(_).forEach(function(y){var E=x.elementaryStreams[y];if(!!E){var u=_[y],s=l!==null||E.partial===!0;d.range[y]=L.getBufferedTimes(x,l,s,u)}}),d.loaded=null,Object.keys(d.range).length?d.buffered=!0:this.removeFragment(d.body))}},S.fragBuffered=function(I){var L=O(I),_=this.fragments[L];_&&(_.loaded=null,_.buffered=!0)},S.getBufferedTimes=function(I,L,_,x){for(var l={time:[],partial:_},a=L?L.start:I.start,d=L?L.end:I.end,y=I.minEndPTS||d,E=I.maxStartPTS||a,u=0;u<x.length;u++){var s=x.start(u)-this.bufferPadding,o=x.end(u)+this.bufferPadding;if(E>=s&&y<=o){l.time.push({startPTS:Math.max(a,x.start(u)),endPTS:Math.min(d,x.end(u))});break}else if(a<o&&d>s)l.partial=!0,l.time.push({startPTS:Math.max(a,x.start(u)),endPTS:Math.min(d,x.end(u))});else if(d<=s)break}return l},S.getPartialFragment=function(I){var L=null,_,x,l,a=0,d=this.bufferPadding,y=this.fragments;return Object.keys(y).forEach(function(E){var u=y[E];!u||M(u)&&(x=u.body.start-d,l=u.body.end+d,I>=x&&I<=l&&(_=Math.min(I-x,l-I),a<=_&&(L=u.body,a=_)))}),L},S.getState=function(I){var L=O(I),_=this.fragments[L];return _?_.buffered?M(_)?p.PARTIAL:p.OK:p.APPENDING:p.NOT_LOADED},S.isTimeBuffered=function(I,L,_){for(var x,l,a=0;a<_.length;a++){if(x=_.start(a)-this.bufferPadding,l=_.end(a)+this.bufferPadding,I>=x&&L<=l)return!0;if(L<=x)return!1}return!1},S.onFragLoaded=function(I,L){var _=L.frag,x=L.part;if(!(_.sn==="initSegment"||_.bitrateTest||x)){var l=O(_);this.fragments[l]={body:_,loaded:L,buffered:!1,range:Object.create(null)}}},S.onBufferAppended=function(I,L){var _=this,x=L.frag,l=L.part,a=L.timeRanges;if(x.type===c.PlaylistLevelType.MAIN)if(this.activeFragment=x,l){var d=this.activeParts;d||(this.activeParts=d=[]),d.push(l)}else this.activeParts=null;this.timeRanges=a,Object.keys(a).forEach(function(y){var E=a[y];if(_.detectEvictedFragments(y,E),!l)for(var u=0;u<E.length;u++)x.appendedPTS=Math.max(E.end(u),x.appendedPTS||0)})},S.onFragBuffered=function(I,L){this.detectPartialFragments(L)},S.hasFragment=function(I){var L=O(I);return!!this.fragments[L]},S.removeFragmentsInRange=function(I,L,_){var x=this;Object.keys(this.fragments).forEach(function(l){var a=x.fragments[l];if(!!a&&a.buffered){var d=a.body;d.type===_&&d.start<L&&d.end>I&&x.removeFragment(d)}})},S.removeFragment=function(I){var L=O(I);I.stats.loaded=0,I.clearElementaryStreamInfo(),delete this.fragments[L]},S.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},C}();function M(C){var S,b;return C.buffered&&(((S=C.range.video)===null||S===void 0?void 0:S.partial)||((b=C.range.audio)===null||b===void 0?void 0:b.partial))}function O(C){return C.type+"_"+C.level+"_"+C.urlId+"_"+C.sn}},"./src/controller/gap-controller.ts":function(n,i,r){r.r(i),r.d(i,"STALL_MINIMUM_DURATION_MS",function(){return M}),r.d(i,"MAX_START_GAP_JUMP",function(){return O}),r.d(i,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return C}),r.d(i,"SKIP_BUFFER_RANGE_START",function(){return S}),r.d(i,"default",function(){return b});var D=r("./src/utils/buffer-helper.ts"),c=r("./src/errors.ts"),p=r("./src/events.ts"),w=r("./src/utils/logger.ts"),M=250,O=2,C=.1,S=.05,b=function(){function I(_,x,l,a){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=_,this.media=x,this.fragmentTracker=l,this.hls=a}var L=I.prototype;return L.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},L.poll=function(x,l){var a=this.config,d=this.media,y=this.stalled;if(d!==null){var E=d.currentTime,u=d.seeking,s=this.seeking&&!u,o=!this.seeking&&u;if(this.seeking=u,E!==x){if(this.moved=!0,y!==null){if(this.stallReported){var g=self.performance.now()-y;w.logger.warn("playback not stuck anymore @"+E+", after "+Math.round(g)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((o||s)&&(this.stalled=null),!(d.paused&&!u||d.ended||d.playbackRate===0||!D.BufferHelper.getBuffered(d).length)){var f=D.BufferHelper.bufferInfo(d,E,0),v=f.len>0,T=f.nextStart||0;if(!(!v&&!T)){if(u){var m=f.len>O,h=!T||l&&l.start<=E||T-E>O&&!this.fragmentTracker.getPartialFragment(E);if(m||h)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var A,R=Math.max(T,f.start||0)-E,P=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,k=P==null||(A=P.details)===null||A===void 0?void 0:A.live,j=k?P.details.targetduration*2:O;if(R>0&&R<=j){this._trySkipBufferHole(null);return}}var K=self.performance.now();if(y===null){this.stalled=K;return}var W=K-y;if(!(!u&&W>=M&&(this._reportStall(f),!this.media))){var H=D.BufferHelper.bufferInfo(d,E,a.maxBufferHole);this._tryFixBufferStall(H,W)}}}}},L._tryFixBufferStall=function(x,l){var a=this.config,d=this.fragmentTracker,y=this.media;if(y!==null){var E=y.currentTime,u=d.getPartialFragment(E);if(u){var s=this._trySkipBufferHole(u);if(s||!this.media)return}x.len>a.maxBufferHole&&l>a.highBufferWatchdogPeriod*1e3&&(w.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},L._reportStall=function(x){var l=this.hls,a=this.media,d=this.stallReported;!d&&a&&(this.stallReported=!0,w.logger.warn("Playback stalling at @"+a.currentTime+" due to low buffer ("+JSON.stringify(x)+")"),l.trigger(p.Events.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:x.len}))},L._trySkipBufferHole=function(x){var l=this.config,a=this.hls,d=this.media;if(d===null)return 0;for(var y=d.currentTime,E=0,u=D.BufferHelper.getBuffered(d),s=0;s<u.length;s++){var o=u.start(s);if(y+l.maxBufferHole>=E&&y<o){var g=Math.max(o+S,d.currentTime+C);return w.logger.warn("skipping hole, adjusting currentTime from "+y+" to "+g),this.moved=!0,this.stalled=null,d.currentTime=g,x&&a.trigger(p.Events.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+y+" to "+g,frag:x}),g}E=u.end(s)}return 0},L._tryNudgeBuffer=function(){var x=this.config,l=this.hls,a=this.media,d=this.nudgeRetry;if(a!==null){var y=a.currentTime;if(this.nudgeRetry++,d<x.nudgeMaxRetry){var E=y+(d+1)*x.nudgeOffset;w.logger.warn("Nudging 'currentTime' from "+y+" to "+E),a.currentTime=E,l.trigger(p.Events.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else w.logger.error("Playhead still not moving while enough data buffered @"+y+" after "+x.nudgeMaxRetry+" nudges"),l.trigger(p.Events.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},I}()},"./src/controller/id3-track-controller.ts":function(n,i,r){r.r(i);var D=r("./src/polyfills/number.ts"),c=r("./src/events.ts"),p=r("./src/utils/texttrack-utils.ts"),w=r("./src/demux/id3.ts"),M=r("./src/loader/date-range.ts"),O=r("./src/types/demuxer.ts"),C=.25;function S(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}function b(_,x){return _.getTime()/1e3-x}function I(_){return Uint8Array.from(_.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var L=function(){function _(l){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=l,this._registerListeners()}var x=_.prototype;return x.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},x._registerListeners=function(){var a=this.hls;a.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(c.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),a.on(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),a.on(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},x._unregisterListeners=function(){var a=this.hls;a.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(c.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),a.off(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),a.off(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},x.onMediaAttached=function(a,d){this.media=d.media},x.onMediaDetaching=function(){!this.id3Track||(Object(p.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},x.onManifestLoading=function(){this.dateRangeCuesAppended={}},x.createTrack=function(a){var d=this.getID3Track(a.textTracks);return d.mode="hidden",d},x.getID3Track=function(a){if(!!this.media){for(var d=0;d<a.length;d++){var y=a[d];if(y.kind==="metadata"&&y.label==="id3")return Object(p.sendAddTrackEvent)(y,this.media),y}return this.media.addTextTrack("metadata","id3")}},x.onFragParsingMetadata=function(a,d){if(!!this.media){var y=this.hls.config,E=y.enableEmsgMetadataCues,u=y.enableID3MetadataCues;if(!(!E&&!u)){var s=d.frag,o=d.samples,g=d.details;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var f=g.edge||s.end,v=S(),T=!1,m={},h=0;h<o.length;h++){var A=o[h].type;if(!(A===O.MetadataSchema.emsg&&!E||!u)){var R=w.getID3Frames(o[h].data);if(R){var P=o[h].pts,k=f,j=k-P;j<=0&&(k=P+C);for(var K=0;K<R.length;K++){var W=R[K];if(!w.isTimeStampFrame(W)){var H=new v(P,k,"");H.value=W,A&&(H.type=A),this.id3Track.addCue(H),m[W.key]=null,T=!0}}}}}T&&this.updateId3CueEnds(m)}}},x.updateId3CueEnds=function(a){var d,y=(d=this.id3Track)===null||d===void 0?void 0:d.cues;if(y)for(var E=y.length;E--;){var u,s=y[E],o=(u=s.value)===null||u===void 0?void 0:u.key;if(o&&o in a){var g=a[o];g&&s.endTime!==g&&(s.endTime=g),a[o]=s.startTime}}},x.onBufferFlushing=function(a,d){var y=d.startOffset,E=d.endOffset,u=d.type,s=this.id3Track,o=this.hls;if(!!o){var g=o.config,f=g.enableEmsgMetadataCues,v=g.enableID3MetadataCues;if(s&&(f||v)){var T;u==="audio"?T=function(h){return h.type===O.MetadataSchema.audioId3&&v}:u==="video"?T=function(h){return h.type===O.MetadataSchema.emsg&&f}:T=function(h){return h.type===O.MetadataSchema.audioId3&&v||h.type===O.MetadataSchema.emsg&&f},Object(p.removeCuesInRange)(s,y,E,T)}}},x.onLevelUpdated=function(a,d){var y=this,E=d.details;if(!(!this.media||!E.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var u=this.dateRangeCuesAppended,s=this.id3Track,o=E.dateRanges,g=Object.keys(o);if(s)for(var f=Object.keys(u).filter(function(j){return!g.includes(j)}),v=function(K){var W=f[K];Object.keys(u[W].cues).forEach(function(H){s.removeCue(u[W].cues[H])}),delete u[W]},T=f.length;T--;)v(T);var m=E.fragments[E.fragments.length-1];if(!(g.length===0||!Object(D.isFiniteNumber)(m==null?void 0:m.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var h=m.programDateTime/1e3-m.start,A=E.edge||m.end,R=S(),P=function(K){var W=g[K],H=o[W],$=u[W],z=($==null?void 0:$.cues)||{},J=($==null?void 0:$.durationKnown)||!1,ee=b(H.startDate,h),re=A,ne=H.endDate;if(ne)re=b(ne,h),J=!0;else if(H.endOnNext&&!J){var ae=g.reduce(function(ue,Ce){var be=o[Ce];return be.class===H.class&&be.id!==Ce&&be.startDate>H.startDate&&ue.push(be),ue},[]).sort(function(ue,Ce){return ue.startDate.getTime()-Ce.startDate.getTime()})[0];ae&&(re=b(ae.startDate,h),J=!0)}for(var ce=Object.keys(H.attr),fe=0;fe<ce.length;fe++){var se=ce[fe];if(!(se===M.DateRangeAttribute.ID||se===M.DateRangeAttribute.CLASS||se===M.DateRangeAttribute.START_DATE||se===M.DateRangeAttribute.DURATION||se===M.DateRangeAttribute.END_DATE||se===M.DateRangeAttribute.END_ON_NEXT)){var ve=z[se];if(ve)J&&!$.durationKnown&&(ve.endTime=re);else{var le=H.attr[se];ve=new R(ee,re,""),(se===M.DateRangeAttribute.SCTE35_OUT||se===M.DateRangeAttribute.SCTE35_IN)&&(le=I(le)),ve.value={key:se,data:le},ve.type=O.MetadataSchema.dateRange,y.id3Track.addCue(ve),z[se]=ve}}}u[W]={cues:z,dateRange:H,durationKnown:J}},k=0;k<g.length;k++)P(k)}}},_}();i.default=L},"./src/controller/latency-controller.ts":function(n,i,r){r.r(i),r.d(i,"default",function(){return O});var D=r("./src/errors.ts"),c=r("./src/events.ts"),p=r("./src/utils/logger.ts");function w(C,S){for(var b=0;b<S.length;b++){var I=S[b];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(C,I.key,I)}}function M(C,S,b){return S&&w(C.prototype,S),b&&w(C,b),Object.defineProperty(C,"prototype",{writable:!1}),C}var O=function(){function C(b){var I=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return I.timeupdate()},this.hls=b,this.config=b.config,this.registerListeners()}var S=C.prototype;return S.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},S.registerListeners=function(){this.hls.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(c.Events.ERROR,this.onError,this)},S.unregisterListeners=function(){this.hls.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(c.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(c.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(c.Events.ERROR,this.onError)},S.onMediaAttached=function(I,L){this.media=L.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},S.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},S.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},S.onLevelUpdated=function(I,L){var _=L.details;this.levelDetails=_,_.advanced&&this.timeupdate(),!_.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},S.onError=function(I,L){L.details===D.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,p.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},S.timeupdate=function(){var I=this.media,L=this.levelDetails;if(!(!I||!L)){this.currentTime=I.currentTime;var _=this.computeLatency();if(_!==null){this._latency=_;var x=this.config,l=x.lowLatencyMode,a=x.maxLiveSyncPlaybackRate;if(!(!l||a===1)){var d=this.targetLatency;if(d!==null){var y=_-d,E=Math.min(this.maxLatency,d+L.targetduration),u=y<E;if(L.live&&u&&y>.05&&this.forwardBufferLength>1){var s=Math.min(2,Math.max(1,a)),o=Math.round(2/(1+Math.exp(-.75*y-this.edgeStalled))*20)/20;I.playbackRate=Math.min(s,Math.max(1,o))}else I.playbackRate!==1&&I.playbackRate!==0&&(I.playbackRate=1)}}}}},S.estimateLiveEdge=function(){var I=this.levelDetails;return I===null?null:I.edge+I.age},S.computeLatency=function(){var I=this.estimateLiveEdge();return I===null?null:I-this.currentTime},M(C,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var I=this.config,L=this.levelDetails;return I.liveMaxLatencyDuration!==void 0?I.liveMaxLatencyDuration:L?I.liveMaxLatencyDurationCount*L.targetduration:0}},{key:"targetLatency",get:function(){var I=this.levelDetails;if(I===null)return null;var L=I.holdBack,_=I.partHoldBack,x=I.targetduration,l=this.config,a=l.liveSyncDuration,d=l.liveSyncDurationCount,y=l.lowLatencyMode,E=this.hls.userConfig,u=y&&_||L;(E.liveSyncDuration||E.liveSyncDurationCount||u===0)&&(u=a!==void 0?a:d*x);var s=x,o=1;return u+Math.min(this.stallCount*o,s)}},{key:"liveSyncPosition",get:function(){var I=this.estimateLiveEdge(),L=this.targetLatency,_=this.levelDetails;if(I===null||L===null||_===null)return null;var x=_.edge,l=I-L-this.edgeStalled,a=x-_.totalduration,d=x-(this.config.lowLatencyMode&&_.partTarget||_.targetduration);return Math.min(Math.max(a,l),d)}},{key:"drift",get:function(){var I=this.levelDetails;return I===null?1:I.drift}},{key:"edgeStalled",get:function(){var I=this.levelDetails;if(I===null)return 0;var L=(this.config.lowLatencyMode&&I.partTarget||I.targetduration)*3;return Math.max(I.age-L,0)}},{key:"forwardBufferLength",get:function(){var I=this.media,L=this.levelDetails;if(!I||!L)return 0;var _=I.buffered.length;return(_?I.buffered.end(_-1):L.edge)-this.currentTime}}]),C}()},"./src/controller/level-controller.ts":function(n,i,r){r.r(i),r.d(i,"default",function(){return l});var D=r("./src/types/level.ts"),c=r("./src/events.ts"),p=r("./src/errors.ts"),w=r("./src/utils/codecs.ts"),M=r("./src/controller/level-helper.ts"),O=r("./src/controller/base-playlist-controller.ts"),C=r("./src/types/loader.ts");function S(){return S=Object.assign?Object.assign.bind():function(a){for(var d=1;d<arguments.length;d++){var y=arguments[d];for(var E in y)Object.prototype.hasOwnProperty.call(y,E)&&(a[E]=y[E])}return a},S.apply(this,arguments)}function b(a,d){for(var y=0;y<d.length;y++){var E=d[y];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(a,E.key,E)}}function I(a,d,y){return d&&b(a.prototype,d),y&&b(a,y),Object.defineProperty(a,"prototype",{writable:!1}),a}function L(a,d){a.prototype=Object.create(d.prototype),a.prototype.constructor=a,_(a,d)}function _(a,d){return _=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(E,u){return E.__proto__=u,E},_(a,d)}var x=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),l=function(a){L(d,a);function d(E){var u;return u=a.call(this,E,"[level-controller]")||this,u._levels=[],u._firstLevel=-1,u._startLevel=void 0,u.currentLevelIndex=-1,u.manualLevelIndex=-1,u.onParsedComplete=void 0,u._registerListeners(),u}var y=d.prototype;return y._registerListeners=function(){var u=this.hls;u.on(c.Events.MANIFEST_LOADED,this.onManifestLoaded,this),u.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.on(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),u.on(c.Events.FRAG_LOADED,this.onFragLoaded,this),u.on(c.Events.ERROR,this.onError,this)},y._unregisterListeners=function(){var u=this.hls;u.off(c.Events.MANIFEST_LOADED,this.onManifestLoaded,this),u.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.off(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),u.off(c.Events.FRAG_LOADED,this.onFragLoaded,this),u.off(c.Events.ERROR,this.onError,this)},y.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,a.prototype.destroy.call(this)},y.startLoad=function(){var u=this._levels;u.forEach(function(s){s.loadError=0}),a.prototype.startLoad.call(this)},y.onManifestLoaded=function(u,s){var o=[],g=[],f=[],v,T={},m,h=!1,A=!1,R=!1;if(s.levels.forEach(function(K){var W=K.attrs;h=h||!!(K.width&&K.height),A=A||!!K.videoCodec,R=R||!!K.audioCodec,x&&K.audioCodec&&K.audioCodec.indexOf("mp4a.40.34")!==-1&&(K.audioCodec=void 0);var H=K.bitrate+"-"+K.attrs.RESOLUTION+"-"+K.attrs.CODECS;m=T[H],m?m.url.push(K.url):(m=new D.Level(K),T[H]=m,o.push(m)),W&&(W.AUDIO&&Object(M.addGroupId)(m,"audio",W.AUDIO),W.SUBTITLES&&Object(M.addGroupId)(m,"text",W.SUBTITLES))}),(h||A)&&R&&(o=o.filter(function(K){var W=K.videoCodec,H=K.width,$=K.height;return!!W||!!(H&&$)})),o=o.filter(function(K){var W=K.audioCodec,H=K.videoCodec;return(!W||Object(w.isCodecSupportedInMp4)(W,"audio"))&&(!H||Object(w.isCodecSupportedInMp4)(H,"video"))}),s.audioTracks&&(g=s.audioTracks.filter(function(K){return!K.audioCodec||Object(w.isCodecSupportedInMp4)(K.audioCodec,"audio")}),Object(M.assignTrackIdsByGroup)(g)),s.subtitles&&(f=s.subtitles,Object(M.assignTrackIdsByGroup)(f)),o.length>0){v=o[0].bitrate,o.sort(function(K,W){return K.bitrate-W.bitrate}),this._levels=o;for(var P=0;P<o.length;P++)if(o[P].bitrate===v){this._firstLevel=P,this.log("manifest loaded, "+o.length+" level(s) found, first bitrate: "+v);break}var k=R&&!A,j={levels:o,audioTracks:g,subtitleTracks:f,firstLevel:this._firstLevel,stats:s.stats,audio:R,video:A,altAudio:!k&&g.some(function(K){return!!K.url})};this.hls.trigger(c.Events.MANIFEST_PARSED,j),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(c.Events.ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:s.url,reason:"no level with compatible codecs found in manifest"})},y.onError=function(u,s){var o;if(a.prototype.onError.call(this,u,s),!s.fatal){var g=s.context,f=this._levels[this.currentLevelIndex];if(g&&(g.type===C.PlaylistContextType.AUDIO_TRACK&&f.audioGroupIds&&g.groupId===f.audioGroupIds[f.urlId]||g.type===C.PlaylistContextType.SUBTITLE_TRACK&&f.textGroupIds&&g.groupId===f.textGroupIds[f.urlId])){this.redundantFailover(this.currentLevelIndex);return}var v=!1,T=!0,m;switch(s.details){case p.ErrorDetails.FRAG_LOAD_ERROR:case p.ErrorDetails.FRAG_LOAD_TIMEOUT:case p.ErrorDetails.KEY_LOAD_ERROR:case p.ErrorDetails.KEY_LOAD_TIMEOUT:if(s.frag){var h=s.frag.type===C.PlaylistLevelType.MAIN?s.frag.level:this.currentLevelIndex,A=this._levels[h];A?(A.fragmentError++,A.fragmentError>this.hls.config.fragLoadingMaxRetry&&(m=h)):m=h}break;case p.ErrorDetails.LEVEL_LOAD_ERROR:case p.ErrorDetails.LEVEL_LOAD_TIMEOUT:g&&(g.deliveryDirectives&&(T=!1),m=g.level),v=!0;break;case p.ErrorDetails.REMUX_ALLOC_ERROR:m=(o=s.level)!=null?o:this.currentLevelIndex,v=!0;break}m!==void 0&&this.recoverLevel(s,m,v,T)}},y.recoverLevel=function(u,s,o,g){var f=u.details,v=this._levels[s];if(v.loadError++,o){var T=this.retryLoadingOrFail(u);if(T)u.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(g){var m=v.url.length;if(m>1&&v.loadError<m)u.levelRetry=!0,this.redundantFailover(s);else if(this.manualLevelIndex===-1){for(var h=-1,A=this._levels,R=A.length;R--;){var P=(R+this.currentLevelIndex)%A.length;if(P!==this.currentLevelIndex&&A[P].loadError===0){h=P;break}}h>-1&&this.currentLevelIndex!==h&&(this.warn(f+": switch to "+h),u.levelRetry=!0,this.hls.nextAutoLevel=h)}}},y.redundantFailover=function(u){var s=this._levels[u],o=s.url.length;if(o>1){var g=(s.urlId+1)%o;this.warn("Switching to redundant URL-id "+g),this._levels.forEach(function(f){f.urlId=g}),this.level=u}},y.onFragLoaded=function(u,s){var o=s.frag;if(o!==void 0&&o.type===C.PlaylistLevelType.MAIN){var g=this._levels[o.level];g!==void 0&&(g.fragmentError=0,g.loadError=0)}},y.onLevelLoaded=function(u,s){var o,g=s.level,f=s.details,v=this._levels[g];if(!v){var T;this.warn("Invalid level index "+g),(T=s.deliveryDirectives)!==null&&T!==void 0&&T.skip&&(f.deltaUpdateFailed=!0);return}g===this.currentLevelIndex?(v.fragmentError===0&&(v.loadError=0,this.retryCount=0),this.playlistLoaded(g,s,v.details)):(o=s.deliveryDirectives)!==null&&o!==void 0&&o.skip&&(f.deltaUpdateFailed=!0)},y.onAudioTrackSwitched=function(u,s){var o=this.hls.levels[this.currentLevelIndex];if(!!o&&o.audioGroupIds){for(var g=-1,f=this.hls.audioTracks[s.id].groupId,v=0;v<o.audioGroupIds.length;v++)if(o.audioGroupIds[v]===f){g=v;break}g!==o.urlId&&(o.urlId=g,this.startLoad())}},y.loadPlaylist=function(u){var s=this.currentLevelIndex,o=this._levels[s];if(this.canLoad&&o&&o.url.length>0){var g=o.urlId,f=o.url[g];if(u)try{f=u.addDirectives(f)}catch(v){this.warn("Could not construct new URL with HLS Delivery Directives: "+v)}this.log("Attempt loading level index "+s+(u?" at sn "+u.msn+" part "+u.part:"")+" with URL-id "+g+" "+f),this.clearTimer(),this.hls.trigger(c.Events.LEVEL_LOADING,{url:f,level:s,id:g,deliveryDirectives:u||null})}},y.removeLevel=function(u,s){var o=function(v,T){return T!==s},g=this._levels.filter(function(f,v){return v!==u?!0:f.url.length>1&&s!==void 0?(f.url=f.url.filter(o),f.audioGroupIds&&(f.audioGroupIds=f.audioGroupIds.filter(o)),f.textGroupIds&&(f.textGroupIds=f.textGroupIds.filter(o)),f.urlId=0,!0):!1}).map(function(f,v){var T=f.details;return T!=null&&T.fragments&&T.fragments.forEach(function(m){m.level=v}),f});this._levels=g,this.hls.trigger(c.Events.LEVELS_UPDATED,{levels:g})},I(d,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(u){var s,o=this._levels;if(o.length!==0&&!(this.currentLevelIndex===u&&(s=o[u])!==null&&s!==void 0&&s.details)){if(u<0||u>=o.length){var g=u<0;if(this.hls.trigger(c.Events.ERROR,{type:p.ErrorTypes.OTHER_ERROR,details:p.ErrorDetails.LEVEL_SWITCH_ERROR,level:u,fatal:g,reason:"invalid level idx"}),g)return;u=Math.min(u,o.length-1)}this.clearTimer();var f=this.currentLevelIndex,v=o[f],T=o[u];this.log("switching to level "+u+" from "+f),this.currentLevelIndex=u;var m=S({},T,{level:u,maxBitrate:T.maxBitrate,uri:T.uri,urlId:T.urlId});delete m._urlId,this.hls.trigger(c.Events.LEVEL_SWITCHING,m);var h=T.details;if(!h||h.live){var A=this.switchParams(T.uri,v==null?void 0:v.details);this.loadPlaylist(A)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(u){this.manualLevelIndex=u,this._startLevel===void 0&&(this._startLevel=u),u!==-1&&(this.level=u)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(u){this._firstLevel=u}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var u=this.hls.config.startLevel;return u!==void 0?u:this._firstLevel}else return this._startLevel},set:function(u){this._startLevel=u}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(u){this.level=u,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=u)}}]),d}(O.default)},"./src/controller/level-helper.ts":function(n,i,r){r.r(i),r.d(i,"addGroupId",function(){return M}),r.d(i,"assignTrackIdsByGroup",function(){return O}),r.d(i,"updatePTS",function(){return C}),r.d(i,"updateFragPTSDTS",function(){return b}),r.d(i,"mergeDetails",function(){return I}),r.d(i,"mapPartIntersection",function(){return _}),r.d(i,"mapFragmentIntersection",function(){return x}),r.d(i,"adjustSliding",function(){return l}),r.d(i,"addSliding",function(){return a}),r.d(i,"computeReloadInterval",function(){return d}),r.d(i,"getFragmentWithSN",function(){return y}),r.d(i,"getPartWith",function(){return E});var D=r("./src/polyfills/number.ts"),c=r("./src/utils/logger.ts"),p=r("./src/loader/date-range.ts");function w(){return w=Object.assign?Object.assign.bind():function(u){for(var s=1;s<arguments.length;s++){var o=arguments[s];for(var g in o)Object.prototype.hasOwnProperty.call(o,g)&&(u[g]=o[g])}return u},w.apply(this,arguments)}function M(u,s,o){switch(s){case"audio":u.audioGroupIds||(u.audioGroupIds=[]),u.audioGroupIds.push(o);break;case"text":u.textGroupIds||(u.textGroupIds=[]),u.textGroupIds.push(o);break}}function O(u){var s={};u.forEach(function(o){var g=o.groupId||"";o.id=s[g]=s[g]||0,s[g]++})}function C(u,s,o){var g=u[s],f=u[o];S(g,f)}function S(u,s){var o=s.startPTS;if(Object(D.isFiniteNumber)(o)){var g=0,f;s.sn>u.sn?(g=o-u.start,f=u):(g=u.start-o,f=s),f.duration!==g&&(f.duration=g)}else if(s.sn>u.sn){var v=u.cc===s.cc;v&&u.minEndPTS?s.start=u.start+(u.minEndPTS-u.start):s.start=u.start+u.duration}else s.start=Math.max(u.start-s.duration,0)}function b(u,s,o,g,f,v){var T=g-o;T<=0&&(c.logger.warn("Fragment should have a positive duration",s),g=o+s.duration,v=f+s.duration);var m=o,h=g,A=s.startPTS,R=s.endPTS;if(Object(D.isFiniteNumber)(A)){var P=Math.abs(A-o);Object(D.isFiniteNumber)(s.deltaPTS)?s.deltaPTS=Math.max(P,s.deltaPTS):s.deltaPTS=P,m=Math.max(o,A),o=Math.min(o,A),f=Math.min(f,s.startDTS),h=Math.min(g,R),g=Math.max(g,R),v=Math.max(v,s.endDTS)}s.duration=g-o;var k=o-s.start;s.appendedPTS=g,s.start=s.startPTS=o,s.maxStartPTS=m,s.startDTS=f,s.endPTS=g,s.minEndPTS=h,s.endDTS=v;var j=s.sn;if(!u||j<u.startSN||j>u.endSN)return 0;var K,W=j-u.startSN,H=u.fragments;for(H[W]=s,K=W;K>0;K--)S(H[K],H[K-1]);for(K=W;K<H.length-1;K++)S(H[K],H[K+1]);return u.fragmentHint&&S(H[H.length-1],u.fragmentHint),u.PTSKnown=u.alignedSliding=!0,k}function I(u,s){for(var o=null,g=u.fragments,f=g.length-1;f>=0;f--){var v=g[f].initSegment;if(v){o=v;break}}u.fragmentHint&&delete u.fragmentHint.endPTS;var T=0,m;if(x(u,s,function(K,W){K.relurl&&(T=K.cc-W.cc),Object(D.isFiniteNumber)(K.startPTS)&&Object(D.isFiniteNumber)(K.endPTS)&&(W.start=W.startPTS=K.startPTS,W.startDTS=K.startDTS,W.appendedPTS=K.appendedPTS,W.maxStartPTS=K.maxStartPTS,W.endPTS=K.endPTS,W.endDTS=K.endDTS,W.minEndPTS=K.minEndPTS,W.duration=K.endPTS-K.startPTS,W.duration&&(m=W),s.PTSKnown=s.alignedSliding=!0),W.elementaryStreams=K.elementaryStreams,W.loader=K.loader,W.stats=K.stats,W.urlId=K.urlId,K.initSegment&&(W.initSegment=K.initSegment,o=K.initSegment)}),o){var h=s.fragmentHint?s.fragments.concat(s.fragmentHint):s.fragments;h.forEach(function(K){var W;(!K.initSegment||K.initSegment.relurl===((W=o)===null||W===void 0?void 0:W.relurl))&&(K.initSegment=o)})}if(s.skippedSegments)if(s.deltaUpdateFailed=s.fragments.some(function(K){return!K}),s.deltaUpdateFailed){c.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var A=s.skippedSegments;A--;)s.fragments.shift();s.startSN=s.fragments[0].sn,s.startCC=s.fragments[0].cc}else s.canSkipDateRanges&&(s.dateRanges=L(u.dateRanges,s.dateRanges,s.recentlyRemovedDateranges));var R=s.fragments;if(T){c.logger.warn("discontinuity sliding from playlist, take drift into account");for(var P=0;P<R.length;P++)R[P].cc+=T}s.skippedSegments&&(s.startCC=s.fragments[0].cc),_(u.partList,s.partList,function(K,W){W.elementaryStreams=K.elementaryStreams,W.stats=K.stats}),m?b(s,m,m.startPTS,m.endPTS,m.startDTS,m.endDTS):l(u,s),R.length&&(s.totalduration=s.edge-R[0].start),s.driftStartTime=u.driftStartTime,s.driftStart=u.driftStart;var k=s.advancedDateTime;if(s.advanced&&k){var j=s.edge;s.driftStart||(s.driftStartTime=k,s.driftStart=j),s.driftEndTime=k,s.driftEnd=j}else s.driftEndTime=u.driftEndTime,s.driftEnd=u.driftEnd,s.advancedDateTime=u.advancedDateTime}function L(u,s,o){var g=w({},u);return o&&o.forEach(function(f){delete g[f]}),Object.keys(s).forEach(function(f){var v=new p.DateRange(s[f].attr,g[f]);v.isValid?g[f]=v:c.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(s[f].attr)+'"')}),g}function _(u,s,o){if(u&&s)for(var g=0,f=0,v=u.length;f<=v;f++){var T=u[f],m=s[f+g];T&&m&&T.index===m.index&&T.fragment.sn===m.fragment.sn?o(T,m):g--}}function x(u,s,o){for(var g=s.skippedSegments,f=Math.max(u.startSN,s.startSN)-s.startSN,v=(u.fragmentHint?1:0)+(g?s.endSN:Math.min(u.endSN,s.endSN))-s.startSN,T=s.startSN-u.startSN,m=s.fragmentHint?s.fragments.concat(s.fragmentHint):s.fragments,h=u.fragmentHint?u.fragments.concat(u.fragmentHint):u.fragments,A=f;A<=v;A++){var R=h[T+A],P=m[A];g&&!P&&A<g&&(P=s.fragments[A]=R),R&&P&&o(R,P)}}function l(u,s){var o=s.startSN+s.skippedSegments-u.startSN,g=u.fragments;o<0||o>=g.length||a(s,g[o].start)}function a(u,s){if(s){for(var o=u.fragments,g=u.skippedSegments;g<o.length;g++)o[g].start+=s;u.fragmentHint&&(u.fragmentHint.start+=s)}}function d(u,s){var o=1e3*u.levelTargetDuration,g=o/2,f=u.age,v=f>0&&f<o*3,T=s.loading.end-s.loading.start,m,h=u.availabilityDelay;if(u.updated===!1)if(v){var A=333*u.misses;m=Math.max(Math.min(g,T*2),A),u.availabilityDelay=(u.availabilityDelay||0)+m}else m=g;else v?(h=Math.min(h||o/2,f),u.availabilityDelay=h,m=h+o-f):m=o-T;return Math.round(m)}function y(u,s,o){if(!u||!u.details)return null;var g=u.details,f=g.fragments[s-g.startSN];return f||(f=g.fragmentHint,f&&f.sn===s)?f:s<g.startSN&&o&&o.sn===s?o:null}function E(u,s,o){if(!u||!u.details)return null;var g=u.details.partList;if(g)for(var f=g.length;f--;){var v=g[f];if(v.index===o&&v.fragment.sn===s)return v}return null}},"./src/controller/stream-controller.ts":function(n,i,r){r.r(i),r.d(i,"default",function(){return E});var D=r("./src/polyfills/number.ts"),c=r("./src/controller/base-stream-controller.ts"),p=r("./src/is-supported.ts"),w=r("./src/events.ts"),M=r("./src/utils/buffer-helper.ts"),O=r("./src/controller/fragment-tracker.ts"),C=r("./src/types/loader.ts"),S=r("./src/loader/fragment.ts"),b=r("./src/demux/transmuxer-interface.ts"),I=r("./src/types/transmuxer.ts"),L=r("./src/controller/gap-controller.ts"),_=r("./src/errors.ts");function x(u,s){for(var o=0;o<s.length;o++){var g=s[o];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(u,g.key,g)}}function l(u,s,o){return s&&x(u.prototype,s),o&&x(u,o),Object.defineProperty(u,"prototype",{writable:!1}),u}function a(u,s){u.prototype=Object.create(s.prototype),u.prototype.constructor=u,d(u,s)}function d(u,s){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(g,f){return g.__proto__=f,g},d(u,s)}var y=100,E=function(u){a(s,u);function s(g,f){var v;return v=u.call(this,g,f,"[stream-controller]")||this,v.audioCodecSwap=!1,v.gapController=null,v.level=-1,v._forceStartLoad=!1,v.altAudio=!1,v.audioOnly=!1,v.fragPlaying=null,v.onvplaying=null,v.onvseeked=null,v.fragLastKbps=0,v.couldBacktrack=!1,v.backtrackFragment=null,v.audioCodecSwitch=!1,v.videoBuffer=null,v._registerListeners(),v}var o=s.prototype;return o._registerListeners=function(){var f=this.hls;f.on(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.on(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.on(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.on(w.Events.MANIFEST_PARSED,this.onManifestParsed,this),f.on(w.Events.LEVEL_LOADING,this.onLevelLoading,this),f.on(w.Events.LEVEL_LOADED,this.onLevelLoaded,this),f.on(w.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),f.on(w.Events.ERROR,this.onError,this),f.on(w.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),f.on(w.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),f.on(w.Events.BUFFER_CREATED,this.onBufferCreated,this),f.on(w.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),f.on(w.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),f.on(w.Events.FRAG_BUFFERED,this.onFragBuffered,this)},o._unregisterListeners=function(){var f=this.hls;f.off(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.off(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.off(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.off(w.Events.MANIFEST_PARSED,this.onManifestParsed,this),f.off(w.Events.LEVEL_LOADED,this.onLevelLoaded,this),f.off(w.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),f.off(w.Events.ERROR,this.onError,this),f.off(w.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),f.off(w.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),f.off(w.Events.BUFFER_CREATED,this.onBufferCreated,this),f.off(w.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),f.off(w.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),f.off(w.Events.FRAG_BUFFERED,this.onFragBuffered,this)},o.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},o.startLoad=function(f){if(this.levels){var v=this.lastCurrentTime,T=this.hls;if(this.stopLoad(),this.setInterval(y),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var m=T.startLevel;m===-1&&(T.config.testBandwidth&&this.levels.length>1?(m=0,this.bitrateTest=!0):m=T.nextAutoLevel),this.level=T.nextLoadLevel=m,this.loadedmetadata=!1}v>0&&f===-1&&(this.log("Override startPosition with lastCurrentTime @"+v.toFixed(3)),f=v),this.state=c.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=f,this.tick()}else this._forceStartLoad=!0,this.state=c.State.STOPPED},o.stopLoad=function(){this._forceStartLoad=!1,u.prototype.stopLoad.call(this)},o.doTick=function(){switch(this.state){case c.State.IDLE:this.doTickIdle();break;case c.State.WAITING_LEVEL:{var f,v=this.levels,T=this.level,m=v==null||(f=v[T])===null||f===void 0?void 0:f.details;if(m&&(!m.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(m))break;this.state=c.State.IDLE;break}break}case c.State.FRAG_LOADING_WAITING_RETRY:{var h,A=self.performance.now(),R=this.retryDate;(!R||A>=R||(h=this.media)!==null&&h!==void 0&&h.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=c.State.IDLE)}break}this.onTickEnd()},o.onTickEnd=function(){u.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},o.doTickIdle=function(){var f,v,T=this.hls,m=this.levelLastLoaded,h=this.levels,A=this.media,R=T.config,P=T.nextLoadLevel;if(!(m===null||!A&&(this.startFragRequested||!R.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!h||!h[P])){var k=h[P];this.level=T.nextLoadLevel=P;var j=k.details;if(!j||this.state===c.State.WAITING_LEVEL||j.live&&this.levelLastLoaded!==P){this.state=c.State.WAITING_LEVEL;return}var K=this.getMainFwdBufferInfo();if(K!==null){var W=K.len,H=this.getMaxBufferLength(k.maxBitrate);if(!(W>=H)){if(this._streamEnded(K,j)){var $={};this.altAudio&&($.type="video"),this.hls.trigger(w.Events.BUFFER_EOS,$),this.state=c.State.ENDED;return}this.backtrackFragment&&this.backtrackFragment.start>K.end&&(this.backtrackFragment=null);var z=this.backtrackFragment?this.backtrackFragment.start:K.end,J=this.getNextFragment(z,j);if(this.couldBacktrack&&!this.fragPrevious&&J&&J.sn!=="initSegment"&&this.fragmentTracker.getState(J)!==O.FragmentState.OK){var ee,re=((ee=this.backtrackFragment)!=null?ee:J).sn,ne=re-j.startSN,ae=j.fragments[ne-1];ae&&J.cc===ae.cc&&(J=ae,this.fragmentTracker.removeFragment(ae))}else this.backtrackFragment&&K.len&&(this.backtrackFragment=null);if(J&&this.fragmentTracker.getState(J)===O.FragmentState.OK&&this.nextLoadPosition>z){var ce=this.audioOnly&&!this.altAudio?S.ElementaryStreamTypes.AUDIO:S.ElementaryStreamTypes.VIDEO;A&&this.afterBufferFlushed(A,ce,C.PlaylistLevelType.MAIN),J=this.getNextFragment(this.nextLoadPosition,j)}!J||(J.initSegment&&!J.initSegment.data&&!this.bitrateTest&&(J=J.initSegment),((f=J.decryptdata)===null||f===void 0?void 0:f.keyFormat)==="identity"&&!((v=J.decryptdata)!==null&&v!==void 0&&v.key)?this.loadKey(J,j):this.loadFragment(J,j,z))}}}},o.loadFragment=function(f,v,T){var m,h=this.fragmentTracker.getState(f);this.fragCurrent=f,h===O.FragmentState.NOT_LOADED?f.sn==="initSegment"?this._loadInitSegment(f):this.bitrateTest?(this.log("Fragment "+f.sn+" of level "+f.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(f)):(this.startFragRequested=!0,u.prototype.loadFragment.call(this,f,v,T)):h===O.FragmentState.APPENDING?this.reduceMaxBufferLength(f.duration)&&this.fragmentTracker.removeFragment(f):((m=this.media)===null||m===void 0?void 0:m.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},o.getAppendedFrag=function(f){var v=this.fragmentTracker.getAppendedFrag(f,C.PlaylistLevelType.MAIN);return v&&"fragment"in v?v.fragment:v},o.getBufferedFrag=function(f){return this.fragmentTracker.getBufferedFrag(f,C.PlaylistLevelType.MAIN)},o.followingBufferedFrag=function(f){return f?this.getBufferedFrag(f.end+.5):null},o.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},o.nextLevelSwitch=function(){var f=this.levels,v=this.media;if(v!=null&&v.readyState){var T,m=this.getAppendedFrag(v.currentTime);if(m&&m.start>1&&this.flushMainBuffer(0,m.start-1),!v.paused&&f){var h=this.hls.nextLoadLevel,A=f[h],R=this.fragLastKbps;R&&this.fragCurrent?T=this.fragCurrent.duration*A.maxBitrate/(1e3*R)+1:T=0}else T=0;var P=this.getBufferedFrag(v.currentTime+T);if(P){var k=this.followingBufferedFrag(P);if(k){this.abortCurrentFrag();var j=k.maxStartPTS?k.maxStartPTS:k.start,K=k.duration,W=Math.max(P.end,j+Math.min(Math.max(K-this.config.maxFragLookUpTolerance,K*.5),K*.75));this.flushMainBuffer(W,Number.POSITIVE_INFINITY)}}}},o.abortCurrentFrag=function(){var f=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,f!=null&&f.loader&&f.loader.abort(),this.state){case c.State.KEY_LOADING:case c.State.FRAG_LOADING:case c.State.FRAG_LOADING_WAITING_RETRY:case c.State.PARSING:case c.State.PARSED:this.state=c.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},o.flushMainBuffer=function(f,v){u.prototype.flushMainBuffer.call(this,f,v,this.altAudio?"video":null)},o.onMediaAttached=function(f,v){u.prototype.onMediaAttached.call(this,f,v);var T=v.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),T.addEventListener("playing",this.onvplaying),T.addEventListener("seeked",this.onvseeked),this.gapController=new L.default(this.config,T,this.fragmentTracker,this.hls)},o.onMediaDetaching=function(){var f=this.media;f&&this.onvplaying&&this.onvseeked&&(f.removeEventListener("playing",this.onvplaying),f.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),u.prototype.onMediaDetaching.call(this)},o.onMediaPlaying=function(){this.tick()},o.onMediaSeeked=function(){var f=this.media,v=f?f.currentTime:null;Object(D.isFiniteNumber)(v)&&this.log("Media seeked to "+v.toFixed(3)),this.tick()},o.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(w.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},o.onManifestParsed=function(f,v){var T=!1,m=!1,h;v.levels.forEach(function(A){h=A.audioCodec,h&&(h.indexOf("mp4a.40.2")!==-1&&(T=!0),h.indexOf("mp4a.40.5")!==-1&&(m=!0))}),this.audioCodecSwitch=T&&m&&!Object(p.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=v.levels,this.startFragRequested=!1},o.onLevelLoading=function(f,v){var T=this.levels;if(!(!T||this.state!==c.State.IDLE)){var m=T[v.level];(!m.details||m.details.live&&this.levelLastLoaded!==v.level||this.waitForCdnTuneIn(m.details))&&(this.state=c.State.WAITING_LEVEL)}},o.onLevelLoaded=function(f,v){var T,m=this.levels,h=v.level,A=v.details,R=A.totalduration;if(!m){this.warn("Levels were reset while loading level "+h);return}this.log("Level "+h+" loaded ["+A.startSN+","+A.endSN+"], cc ["+A.startCC+", "+A.endCC+"] duration:"+R);var P=this.fragCurrent;P&&(this.state===c.State.FRAG_LOADING||this.state===c.State.FRAG_LOADING_WAITING_RETRY)&&P.level!==v.level&&P.loader&&(this.state=c.State.IDLE,this.backtrackFragment=null,P.loader.abort());var k=m[h],j=0;if(A.live||(T=k.details)!==null&&T!==void 0&&T.live){if(A.fragments[0]||(A.deltaUpdateFailed=!0),A.deltaUpdateFailed)return;j=this.alignPlaylists(A,k.details)}if(k.details=A,this.levelLastLoaded=h,this.hls.trigger(w.Events.LEVEL_UPDATED,{details:A,level:h}),this.state===c.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(A))return;this.state=c.State.IDLE}this.startFragRequested?A.live&&this.synchronizeToLiveEdge(A):this.setStartPosition(A,j),this.tick()},o._handleFragmentLoadProgress=function(f){var v,T=f.frag,m=f.part,h=f.payload,A=this.levels;if(!A){this.warn("Levels were reset while fragment load was in progress. Fragment "+T.sn+" of level "+T.level+" will not be buffered");return}var R=A[T.level],P=R.details;if(!P){this.warn("Dropping fragment "+T.sn+" of level "+T.level+" after level details were reset");return}var k=R.videoCodec,j=P.PTSKnown||!P.live,K=(v=T.initSegment)===null||v===void 0?void 0:v.data,W=this._getAudioCodec(R),H=this.transmuxer=this.transmuxer||new b.default(this.hls,C.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),$=m?m.index:-1,z=$!==-1,J=new I.ChunkMetadata(T.level,T.sn,T.stats.chunkCount,h.byteLength,$,z),ee=this.initPTS[T.cc];H.push(h,K,W,k,T,m,P.totalduration,j,J,ee)},o.onAudioTrackSwitching=function(f,v){var T=this.altAudio,m=!!v.url,h=v.id;if(!m){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var A=this.fragCurrent;A!=null&&A.loader&&(this.log("Switching to main audio track, cancel main fragment load"),A.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var R=this.hls;T&&R.trigger(w.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),R.trigger(w.Events.AUDIO_TRACK_SWITCHED,{id:h})}},o.onAudioTrackSwitched=function(f,v){var T=v.id,m=!!this.hls.audioTracks[T].url;if(m){var h=this.videoBuffer;h&&this.mediaBuffer!==h&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=h)}this.altAudio=m,this.tick()},o.onBufferCreated=function(f,v){var T=v.tracks,m,h,A=!1;for(var R in T){var P=T[R];if(P.id==="main"){if(h=R,m=P,R==="video"){var k=T[R];k&&(this.videoBuffer=k.buffer)}}else A=!0}A&&m?(this.log("Alternate track found, use "+h+".buffered to schedule main fragment loading"),this.mediaBuffer=m.buffer):this.mediaBuffer=this.media},o.onFragBuffered=function(f,v){var T=v.frag,m=v.part;if(!(T&&T.type!==C.PlaylistLevelType.MAIN)){if(this.fragContextChanged(T)){this.warn("Fragment "+T.sn+(m?" p: "+m.index:"")+" of level "+T.level+" finished buffering, but was aborted. state: "+this.state),this.state===c.State.PARSED&&(this.state=c.State.IDLE);return}var h=m?m.stats:T.stats;this.fragLastKbps=Math.round(8*h.total/(h.buffering.end-h.loading.first)),T.sn!=="initSegment"&&(this.fragPrevious=T),this.fragBufferedComplete(T,m)}},o.onError=function(f,v){switch(v.details){case _.ErrorDetails.FRAG_LOAD_ERROR:case _.ErrorDetails.FRAG_LOAD_TIMEOUT:case _.ErrorDetails.KEY_LOAD_ERROR:case _.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(C.PlaylistLevelType.MAIN,v);break;case _.ErrorDetails.LEVEL_LOAD_ERROR:case _.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==c.State.ERROR&&(v.fatal?(this.warn(""+v.details),this.state=c.State.ERROR):!v.levelRetry&&this.state===c.State.WAITING_LEVEL&&(this.state=c.State.IDLE));break;case _.ErrorDetails.BUFFER_FULL_ERROR:if(v.parent==="main"&&(this.state===c.State.PARSING||this.state===c.State.PARSED)){var T=!0,m=this.getFwdBufferInfo(this.media,C.PlaylistLevelType.MAIN);m&&m.len>.5&&(T=!this.reduceMaxBufferLength(m.len)),T&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},o.checkBuffer=function(){var f=this.media,v=this.gapController;if(!(!f||!v||!f.readyState)){if(this.loadedmetadata||!M.BufferHelper.getBuffered(f).length){var T=this.state!==c.State.IDLE?this.fragCurrent:null;v.poll(this.lastCurrentTime,T)}this.lastCurrentTime=f.currentTime}},o.onFragLoadEmergencyAborted=function(){this.state=c.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},o.onBufferFlushed=function(f,v){var T=v.type;if(T!==S.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var m=(T===S.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(m,T,C.PlaylistLevelType.MAIN)}},o.onLevelsUpdated=function(f,v){this.levels=v.levels},o.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},o.seekToStartPos=function(){var f=this.media;if(!!f){var v=f.currentTime,T=this.startPosition;if(T>=0&&v<T){if(f.seeking){this.log("could not seek to "+T+", already seeking at "+v);return}var m=M.BufferHelper.getBuffered(f),h=m.length?m.start(0):0,A=h-T;A>0&&(A<this.config.maxBufferHole||A<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+A+" to match buffer start"),T+=A,this.startPosition=T),this.log("seek to target start position "+T+" from current time "+v),f.currentTime=T}}},o._getAudioCodec=function(f){var v=this.config.defaultAudioCodec||f.audioCodec;return this.audioCodecSwap&&v&&(this.log("Swapping audio codec"),v.indexOf("mp4a.40.5")!==-1?v="mp4a.40.2":v="mp4a.40.5"),v},o._loadBitrateTestFrag=function(f){var v=this;f.bitrateTest=!0,this._doFragLoad(f).then(function(T){var m=v.hls;if(!(!T||m.nextLoadLevel||v.fragContextChanged(f))){v.fragLoadError=0,v.state=c.State.IDLE,v.startFragRequested=!1,v.bitrateTest=!1;var h=f.stats;h.parsing.start=h.parsing.end=h.buffering.start=h.buffering.end=self.performance.now(),m.trigger(w.Events.FRAG_LOADED,T),f.bitrateTest=!1}})},o._handleTransmuxComplete=function(f){var v,T="main",m=this.hls,h=f.remuxResult,A=f.chunkMeta,R=this.getCurrentContext(A);if(!R){this.warn("The loading context changed while buffering fragment "+A.sn+" of level "+A.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(A.level);return}var P=R.frag,k=R.part,j=R.level,K=h.video,W=h.text,H=h.id3,$=h.initSegment,z=j.details,J=this.altAudio?void 0:h.audio;if(!this.fragContextChanged(P)){if(this.state=c.State.PARSING,$){$.tracks&&(this._bufferInitSegment(j,$.tracks,P,A),m.trigger(w.Events.FRAG_PARSING_INIT_SEGMENT,{frag:P,id:T,tracks:$.tracks}));var ee=$.initPTS,re=$.timescale;Object(D.isFiniteNumber)(ee)&&(this.initPTS[P.cc]=ee,m.trigger(w.Events.INIT_PTS_FOUND,{frag:P,id:T,initPTS:ee,timescale:re}))}if(K&&h.independent!==!1){if(z){var ne=K.startPTS,ae=K.endPTS,ce=K.startDTS,fe=K.endDTS;if(k)k.elementaryStreams[K.type]={startPTS:ne,endPTS:ae,startDTS:ce,endDTS:fe};else if(K.firstKeyFrame&&K.independent&&(this.couldBacktrack=!0),K.dropped&&K.independent){var se=this.getMainFwdBufferInfo(),ve=(se?se.end:this.getLoadPosition())+this.config.maxBufferHole,le=K.firstKeyFramePTS?K.firstKeyFramePTS:ne;if(ve<le-this.config.maxBufferHole){this.backtrack(P);return}P.setElementaryStreamInfo(K.type,P.start,ae,P.start,fe,!0)}P.setElementaryStreamInfo(K.type,ne,ae,ce,fe),this.backtrackFragment&&(this.backtrackFragment=P),this.bufferFragmentData(K,P,k,A)}}else if(h.independent===!1){this.backtrack(P);return}if(J){var ue=J.startPTS,Ce=J.endPTS,be=J.startDTS,Le=J.endDTS;k&&(k.elementaryStreams[S.ElementaryStreamTypes.AUDIO]={startPTS:ue,endPTS:Ce,startDTS:be,endDTS:Le}),P.setElementaryStreamInfo(S.ElementaryStreamTypes.AUDIO,ue,Ce,be,Le),this.bufferFragmentData(J,P,k,A)}if(z&&H!==null&&H!==void 0&&(v=H.samples)!==null&&v!==void 0&&v.length){var Ue={id:T,frag:P,details:z,samples:H.samples};m.trigger(w.Events.FRAG_PARSING_METADATA,Ue)}if(z&&W){var we={id:T,frag:P,details:z,samples:W.samples};m.trigger(w.Events.FRAG_PARSING_USERDATA,we)}}},o._bufferInitSegment=function(f,v,T,m){var h=this;if(this.state===c.State.PARSING){this.audioOnly=!!v.audio&&!v.video,this.altAudio&&!this.audioOnly&&delete v.audio;var A=v.audio,R=v.video,P=v.audiovideo;if(A){var k=f.audioCodec,j=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(k&&(k.indexOf("mp4a.40.5")!==-1?k="mp4a.40.2":k="mp4a.40.5"),A.metadata.channelCount!==1&&j.indexOf("firefox")===-1&&(k="mp4a.40.5")),j.indexOf("android")!==-1&&A.container!=="audio/mpeg"&&(k="mp4a.40.2",this.log("Android: force audio codec to "+k)),f.audioCodec&&f.audioCodec!==k&&this.log('Swapping manifest audio codec "'+f.audioCodec+'" for "'+k+'"'),A.levelCodec=k,A.id="main",this.log("Init audio buffer, container:"+A.container+", codecs[selected/level/parsed]=["+(k||"")+"/"+(f.audioCodec||"")+"/"+A.codec+"]")}R&&(R.levelCodec=f.videoCodec,R.id="main",this.log("Init video buffer, container:"+R.container+", codecs[level/parsed]=["+(f.videoCodec||"")+"/"+R.codec+"]")),P&&this.log("Init audiovideo buffer, container:"+P.container+", codecs[level/parsed]=["+(f.attrs.CODECS||"")+"/"+P.codec+"]"),this.hls.trigger(w.Events.BUFFER_CODECS,v),Object.keys(v).forEach(function(K){var W=v[K],H=W.initSegment;H!=null&&H.byteLength&&h.hls.trigger(w.Events.BUFFER_APPENDING,{type:K,data:H,frag:T,part:null,chunkMeta:m,parent:T.type})}),this.tick()}},o.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,C.PlaylistLevelType.MAIN)},o.backtrack=function(f){this.couldBacktrack=!0,this.backtrackFragment=f,this.resetTransmuxer(),this.flushBufferGap(f),this.fragmentTracker.removeFragment(f),this.fragPrevious=null,this.nextLoadPosition=f.start,this.state=c.State.IDLE},o.checkFragmentChanged=function(){var f=this.media,v=null;if(f&&f.readyState>1&&f.seeking===!1){var T=f.currentTime;if(M.BufferHelper.isBuffered(f,T)?v=this.getAppendedFrag(T):M.BufferHelper.isBuffered(f,T+.1)&&(v=this.getAppendedFrag(T+.1)),v){this.backtrackFragment=null;var m=this.fragPlaying,h=v.level;(!m||v.sn!==m.sn||m.level!==h||v.urlId!==m.urlId)&&(this.hls.trigger(w.Events.FRAG_CHANGED,{frag:v}),(!m||m.level!==h)&&this.hls.trigger(w.Events.LEVEL_SWITCHED,{level:h}),this.fragPlaying=v)}}},l(s,[{key:"nextLevel",get:function(){var f=this.nextBufferedFrag;return f?f.level:-1}},{key:"currentFrag",get:function(){var f=this.media;return f?this.fragPlaying||this.getAppendedFrag(f.currentTime):null}},{key:"currentProgramDateTime",get:function(){var f=this.media;if(f){var v=f.currentTime,T=this.currentFrag;if(T&&Object(D.isFiniteNumber)(v)&&Object(D.isFiniteNumber)(T.programDateTime)){var m=T.programDateTime+(v-T.start)*1e3;return new Date(m)}}return null}},{key:"currentLevel",get:function(){var f=this.currentFrag;return f?f.level:-1}},{key:"nextBufferedFrag",get:function(){var f=this.currentFrag;return f?this.followingBufferedFrag(f):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),s}(c.default)},"./src/controller/subtitle-stream-controller.ts":function(n,i,r){r.r(i),r.d(i,"SubtitleStreamController",function(){return a});var D=r("./src/events.ts"),c=r("./src/utils/buffer-helper.ts"),p=r("./src/controller/fragment-finders.ts"),w=r("./src/utils/discontinuities.ts"),M=r("./src/controller/level-helper.ts"),O=r("./src/controller/fragment-tracker.ts"),C=r("./src/controller/base-stream-controller.ts"),S=r("./src/types/loader.ts"),b=r("./src/types/level.ts");function I(y,E){for(var u=0;u<E.length;u++){var s=E[u];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(y,s.key,s)}}function L(y,E,u){return E&&I(y.prototype,E),u&&I(y,u),Object.defineProperty(y,"prototype",{writable:!1}),y}function _(y,E){y.prototype=Object.create(E.prototype),y.prototype.constructor=y,x(y,E)}function x(y,E){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,o){return s.__proto__=o,s},x(y,E)}var l=500,a=function(y){_(E,y);function E(s,o){var g;return g=y.call(this,s,o,"[subtitle-stream-controller]")||this,g.levels=[],g.currentTrackId=-1,g.tracksBuffered=[],g.mainDetails=null,g._registerListeners(),g}var u=E.prototype;return u.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},u._registerListeners=function(){var o=this.hls;o.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.on(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.on(D.Events.ERROR,this.onError,this),o.on(D.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),o.on(D.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),o.on(D.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),o.on(D.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),o.on(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},u._unregisterListeners=function(){var o=this.hls;o.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.off(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.off(D.Events.ERROR,this.onError,this),o.off(D.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),o.off(D.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),o.off(D.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),o.off(D.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),o.off(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},u.startLoad=function(){this.stopLoad(),this.state=C.State.IDLE,this.setInterval(l),this.tick()},u.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},u.onLevelLoaded=function(o,g){this.mainDetails=g.details},u.onSubtitleFragProcessed=function(o,g){var f=g.frag,v=g.success;if(this.fragPrevious=f,this.state=C.State.IDLE,!!v){var T=this.tracksBuffered[this.currentTrackId];if(!!T){for(var m,h=f.start,A=0;A<T.length;A++)if(h>=T[A].start&&h<=T[A].end){m=T[A];break}var R=f.start+f.duration;m?m.end=R:(m={start:h,end:R},T.push(m)),this.fragmentTracker.fragBuffered(f)}}},u.onBufferFlushing=function(o,g){var f=g.startOffset,v=g.endOffset;if(f===0&&v!==Number.POSITIVE_INFINITY){var T=this.currentTrackId,m=this.levels;if(!m.length||!m[T]||!m[T].details)return;var h=m[T].details,A=h.targetduration,R=v-A;if(R<=0)return;g.endOffsetSubtitles=Math.max(0,R),this.tracksBuffered.forEach(function(P){for(var k=0;k<P.length;){if(P[k].end<=R){P.shift();continue}else if(P[k].start<R)P[k].start=R;else break;k++}}),this.fragmentTracker.removeFragmentsInRange(f,R,S.PlaylistLevelType.SUBTITLE)}},u.onError=function(o,g){var f,v=g.frag;!v||v.type!==S.PlaylistLevelType.SUBTITLE||((f=this.fragCurrent)!==null&&f!==void 0&&f.loader&&this.fragCurrent.loader.abort(),this.state=C.State.IDLE)},u.onSubtitleTracksUpdated=function(o,g){var f=this,v=g.subtitleTracks;this.tracksBuffered=[],this.levels=v.map(function(T){return new b.Level(T)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(T){f.tracksBuffered[T.id]=[]}),this.mediaBuffer=null},u.onSubtitleTrackSwitch=function(o,g){if(this.currentTrackId=g.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var f=this.levels[this.currentTrackId];f!=null&&f.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,f&&this.setInterval(l)},u.onSubtitleTrackLoaded=function(o,g){var f,v=g.details,T=g.id,m=this.currentTrackId,h=this.levels;if(!!h.length){var A=h[m];if(!(T>=h.length||T!==m||!A)){if(this.mediaBuffer=this.mediaBufferTimeRanges,v.live||(f=A.details)!==null&&f!==void 0&&f.live){var R=this.mainDetails;if(v.deltaUpdateFailed||!R)return;var P=R.fragments[0];if(!A.details)v.hasProgramDateTime&&R.hasProgramDateTime?Object(w.alignMediaPlaylistByPDT)(v,R):P&&Object(M.addSliding)(v,P.start);else{var k=this.alignPlaylists(v,A.details);k===0&&P&&Object(M.addSliding)(v,P.start)}}if(A.details=v,this.levelLastLoaded=T,this.tick(),v.live&&!this.fragCurrent&&this.media&&this.state===C.State.IDLE){var j=Object(p.findFragmentByPTS)(null,v.fragments,this.media.currentTime,0);j||(this.warn("Subtitle playlist not aligned with playback"),A.details=void 0)}}}},u._handleFragmentLoadComplete=function(o){var g=o.frag,f=o.payload,v=g.decryptdata,T=this.hls;if(!this.fragContextChanged(g)&&f&&f.byteLength>0&&v&&v.key&&v.iv&&v.method==="AES-128"){var m=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(f),v.key.buffer,v.iv.buffer).then(function(h){var A=performance.now();T.trigger(D.Events.FRAG_DECRYPTED,{frag:g,payload:h,stats:{tstart:m,tdecrypt:A}})})}},u.doTick=function(){if(!this.media){this.state=C.State.IDLE;return}if(this.state===C.State.IDLE){var o=this.currentTrackId,g=this.levels;if(!g.length||!g[o]||!g[o].details)return;var f=g[o].details,v=f.targetduration,T=this.config,m=this.media,h=c.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],m.currentTime-v,T.maxBufferHole),A=h.end,R=h.len,P=this.getMaxBufferLength()+v;if(R>P)return;console.assert(f,"Subtitle track details are defined on idle subtitle stream controller tick");var k=f.fragments,j=k.length,K=f.edge,W,H=this.fragPrevious;if(A<K){var $=T.maxFragLookUpTolerance;W=Object(p.findFragmentByPTS)(H,k,Math.max(k[0].start,A),$),!W&&H&&H.start<k[0].start&&(W=k[0])}else W=k[j-1];if(W=this.mapToInitFragWhenRequired(W),!W||this.fragmentTracker.getState(W)!==O.FragmentState.NOT_LOADED)return;W.encrypted?this.loadKey(W,f):this.loadFragment(W,f,A)}},u.loadFragment=function(o,g,f){this.fragCurrent=o,o.sn==="initSegment"?this._loadInitSegment(o):y.prototype.loadFragment.call(this,o,g,f)},L(E,[{key:"mediaBufferTimeRanges",get:function(){return new d(this.tracksBuffered[this.currentTrackId]||[])}}]),E}(C.default),d=function(E){this.buffered=void 0;var u=function(o,g,f){if(g=g>>>0,g>f-1)throw new DOMException("Failed to execute '"+o+"' on 'TimeRanges': The index provided ("+g+") is greater than the maximum bound ("+f+")");return E[g][o]};this.buffered={get length(){return E.length},end:function(o){return u("end",o,E.length)},start:function(o){return u("start",o,E.length)}}}},"./src/controller/subtitle-track-controller.ts":function(n,i,r){r.r(i);var D=r("./src/events.ts"),c=r("./src/utils/texttrack-utils.ts"),p=r("./src/controller/base-playlist-controller.ts"),w=r("./src/types/loader.ts");function M(L,_){for(var x=0;x<_.length;x++){var l=_[x];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(L,l.key,l)}}function O(L,_,x){return _&&M(L.prototype,_),x&&M(L,x),Object.defineProperty(L,"prototype",{writable:!1}),L}function C(L,_){L.prototype=Object.create(_.prototype),L.prototype.constructor=L,S(L,_)}function S(L,_){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,a){return l.__proto__=a,l},S(L,_)}var b=function(L){C(_,L);function _(l){var a;return a=L.call(this,l,"[subtitle-track-controller]")||this,a.media=null,a.tracks=[],a.groupId=null,a.tracksInGroup=[],a.trackId=-1,a.selectDefaultTrack=!0,a.queuedDefaultTrack=-1,a.trackChangeListener=function(){return a.onTextTracksChanged()},a.asyncPollTrackChange=function(){return a.pollTrackChange(0)},a.useTextTrackPolling=!1,a.subtitlePollingInterval=-1,a._subtitleDisplay=!0,a.registerListeners(),a}var x=_.prototype;return x.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,L.prototype.destroy.call(this)},x.registerListeners=function(){var a=this.hls;a.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(D.Events.LEVEL_LOADING,this.onLevelLoading,this),a.on(D.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.on(D.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.on(D.Events.ERROR,this.onError,this)},x.unregisterListeners=function(){var a=this.hls;a.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(D.Events.LEVEL_LOADING,this.onLevelLoading,this),a.off(D.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.off(D.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.off(D.Events.ERROR,this.onError,this)},x.onMediaAttached=function(a,d){this.media=d.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},x.pollTrackChange=function(a){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,a)},x.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var a=I(this.media.textTracks);a.forEach(function(d){Object(c.clearCurrentCues)(d)}),this.subtitleTrack=-1,this.media=null}},x.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},x.onManifestParsed=function(a,d){this.tracks=d.subtitleTracks},x.onSubtitleTrackLoaded=function(a,d){var y=d.id,E=d.details,u=this.trackId,s=this.tracksInGroup[u];if(!s){this.warn("Invalid subtitle track id "+y);return}var o=s.details;s.details=d.details,this.log("subtitle track "+y+" loaded ["+E.startSN+"-"+E.endSN+"]"),y===this.trackId&&(this.retryCount=0,this.playlistLoaded(y,d,o))},x.onLevelLoading=function(a,d){this.switchLevel(d.level)},x.onLevelSwitching=function(a,d){this.switchLevel(d.level)},x.switchLevel=function(a){var d=this.hls.levels[a];if(!!(d!=null&&d.textGroupIds)){var y=d.textGroupIds[d.urlId];if(this.groupId!==y){var E=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,u=this.tracks.filter(function(g){return!y||g.groupId===y});this.tracksInGroup=u;var s=this.findTrackId(E==null?void 0:E.name)||this.findTrackId();this.groupId=y;var o={subtitleTracks:u};this.log("Updating subtitle tracks, "+u.length+' track(s) found in "'+y+'" group-id'),this.hls.trigger(D.Events.SUBTITLE_TRACKS_UPDATED,o),s!==-1&&this.setSubtitleTrack(s,E)}}},x.findTrackId=function(a){for(var d=this.tracksInGroup,y=0;y<d.length;y++){var E=d[y];if((!this.selectDefaultTrack||E.default)&&(!a||a===E.name))return E.id}return-1},x.onError=function(a,d){L.prototype.onError.call(this,a,d),!(d.fatal||!d.context)&&d.context.type===w.PlaylistContextType.SUBTITLE_TRACK&&d.context.id===this.trackId&&d.context.groupId===this.groupId&&this.retryLoadingOrFail(d)},x.loadPlaylist=function(a){var d=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(d)){var y=d.id,E=d.groupId,u=d.url;if(a)try{u=a.addDirectives(u)}catch(s){this.warn("Could not construct new URL with HLS Delivery Directives: "+s)}this.log("Loading subtitle playlist for id "+y),this.hls.trigger(D.Events.SUBTITLE_TRACK_LOADING,{url:u,id:y,groupId:E,deliveryDirectives:a||null})}},x.toggleTrackModes=function(a){var d=this,y=this.media,E=this.trackId;if(!!y){var u=I(y.textTracks),s=u.filter(function(f){return f.groupId===d.groupId});if(a===-1)[].slice.call(u).forEach(function(f){f.mode="disabled"});else{var o=s[E];o&&(o.mode="disabled")}var g=s[a];g&&(g.mode=this.subtitleDisplay?"showing":"hidden")}},x.setSubtitleTrack=function(a,d){var y,E=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=a;return}if(this.trackId!==a&&this.toggleTrackModes(a),!(this.trackId===a&&(a===-1||(y=E[a])!==null&&y!==void 0&&y.details)||a<-1||a>=E.length)){this.clearTimer();var u=E[a];if(this.log("Switching to subtitle track "+a),this.trackId=a,u){var s=u.id,o=u.groupId,g=o===void 0?"":o,f=u.name,v=u.type,T=u.url;this.hls.trigger(D.Events.SUBTITLE_TRACK_SWITCH,{id:s,groupId:g,name:f,type:v,url:T});var m=this.switchParams(u.url,d==null?void 0:d.details);this.loadPlaylist(m)}else this.hls.trigger(D.Events.SUBTITLE_TRACK_SWITCH,{id:a})}},x.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var a=-1,d=I(this.media.textTracks),y=0;y<d.length;y++)if(d[y].mode==="hidden")a=y;else if(d[y].mode==="showing"){a=y;break}this.subtitleTrack!==a&&(this.subtitleTrack=a)}},O(_,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(a){this._subtitleDisplay=a,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(a){this.selectDefaultTrack=!1;var d=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(a,d)}}]),_}(p.default);function I(L){for(var _=[],x=0;x<L.length;x++){var l=L[x];l.kind==="subtitles"&&l.label&&_.push(L[x])}return _}i.default=b},"./src/controller/timeline-controller.ts":function(n,i,r){r.r(i),r.d(i,"TimelineController",function(){return L});var D=r("./src/polyfills/number.ts"),c=r("./src/events.ts"),p=r("./src/utils/cea-608-parser.ts"),w=r("./src/utils/output-filter.ts"),M=r("./src/utils/webvtt-parser.ts"),O=r("./src/utils/texttrack-utils.ts"),C=r("./src/utils/imsc1-ttml-parser.ts"),S=r("./src/utils/mp4-tools.ts"),b=r("./src/types/loader.ts"),I=r("./src/utils/logger.ts"),L=function(){function a(y){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=l(),this.captionsProperties=void 0,this.hls=y,this.config=y.config,this.Cues=y.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var E=new w.default(this,"textTrack1"),u=new w.default(this,"textTrack2"),s=new w.default(this,"textTrack3"),o=new w.default(this,"textTrack4");this.cea608Parser1=new p.default(1,E,u),this.cea608Parser2=new p.default(3,s,o)}y.on(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),y.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),y.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),y.on(c.Events.MANIFEST_LOADED,this.onManifestLoaded,this),y.on(c.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),y.on(c.Events.FRAG_LOADING,this.onFragLoading,this),y.on(c.Events.FRAG_LOADED,this.onFragLoaded,this),y.on(c.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),y.on(c.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),y.on(c.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),y.on(c.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),y.on(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var d=a.prototype;return d.destroy=function(){var E=this.hls;E.off(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),E.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),E.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),E.off(c.Events.MANIFEST_LOADED,this.onManifestLoaded,this),E.off(c.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),E.off(c.Events.FRAG_LOADING,this.onFragLoading,this),E.off(c.Events.FRAG_LOADED,this.onFragLoaded,this),E.off(c.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),E.off(c.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),E.off(c.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),E.off(c.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),E.off(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},d.addCues=function(E,u,s,o,g){for(var f=!1,v=g.length;v--;){var T=g[v],m=x(T[0],T[1],u,s);if(m>=0&&(T[0]=Math.min(T[0],u),T[1]=Math.max(T[1],s),f=!0,m/(s-u)>.5))return}if(f||g.push([u,s]),this.config.renderTextTracksNatively){var h=this.captionsTracks[E];this.Cues.newCue(h,u,s,o)}else{var A=this.Cues.newCue(null,u,s,o);this.hls.trigger(c.Events.CUES_PARSED,{type:"captions",cues:A,track:E})}},d.onInitPtsFound=function(E,u){var s=this,o=u.frag,g=u.id,f=u.initPTS,v=u.timescale,T=this.unparsedVttFrags;g==="main"&&(this.initPTS[o.cc]=f,this.timescale[o.cc]=v),T.length&&(this.unparsedVttFrags=[],T.forEach(function(m){s.onFragLoaded(c.Events.FRAG_LOADED,m)}))},d.getExistingTrack=function(E){var u=this.media;if(u)for(var s=0;s<u.textTracks.length;s++){var o=u.textTracks[s];if(o[E])return o}return null},d.createCaptionsTrack=function(E){this.config.renderTextTracksNatively?this.createNativeTrack(E):this.createNonNativeTrack(E)},d.createNativeTrack=function(E){if(!this.captionsTracks[E]){var u=this.captionsProperties,s=this.captionsTracks,o=this.media,g=u[E],f=g.label,v=g.languageCode,T=this.getExistingTrack(E);if(T)s[E]=T,Object(O.clearCurrentCues)(s[E]),Object(O.sendAddTrackEvent)(s[E],o);else{var m=this.createTextTrack("captions",f,v);m&&(m[E]=!0,s[E]=m)}}},d.createNonNativeTrack=function(E){if(!this.nonNativeCaptionsTracks[E]){var u=this.captionsProperties[E];if(!!u){var s=u.label,o={_id:E,label:s,kind:"captions",default:u.media?!!u.media.default:!1,closedCaptions:u.media};this.nonNativeCaptionsTracks[E]=o,this.hls.trigger(c.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[o]})}}},d.createTextTrack=function(E,u,s){var o=this.media;if(!!o)return o.addTextTrack(E,u,s)},d.onMediaAttaching=function(E,u){this.media=u.media,this._cleanTracks()},d.onMediaDetaching=function(){var E=this.captionsTracks;Object.keys(E).forEach(function(u){Object(O.clearCurrentCues)(E[u]),delete E[u]}),this.nonNativeCaptionsTracks={}},d.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=l(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},d._cleanTracks=function(){var E=this.media;if(!!E){var u=E.textTracks;if(u)for(var s=0;s<u.length;s++)Object(O.clearCurrentCues)(u[s])}},d.onSubtitleTracksUpdated=function(E,u){var s=this;this.textTracks=[];var o=u.subtitleTracks||[],g=o.some(function(m){return m.textCodec===C.IMSC1_CODEC});if(this.config.enableWebVTT||g&&this.config.enableIMSC1){var f=this.tracks&&o&&this.tracks.length===o.length;if(this.tracks=o||[],this.config.renderTextTracksNatively){var v=this.media?this.media.textTracks:[];this.tracks.forEach(function(m,h){var A;if(h<v.length){for(var R=null,P=0;P<v.length;P++)if(_(v[P],m)){R=v[P];break}R&&(A=R)}if(A)Object(O.clearCurrentCues)(A);else{var k=s._captionsOrSubtitlesFromCharacteristics(m);A=s.createTextTrack(k,m.name,m.lang),A&&(A.mode="disabled")}A&&(A.groupId=m.groupId,s.textTracks.push(A))})}else if(!f&&this.tracks&&this.tracks.length){var T=this.tracks.map(function(m){return{label:m.name,kind:m.type.toLowerCase(),default:m.default,subtitleTrack:m}});this.hls.trigger(c.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:T})}}},d._captionsOrSubtitlesFromCharacteristics=function(E){var u;if((u=E.attrs)!==null&&u!==void 0&&u.CHARACTERISTICS){var s=/transcribes-spoken-dialog/gi.test(E.attrs.CHARACTERISTICS),o=/describes-music-and-sound/gi.test(E.attrs.CHARACTERISTICS);if(s&&o)return"captions"}return"subtitles"},d.onManifestLoaded=function(E,u){var s=this;this.config.enableCEA708Captions&&u.captions&&u.captions.forEach(function(o){var g=/(?:CC|SERVICE)([1-4])/.exec(o.instreamId);if(!!g){var f="textTrack"+g[1],v=s.captionsProperties[f];!v||(v.label=o.name,o.lang&&(v.languageCode=o.lang),v.media=o)}})},d.onFragLoading=function(E,u){var s=this.cea608Parser1,o=this.cea608Parser2,g=this.lastSn,f=this.lastPartIndex;if(!(!this.enabled||!(s&&o))&&u.frag.type===b.PlaylistLevelType.MAIN){var v,T,m=u.frag.sn,h=(v=u==null||(T=u.part)===null||T===void 0?void 0:T.index)!=null?v:-1;m===g+1||m===g&&h===f+1||(s.reset(),o.reset()),this.lastSn=m,this.lastPartIndex=h}},d.onFragLoaded=function(E,u){var s=u.frag,o=u.payload,g=this.initPTS,f=this.unparsedVttFrags;if(s.type===b.PlaylistLevelType.SUBTITLE)if(o.byteLength){if(!Object(D.isFiniteNumber)(g[s.cc])){f.push(u),g.length&&this.hls.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Missing initial subtitle PTS")});return}var v=s.decryptdata,T="stats"in u;if(v==null||v.key==null||v.method!=="AES-128"||T){var m=this.tracks[s.level],h=this.vttCCs;h[s.cc]||(h[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),m&&m.textCodec===C.IMSC1_CODEC?this._parseIMSC1(s,o):this._parseVTTs(s,o,h)}}else this.hls.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})},d._parseIMSC1=function(E,u){var s=this,o=this.hls;Object(C.parseIMSC1)(u,this.initPTS[E.cc],this.timescale[E.cc],function(g){s._appendCues(g,E.level),o.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:E})},function(g){I.logger.log("Failed to parse IMSC1: "+g),o.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:E,error:g})})},d._parseVTTs=function(E,u,s){var o,g=this,f=this.hls,v=(o=E.initSegment)!==null&&o!==void 0&&o.data?Object(S.appendUint8Array)(E.initSegment.data,new Uint8Array(u)):u;Object(M.parseWebVTT)(v,this.initPTS[E.cc],this.timescale[E.cc],s,E.cc,E.start,function(T){g._appendCues(T,E.level),f.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:E})},function(T){g._fallbackToIMSC1(E,u),I.logger.log("Failed to parse VTT cue: "+T),f.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:E,error:T})})},d._fallbackToIMSC1=function(E,u){var s=this,o=this.tracks[E.level];o.textCodec||Object(C.parseIMSC1)(u,this.initPTS[E.cc],this.timescale[E.cc],function(){o.textCodec=C.IMSC1_CODEC,s._parseIMSC1(E,u)},function(){o.textCodec="wvtt"})},d._appendCues=function(E,u){var s=this.hls;if(this.config.renderTextTracksNatively){var o=this.textTracks[u];if(!o||o.mode==="disabled")return;E.forEach(function(v){return Object(O.addCueToTrack)(o,v)})}else{var g=this.tracks[u];if(!g)return;var f=g.default?"default":"subtitles"+u;s.trigger(c.Events.CUES_PARSED,{type:"subtitles",cues:E,track:f})}},d.onFragDecrypted=function(E,u){var s=u.frag;if(s.type===b.PlaylistLevelType.SUBTITLE){if(!Object(D.isFiniteNumber)(this.initPTS[s.cc])){this.unparsedVttFrags.push(u);return}this.onFragLoaded(c.Events.FRAG_LOADED,u)}},d.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},d.onFragParsingUserdata=function(E,u){var s=this.cea608Parser1,o=this.cea608Parser2;if(!(!this.enabled||!(s&&o)))for(var g=0;g<u.samples.length;g++){var f=u.samples[g].bytes;if(f){var v=this.extractCea608Data(f);s.addData(u.samples[g].pts,v[0]),o.addData(u.samples[g].pts,v[1])}}},d.onBufferFlushing=function(E,u){var s=u.startOffset,o=u.endOffset,g=u.endOffsetSubtitles,f=u.type,v=this.media;if(!(!v||v.currentTime<o)){if(!f||f==="video"){var T=this.captionsTracks;Object.keys(T).forEach(function(h){return Object(O.removeCuesInRange)(T[h],s,o)})}if(this.config.renderTextTracksNatively&&s===0&&g!==void 0){var m=this.textTracks;Object.keys(m).forEach(function(h){return Object(O.removeCuesInRange)(m[h],s,g)})}}},d.extractCea608Data=function(E){for(var u=[[],[]],s=E[0]&31,o=2,g=0;g<s;g++){var f=E[o++],v=127&E[o++],T=127&E[o++];if(!(v===0&&T===0)){var m=(4&f)!==0;if(m){var h=3&f;(h===0||h===1)&&(u[h].push(v),u[h].push(T))}}}return u},a}();function _(a,d){return a&&a.label===d.name&&!(a.textTrack1||a.textTrack2)}function x(a,d,y,E){return Math.min(d,E)-Math.max(a,y)}function l(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}},"./src/crypt/aes-crypto.ts":function(n,i,r){r.r(i),r.d(i,"default",function(){return D});var D=function(){function c(w,M){this.subtle=void 0,this.aesIV=void 0,this.subtle=w,this.aesIV=M}var p=c.prototype;return p.decrypt=function(M,O){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},O,M)},c}()},"./src/crypt/aes-decryptor.ts":function(n,i,r){r.r(i),r.d(i,"removePadding",function(){return c}),r.d(i,"default",function(){return p});var D=r("./src/utils/typed-array.ts");function c(w){var M=w.byteLength,O=M&&new DataView(w.buffer).getUint8(M-1);return O?Object(D.sliceUint8)(w,0,M-O):w}var p=function(){function w(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var M=w.prototype;return M.uint8ArrayToUint32Array_=function(C){for(var S=new DataView(C),b=new Uint32Array(4),I=0;I<4;I++)b[I]=S.getUint32(I*4);return b},M.initTable=function(){var C=this.sBox,S=this.invSBox,b=this.subMix,I=b[0],L=b[1],_=b[2],x=b[3],l=this.invSubMix,a=l[0],d=l[1],y=l[2],E=l[3],u=new Uint32Array(256),s=0,o=0,g=0;for(g=0;g<256;g++)g<128?u[g]=g<<1:u[g]=g<<1^283;for(g=0;g<256;g++){var f=o^o<<1^o<<2^o<<3^o<<4;f=f>>>8^f&255^99,C[s]=f,S[f]=s;var v=u[s],T=u[v],m=u[T],h=u[f]*257^f*16843008;I[s]=h<<24|h>>>8,L[s]=h<<16|h>>>16,_[s]=h<<8|h>>>24,x[s]=h,h=m*16843009^T*65537^v*257^s*16843008,a[f]=h<<24|h>>>8,d[f]=h<<16|h>>>16,y[f]=h<<8|h>>>24,E[f]=h,s?(s=v^u[u[u[m^v]]],o^=u[u[o]]):s=o=1}},M.expandKey=function(C){for(var S=this.uint8ArrayToUint32Array_(C),b=!0,I=0;I<S.length&&b;)b=S[I]===this.key[I],I++;if(!b){this.key=S;var L=this.keySize=S.length;if(L!==4&&L!==6&&L!==8)throw new Error("Invalid aes key size="+L);var _=this.ksRows=(L+6+1)*4,x,l,a=this.keySchedule=new Uint32Array(_),d=this.invKeySchedule=new Uint32Array(_),y=this.sBox,E=this.rcon,u=this.invSubMix,s=u[0],o=u[1],g=u[2],f=u[3],v,T;for(x=0;x<_;x++){if(x<L){v=a[x]=S[x];continue}T=v,x%L===0?(T=T<<8|T>>>24,T=y[T>>>24]<<24|y[T>>>16&255]<<16|y[T>>>8&255]<<8|y[T&255],T^=E[x/L|0]<<24):L>6&&x%L===4&&(T=y[T>>>24]<<24|y[T>>>16&255]<<16|y[T>>>8&255]<<8|y[T&255]),a[x]=v=(a[x-L]^T)>>>0}for(l=0;l<_;l++)x=_-l,l&3?T=a[x]:T=a[x-4],l<4||x<=4?d[l]=T:d[l]=s[y[T>>>24]]^o[y[T>>>16&255]]^g[y[T>>>8&255]]^f[y[T&255]],d[l]=d[l]>>>0}},M.networkToHostOrderSwap=function(C){return C<<24|(C&65280)<<8|(C&16711680)>>8|C>>>24},M.decrypt=function(C,S,b){for(var I=this.keySize+6,L=this.invKeySchedule,_=this.invSBox,x=this.invSubMix,l=x[0],a=x[1],d=x[2],y=x[3],E=this.uint8ArrayToUint32Array_(b),u=E[0],s=E[1],o=E[2],g=E[3],f=new Int32Array(C),v=new Int32Array(f.length),T,m,h,A,R,P,k,j,K,W,H,$,z,J,ee=this.networkToHostOrderSwap;S<f.length;){for(K=ee(f[S]),W=ee(f[S+1]),H=ee(f[S+2]),$=ee(f[S+3]),R=K^L[0],P=$^L[1],k=H^L[2],j=W^L[3],z=4,J=1;J<I;J++)T=l[R>>>24]^a[P>>16&255]^d[k>>8&255]^y[j&255]^L[z],m=l[P>>>24]^a[k>>16&255]^d[j>>8&255]^y[R&255]^L[z+1],h=l[k>>>24]^a[j>>16&255]^d[R>>8&255]^y[P&255]^L[z+2],A=l[j>>>24]^a[R>>16&255]^d[P>>8&255]^y[k&255]^L[z+3],R=T,P=m,k=h,j=A,z=z+4;T=_[R>>>24]<<24^_[P>>16&255]<<16^_[k>>8&255]<<8^_[j&255]^L[z],m=_[P>>>24]<<24^_[k>>16&255]<<16^_[j>>8&255]<<8^_[R&255]^L[z+1],h=_[k>>>24]<<24^_[j>>16&255]<<16^_[R>>8&255]<<8^_[P&255]^L[z+2],A=_[j>>>24]<<24^_[R>>16&255]<<16^_[P>>8&255]<<8^_[k&255]^L[z+3],v[S]=ee(T^u),v[S+1]=ee(A^s),v[S+2]=ee(h^o),v[S+3]=ee(m^g),u=K,s=W,o=H,g=$,S=S+4}return v.buffer},w}()},"./src/crypt/decrypter.ts":function(n,i,r){r.r(i),r.d(i,"default",function(){return S});var D=r("./src/crypt/aes-crypto.ts"),c=r("./src/crypt/fast-aes-key.ts"),p=r("./src/crypt/aes-decryptor.ts"),w=r("./src/utils/logger.ts"),M=r("./src/utils/mp4-tools.ts"),O=r("./src/utils/typed-array.ts"),C=16,S=function(){function b(L,_,x){var l=x===void 0?{}:x,a=l.removePKCS7Padding,d=a===void 0?!0:a;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=L,this.config=_,this.removePKCS7Padding=d,d)try{var y=self.crypto;y&&(this.subtle=y.subtle||y.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var I=b.prototype;return I.destroy=function(){this.observer=null},I.isSync=function(){return this.config.enableSoftwareAES},I.flush=function(){var _=this.currentResult;if(!_){this.reset();return}var x=new Uint8Array(_);return this.reset(),this.removePKCS7Padding?Object(p.removePadding)(x):x},I.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},I.decrypt=function(_,x,l,a){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(_),x,l);var d=this.flush();d&&a(d.buffer)}else this.webCryptoDecrypt(new Uint8Array(_),x,l).then(a)},I.softwareDecrypt=function(_,x,l){var a=this.currentIV,d=this.currentResult,y=this.remainderData;this.logOnce("JS AES decrypt"),y&&(_=Object(M.appendUint8Array)(y,_),this.remainderData=null);var E=this.getValidChunk(_);if(!E.length)return null;a&&(l=a);var u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new p.default),u.expandKey(x);var s=d;return this.currentResult=u.decrypt(E.buffer,0,l),this.currentIV=Object(O.sliceUint8)(E,-16).buffer,s||null},I.webCryptoDecrypt=function(_,x,l){var a=this,d=this.subtle;return(this.key!==x||!this.fastAesKey)&&(this.key=x,this.fastAesKey=new c.default(d,x)),this.fastAesKey.expandKey().then(function(y){if(!d)return Promise.reject(new Error("web crypto not initialized"));var E=new D.default(d,l);return E.decrypt(_.buffer,y)}).catch(function(y){return a.onWebCryptoError(y,_,x,l)})},I.onWebCryptoError=function(_,x,l,a){return w.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",_),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(x,l,a)},I.getValidChunk=function(_){var x=_,l=_.length-_.length%C;return l!==_.length&&(x=Object(O.sliceUint8)(_,0,l),this.remainderData=Object(O.sliceUint8)(_,l)),x},I.logOnce=function(_){!this.logEnabled||(w.logger.log("[decrypter.ts]: "+_),this.logEnabled=!1)},b}()},"./src/crypt/fast-aes-key.ts":function(n,i,r){r.r(i),r.d(i,"default",function(){return D});var D=function(){function c(w,M){this.subtle=void 0,this.key=void 0,this.subtle=w,this.key=M}var p=c.prototype;return p.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},c}()},"./src/demux/aacdemuxer.ts":function(n,i,r){r.r(i);var D=r("./src/demux/base-audio-demuxer.ts"),c=r("./src/demux/adts.ts"),p=r("./src/utils/logger.ts"),w=r("./src/demux/id3.ts");function M(S,b){S.prototype=Object.create(b.prototype),S.prototype.constructor=S,O(S,b)}function O(S,b){return O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(L,_){return L.__proto__=_,L},O(S,b)}var C=function(S){M(b,S);function b(L,_){var x;return x=S.call(this)||this,x.observer=void 0,x.config=void 0,x.observer=L,x.config=_,x}var I=b.prototype;return I.resetInitSegment=function(_,x,l,a){S.prototype.resetInitSegment.call(this,_,x,l,a),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:x,duration:a,inputTimeScale:9e4,dropped:0}},b.probe=function(_){if(!_)return!1;for(var x=w.getID3Data(_,0)||[],l=x.length,a=_.length;l<a;l++)if(c.probe(_,l))return p.logger.log("ADTS sync word found !"),!0;return!1},I.canParse=function(_,x){return c.canParse(_,x)},I.appendFrame=function(_,x,l){c.initTrackConfig(_,this.observer,x,l,_.manifestCodec);var a=c.appendFrame(_,x,l,this.basePTS,this.frameIndex);if(a&&a.missing===0)return a},b}(D.default);i.default=C},"./src/demux/adts.ts":function(n,i,r){r.r(i),r.d(i,"getAudioConfig",function(){return w}),r.d(i,"isHeaderPattern",function(){return M}),r.d(i,"getHeaderLength",function(){return O}),r.d(i,"getFullFrameLength",function(){return C}),r.d(i,"canGetFrameLength",function(){return S}),r.d(i,"isHeader",function(){return b}),r.d(i,"canParse",function(){return I}),r.d(i,"probe",function(){return L}),r.d(i,"initTrackConfig",function(){return _}),r.d(i,"getFrameDuration",function(){return x}),r.d(i,"parseFrameHeader",function(){return l}),r.d(i,"appendFrame",function(){return a});var D=r("./src/utils/logger.ts"),c=r("./src/errors.ts"),p=r("./src/events.ts");function w(d,y,E,u){var s,o,g,f,v=navigator.userAgent.toLowerCase(),T=u,m=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];s=((y[E+2]&192)>>>6)+1;var h=(y[E+2]&60)>>>2;if(h>m.length-1){d.trigger(p.Events.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+h});return}return g=(y[E+2]&1)<<2,g|=(y[E+3]&192)>>>6,D.logger.log("manifest codec:"+u+", ADTS type:"+s+", samplingIndex:"+h),/firefox/i.test(v)?h>=6?(s=5,f=new Array(4),o=h-3):(s=2,f=new Array(2),o=h):v.indexOf("android")!==-1?(s=2,f=new Array(2),o=h):(s=5,f=new Array(4),u&&(u.indexOf("mp4a.40.29")!==-1||u.indexOf("mp4a.40.5")!==-1)||!u&&h>=6?o=h-3:((u&&u.indexOf("mp4a.40.2")!==-1&&(h>=6&&g===1||/vivaldi/i.test(v))||!u&&g===1)&&(s=2,f=new Array(2)),o=h)),f[0]=s<<3,f[0]|=(h&14)>>1,f[1]|=(h&1)<<7,f[1]|=g<<3,s===5&&(f[1]|=(o&14)>>1,f[2]=(o&1)<<7,f[2]|=2<<2,f[3]=0),{config:f,samplerate:m[h],channelCount:g,codec:"mp4a.40."+s,manifestCodec:T}}function M(d,y){return d[y]===255&&(d[y+1]&246)===240}function O(d,y){return d[y+1]&1?7:9}function C(d,y){return(d[y+3]&3)<<11|d[y+4]<<3|(d[y+5]&224)>>>5}function S(d,y){return y+5<d.length}function b(d,y){return y+1<d.length&&M(d,y)}function I(d,y){return S(d,y)&&M(d,y)&&C(d,y)<=d.length-y}function L(d,y){if(b(d,y)){var E=O(d,y);if(y+E>=d.length)return!1;var u=C(d,y);if(u<=E)return!1;var s=y+u;return s===d.length||b(d,s)}return!1}function _(d,y,E,u,s){if(!d.samplerate){var o=w(y,E,u,s);if(!o)return;d.config=o.config,d.samplerate=o.samplerate,d.channelCount=o.channelCount,d.codec=o.codec,d.manifestCodec=o.manifestCodec,D.logger.log("parsed codec:"+d.codec+", rate:"+o.samplerate+", channels:"+o.channelCount)}}function x(d){return 1024*9e4/d}function l(d,y){var E=O(d,y);if(y+E<=d.length){var u=C(d,y)-E;if(u>0)return{headerLength:E,frameLength:u}}}function a(d,y,E,u,s){var o=x(d.samplerate),g=u+s*o,f=l(y,E),v;if(f){var T=f.frameLength,m=f.headerLength,h=m+T,A=Math.max(0,E+h-y.length);A?(v=new Uint8Array(h-m),v.set(y.subarray(E+m,y.length),0)):v=y.subarray(E+m,E+h);var R={unit:v,pts:g};return A||d.samples.push(R),{sample:R,length:h,missing:A}}var P=y.length-E;v=new Uint8Array(P),v.set(y.subarray(E,y.length),0);var k={unit:v,pts:g};return{sample:k,length:P,missing:-1}}},"./src/demux/base-audio-demuxer.ts":function(n,i,r){r.r(i),r.d(i,"initPTSFn",function(){return S});var D=r("./src/polyfills/number.ts"),c=r("./src/demux/id3.ts"),p=r("./src/types/demuxer.ts"),w=r("./src/demux/dummy-demuxed-track.ts"),M=r("./src/utils/mp4-tools.ts"),O=r("./src/utils/typed-array.ts"),C=function(){function b(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null}var I=b.prototype;return I.resetInitSegment=function(_,x,l,a){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},I.resetTimeStamp=function(_){this.initPTS=_,this.resetContiguity()},I.resetContiguity=function(){this.basePTS=null,this.frameIndex=0},I.canParse=function(_,x){return!1},I.appendFrame=function(_,x,l){},I.demux=function(_,x){this.cachedData&&(_=Object(M.appendUint8Array)(this.cachedData,_),this.cachedData=null);var l=c.getID3Data(_,0),a=l?l.length:0,d,y,E=this._audioTrack,u=this._id3Track,s=l?c.getTimeStamp(l):void 0,o=_.length;for((this.basePTS===null||this.frameIndex===0&&Object(D.isFiniteNumber)(s))&&(this.basePTS=S(s,x,this.initPTS)),l&&l.length>0&&u.samples.push({pts:this.basePTS,dts:this.basePTS,data:l,type:p.MetadataSchema.audioId3}),y=this.basePTS;a<o;){if(this.canParse(_,a)){var g=this.appendFrame(E,_,a);g?(this.frameIndex++,y=g.sample.pts,a+=g.length,d=a):a=o}else c.canParse(_,a)?(l=c.getID3Data(_,a),u.samples.push({pts:y,dts:y,data:l,type:p.MetadataSchema.audioId3}),a+=l.length,d=a):a++;if(a===o&&d!==o){var f=Object(O.sliceUint8)(_,d);this.cachedData?this.cachedData=Object(M.appendUint8Array)(this.cachedData,f):this.cachedData=f}}return{audioTrack:E,videoTrack:Object(w.dummyTrack)(),id3Track:u,textTrack:Object(w.dummyTrack)()}},I.demuxSampleAes=function(_,x,l){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},I.flush=function(_){var x=this.cachedData;return x&&(this.cachedData=null,this.demux(x,0)),{audioTrack:this._audioTrack,videoTrack:Object(w.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(w.dummyTrack)()}},I.destroy=function(){},b}(),S=function(I,L,_){return Object(D.isFiniteNumber)(I)?I*90:L*9e4+(_||0)};i.default=C},"./src/demux/chunk-cache.ts":function(n,i,r){r.r(i),r.d(i,"default",function(){return D});var D=function(){function p(){this.chunks=[],this.dataLength=0}var w=p.prototype;return w.push=function(O){this.chunks.push(O),this.dataLength+=O.length},w.flush=function(){var O=this.chunks,C=this.dataLength,S;if(O.length)O.length===1?S=O[0]:S=c(O,C);else return new Uint8Array(0);return this.reset(),S},w.reset=function(){this.chunks.length=0,this.dataLength=0},p}();function c(p,w){for(var M=new Uint8Array(w),O=0,C=0;C<p.length;C++){var S=p[C];M.set(S,O),O+=S.length}return M}},"./src/demux/dummy-demuxed-track.ts":function(n,i,r){r.r(i),r.d(i,"dummyTrack",function(){return D});function D(c,p){return c===void 0&&(c=""),p===void 0&&(p=9e4),{type:c,id:-1,pid:-1,inputTimeScale:p,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(n,i,r){r.r(i);var D=r("./src/utils/logger.ts"),c=function(){function p(M){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=M,this.bytesAvailable=M.byteLength,this.word=0,this.bitsAvailable=0}var w=p.prototype;return w.loadWord=function(){var O=this.data,C=this.bytesAvailable,S=O.byteLength-C,b=new Uint8Array(4),I=Math.min(4,C);if(I===0)throw new Error("no bytes available");b.set(O.subarray(S,S+I)),this.word=new DataView(b.buffer).getUint32(0),this.bitsAvailable=I*8,this.bytesAvailable-=I},w.skipBits=function(O){var C;this.bitsAvailable>O?(this.word<<=O,this.bitsAvailable-=O):(O-=this.bitsAvailable,C=O>>3,O-=C>>3,this.bytesAvailable-=C,this.loadWord(),this.word<<=O,this.bitsAvailable-=O)},w.readBits=function(O){var C=Math.min(this.bitsAvailable,O),S=this.word>>>32-C;return O>32&&D.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=C,this.bitsAvailable>0?this.word<<=C:this.bytesAvailable>0&&this.loadWord(),C=O-C,C>0&&this.bitsAvailable?S<<C|this.readBits(C):S},w.skipLZ=function(){var O;for(O=0;O<this.bitsAvailable;++O)if((this.word&2147483648>>>O)!==0)return this.word<<=O,this.bitsAvailable-=O,O;return this.loadWord(),O+this.skipLZ()},w.skipUEG=function(){this.skipBits(1+this.skipLZ())},w.skipEG=function(){this.skipBits(1+this.skipLZ())},w.readUEG=function(){var O=this.skipLZ();return this.readBits(O+1)-1},w.readEG=function(){var O=this.readUEG();return 1&O?1+O>>>1:-1*(O>>>1)},w.readBoolean=function(){return this.readBits(1)===1},w.readUByte=function(){return this.readBits(8)},w.readUShort=function(){return this.readBits(16)},w.readUInt=function(){return this.readBits(32)},w.skipScalingList=function(O){for(var C=8,S=8,b,I=0;I<O;I++)S!==0&&(b=this.readEG(),S=(C+b+256)%256),C=S===0?C:S},w.readSPS=function(){var O=0,C=0,S=0,b=0,I,L,_,x=this.readUByte.bind(this),l=this.readBits.bind(this),a=this.readUEG.bind(this),d=this.readBoolean.bind(this),y=this.skipBits.bind(this),E=this.skipEG.bind(this),u=this.skipUEG.bind(this),s=this.skipScalingList.bind(this);x();var o=x();if(l(5),y(3),x(),u(),o===100||o===110||o===122||o===244||o===44||o===83||o===86||o===118||o===128){var g=a();if(g===3&&y(1),u(),u(),y(1),d())for(L=g!==3?8:12,_=0;_<L;_++)d()&&(_<6?s(16):s(64))}u();var f=a();if(f===0)a();else if(f===1)for(y(1),E(),E(),I=a(),_=0;_<I;_++)E();u(),y(1);var v=a(),T=a(),m=l(1);m===0&&y(1),y(1),d()&&(O=a(),C=a(),S=a(),b=a());var h=[1,1];if(d()&&d()){var A=x();switch(A){case 1:h=[1,1];break;case 2:h=[12,11];break;case 3:h=[10,11];break;case 4:h=[16,11];break;case 5:h=[40,33];break;case 6:h=[24,11];break;case 7:h=[20,11];break;case 8:h=[32,11];break;case 9:h=[80,33];break;case 10:h=[18,11];break;case 11:h=[15,11];break;case 12:h=[64,33];break;case 13:h=[160,99];break;case 14:h=[4,3];break;case 15:h=[3,2];break;case 16:h=[2,1];break;case 255:{h=[x()<<8|x(),x()<<8|x()];break}}}return{width:Math.ceil((v+1)*16-O*2-C*2),height:(2-m)*(T+1)*16-(m?2:4)*(S+b),pixelRatio:h}},w.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},p}();i.default=c},"./src/demux/id3.ts":function(n,i,r){r.r(i),r.d(i,"isHeader",function(){return D}),r.d(i,"isFooter",function(){return c}),r.d(i,"getID3Data",function(){return p}),r.d(i,"canParse",function(){return M}),r.d(i,"getTimeStamp",function(){return O}),r.d(i,"isTimeStampFrame",function(){return C}),r.d(i,"getID3Frames",function(){return b}),r.d(i,"decodeFrame",function(){return I}),r.d(i,"utf8ArrayToStr",function(){return a}),r.d(i,"testables",function(){return d});var D=function(s,o){return o+10<=s.length&&s[o]===73&&s[o+1]===68&&s[o+2]===51&&s[o+3]<255&&s[o+4]<255&&s[o+6]<128&&s[o+7]<128&&s[o+8]<128&&s[o+9]<128},c=function(s,o){return o+10<=s.length&&s[o]===51&&s[o+1]===68&&s[o+2]===73&&s[o+3]<255&&s[o+4]<255&&s[o+6]<128&&s[o+7]<128&&s[o+8]<128&&s[o+9]<128},p=function(s,o){for(var g=o,f=0;D(s,o);){f+=10;var v=w(s,o+6);f+=v,c(s,o+10)&&(f+=10),o+=f}if(f>0)return s.subarray(g,g+f)},w=function(s,o){var g=0;return g=(s[o]&127)<<21,g|=(s[o+1]&127)<<14,g|=(s[o+2]&127)<<7,g|=s[o+3]&127,g},M=function(s,o){return D(s,o)&&w(s,o+6)+10<=s.length-o},O=function(s){for(var o=b(s),g=0;g<o.length;g++){var f=o[g];if(C(f))return l(f)}},C=function(s){return s&&s.key==="PRIV"&&s.info==="com.apple.streaming.transportStreamTimestamp"},S=function(s){var o=String.fromCharCode(s[0],s[1],s[2],s[3]),g=w(s,4),f=10;return{type:o,size:g,data:s.subarray(f,f+g)}},b=function(s){for(var o=0,g=[];D(s,o);){var f=w(s,o+6);o+=10;for(var v=o+f;o+8<v;){var T=S(s.subarray(o)),m=I(T);m&&g.push(m),o+=T.size+10}c(s,o)&&(o+=10)}return g},I=function(s){return s.type==="PRIV"?L(s):s.type[0]==="W"?x(s):_(s)},L=function(s){if(!(s.size<2)){var o=a(s.data,!0),g=new Uint8Array(s.data.subarray(o.length+1));return{key:s.type,info:o,data:g.buffer}}},_=function(s){if(!(s.size<2)){if(s.type==="TXXX"){var o=1,g=a(s.data.subarray(o),!0);o+=g.length+1;var f=a(s.data.subarray(o));return{key:s.type,info:g,data:f}}var v=a(s.data.subarray(1));return{key:s.type,data:v}}},x=function(s){if(s.type==="WXXX"){if(s.size<2)return;var o=1,g=a(s.data.subarray(o),!0);o+=g.length+1;var f=a(s.data.subarray(o));return{key:s.type,info:g,data:f}}var v=a(s.data);return{key:s.type,data:v}},l=function(s){if(s.data.byteLength===8){var o=new Uint8Array(s.data),g=o[3]&1,f=(o[4]<<23)+(o[5]<<15)+(o[6]<<7)+o[7];return f/=45,g&&(f+=4772185884e-2),Math.round(f)}},a=function(s,o){o===void 0&&(o=!1);var g=E();if(g){var f=g.decode(s);if(o){var v=f.indexOf("\0");return v!==-1?f.substring(0,v):f}return f.replace(/\0/g,"")}for(var T=s.length,m,h,A,R="",P=0;P<T;){if(m=s[P++],m===0&&o)return R;if(m===0||m===3)continue;switch(m>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:R+=String.fromCharCode(m);break;case 12:case 13:h=s[P++],R+=String.fromCharCode((m&31)<<6|h&63);break;case 14:h=s[P++],A=s[P++],R+=String.fromCharCode((m&15)<<12|(h&63)<<6|(A&63)<<0);break}}return R},d={decodeTextFrame:_},y;function E(){return!y&&typeof self.TextDecoder<"u"&&(y=new self.TextDecoder("utf-8")),y}},"./src/demux/mp3demuxer.ts":function(n,i,r){r.r(i);var D=r("./src/demux/base-audio-demuxer.ts"),c=r("./src/demux/id3.ts"),p=r("./src/utils/logger.ts"),w=r("./src/demux/mpegaudio.ts");function M(S,b){S.prototype=Object.create(b.prototype),S.prototype.constructor=S,O(S,b)}function O(S,b){return O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(L,_){return L.__proto__=_,L},O(S,b)}var C=function(S){M(b,S);function b(){return S.apply(this,arguments)||this}var I=b.prototype;return I.resetInitSegment=function(_,x,l,a){S.prototype.resetInitSegment.call(this,_,x,l,a),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:x,duration:a,inputTimeScale:9e4,dropped:0}},b.probe=function(_){if(!_)return!1;for(var x=c.getID3Data(_,0)||[],l=x.length,a=_.length;l<a;l++)if(w.probe(_,l))return p.logger.log("MPEG Audio sync word found !"),!0;return!1},I.canParse=function(_,x){return w.canParse(_,x)},I.appendFrame=function(_,x,l){if(this.basePTS!==null)return w.appendFrame(_,x,l,this.basePTS,this.frameIndex)},b}(D.default);i.default=C},"./src/demux/mp4demuxer.ts":function(n,i,r){r.r(i);var D=r("./src/polyfills/number.ts"),c=r("./src/types/demuxer.ts"),p=r("./src/utils/mp4-tools.ts"),w=r("./src/demux/dummy-demuxed-track.ts"),M=/\/emsg[-/]ID3/i,O=function(){function C(b,I){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=I}var S=C.prototype;return S.resetTimeStamp=function(){},S.resetInitSegment=function(I,L,_,x){var l=Object(p.parseInitSegment)(I),a=this.videoTrack=Object(w.dummyTrack)("video",1),d=this.audioTrack=Object(w.dummyTrack)("audio",1),y=this.txtTrack=Object(w.dummyTrack)("text",1);if(this.id3Track=Object(w.dummyTrack)("id3",1),this.timeOffset=0,l.video){var E=l.video,u=E.id,s=E.timescale,o=E.codec;a.id=u,a.timescale=y.timescale=s,a.codec=o}if(l.audio){var g=l.audio,f=g.id,v=g.timescale,T=g.codec;d.id=f,d.timescale=v,d.codec=T}y.id=p.RemuxerTrackIdConfig.text,a.sampleDuration=0,a.duration=d.duration=x},S.resetContiguity=function(){},C.probe=function(I){return I=I.length>16384?I.subarray(0,16384):I,Object(p.findBox)(I,["moof"]).length>0},S.demux=function(I,L){this.timeOffset=L;var _=I,x=this.videoTrack,l=this.txtTrack;if(this.config.progressive){this.remainderData&&(_=Object(p.appendUint8Array)(this.remainderData,I));var a=Object(p.segmentValidRange)(_);this.remainderData=a.remainder,x.samples=a.valid||new Uint8Array}else x.samples=_;var d=this.extractID3Track(x,L);return l.samples=Object(p.parseSamples)(L,x),{videoTrack:x,audioTrack:this.audioTrack,id3Track:d,textTrack:this.txtTrack}},S.flush=function(){var I=this.timeOffset,L=this.videoTrack,_=this.txtTrack;L.samples=this.remainderData||new Uint8Array,this.remainderData=null;var x=this.extractID3Track(L,this.timeOffset);return _.samples=Object(p.parseSamples)(I,L),{videoTrack:L,audioTrack:Object(w.dummyTrack)(),id3Track:x,textTrack:Object(w.dummyTrack)()}},S.extractID3Track=function(I,L){var _=this.id3Track;if(I.samples.length){var x=Object(p.findBox)(I.samples,["emsg"]);x&&x.forEach(function(l){var a=Object(p.parseEmsg)(l);if(M.test(a.schemeIdUri)){var d=Object(D.isFiniteNumber)(a.presentationTime)?a.presentationTime/a.timeScale:L+a.presentationTimeDelta/a.timeScale,y=a.payload;_.samples.push({data:y,len:y.byteLength,dts:d,pts:d,type:c.MetadataSchema.emsg})}})}return _},S.demuxSampleAes=function(I,L,_){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},S.destroy=function(){},C}();i.default=O},"./src/demux/mpegaudio.ts":function(n,i,r){r.r(i),r.d(i,"appendFrame",function(){return O}),r.d(i,"parseHeader",function(){return C}),r.d(i,"isHeaderPattern",function(){return S}),r.d(i,"isHeader",function(){return b}),r.d(i,"canParse",function(){return I}),r.d(i,"probe",function(){return L});var D=null,c=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],p=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],w=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],M=[0,1,1,4];function O(_,x,l,a,d){if(!(l+24>x.length)){var y=C(x,l);if(y&&l+y.frameLength<=x.length){var E=y.samplesPerFrame*9e4/y.sampleRate,u=a+d*E,s={unit:x.subarray(l,l+y.frameLength),pts:u,dts:u};return _.config=[],_.channelCount=y.channelCount,_.samplerate=y.sampleRate,_.samples.push(s),{sample:s,length:y.frameLength,missing:0}}}}function C(_,x){var l=_[x+1]>>3&3,a=_[x+1]>>1&3,d=_[x+2]>>4&15,y=_[x+2]>>2&3;if(l!==1&&d!==0&&d!==15&&y!==3){var E=_[x+2]>>1&1,u=_[x+3]>>6,s=l===3?3-a:a===3?3:4,o=c[s*14+d-1]*1e3,g=l===3?0:l===2?1:2,f=p[g*3+y],v=u===3?1:2,T=w[l][a],m=M[a],h=T*8*m,A=Math.floor(T*o/f+E)*m;if(D===null){var R=navigator.userAgent||"",P=R.match(/Chrome\/(\d+)/i);D=P?parseInt(P[1]):0}var k=!!D&&D<=87;return k&&a===2&&o>=224e3&&u===0&&(_[x+3]=_[x+3]|128),{sampleRate:f,channelCount:v,frameLength:A,samplesPerFrame:h}}}function S(_,x){return _[x]===255&&(_[x+1]&224)===224&&(_[x+1]&6)!==0}function b(_,x){return x+1<_.length&&S(_,x)}function I(_,x){var l=4;return S(_,x)&&l<=_.length-x}function L(_,x){if(x+1<_.length&&S(_,x)){var l=4,a=C(_,x),d=l;a!=null&&a.frameLength&&(d=a.frameLength);var y=x+d;return y===_.length||b(_,y)}return!1}},"./src/demux/sample-aes.ts":function(n,i,r){r.r(i);var D=r("./src/crypt/decrypter.ts"),c=r("./src/demux/tsdemuxer.ts"),p=function(){function w(O,C,S){this.keyData=void 0,this.decrypter=void 0,this.keyData=S,this.decrypter=new D.default(O,C,{removePKCS7Padding:!1})}var M=w.prototype;return M.decryptBuffer=function(C,S){this.decrypter.decrypt(C,this.keyData.key.buffer,this.keyData.iv.buffer,S)},M.decryptAacSample=function(C,S,b,I){var L=C[S].unit;if(!(L.length<=16)){var _=L.subarray(16,L.length-L.length%16),x=_.buffer.slice(_.byteOffset,_.byteOffset+_.length),l=this;this.decryptBuffer(x,function(a){var d=new Uint8Array(a);L.set(d,16),I||l.decryptAacSamples(C,S+1,b)})}},M.decryptAacSamples=function(C,S,b){for(;;S++){if(S>=C.length){b();return}if(!(C[S].unit.length<32)){var I=this.decrypter.isSync();if(this.decryptAacSample(C,S,b,I),!I)return}}},M.getAvcEncryptedData=function(C){for(var S=Math.floor((C.length-48)/160)*16+16,b=new Int8Array(S),I=0,L=32;L<C.length-16;L+=160,I+=16)b.set(C.subarray(L,L+16),I);return b},M.getAvcDecryptedUnit=function(C,S){for(var b=new Uint8Array(S),I=0,L=32;L<C.length-16;L+=160,I+=16)C.set(b.subarray(I,I+16),L);return C},M.decryptAvcSample=function(C,S,b,I,L,_){var x=Object(c.discardEPB)(L.data),l=this.getAvcEncryptedData(x),a=this;this.decryptBuffer(l.buffer,function(d){L.data=a.getAvcDecryptedUnit(x,d),_||a.decryptAvcSamples(C,S,b+1,I)})},M.decryptAvcSamples=function(C,S,b,I){if(C instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;S++,b=0){if(S>=C.length){I();return}for(var L=C[S].units;!(b>=L.length);b++){var _=L[b];if(!(_.data.length<=48||_.type!==1&&_.type!==5)){var x=this.decrypter.isSync();if(this.decryptAvcSample(C,S,b,I,_,x),!x)return}}}},w}();i.default=p},"./src/demux/transmuxer-interface.ts":function(n,i,r){r.r(i),r.d(i,"default",function(){return b});var D=r("./node_modules/webworkify-webpack/index.js"),c=r("./src/events.ts"),p=r("./src/demux/transmuxer.ts"),w=r("./src/utils/logger.ts"),M=r("./src/errors.ts"),O=r("./src/utils/mediasource-helper.ts"),C=r("./node_modules/eventemitter3/index.js"),S=Object(O.getMediaSource)()||{isTypeSupported:function(){return!1}},b=function(){function I(_,x,l,a){var d=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=_,this.id=x,this.onTransmuxComplete=l,this.onFlush=a;var y=_.config,E=function(f,v){v=v||{},v.frag=d.frag,v.id=d.id,_.trigger(f,v)};this.observer=new C.EventEmitter,this.observer.on(c.Events.FRAG_DECRYPTED,E),this.observer.on(c.Events.ERROR,E);var u={mp4:S.isTypeSupported("video/mp4"),mpeg:S.isTypeSupported("audio/mpeg"),mp3:S.isTypeSupported('audio/mp4; codecs="mp3"')},s=navigator.vendor;if(y.enableWorker&&typeof Worker<"u"){w.logger.log("demuxing in webworker");var o;try{o=this.worker=D("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),o.addEventListener("message",this.onwmsg),o.onerror=function(g){_.trigger(c.Events.ERROR,{type:M.ErrorTypes.OTHER_ERROR,details:M.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(g.message+"  ("+g.filename+":"+g.lineno+")")})},o.postMessage({cmd:"init",typeSupported:u,vendor:s,id:x,config:JSON.stringify(y)})}catch(g){w.logger.warn("Error in worker:",g),w.logger.error("Error while initializing DemuxerWorker, fallback to inline"),o&&self.URL.revokeObjectURL(o.objectURL),this.transmuxer=new p.default(this.observer,u,y,s,x),this.worker=null}}else this.transmuxer=new p.default(this.observer,u,y,s,x)}var L=I.prototype;return L.destroy=function(){var x=this.worker;if(x)x.removeEventListener("message",this.onwmsg),x.terminate(),this.worker=null,this.onwmsg=void 0;else{var l=this.transmuxer;l&&(l.destroy(),this.transmuxer=null)}var a=this.observer;a&&a.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},L.push=function(x,l,a,d,y,E,u,s,o,g){var f,v,T=this;o.transmuxing.start=self.performance.now();var m=this.transmuxer,h=this.worker,A=E?E.start:y.start,R=y.decryptdata,P=this.frag,k=!(P&&y.cc===P.cc),j=!(P&&o.level===P.level),K=P?o.sn-P.sn:-1,W=this.part?o.part-this.part.index:-1,H=K===0&&o.id>1&&o.id===(P==null?void 0:P.stats.chunkCount),$=!j&&(K===1||K===0&&(W===1||H&&W<=0)),z=self.performance.now();(j||K||y.stats.parsing.start===0)&&(y.stats.parsing.start=z),E&&(W||!$)&&(E.stats.parsing.start=z);var J=!(P&&((f=y.initSegment)===null||f===void 0?void 0:f.url)===((v=P.initSegment)===null||v===void 0?void 0:v.url)),ee=new p.TransmuxState(k,$,s,j,A,J);if(!$||k||J){w.logger.log("[transmuxer-interface, "+y.type+"]: Starting new transmux session for sn: "+o.sn+" p: "+o.part+" level: "+o.level+" id: "+o.id+`
        discontinuity: `+k+`
        trackSwitch: `+j+`
        contiguous: `+$+`
        accurateTimeOffset: `+s+`
        timeOffset: `+A+`
        initSegmentChange: `+J);var re=new p.TransmuxConfig(a,d,l,u,g);this.configureTransmuxer(re)}if(this.frag=y,this.part=E,h)h.postMessage({cmd:"demux",data:x,decryptdata:R,chunkMeta:o,state:ee},x instanceof ArrayBuffer?[x]:[]);else if(m){var ne=m.push(x,R,o,ee);Object(p.isPromise)(ne)?ne.then(function(ae){T.handleTransmuxComplete(ae)}):this.handleTransmuxComplete(ne)}},L.flush=function(x){var l=this;x.transmuxing.start=self.performance.now();var a=this.transmuxer,d=this.worker;if(d)d.postMessage({cmd:"flush",chunkMeta:x});else if(a){var y=a.flush(x);Object(p.isPromise)(y)?y.then(function(E){l.handleFlushResult(E,x)}):this.handleFlushResult(y,x)}},L.handleFlushResult=function(x,l){var a=this;x.forEach(function(d){a.handleTransmuxComplete(d)}),this.onFlush(l)},L.onWorkerMessage=function(x){var l=x.data,a=this.hls;switch(l.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(l.data);break}case"flush":{this.onFlush(l.data);break}case"workerLog":w.logger[l.data.logType]&&w.logger[l.data.logType](l.data.message);break;default:{l.data=l.data||{},l.data.frag=this.frag,l.data.id=this.id,a.trigger(l.event,l.data);break}}},L.configureTransmuxer=function(x){var l=this.worker,a=this.transmuxer;l?l.postMessage({cmd:"configure",config:x}):a&&a.configure(x)},L.handleTransmuxComplete=function(x){x.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(x)},I}()},"./src/demux/transmuxer-worker.ts":function(n,i,r){r.r(i),r.d(i,"default",function(){return M});var D=r("./src/demux/transmuxer.ts"),c=r("./src/events.ts"),p=r("./src/utils/logger.ts"),w=r("./node_modules/eventemitter3/index.js");function M(I){var L=new w.EventEmitter,_=function(a,d){I.postMessage({event:a,data:d})};L.on(c.Events.FRAG_DECRYPTED,_),L.on(c.Events.ERROR,_);var x=function(){var a=function(E){var u=function(o){_("workerLog",{logType:E,message:o})};p.logger[E]=u};for(var d in p.logger)a(d)};I.addEventListener("message",function(l){var a=l.data;switch(a.cmd){case"init":{var d=JSON.parse(a.config);I.transmuxer=new D.default(L,a.typeSupported,d,a.vendor,a.id),Object(p.enableLogs)(d.debug),x(),_("init",null);break}case"configure":{I.transmuxer.configure(a.config);break}case"demux":{var y=I.transmuxer.push(a.data,a.decryptdata,a.chunkMeta,a.state);Object(D.isPromise)(y)?y.then(function(s){O(I,s)}):O(I,y);break}case"flush":{var E=a.chunkMeta,u=I.transmuxer.flush(E);Object(D.isPromise)(u)?u.then(function(s){S(I,s,E)}):S(I,u,E);break}}})}function O(I,L){if(b(L.remuxResult))return!1;var _=[],x=L.remuxResult,l=x.audio,a=x.video;return l&&C(_,l),a&&C(_,a),I.postMessage({event:"transmuxComplete",data:L},_),!0}function C(I,L){L.data1&&I.push(L.data1.buffer),L.data2&&I.push(L.data2.buffer)}function S(I,L,_){var x=L.reduce(function(l,a){return O(I,a)||l},!1);x||I.postMessage({event:"transmuxComplete",data:L[0]}),I.postMessage({event:"flush",data:_})}function b(I){return!I.audio&&!I.video&&!I.text&&!I.id3&&!I.initSegment}},"./src/demux/transmuxer.ts":function(n,i,r){r.r(i),r.d(i,"default",function(){return x}),r.d(i,"isPromise",function(){return d}),r.d(i,"TransmuxConfig",function(){return y}),r.d(i,"TransmuxState",function(){return E});var D=r("./src/events.ts"),c=r("./src/errors.ts"),p=r("./src/crypt/decrypter.ts"),w=r("./src/demux/aacdemuxer.ts"),M=r("./src/demux/mp4demuxer.ts"),O=r("./src/demux/tsdemuxer.ts"),C=r("./src/demux/mp3demuxer.ts"),S=r("./src/remux/mp4-remuxer.ts"),b=r("./src/remux/passthrough-remuxer.ts"),I=r("./src/utils/logger.ts"),L;try{L=self.performance.now.bind(self.performance)}catch{I.logger.debug("Unable to use Performance API on this environment"),L=self.Date.now}var _=[{demux:O.default,remux:S.default},{demux:M.default,remux:b.default},{demux:w.default,remux:S.default},{demux:C.default,remux:S.default}],x=function(){function u(o,g,f,v,T){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=o,this.typeSupported=g,this.config=f,this.vendor=v,this.id=T}var s=u.prototype;return s.configure=function(g){this.transmuxConfig=g,this.decrypter&&this.decrypter.reset()},s.push=function(g,f,v,T){var m=this,h=v.transmuxing;h.executeStart=L();var A=new Uint8Array(g),R=this.config,P=this.currentTransmuxState,k=this.transmuxConfig;T&&(this.currentTransmuxState=T);var j=T||P,K=j.contiguous,W=j.discontinuity,H=j.trackSwitch,$=j.accurateTimeOffset,z=j.timeOffset,J=j.initSegmentChange,ee=k.audioCodec,re=k.videoCodec,ne=k.defaultInitPts,ae=k.duration,ce=k.initSegmentData;(W||H||J)&&this.resetInitSegment(ce,ee,re,ae),(W||J)&&this.resetInitialTimestamp(ne),K||this.resetContiguity();var fe=l(A,f);if(fe&&fe.method==="AES-128"){var se=this.getDecrypter();if(R.enableSoftwareAES){var ve=se.softwareDecrypt(A,fe.key.buffer,fe.iv.buffer);if(!ve)return h.executeEnd=L(),a(v);A=new Uint8Array(ve)}else return this.decryptionPromise=se.webCryptoDecrypt(A,fe.key.buffer,fe.iv.buffer).then(function(Ce){var be=m.push(Ce,null,v);return m.decryptionPromise=null,be}),this.decryptionPromise}this.needsProbing(A,W,H)&&this.configureTransmuxer(A,k);var le=this.transmux(A,fe,z,$,v),ue=this.currentTransmuxState;return ue.contiguous=!0,ue.discontinuity=!1,ue.trackSwitch=!1,h.executeEnd=L(),le},s.flush=function(g){var f=this,v=g.transmuxing;v.executeStart=L();var T=this.decrypter,m=this.currentTransmuxState,h=this.decryptionPromise;if(h)return h.then(function(){return f.flush(g)});var A=[],R=m.timeOffset;if(T){var P=T.flush();P&&A.push(this.push(P,null,g))}var k=this.demuxer,j=this.remuxer;if(!k||!j)return this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),v.executeEnd=L(),[a(g)];var K=k.flush(R);return d(K)?K.then(function(W){return f.flushRemux(A,W,g),A}):(this.flushRemux(A,K,g),A)},s.flushRemux=function(g,f,v){var T=f.audioTrack,m=f.videoTrack,h=f.id3Track,A=f.textTrack,R=this.currentTransmuxState,P=R.accurateTimeOffset,k=R.timeOffset;I.logger.log("[transmuxer.ts]: Flushed fragment "+v.sn+(v.part>-1?" p: "+v.part:"")+" of level "+v.level);var j=this.remuxer.remux(T,m,h,A,k,P,!0,this.id);g.push({remuxResult:j,chunkMeta:v}),v.transmuxing.executeEnd=L()},s.resetInitialTimestamp=function(g){var f=this.demuxer,v=this.remuxer;!f||!v||(f.resetTimeStamp(g),v.resetTimeStamp(g))},s.resetContiguity=function(){var g=this.demuxer,f=this.remuxer;!g||!f||(g.resetContiguity(),f.resetNextTimestamp())},s.resetInitSegment=function(g,f,v,T){var m=this.demuxer,h=this.remuxer;!m||!h||(m.resetInitSegment(g,f,v,T),h.resetInitSegment(g,f,v))},s.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},s.transmux=function(g,f,v,T,m){var h;return f&&f.method==="SAMPLE-AES"?h=this.transmuxSampleAes(g,f,v,T,m):h=this.transmuxUnencrypted(g,v,T,m),h},s.transmuxUnencrypted=function(g,f,v,T){var m=this.demuxer.demux(g,f,!1,!this.config.progressive),h=m.audioTrack,A=m.videoTrack,R=m.id3Track,P=m.textTrack,k=this.remuxer.remux(h,A,R,P,f,v,!1,this.id);return{remuxResult:k,chunkMeta:T}},s.transmuxSampleAes=function(g,f,v,T,m){var h=this;return this.demuxer.demuxSampleAes(g,f,v).then(function(A){var R=h.remuxer.remux(A.audioTrack,A.videoTrack,A.id3Track,A.textTrack,v,T,!1,h.id);return{remuxResult:R,chunkMeta:m}})},s.configureTransmuxer=function(g,f){for(var v=this.config,T=this.observer,m=this.typeSupported,h=this.vendor,A=f.audioCodec,R=f.defaultInitPts,P=f.duration,k=f.initSegmentData,j=f.videoCodec,K,W=0,H=_.length;W<H;W++)if(_[W].demux.probe(g)){K=_[W];break}K||(I.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),K={demux:M.default,remux:b.default});var $=this.demuxer,z=this.remuxer,J=K.remux,ee=K.demux;(!z||!(z instanceof J))&&(this.remuxer=new J(T,v,m,h)),(!$||!($ instanceof ee))&&(this.demuxer=new ee(T,v,m),this.probe=ee.probe),this.resetInitSegment(k,A,j,P),this.resetInitialTimestamp(R)},s.needsProbing=function(g,f,v){return!this.demuxer||!this.remuxer||f||v},s.getDecrypter=function(){var g=this.decrypter;return g||(g=this.decrypter=new p.default(this.observer,this.config)),g},u}();function l(u,s){var o=null;return u.byteLength>0&&s!=null&&s.key!=null&&s.iv!==null&&s.method!=null&&(o=s),o}var a=function(s){return{remuxResult:{},chunkMeta:s}};function d(u){return"then"in u&&u.then instanceof Function}var y=function(s,o,g,f,v){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=s,this.videoCodec=o,this.initSegmentData=g,this.duration=f,this.defaultInitPts=v},E=function(s,o,g,f,v,T){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=s,this.contiguous=o,this.accurateTimeOffset=g,this.trackSwitch=f,this.timeOffset=v,this.initSegmentChange=T}},"./src/demux/tsdemuxer.ts":function(n,i,r){r.r(i),r.d(i,"discardEPB",function(){return y});var D=r("./src/demux/adts.ts"),c=r("./src/demux/mpegaudio.ts"),p=r("./src/demux/exp-golomb.ts"),w=r("./src/demux/sample-aes.ts"),M=r("./src/events.ts"),O=r("./src/utils/mp4-tools.ts"),C=r("./src/utils/logger.ts"),S=r("./src/errors.ts"),b=r("./src/types/demuxer.ts");function I(){return I=Object.assign?Object.assign.bind():function(E){for(var u=1;u<arguments.length;u++){var s=arguments[u];for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(E[o]=s[o])}return E},I.apply(this,arguments)}var L=function(){function E(s,o,g){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=s,this.config=o,this.typeSupported=g}E.probe=function(o){return o[0]===71&&o[188]===71},E.createTrack=function(o,g){return{container:o==="video"||o==="audio"?"video/mp2t":void 0,type:o,id:O.RemuxerTrackIdConfig[o],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:o==="audio"?g:void 0}};var u=E.prototype;return u.resetInitSegment=function(o,g,f,v){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=E.createTrack("video"),this._audioTrack=E.createTrack("audio",v),this._id3Track=E.createTrack("id3"),this._txtTrack=E.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=g,this.videoCodec=f,this._duration=v},u.resetTimeStamp=function(){},u.resetContiguity=function(){var o=this._audioTrack,g=this._avcTrack,f=this._id3Track;o&&(o.pesData=null),g&&(g.pesData=null),f&&(f.pesData=null),this.aacOverFlow=null},u.demux=function(o,g,f,v){f===void 0&&(f=!1),v===void 0&&(v=!1),f||(this.sampleAes=null);var T,m=this._avcTrack,h=this._audioTrack,A=this._id3Track,R=this._txtTrack,P=m.pid,k=m.pesData,j=h.pid,K=A.pid,W=h.pesData,H=A.pesData,$=null,z=this.pmtParsed,J=this._pmtId,ee=o.length;if(this.remainderData&&(o=Object(O.appendUint8Array)(this.remainderData,o),ee=o.length,this.remainderData=null),ee<188&&!v)return this.remainderData=o,{audioTrack:h,videoTrack:m,id3Track:A,textTrack:R};ee-=ee%188,ee<o.byteLength&&!v&&(this.remainderData=new Uint8Array(o.buffer,ee,o.buffer.byteLength-ee));for(var re=0,ne=0;ne<ee;ne+=188)if(o[ne]===71){var ae=!!(o[ne+1]&64),ce=((o[ne+1]&31)<<8)+o[ne+2],fe=(o[ne+3]&48)>>4,se=void 0;if(fe>1){if(se=ne+5+o[ne+4],se===ne+188)continue}else se=ne+4;switch(ce){case P:ae&&(k&&(T=a(k))&&this.parseAVCPES(m,R,T,!1),k={data:[],size:0}),k&&(k.data.push(o.subarray(se,ne+188)),k.size+=ne+188-se);break;case j:if(ae){if(W&&(T=a(W)))switch(h.segmentCodec){case"aac":this.parseAACPES(h,T);break;case"mp3":this.parseMPEGPES(h,T);break}W={data:[],size:0}}W&&(W.data.push(o.subarray(se,ne+188)),W.size+=ne+188-se);break;case K:ae&&(H&&(T=a(H))&&this.parseID3PES(A,T),H={data:[],size:0}),H&&(H.data.push(o.subarray(se,ne+188)),H.size+=ne+188-se);break;case 0:ae&&(se+=o[se]+1),J=this._pmtId=x(o,se);break;case J:{ae&&(se+=o[se]+1);var ve=l(o,se,this.typeSupported,f);P=ve.avc,P>0&&(m.pid=P),j=ve.audio,j>0&&(h.pid=j,h.segmentCodec=ve.segmentCodec),K=ve.id3,K>0&&(A.pid=K),$!==null&&!z&&(C.logger.log("unknown PID '"+$+"' in TS found"),$=null),z=this.pmtParsed=!0;break}case 17:case 8191:break;default:$=ce;break}}else re++;re>0&&this.observer.emit(M.Events.ERROR,M.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+re+" TS packet/s that do not start with 0x47"}),m.pesData=k,h.pesData=W,A.pesData=H;var le={audioTrack:h,videoTrack:m,id3Track:A,textTrack:R};return v&&this.extractRemainingSamples(le),le},u.flush=function(){var o=this.remainderData;this.remainderData=null;var g;return o?g=this.demux(o,-1,!1,!0):g={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(g),this.sampleAes?this.decrypt(g,this.sampleAes):g},u.extractRemainingSamples=function(o){var g=o.audioTrack,f=o.videoTrack,v=o.id3Track,T=o.textTrack,m=f.pesData,h=g.pesData,A=v.pesData,R;if(m&&(R=a(m))?(this.parseAVCPES(f,T,R,!0),f.pesData=null):f.pesData=m,h&&(R=a(h))){switch(g.segmentCodec){case"aac":this.parseAACPES(g,R);break;case"mp3":this.parseMPEGPES(g,R);break}g.pesData=null}else h!=null&&h.size&&C.logger.log("last AAC PES packet truncated,might overlap between fragments"),g.pesData=h;A&&(R=a(A))?(this.parseID3PES(v,R),v.pesData=null):v.pesData=A},u.demuxSampleAes=function(o,g,f){var v=this.demux(o,f,!0,!this.config.progressive),T=this.sampleAes=new w.default(this.observer,this.config,g);return this.decrypt(v,T)},u.decrypt=function(o,g){return new Promise(function(f){var v=o.audioTrack,T=o.videoTrack;v.samples&&v.segmentCodec==="aac"?g.decryptAacSamples(v.samples,0,function(){T.samples?g.decryptAvcSamples(T.samples,0,0,function(){f(o)}):f(o)}):T.samples&&g.decryptAvcSamples(T.samples,0,0,function(){f(o)})})},u.destroy=function(){this._duration=0},u.parseAVCPES=function(o,g,f,v){var T=this,m=this.parseAVCNALu(o,f.data),h=this.avcSample,A,R=!1;f.data=null,h&&m.length&&!o.audFound&&(d(h,o),h=this.avcSample=_(!1,f.pts,f.dts,"")),m.forEach(function(P){switch(P.type){case 1:{A=!0,h||(h=T.avcSample=_(!0,f.pts,f.dts,"")),h.frame=!0;var k=P.data;if(R&&k.length>4){var j=new p.default(k).readSliceType();(j===2||j===4||j===7||j===9)&&(h.key=!0)}break}case 5:A=!0,h||(h=T.avcSample=_(!0,f.pts,f.dts,"")),h.key=!0,h.frame=!0;break;case 6:{A=!0,Object(O.parseSEIMessageFromNALu)(y(P.data),f.pts,g.samples);break}case 7:if(A=!0,R=!0,!o.sps){var K=new p.default(P.data),W=K.readSPS();o.width=W.width,o.height=W.height,o.pixelRatio=W.pixelRatio,o.sps=[P.data],o.duration=T._duration;for(var H=P.data.subarray(1,4),$="avc1.",z=0;z<3;z++){var J=H[z].toString(16);J.length<2&&(J="0"+J),$+=J}o.codec=$}break;case 8:A=!0,o.pps||(o.pps=[P.data]);break;case 9:A=!1,o.audFound=!0,h&&d(h,o),h=T.avcSample=_(!1,f.pts,f.dts,"");break;case 12:A=!0;break;default:A=!1,h&&(h.debug+="unknown NAL "+P.type+" ");break}if(h&&A){var ee=h.units;ee.push(P)}}),v&&h&&(d(h,o),this.avcSample=null)},u.getLastNalUnit=function(o){var g,f=this.avcSample,v;if((!f||f.units.length===0)&&(f=o[o.length-1]),(g=f)!==null&&g!==void 0&&g.units){var T=f.units;v=T[T.length-1]}return v},u.parseAVCNALu=function(o,g){var f=g.byteLength,v=o.naluState||0,T=v,m=[],h=0,A,R,P,k=-1,j=0;for(v===-1&&(k=0,j=g[0]&31,v=0,h=1);h<f;){if(A=g[h++],!v){v=A?0:1;continue}if(v===1){v=A?0:2;continue}if(!A)v=3;else if(A===1){if(k>=0){var K={data:g.subarray(k,h-v-1),type:j};m.push(K)}else{var W=this.getLastNalUnit(o.samples);if(W&&(T&&h<=4-T&&W.state&&(W.data=W.data.subarray(0,W.data.byteLength-T)),R=h-v-1,R>0)){var H=new Uint8Array(W.data.byteLength+R);H.set(W.data,0),H.set(g.subarray(0,R),W.data.byteLength),W.data=H,W.state=0}}h<f?(P=g[h]&31,k=h,j=P,v=0):v=-1}else v=0}if(k>=0&&v>=0){var $={data:g.subarray(k,f),type:j,state:v};m.push($)}if(m.length===0){var z=this.getLastNalUnit(o.samples);if(z){var J=new Uint8Array(z.data.byteLength+g.byteLength);J.set(z.data,0),J.set(g,z.data.byteLength),z.data=J}}return o.naluState=v,m},u.parseAACPES=function(o,g){var f=0,v=this.aacOverFlow,T=g.data;if(v){this.aacOverFlow=null;var m=v.missing,h=v.sample.unit.byteLength;if(m===-1){var A=new Uint8Array(h+T.byteLength);A.set(v.sample.unit,0),A.set(T,h),T=A}else{var R=h-m;v.sample.unit.set(T.subarray(0,m),R),o.samples.push(v.sample),f=v.missing}}var P,k;for(P=f,k=T.length;P<k-1&&!D.isHeader(T,P);P++);if(P!==f){var j,K;if(P<k-1?(j="AAC PES did not start with ADTS header,offset:"+P,K=!1):(j="no ADTS header found in AAC PES",K=!0),C.logger.warn("parsing error:"+j),this.observer.emit(M.Events.ERROR,M.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.FRAG_PARSING_ERROR,fatal:K,reason:j}),K)return}D.initTrackConfig(o,this.observer,T,P,this.audioCodec);var W;if(g.pts!==void 0)W=g.pts;else if(v){var H=D.getFrameDuration(o.samplerate);W=v.sample.pts+H}else{C.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var $=0,z;P<k;)if(z=D.appendFrame(o,T,P,W,$),P+=z.length,z.missing){this.aacOverFlow=z;break}else for($++;P<k-1&&!D.isHeader(T,P);P++);},u.parseMPEGPES=function(o,g){var f=g.data,v=f.length,T=0,m=0,h=g.pts;if(h===void 0){C.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;m<v;)if(c.isHeader(f,m)){var A=c.appendFrame(o,f,m,h,T);if(A)m+=A.length,T++;else break}else m++},u.parseID3PES=function(o,g){if(g.pts===void 0){C.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var f=I({},g,{type:this._avcTrack?b.MetadataSchema.emsg:b.MetadataSchema.audioId3});o.samples.push(f)},E}();function _(E,u,s,o){return{key:E,frame:!1,pts:u,dts:s,units:[],debug:o,length:0}}function x(E,u){return(E[u+10]&31)<<8|E[u+11]}function l(E,u,s,o){var g={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},f=(E[u+1]&15)<<8|E[u+2],v=u+3+f-4,T=(E[u+10]&15)<<8|E[u+11];for(u+=12+T;u<v;){var m=(E[u+1]&31)<<8|E[u+2];switch(E[u]){case 207:if(!o){C.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:g.audio===-1&&(g.audio=m);break;case 21:g.id3===-1&&(g.id3=m);break;case 219:if(!o){C.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:g.avc===-1&&(g.avc=m);break;case 3:case 4:s.mpeg!==!0&&s.mp3!==!0?C.logger.log("MPEG audio found, not supported in this browser"):g.audio===-1&&(g.audio=m,g.segmentCodec="mp3");break;case 36:C.logger.warn("Unsupported HEVC stream type found");break}u+=((E[u+3]&15)<<8|E[u+4])+5}return g}function a(E){var u=0,s,o,g,f,v,T=E.data;if(!E||E.size===0)return null;for(;T[0].length<19&&T.length>1;){var m=new Uint8Array(T[0].length+T[1].length);m.set(T[0]),m.set(T[1],T[0].length),T[0]=m,T.splice(1,1)}s=T[0];var h=(s[0]<<16)+(s[1]<<8)+s[2];if(h===1){if(o=(s[4]<<8)+s[5],o&&o>E.size-6)return null;var A=s[7];A&192&&(f=(s[9]&14)*536870912+(s[10]&255)*4194304+(s[11]&254)*16384+(s[12]&255)*128+(s[13]&254)/2,A&64?(v=(s[14]&14)*536870912+(s[15]&255)*4194304+(s[16]&254)*16384+(s[17]&255)*128+(s[18]&254)/2,f-v>60*9e4&&(C.logger.warn(Math.round((f-v)/9e4)+"s delta between PTS and DTS, align them"),f=v)):v=f),g=s[8];var R=g+9;if(E.size<=R)return null;E.size-=R;for(var P=new Uint8Array(E.size),k=0,j=T.length;k<j;k++){s=T[k];var K=s.byteLength;if(R)if(R>K){R-=K;continue}else s=s.subarray(R),K-=R,R=0;P.set(s,u),u+=K}return o&&(o-=g+3),{data:P,pts:f,dts:v,len:o}}return null}function d(E,u){if(E.units.length&&E.frame){if(E.pts===void 0){var s=u.samples,o=s.length;if(o){var g=s[o-1];E.pts=g.pts,E.dts=g.dts}else{u.dropped++;return}}u.samples.push(E)}E.debug.length&&C.logger.log(E.pts+"/"+E.dts+":"+E.debug)}function y(E){for(var u=E.byteLength,s=[],o=1;o<u-2;)E[o]===0&&E[o+1]===0&&E[o+2]===3?(s.push(o+2),o+=2):o++;if(s.length===0)return E;var g=u-s.length,f=new Uint8Array(g),v=0;for(o=0;o<g;v++,o++)v===s[0]&&(v++,s.shift()),f[o]=E[v];return f}i.default=L},"./src/errors.ts":function(n,i,r){r.r(i),r.d(i,"ErrorTypes",function(){return D}),r.d(i,"ErrorDetails",function(){return c});var D;(function(p){p.NETWORK_ERROR="networkError",p.MEDIA_ERROR="mediaError",p.KEY_SYSTEM_ERROR="keySystemError",p.MUX_ERROR="muxError",p.OTHER_ERROR="otherError"})(D||(D={}));var c;(function(p){p.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",p.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",p.KEY_SYSTEM_NO_SESSION="keySystemNoSession",p.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",p.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",p.MANIFEST_LOAD_ERROR="manifestLoadError",p.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",p.MANIFEST_PARSING_ERROR="manifestParsingError",p.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",p.LEVEL_EMPTY_ERROR="levelEmptyError",p.LEVEL_LOAD_ERROR="levelLoadError",p.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",p.LEVEL_SWITCH_ERROR="levelSwitchError",p.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",p.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",p.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",p.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",p.FRAG_LOAD_ERROR="fragLoadError",p.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",p.FRAG_DECRYPT_ERROR="fragDecryptError",p.FRAG_PARSING_ERROR="fragParsingError",p.REMUX_ALLOC_ERROR="remuxAllocError",p.KEY_LOAD_ERROR="keyLoadError",p.KEY_LOAD_TIMEOUT="keyLoadTimeOut",p.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",p.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",p.BUFFER_APPEND_ERROR="bufferAppendError",p.BUFFER_APPENDING_ERROR="bufferAppendingError",p.BUFFER_STALLED_ERROR="bufferStalledError",p.BUFFER_FULL_ERROR="bufferFullError",p.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",p.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",p.INTERNAL_EXCEPTION="internalException",p.INTERNAL_ABORTED="aborted",p.UNKNOWN="unknown"})(c||(c={}))},"./src/events.ts":function(n,i,r){r.r(i),r.d(i,"Events",function(){return D});var D;(function(c){c.MEDIA_ATTACHING="hlsMediaAttaching",c.MEDIA_ATTACHED="hlsMediaAttached",c.MEDIA_DETACHING="hlsMediaDetaching",c.MEDIA_DETACHED="hlsMediaDetached",c.BUFFER_RESET="hlsBufferReset",c.BUFFER_CODECS="hlsBufferCodecs",c.BUFFER_CREATED="hlsBufferCreated",c.BUFFER_APPENDING="hlsBufferAppending",c.BUFFER_APPENDED="hlsBufferAppended",c.BUFFER_EOS="hlsBufferEos",c.BUFFER_FLUSHING="hlsBufferFlushing",c.BUFFER_FLUSHED="hlsBufferFlushed",c.MANIFEST_LOADING="hlsManifestLoading",c.MANIFEST_LOADED="hlsManifestLoaded",c.MANIFEST_PARSED="hlsManifestParsed",c.LEVEL_SWITCHING="hlsLevelSwitching",c.LEVEL_SWITCHED="hlsLevelSwitched",c.LEVEL_LOADING="hlsLevelLoading",c.LEVEL_LOADED="hlsLevelLoaded",c.LEVEL_UPDATED="hlsLevelUpdated",c.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",c.LEVELS_UPDATED="hlsLevelsUpdated",c.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",c.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",c.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",c.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",c.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",c.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",c.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",c.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",c.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",c.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",c.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",c.CUES_PARSED="hlsCuesParsed",c.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",c.INIT_PTS_FOUND="hlsInitPtsFound",c.FRAG_LOADING="hlsFragLoading",c.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",c.FRAG_LOADED="hlsFragLoaded",c.FRAG_DECRYPTED="hlsFragDecrypted",c.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",c.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",c.FRAG_PARSING_METADATA="hlsFragParsingMetadata",c.FRAG_PARSED="hlsFragParsed",c.FRAG_BUFFERED="hlsFragBuffered",c.FRAG_CHANGED="hlsFragChanged",c.FPS_DROP="hlsFpsDrop",c.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",c.ERROR="hlsError",c.DESTROYING="hlsDestroying",c.KEY_LOADING="hlsKeyLoading",c.KEY_LOADED="hlsKeyLoaded",c.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",c.BACK_BUFFER_REACHED="hlsBackBufferReached"})(D||(D={}))},"./src/hls.ts":function(n,i,r){r.r(i),r.d(i,"default",function(){return y});var D=r("./node_modules/url-toolkit/src/url-toolkit.js"),c=r("./src/loader/playlist-loader.ts"),p=r("./src/loader/key-loader.ts"),w=r("./src/controller/id3-track-controller.ts"),M=r("./src/controller/latency-controller.ts"),O=r("./src/controller/level-controller.ts"),C=r("./src/controller/fragment-tracker.ts"),S=r("./src/controller/stream-controller.ts"),b=r("./src/is-supported.ts"),I=r("./src/utils/logger.ts"),L=r("./src/config.ts"),_=r("./node_modules/eventemitter3/index.js"),x=r("./src/events.ts"),l=r("./src/errors.ts");function a(E,u){for(var s=0;s<u.length;s++){var o=u[s];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(E,o.key,o)}}function d(E,u,s){return u&&a(E.prototype,u),s&&a(E,s),Object.defineProperty(E,"prototype",{writable:!1}),E}var y=function(){E.isSupported=function(){return Object(b.isSupported)()};function E(s){s===void 0&&(s={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new _.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var o=this.config=Object(L.mergeConfig)(E.DefaultConfig,s);this.userConfig=s,Object(I.enableLogs)(o.debug),this._autoLevelCapping=-1,o.progressive&&Object(L.enableStreamingMode)(o);var g=o.abrController,f=o.bufferController,v=o.capLevelController,T=o.fpsController,m=this.abrController=new g(this),h=this.bufferController=new f(this),A=this.capLevelController=new v(this),R=new T(this),P=new c.default(this),k=new p.default(this),j=new w.default(this),K=this.levelController=new O.default(this),W=new C.FragmentTracker(this),H=this.streamController=new S.default(this,W);A.setStreamController(H),R.setStreamController(H);var $=[P,k,K,H];this.networkControllers=$;var z=[m,h,A,R,j,W];this.audioTrackController=this.createController(o.audioTrackController,null,$),this.createController(o.audioStreamController,W,$),this.subtitleTrackController=this.createController(o.subtitleTrackController,null,$),this.createController(o.subtitleStreamController,W,$),this.createController(o.timelineController,null,z),this.emeController=this.createController(o.emeController,null,z),this.cmcdController=this.createController(o.cmcdController,null,z),this.latencyController=this.createController(M.default,null,z),this.coreComponents=z}var u=E.prototype;return u.createController=function(o,g,f){if(o){var v=g?new o(this,g):new o(this);return f&&f.push(v),v}return null},u.on=function(o,g,f){f===void 0&&(f=this),this._emitter.on(o,g,f)},u.once=function(o,g,f){f===void 0&&(f=this),this._emitter.once(o,g,f)},u.removeAllListeners=function(o){this._emitter.removeAllListeners(o)},u.off=function(o,g,f,v){f===void 0&&(f=this),this._emitter.off(o,g,f,v)},u.listeners=function(o){return this._emitter.listeners(o)},u.emit=function(o,g,f){return this._emitter.emit(o,g,f)},u.trigger=function(o,g){if(this.config.debug)return this.emit(o,o,g);try{return this.emit(o,o,g)}catch(f){I.logger.error("An internal error happened while handling event "+o+'. Error message: "'+f.message+'". Here is a stacktrace:',f),this.trigger(x.Events.ERROR,{type:l.ErrorTypes.OTHER_ERROR,details:l.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:o,error:f})}return!1},u.listenerCount=function(o){return this._emitter.listenerCount(o)},u.destroy=function(){I.logger.log("destroy"),this.trigger(x.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(o){return o.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(o){return o.destroy()}),this.coreComponents.length=0},u.attachMedia=function(o){I.logger.log("attachMedia"),this._media=o,this.trigger(x.Events.MEDIA_ATTACHING,{media:o})},u.detachMedia=function(){I.logger.log("detachMedia"),this.trigger(x.Events.MEDIA_DETACHING,void 0),this._media=null},u.loadSource=function(o){this.stopLoad();var g=this.media,f=this.url,v=this.url=D.buildAbsoluteURL(self.location.href,o,{alwaysNormalize:!0});I.logger.log("loadSource:"+v),g&&f&&f!==v&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(g)),this.trigger(x.Events.MANIFEST_LOADING,{url:o})},u.startLoad=function(o){o===void 0&&(o=-1),I.logger.log("startLoad("+o+")"),this.networkControllers.forEach(function(g){g.startLoad(o)})},u.stopLoad=function(){I.logger.log("stopLoad"),this.networkControllers.forEach(function(o){o.stopLoad()})},u.swapAudioCodec=function(){I.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},u.recoverMediaError=function(){I.logger.log("recoverMediaError");var o=this._media;this.detachMedia(),o&&this.attachMedia(o)},u.removeLevel=function(o,g){g===void 0&&(g=0),this.levelController.removeLevel(o,g)},d(E,[{key:"levels",get:function(){var o=this.levelController.levels;return o||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(o){I.logger.log("set currentLevel:"+o),this.loadLevel=o,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(o){I.logger.log("set nextLevel:"+o),this.levelController.manualLevel=o,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(o){I.logger.log("set loadLevel:"+o),this.levelController.manualLevel=o}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(o){this.levelController.nextLoadLevel=o}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(o){I.logger.log("set firstLevel:"+o),this.levelController.firstLevel=o}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(o){I.logger.log("set startLevel:"+o),o!==-1&&(o=Math.max(o,this.minAutoLevel)),this.levelController.startLevel=o}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(o){var g=!!o;g!==this.config.capLevelToPlayerSize&&(g?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=g)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(o){this._autoLevelCapping!==o&&(I.logger.log("set autoLevelCapping:"+o),this._autoLevelCapping=o)}},{key:"bandwidthEstimate",get:function(){var o=this.abrController.bwEstimator;return o?o.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var o=this.levels,g=this.config.minAutoBitrate;if(!o)return 0;for(var f=o.length,v=0;v<f;v++)if(o[v].maxBitrate>=g)return v;return 0}},{key:"maxAutoLevel",get:function(){var o=this.levels,g=this.autoLevelCapping,f;return g===-1&&o&&o.length?f=o.length-1:f=g,f}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(o){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,o)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"audioTracks",get:function(){var o=this.audioTrackController;return o?o.audioTracks:[]}},{key:"audioTrack",get:function(){var o=this.audioTrackController;return o?o.audioTrack:-1},set:function(o){var g=this.audioTrackController;g&&(g.audioTrack=o)}},{key:"subtitleTracks",get:function(){var o=this.subtitleTrackController;return o?o.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var o=this.subtitleTrackController;return o?o.subtitleTrack:-1},set:function(o){var g=this.subtitleTrackController;g&&(g.subtitleTrack=o)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var o=this.subtitleTrackController;return o?o.subtitleDisplay:!1},set:function(o){var g=this.subtitleTrackController;g&&(g.subtitleDisplay=o)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(o){this.config.lowLatencyMode=o}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.2.3"}},{key:"Events",get:function(){return x.Events}},{key:"ErrorTypes",get:function(){return l.ErrorTypes}},{key:"ErrorDetails",get:function(){return l.ErrorDetails}},{key:"DefaultConfig",get:function(){return E.defaultConfig?E.defaultConfig:L.hlsDefaultConfig},set:function(o){E.defaultConfig=o}}]),E}();y.defaultConfig=void 0},"./src/is-supported.ts":function(n,i,r){r.r(i),r.d(i,"isSupported",function(){return p}),r.d(i,"changeTypeSupported",function(){return w});var D=r("./src/utils/mediasource-helper.ts");function c(){return self.SourceBuffer||self.WebKitSourceBuffer}function p(){var M=Object(D.getMediaSource)();if(!M)return!1;var O=c(),C=M&&typeof M.isTypeSupported=="function"&&M.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),S=!O||O.prototype&&typeof O.prototype.appendBuffer=="function"&&typeof O.prototype.remove=="function";return!!C&&!!S}function w(){var M,O=c();return typeof(O==null||(M=O.prototype)===null||M===void 0?void 0:M.changeType)=="function"}},"./src/loader/date-range.ts":function(n,i,r){r.r(i),r.d(i,"DateRangeAttribute",function(){return C}),r.d(i,"DateRange",function(){return S});var D=r("./src/polyfills/number.ts"),c=r("./src/utils/attr-list.ts"),p=r("./src/utils/logger.ts");function w(){return w=Object.assign?Object.assign.bind():function(b){for(var I=1;I<arguments.length;I++){var L=arguments[I];for(var _ in L)Object.prototype.hasOwnProperty.call(L,_)&&(b[_]=L[_])}return b},w.apply(this,arguments)}function M(b,I){for(var L=0;L<I.length;L++){var _=I[L];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(b,_.key,_)}}function O(b,I,L){return I&&M(b.prototype,I),L&&M(b,L),Object.defineProperty(b,"prototype",{writable:!1}),b}var C;(function(b){b.ID="ID",b.CLASS="CLASS",b.START_DATE="START-DATE",b.DURATION="DURATION",b.END_DATE="END-DATE",b.END_ON_NEXT="END-ON-NEXT",b.PLANNED_DURATION="PLANNED-DURATION",b.SCTE35_OUT="SCTE35-OUT",b.SCTE35_IN="SCTE35-IN"})(C||(C={}));var S=function(){function b(I,L){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,L){var _=L.attr;for(var x in _)if(Object.prototype.hasOwnProperty.call(I,x)&&I[x]!==_[x]){p.logger.warn('DATERANGE tag attribute: "'+x+'" does not match for tags with ID: "'+I.ID+'"'),this._badValueForSameId=x;break}I=w(new c.AttrList({}),_,I)}if(this.attr=I,this._startDate=new Date(I[C.START_DATE]),C.END_DATE in this.attr){var l=new Date(this.attr[C.END_DATE]);Object(D.isFiniteNumber)(l.getTime())&&(this._endDate=l)}}return O(b,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var L=this.duration;return L!==null?new Date(this._startDate.getTime()+L*1e3):null}},{key:"duration",get:function(){if(C.DURATION in this.attr){var L=this.attr.decimalFloatingPoint(C.DURATION);if(Object(D.isFiniteNumber)(L))return L}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return C.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(C.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(C.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&Object(D.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),b}()},"./src/loader/fragment-loader.ts":function(n,i,r){r.r(i),r.d(i,"default",function(){return L}),r.d(i,"LoadError",function(){return x});var D=r("./src/polyfills/number.ts"),c=r("./src/errors.ts");function p(l,a){l.prototype=Object.create(a.prototype),l.prototype.constructor=l,S(l,a)}function w(l){var a=typeof Map=="function"?new Map:void 0;return w=function(y){if(y===null||!C(y))return y;if(typeof y!="function")throw new TypeError("Super expression must either be null or a function");if(typeof a<"u"){if(a.has(y))return a.get(y);a.set(y,E)}function E(){return M(y,arguments,b(this).constructor)}return E.prototype=Object.create(y.prototype,{constructor:{value:E,enumerable:!1,writable:!0,configurable:!0}}),S(E,y)},w(l)}function M(l,a,d){return O()?M=Reflect.construct.bind():M=function(E,u,s){var o=[null];o.push.apply(o,u);var g=Function.bind.apply(E,o),f=new g;return s&&S(f,s.prototype),f},M.apply(null,arguments)}function O(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function C(l){return Function.toString.call(l).indexOf("[native code]")!==-1}function S(l,a){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,E){return y.__proto__=E,y},S(l,a)}function b(l){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(d){return d.__proto__||Object.getPrototypeOf(d)},b(l)}var I=Math.pow(2,17),L=function(){function l(d){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=d}var a=l.prototype;return a.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},a.abort=function(){this.loader&&this.loader.abort()},a.load=function(y,E){var u=this,s=y.url;if(!s)return Promise.reject(new x({type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:y,networkDetails:null},"Fragment does not have a "+(s?"part list":"url")));this.abort();var o=this.config,g=o.fLoader,f=o.loader;return new Promise(function(v,T){u.loader&&u.loader.destroy();var m=u.loader=y.loader=g?new g(o):new f(o),h=_(y),A={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:o.fragLoadingMaxRetryTimeout,highWaterMark:y.sn==="initSegment"?1/0:I};y.stats=m.stats,m.load(h,A,{onSuccess:function(P,k,j,K){u.resetLoader(y,m),v({frag:y,part:null,payload:P.data,networkDetails:K})},onError:function(P,k,j){u.resetLoader(y,m),T(new x({type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:y,response:P,networkDetails:j}))},onAbort:function(P,k,j){u.resetLoader(y,m),T(new x({type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:y,networkDetails:j}))},onTimeout:function(P,k,j){u.resetLoader(y,m),T(new x({type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:y,networkDetails:j}))},onProgress:function(P,k,j,K){E&&E({frag:y,part:null,payload:j,networkDetails:K})}})})},a.loadPart=function(y,E,u){var s=this;this.abort();var o=this.config,g=o.fLoader,f=o.loader;return new Promise(function(v,T){s.loader&&s.loader.destroy();var m=s.loader=y.loader=g?new g(o):new f(o),h=_(y,E),A={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:o.fragLoadingMaxRetryTimeout,highWaterMark:I};E.stats=m.stats,m.load(h,A,{onSuccess:function(P,k,j,K){s.resetLoader(y,m),s.updateStatsFromPart(y,E);var W={frag:y,part:E,payload:P.data,networkDetails:K};u(W),v(W)},onError:function(P,k,j){s.resetLoader(y,m),T(new x({type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:y,part:E,response:P,networkDetails:j}))},onAbort:function(P,k,j){y.stats.aborted=E.stats.aborted,s.resetLoader(y,m),T(new x({type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:y,part:E,networkDetails:j}))},onTimeout:function(P,k,j){s.resetLoader(y,m),T(new x({type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:y,part:E,networkDetails:j}))}})})},a.updateStatsFromPart=function(y,E){var u=y.stats,s=E.stats,o=s.total;if(u.loaded+=s.loaded,o){var g=Math.round(y.duration/E.duration),f=Math.min(Math.round(u.loaded/o),g),v=g-f,T=v*Math.round(u.loaded/f);u.total=u.loaded+T}else u.total=Math.max(u.loaded,u.total);var m=u.loading,h=s.loading;m.start?m.first+=h.first-h.start:(m.start=h.start,m.first=h.first),m.end=h.end},a.resetLoader=function(y,E){y.loader=null,this.loader===E&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),E.destroy()},l}();function _(l,a){a===void 0&&(a=null);var d=a||l,y={frag:l,part:a,responseType:"arraybuffer",url:d.url,headers:{},rangeStart:0,rangeEnd:0},E=d.byteRangeStartOffset,u=d.byteRangeEndOffset;return Object(D.isFiniteNumber)(E)&&Object(D.isFiniteNumber)(u)&&(y.rangeStart=E,y.rangeEnd=u),y}var x=function(l){p(a,l);function a(d){for(var y,E=arguments.length,u=new Array(E>1?E-1:0),s=1;s<E;s++)u[s-1]=arguments[s];return y=l.call.apply(l,[this].concat(u))||this,y.data=void 0,y.data=d,y}return a}(w(Error))},"./src/loader/fragment.ts":function(n,i,r){r.r(i),r.d(i,"ElementaryStreamTypes",function(){return I}),r.d(i,"BaseSegment",function(){return L}),r.d(i,"Fragment",function(){return _}),r.d(i,"Part",function(){return x});var D=r("./src/polyfills/number.ts"),c=r("./node_modules/url-toolkit/src/url-toolkit.js"),p=r("./src/utils/logger.ts"),w=r("./src/loader/level-key.ts"),M=r("./src/loader/load-stats.ts");function O(l,a){l.prototype=Object.create(a.prototype),l.prototype.constructor=l,C(l,a)}function C(l,a){return C=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,E){return y.__proto__=E,y},C(l,a)}function S(l,a){for(var d=0;d<a.length;d++){var y=a[d];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(l,y.key,y)}}function b(l,a,d){return a&&S(l.prototype,a),d&&S(l,d),Object.defineProperty(l,"prototype",{writable:!1}),l}var I;(function(l){l.AUDIO="audio",l.VIDEO="video",l.AUDIOVIDEO="audiovideo"})(I||(I={}));var L=function(){function l(d){var y;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(y={},y[I.AUDIO]=null,y[I.VIDEO]=null,y[I.AUDIOVIDEO]=null,y),this.baseurl=d}var a=l.prototype;return a.setByteRange=function(y,E){var u=y.split("@",2),s=[];u.length===1?s[0]=E?E.byteRangeEndOffset:0:s[0]=parseInt(u[1]),s[1]=parseInt(u[0])+s[0],this._byteRange=s},b(l,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(c.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(y){this._url=y}}]),l}(),_=function(l){O(a,l);function a(y,E){var u;return u=l.call(this,E)||this,u._decryptdata=null,u.rawProgramDateTime=null,u.programDateTime=null,u.tagList=[],u.duration=0,u.sn=0,u.levelkey=void 0,u.type=void 0,u.loader=null,u.level=-1,u.cc=0,u.startPTS=void 0,u.endPTS=void 0,u.appendedPTS=void 0,u.startDTS=void 0,u.endDTS=void 0,u.start=0,u.deltaPTS=void 0,u.maxStartPTS=void 0,u.minEndPTS=void 0,u.stats=new M.LoadStats,u.urlId=0,u.data=void 0,u.bitrateTest=!1,u.title=null,u.initSegment=null,u.type=y,u}var d=a.prototype;return d.createInitializationVector=function(E){for(var u=new Uint8Array(16),s=12;s<16;s++)u[s]=E>>8*(15-s)&255;return u},d.setDecryptDataFromLevelKey=function(E,u){var s=E;return(E==null?void 0:E.method)==="AES-128"&&E.uri&&!E.iv&&(s=w.LevelKey.fromURI(E.uri),s.method=E.method,s.iv=this.createInitializationVector(u),s.keyFormat="identity"),s},d.setElementaryStreamInfo=function(E,u,s,o,g,f){f===void 0&&(f=!1);var v=this.elementaryStreams,T=v[E];if(!T){v[E]={startPTS:u,endPTS:s,startDTS:o,endDTS:g,partial:f};return}T.startPTS=Math.min(T.startPTS,u),T.endPTS=Math.max(T.endPTS,s),T.startDTS=Math.min(T.startDTS,o),T.endDTS=Math.max(T.endDTS,g)},d.clearElementaryStreamInfo=function(){var E=this.elementaryStreams;E[I.AUDIO]=null,E[I.VIDEO]=null,E[I.AUDIOVIDEO]=null},b(a,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var E=this.sn;typeof E!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&p.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),E=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,E)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(D.isFiniteNumber)(this.programDateTime))return null;var E=Object(D.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+E*1e3}},{key:"encrypted",get:function(){var E;return!!((E=this.decryptdata)!==null&&E!==void 0&&E.keyFormat&&this.decryptdata.uri)}}]),a}(L),x=function(l){O(a,l);function a(d,y,E,u,s){var o;o=l.call(this,E)||this,o.fragOffset=0,o.duration=0,o.gap=!1,o.independent=!1,o.relurl=void 0,o.fragment=void 0,o.index=void 0,o.stats=new M.LoadStats,o.duration=d.decimalFloatingPoint("DURATION"),o.gap=d.bool("GAP"),o.independent=d.bool("INDEPENDENT"),o.relurl=d.enumeratedString("URI"),o.fragment=y,o.index=u;var g=d.enumeratedString("BYTERANGE");return g&&o.setByteRange(g,s),s&&(o.fragOffset=s.fragOffset+s.duration),o}return b(a,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var y=this.elementaryStreams;return!!(y.audio||y.video||y.audiovideo)}}]),a}(L)},"./src/loader/key-loader.ts":function(n,i,r){r.r(i),r.d(i,"default",function(){return w});var D=r("./src/events.ts"),c=r("./src/errors.ts"),p=r("./src/utils/logger.ts"),w=function(){function M(C){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=C,this.registerListeners()}var O=M.prototype;return O.startLoad=function(S){},O.stopLoad=function(){this.destroyInternalLoaders()},O.registerListeners=function(){this.hls.on(D.Events.KEY_LOADING,this.onKeyLoading,this)},O.unregisterListeners=function(){this.hls.off(D.Events.KEY_LOADING,this.onKeyLoading)},O.destroyInternalLoaders=function(){for(var S in this.loaders){var b=this.loaders[S];b&&b.destroy()}this.loaders={}},O.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},O.onKeyLoading=function(S,b){var I=b.frag,L=I.type,_=this.loaders[L];if(!I.decryptdata){p.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var x=I.decryptdata.uri;if(x!==this.decrypturl||this.decryptkey===null){var l=this.hls.config;if(_&&(p.logger.warn("abort previous key loader for type:"+L),_.abort()),!x){p.logger.warn("key uri is falsy");return}var a=l.loader,d=I.loader=this.loaders[L]=new a(l);this.decrypturl=x,this.decryptkey=null;var y={url:x,frag:I,responseType:"arraybuffer"},E={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:l.fragLoadingRetryDelay,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:0},u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};d.load(y,E,u)}else this.decryptkey&&(I.decryptdata.key=this.decryptkey,this.hls.trigger(D.Events.KEY_LOADED,{frag:I}))},O.loadsuccess=function(S,b,I){var L=I.frag;if(!L.decryptdata){p.logger.error("after key load, decryptdata unset");return}this.decryptkey=L.decryptdata.key=new Uint8Array(S.data),L.loader=null,delete this.loaders[L.type],this.hls.trigger(D.Events.KEY_LOADED,{frag:L})},O.loaderror=function(S,b){var I=b.frag,L=I.loader;L&&L.abort(),delete this.loaders[I.type],this.hls.trigger(D.Events.ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:I,response:S})},O.loadtimeout=function(S,b){var I=b.frag,L=I.loader;L&&L.abort(),delete this.loaders[I.type],this.hls.trigger(D.Events.ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:I})},M}()},"./src/loader/level-details.ts":function(n,i,r){r.r(i),r.d(i,"LevelDetails",function(){return M});var D=r("./src/polyfills/number.ts");function c(O,C){for(var S=0;S<C.length;S++){var b=C[S];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(O,b.key,b)}}function p(O,C,S){return C&&c(O.prototype,C),S&&c(O,S),Object.defineProperty(O,"prototype",{writable:!1}),O}var w=10,M=function(){function O(S){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=S}var C=O.prototype;return C.reloaded=function(b){if(!b){this.advanced=!0,this.updated=!0;return}var I=this.lastPartSn-b.lastPartSn,L=this.lastPartIndex-b.lastPartIndex;this.updated=this.endSN!==b.endSN||!!L||!!I,this.advanced=this.endSN>b.endSN||I>0||I===0&&L>0,this.updated||this.advanced?this.misses=Math.floor(b.misses*.6):this.misses=b.misses+1,this.availabilityDelay=b.availabilityDelay},p(O,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(D.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||w}},{key:"drift",get:function(){var b=this.driftEndTime-this.driftStartTime;if(b>0){var I=this.driftEnd-this.driftStart;return I*1e3/b}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var b;return(b=this.partList)!==null&&b!==void 0&&b.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var b;return(b=this.fragments)!==null&&b!==void 0&&b.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var b;return(b=this.partList)!==null&&b!==void 0&&b.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var b;return(b=this.partList)!==null&&b!==void 0&&b.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),O}()},"./src/loader/level-key.ts":function(n,i,r){r.r(i),r.d(i,"LevelKey",function(){return w});var D=r("./node_modules/url-toolkit/src/url-toolkit.js");function c(M,O){for(var C=0;C<O.length;C++){var S=O[C];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(M,S.key,S)}}function p(M,O,C){return O&&c(M.prototype,O),C&&c(M,C),Object.defineProperty(M,"prototype",{writable:!1}),M}var w=function(){M.fromURL=function(C,S){return new M(C,S)},M.fromURI=function(C){return new M(C)};function M(O,C){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,C?this._uri=Object(D.buildAbsoluteURL)(O,C,{alwaysNormalize:!0}):this._uri=O}return p(M,[{key:"uri",get:function(){return this._uri}}]),M}()},"./src/loader/load-stats.ts":function(n,i,r){r.r(i),r.d(i,"LoadStats",function(){return D});var D=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(n,i,r){r.r(i),r.d(i,"default",function(){return d});var D=r("./src/polyfills/number.ts"),c=r("./node_modules/url-toolkit/src/url-toolkit.js"),p=r("./src/loader/date-range.ts"),w=r("./src/loader/fragment.ts"),M=r("./src/loader/level-details.ts"),O=r("./src/loader/level-key.ts"),C=r("./src/utils/attr-list.ts"),S=r("./src/utils/logger.ts"),b=r("./src/utils/codecs.ts"),I=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,L=/#EXT-X-MEDIA:(.*)/g,_=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),x=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),l=/\.(mp4|m4s|m4v|m4a)$/i;function a(g){var f,v;return l.test((f=(v=c.parseURL(g))===null||v===void 0?void 0:v.path)!=null?f:"")}var d=function(){function g(){}return g.findGroup=function(v,T){for(var m=0;m<v.length;m++){var h=v[m];if(h.id===T)return h}},g.convertAVC1ToAVCOTI=function(v){var T=v.split(".");if(T.length>2){var m=T.shift()+".";return m+=parseInt(T.shift()).toString(16),m+=("000"+parseInt(T.shift()).toString(16)).slice(-4),m}return v},g.resolve=function(v,T){return c.buildAbsoluteURL(T,v,{alwaysNormalize:!0})},g.parseMasterPlaylist=function(v,T){var m=[],h={},A=!1;I.lastIndex=0;for(var R;(R=I.exec(v))!=null;)if(R[1]){var P=new C.AttrList(R[1]),k={attrs:P,bitrate:P.decimalInteger("AVERAGE-BANDWIDTH")||P.decimalInteger("BANDWIDTH"),name:P.NAME,url:g.resolve(R[2],T)},j=P.decimalResolution("RESOLUTION");j&&(k.width=j.width,k.height=j.height),y((P.CODECS||"").split(/[ ,]+/).filter(function(W){return W}),k),k.videoCodec&&k.videoCodec.indexOf("avc1")!==-1&&(k.videoCodec=g.convertAVC1ToAVCOTI(k.videoCodec)),m.push(k)}else if(R[3]){var K=new C.AttrList(R[3]);K["DATA-ID"]&&(A=!0,h[K["DATA-ID"]]=K)}return{levels:m,sessionData:A?h:null}},g.parseMasterPlaylistMedia=function(v,T,m,h){h===void 0&&(h=[]);var A,R=[],P=0;for(L.lastIndex=0;(A=L.exec(v))!==null;){var k=new C.AttrList(A[1]);if(k.TYPE===m){var j={attrs:k,bitrate:0,id:P++,groupId:k["GROUP-ID"],instreamId:k["INSTREAM-ID"],name:k.NAME||k.LANGUAGE||"",type:m,default:k.bool("DEFAULT"),autoselect:k.bool("AUTOSELECT"),forced:k.bool("FORCED"),lang:k.LANGUAGE,url:k.URI?g.resolve(k.URI,T):""};if(h.length){var K=g.findGroup(h,j.groupId)||h[0];E(j,K,"audioCodec"),E(j,K,"textCodec")}R.push(j)}}return R},g.parseLevelPlaylist=function(v,T,m,h,A){var R=new M.LevelDetails(T),P=R.fragments,k=null,j=0,K=0,W=0,H=0,$=null,z=new w.Fragment(h,T),J,ee,re,ne=-1,ae=!1;for(_.lastIndex=0,R.m3u8=v;(J=_.exec(v))!==null;){ae&&(ae=!1,z=new w.Fragment(h,T),z.start=W,z.sn=j,z.cc=H,z.level=m,k&&(z.initSegment=k,z.rawProgramDateTime=k.rawProgramDateTime,k.rawProgramDateTime=null));var ce=J[1];if(ce){z.duration=parseFloat(ce);var fe=(" "+J[2]).slice(1);z.title=fe||null,z.tagList.push(fe?["INF",ce,fe]:["INF",ce])}else if(J[3])Object(D.isFiniteNumber)(z.duration)&&(z.start=W,re&&(z.levelkey=re),z.sn=j,z.level=m,z.cc=H,z.urlId=A,P.push(z),z.relurl=(" "+J[3]).slice(1),s(z,$),$=z,W+=z.duration,j++,K=0,ae=!0);else if(J[4]){var se=(" "+J[4]).slice(1);$?z.setByteRange(se,$):z.setByteRange(se)}else if(J[5])z.rawProgramDateTime=(" "+J[5]).slice(1),z.tagList.push(["PROGRAM-DATE-TIME",z.rawProgramDateTime]),ne===-1&&(ne=P.length);else{if(J=J[0].match(x),!J){S.logger.warn("No matches on slow regex match for level playlist!");continue}for(ee=1;ee<J.length&&!(typeof J[ee]<"u");ee++);var ve=(" "+J[ee]).slice(1),le=(" "+J[ee+1]).slice(1),ue=J[ee+2]?(" "+J[ee+2]).slice(1):"";switch(ve){case"PLAYLIST-TYPE":R.type=le.toUpperCase();break;case"MEDIA-SEQUENCE":j=R.startSN=parseInt(le);break;case"SKIP":{var Ce=new C.AttrList(le),be=Ce.decimalInteger("SKIPPED-SEGMENTS");if(Object(D.isFiniteNumber)(be)){R.skippedSegments=be;for(var Le=be;Le--;)P.unshift(null);j+=be}var Ue=Ce.enumeratedString("RECENTLY-REMOVED-DATERANGES");Ue&&(R.recentlyRemovedDateranges=Ue.split("	"));break}case"TARGETDURATION":R.targetduration=parseFloat(le);break;case"VERSION":R.version=parseInt(le);break;case"EXTM3U":break;case"ENDLIST":R.live=!1;break;case"#":(le||ue)&&z.tagList.push(ue?[le,ue]:[le]);break;case"DISCONTINUITY":H++,z.tagList.push(["DIS"]);break;case"GAP":z.tagList.push([ve]);break;case"BITRATE":z.tagList.push([ve,le]);break;case"DATERANGE":{var we=new C.AttrList(le),Ke=new p.DateRange(we,R.dateRanges[we.ID]);Ke.isValid||R.skippedSegments?R.dateRanges[Ke.id]=Ke:S.logger.warn('Ignoring invalid DATERANGE tag: "'+le+'"'),z.tagList.push(["EXT-X-DATERANGE",le]);break}case"DISCONTINUITY-SEQUENCE":H=parseInt(le);break;case"KEY":{var ze,je=new C.AttrList(le),Qe=je.enumeratedString("METHOD"),ct=je.URI,Et=je.hexadecimalInteger("IV"),ot=je.enumeratedString("KEYFORMATVERSIONS"),lt=je.enumeratedString("KEYID"),yt=(ze=je.enumeratedString("KEYFORMAT"))!=null?ze:"identity",ut=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(ut.indexOf(yt)>-1){S.logger.warn("Keyformat "+yt+" is not supported from the manifest");continue}else if(yt!=="identity")continue;Qe&&(re=O.LevelKey.fromURL(T,ct),ct&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(Qe)>=0&&(re.method=Qe,re.keyFormat=yt,lt&&(re.keyID=lt),ot&&(re.keyFormatVersions=ot),re.iv=Et));break}case"START":{var kt=new C.AttrList(le),Be=kt.decimalFloatingPoint("TIME-OFFSET");Object(D.isFiniteNumber)(Be)&&(R.startTimeOffset=Be);break}case"MAP":{var We=new C.AttrList(le);if(z.duration){var ft=new w.Fragment(h,T);o(ft,We,m,re),k=ft,z.initSegment=k,k.rawProgramDateTime&&!z.rawProgramDateTime&&(z.rawProgramDateTime=k.rawProgramDateTime)}else o(z,We,m,re),k=z,ae=!0;break}case"SERVER-CONTROL":{var Fe=new C.AttrList(le);R.canBlockReload=Fe.bool("CAN-BLOCK-RELOAD"),R.canSkipUntil=Fe.optionalFloat("CAN-SKIP-UNTIL",0),R.canSkipDateRanges=R.canSkipUntil>0&&Fe.bool("CAN-SKIP-DATERANGES"),R.partHoldBack=Fe.optionalFloat("PART-HOLD-BACK",0),R.holdBack=Fe.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Ge=new C.AttrList(le);R.partTarget=Ge.decimalFloatingPoint("PART-TARGET");break}case"PART":{var ht=R.partList;ht||(ht=R.partList=[]);var Ut=K>0?ht[ht.length-1]:void 0,Wt=K++,tr=new w.Part(new C.AttrList(le),z,T,Wt,Ut);ht.push(tr),z.duration+=tr.duration;break}case"PRELOAD-HINT":{var Ct=new C.AttrList(le);R.preloadHint=Ct;break}case"RENDITION-REPORT":{var pr=new C.AttrList(le);R.renditionReports=R.renditionReports||[],R.renditionReports.push(pr);break}default:S.logger.warn("line parsed but not handled: "+J);break}}}$&&!$.relurl?(P.pop(),W-=$.duration,R.partList&&(R.fragmentHint=$)):R.partList&&(s(z,$),z.cc=H,R.fragmentHint=z);var Qt=P.length,Ft=P[0],Zt=P[Qt-1];if(W+=R.skippedSegments*R.targetduration,W>0&&Qt&&Zt){R.averagetargetduration=W/Qt;var Jt=Zt.sn;R.endSN=Jt!=="initSegment"?Jt:0,Ft&&(R.startCC=Ft.cc,Ft.initSegment||R.fragments.every(function(fr){return fr.relurl&&a(fr.relurl)})&&(S.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),z=new w.Fragment(h,T),z.relurl=Zt.relurl,z.level=m,z.sn="initSegment",Ft.initSegment=z,R.needSidxRanges=!0))}else R.endSN=0,R.startCC=0;return R.fragmentHint&&(W+=R.fragmentHint.duration),R.totalduration=W,R.endCC=H,ne>0&&u(P,ne),R},g}();function y(g,f){["video","audio","text"].forEach(function(v){var T=g.filter(function(h){return Object(b.isCodecType)(h,v)});if(T.length){var m=T.filter(function(h){return h.lastIndexOf("avc1",0)===0||h.lastIndexOf("mp4a",0)===0});f[v+"Codec"]=m.length>0?m[0]:T[0],g=g.filter(function(h){return T.indexOf(h)===-1})}}),f.unknownCodecs=g}function E(g,f,v){var T=f[v];T&&(g[v]=T)}function u(g,f){for(var v=g[f],T=f;T--;){var m=g[T];if(!m)return;m.programDateTime=v.programDateTime-m.duration*1e3,v=m}}function s(g,f){g.rawProgramDateTime?g.programDateTime=Date.parse(g.rawProgramDateTime):f!=null&&f.programDateTime&&(g.programDateTime=f.endProgramDateTime),Object(D.isFiniteNumber)(g.programDateTime)||(g.programDateTime=null,g.rawProgramDateTime=null)}function o(g,f,v,T){g.relurl=f.URI,f.BYTERANGE&&g.setByteRange(f.BYTERANGE),g.level=v,g.sn="initSegment",T&&(g.levelkey=T),g.initSegment=null}},"./src/loader/playlist-loader.ts":function(n,i,r){r.r(i);var D=r("./src/polyfills/number.ts"),c=r("./src/events.ts"),p=r("./src/errors.ts"),w=r("./src/utils/logger.ts"),M=r("./src/utils/mp4-tools.ts"),O=r("./src/loader/m3u8-parser.ts"),C=r("./src/types/loader.ts"),S=r("./src/utils/attr-list.ts");function b(_){var x=_.type;switch(x){case C.PlaylistContextType.AUDIO_TRACK:return C.PlaylistLevelType.AUDIO;case C.PlaylistContextType.SUBTITLE_TRACK:return C.PlaylistLevelType.SUBTITLE;default:return C.PlaylistLevelType.MAIN}}function I(_,x){var l=_.url;return(l===void 0||l.indexOf("data:")===0)&&(l=x.url),l}var L=function(){function _(l){this.hls=void 0,this.loaders=Object.create(null),this.hls=l,this.registerListeners()}var x=_.prototype;return x.startLoad=function(a){},x.stopLoad=function(){this.destroyInternalLoaders()},x.registerListeners=function(){var a=this.hls;a.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(c.Events.LEVEL_LOADING,this.onLevelLoading,this),a.on(c.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),a.on(c.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},x.unregisterListeners=function(){var a=this.hls;a.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(c.Events.LEVEL_LOADING,this.onLevelLoading,this),a.off(c.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),a.off(c.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},x.createInternalLoader=function(a){var d=this.hls.config,y=d.pLoader,E=d.loader,u=y||E,s=new u(d);return a.loader=s,this.loaders[a.type]=s,s},x.getInternalLoader=function(a){return this.loaders[a.type]},x.resetInternalLoader=function(a){this.loaders[a]&&delete this.loaders[a]},x.destroyInternalLoaders=function(){for(var a in this.loaders){var d=this.loaders[a];d&&d.destroy(),this.resetInternalLoader(a)}},x.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},x.onManifestLoading=function(a,d){var y=d.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:C.PlaylistContextType.MANIFEST,url:y,deliveryDirectives:null})},x.onLevelLoading=function(a,d){var y=d.id,E=d.level,u=d.url,s=d.deliveryDirectives;this.load({id:y,groupId:null,level:E,responseType:"text",type:C.PlaylistContextType.LEVEL,url:u,deliveryDirectives:s})},x.onAudioTrackLoading=function(a,d){var y=d.id,E=d.groupId,u=d.url,s=d.deliveryDirectives;this.load({id:y,groupId:E,level:null,responseType:"text",type:C.PlaylistContextType.AUDIO_TRACK,url:u,deliveryDirectives:s})},x.onSubtitleTrackLoading=function(a,d){var y=d.id,E=d.groupId,u=d.url,s=d.deliveryDirectives;this.load({id:y,groupId:E,level:null,responseType:"text",type:C.PlaylistContextType.SUBTITLE_TRACK,url:u,deliveryDirectives:s})},x.load=function(a){var d,y=this.hls.config,E=this.getInternalLoader(a);if(E){var u=E.context;if(u&&u.url===a.url){w.logger.trace("[playlist-loader]: playlist request ongoing");return}w.logger.log("[playlist-loader]: aborting previous loader for type: "+a.type),E.abort()}var s,o,g,f;switch(a.type){case C.PlaylistContextType.MANIFEST:s=y.manifestLoadingMaxRetry,o=y.manifestLoadingTimeOut,g=y.manifestLoadingRetryDelay,f=y.manifestLoadingMaxRetryTimeout;break;case C.PlaylistContextType.LEVEL:case C.PlaylistContextType.AUDIO_TRACK:case C.PlaylistContextType.SUBTITLE_TRACK:s=0,o=y.levelLoadingTimeOut;break;default:s=y.levelLoadingMaxRetry,o=y.levelLoadingTimeOut,g=y.levelLoadingRetryDelay,f=y.levelLoadingMaxRetryTimeout;break}if(E=this.createInternalLoader(a),(d=a.deliveryDirectives)!==null&&d!==void 0&&d.part){var v;if(a.type===C.PlaylistContextType.LEVEL&&a.level!==null?v=this.hls.levels[a.level].details:a.type===C.PlaylistContextType.AUDIO_TRACK&&a.id!==null?v=this.hls.audioTracks[a.id].details:a.type===C.PlaylistContextType.SUBTITLE_TRACK&&a.id!==null&&(v=this.hls.subtitleTracks[a.id].details),v){var T=v.partTarget,m=v.targetduration;T&&m&&(o=Math.min(Math.max(T*3,m*.8)*1e3,o))}}var h={timeout:o,maxRetry:s,retryDelay:g,maxRetryDelay:f,highWaterMark:0},A={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};E.load(a,h,A)},x.loadsuccess=function(a,d,y,E){if(E===void 0&&(E=null),y.isSidxRequest){this.handleSidxRequest(a,y),this.handlePlaylistLoaded(a,d,y,E);return}this.resetInternalLoader(y.type);var u=a.data;if(u.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(a,y,"no EXTM3U delimiter",E);return}d.parsing.start=performance.now(),u.indexOf("#EXTINF:")>0||u.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(a,d,y,E):this.handleMasterPlaylist(a,d,y,E)},x.loaderror=function(a,d,y){y===void 0&&(y=null),this.handleNetworkError(d,y,!1,a)},x.loadtimeout=function(a,d,y){y===void 0&&(y=null),this.handleNetworkError(d,y,!0)},x.handleMasterPlaylist=function(a,d,y,E){var u=this.hls,s=a.data,o=I(a,y),g=O.default.parseMasterPlaylist(s,o),f=g.levels,v=g.sessionData;if(!f.length){this.handleManifestParsingError(a,y,"no level found in manifest",E);return}var T=f.map(function(k){return{id:k.attrs.AUDIO,audioCodec:k.audioCodec}}),m=f.map(function(k){return{id:k.attrs.SUBTITLES,textCodec:k.textCodec}}),h=O.default.parseMasterPlaylistMedia(s,o,"AUDIO",T),A=O.default.parseMasterPlaylistMedia(s,o,"SUBTITLES",m),R=O.default.parseMasterPlaylistMedia(s,o,"CLOSED-CAPTIONS");if(h.length){var P=h.some(function(k){return!k.url});!P&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(w.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),h.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new S.AttrList({}),bitrate:0,url:""}))}u.trigger(c.Events.MANIFEST_LOADED,{levels:f,audioTracks:h,subtitles:A,captions:R,url:o,stats:d,networkDetails:E,sessionData:v})},x.handleTrackOrLevelPlaylist=function(a,d,y,E){var u=this.hls,s=y.id,o=y.level,g=y.type,f=I(a,y),v=Object(D.isFiniteNumber)(s)?s:0,T=Object(D.isFiniteNumber)(o)?o:v,m=b(y),h=O.default.parseLevelPlaylist(a.data,f,T,m,v);if(!h.fragments.length){u.trigger(c.Events.ERROR,{type:p.ErrorTypes.NETWORK_ERROR,details:p.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:f,reason:"no fragments found in level",level:typeof y.level=="number"?y.level:void 0});return}if(g===C.PlaylistContextType.MANIFEST){var A={attrs:new S.AttrList({}),bitrate:0,details:h,name:"",url:f};u.trigger(c.Events.MANIFEST_LOADED,{levels:[A],audioTracks:[],url:f,stats:d,networkDetails:E,sessionData:null})}if(d.parsing.end=performance.now(),h.needSidxRanges){var R,P=(R=h.fragments[0].initSegment)===null||R===void 0?void 0:R.url;this.load({url:P,isSidxRequest:!0,type:g,level:o,levelDetails:h,id:s,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}y.levelDetails=h,this.handlePlaylistLoaded(a,d,y,E)},x.handleSidxRequest=function(a,d){var y=new Uint8Array(a.data),E=Object(M.findBox)(y,["sidx"])[0];if(!!E){var u=Object(M.parseSegmentIndex)(E);if(!!u){var s=u.references,o=d.levelDetails;s.forEach(function(g,f){var v=g.info,T=o.fragments[f];if(T.byteRange.length===0&&T.setByteRange(String(1+v.end-v.start)+"@"+String(v.start)),T.initSegment){var m=Object(M.findBox)(y,["moov"])[0],h=m?m.length:null;T.initSegment.setByteRange(String(h)+"@0")}})}}},x.handleManifestParsingError=function(a,d,y,E){this.hls.trigger(c.Events.ERROR,{type:p.ErrorTypes.NETWORK_ERROR,details:p.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:d.type===C.PlaylistContextType.MANIFEST,url:a.url,reason:y,response:a,context:d,networkDetails:E})},x.handleNetworkError=function(a,d,y,E){y===void 0&&(y=!1),w.logger.warn("[playlist-loader]: A network "+(y?"timeout":"error")+" occurred while loading "+a.type+" level: "+a.level+" id: "+a.id+' group-id: "'+a.groupId+'"');var u=p.ErrorDetails.UNKNOWN,s=!1,o=this.getInternalLoader(a);switch(a.type){case C.PlaylistContextType.MANIFEST:u=y?p.ErrorDetails.MANIFEST_LOAD_TIMEOUT:p.ErrorDetails.MANIFEST_LOAD_ERROR,s=!0;break;case C.PlaylistContextType.LEVEL:u=y?p.ErrorDetails.LEVEL_LOAD_TIMEOUT:p.ErrorDetails.LEVEL_LOAD_ERROR,s=!1;break;case C.PlaylistContextType.AUDIO_TRACK:u=y?p.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:p.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,s=!1;break;case C.PlaylistContextType.SUBTITLE_TRACK:u=y?p.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:p.ErrorDetails.SUBTITLE_LOAD_ERROR,s=!1;break}o&&this.resetInternalLoader(a.type);var g={type:p.ErrorTypes.NETWORK_ERROR,details:u,fatal:s,url:a.url,loader:o,context:a,networkDetails:d};E&&(g.response=E),this.hls.trigger(c.Events.ERROR,g)},x.handlePlaylistLoaded=function(a,d,y,E){var u=y.type,s=y.level,o=y.id,g=y.groupId,f=y.loader,v=y.levelDetails,T=y.deliveryDirectives;if(!(v!=null&&v.targetduration)){this.handleManifestParsingError(a,y,"invalid target duration",E);return}if(!!f)switch(v.live&&(f.getCacheAge&&(v.ageHeader=f.getCacheAge()||0),(!f.getCacheAge||isNaN(v.ageHeader))&&(v.ageHeader=0)),u){case C.PlaylistContextType.MANIFEST:case C.PlaylistContextType.LEVEL:this.hls.trigger(c.Events.LEVEL_LOADED,{details:v,level:s||0,id:o||0,stats:d,networkDetails:E,deliveryDirectives:T});break;case C.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(c.Events.AUDIO_TRACK_LOADED,{details:v,id:o||0,groupId:g||"",stats:d,networkDetails:E,deliveryDirectives:T});break;case C.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(c.Events.SUBTITLE_TRACK_LOADED,{details:v,id:o||0,groupId:g||"",stats:d,networkDetails:E,deliveryDirectives:T});break}},_}();i.default=L},"./src/polyfills/number.ts":function(n,i,r){r.r(i),r.d(i,"isFiniteNumber",function(){return D}),r.d(i,"MAX_SAFE_INTEGER",function(){return c});var D=Number.isFinite||function(p){return typeof p=="number"&&isFinite(p)},c=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(n,i,r){r.r(i);var D=function(){function c(){}return c.getSilentFrame=function(w,M){switch(w){case"mp4a.40.2":if(M===1)return new Uint8Array([0,200,0,128,35,128]);if(M===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(M===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(M===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(M===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(M===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(M===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(M===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(M===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},c}();i.default=D},"./src/remux/mp4-generator.ts":function(n,i,r){r.r(i);var D=Math.pow(2,32)-1,c=function(){function p(){}return p.init=function(){p.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var M;for(M in p.types)p.types.hasOwnProperty(M)&&(p.types[M]=[M.charCodeAt(0),M.charCodeAt(1),M.charCodeAt(2),M.charCodeAt(3)]);var O=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),C=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);p.HDLR_TYPES={video:O,audio:C};var S=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),b=new Uint8Array([0,0,0,0,0,0,0,0]);p.STTS=p.STSC=p.STCO=b,p.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),p.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),p.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),p.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var I=new Uint8Array([105,115,111,109]),L=new Uint8Array([97,118,99,49]),_=new Uint8Array([0,0,0,1]);p.FTYP=p.box(p.types.ftyp,I,_,I,L),p.DINF=p.box(p.types.dinf,p.box(p.types.dref,S))},p.box=function(M){for(var O=8,C=arguments.length,S=new Array(C>1?C-1:0),b=1;b<C;b++)S[b-1]=arguments[b];for(var I=S.length,L=I;I--;)O+=S[I].byteLength;var _=new Uint8Array(O);for(_[0]=O>>24&255,_[1]=O>>16&255,_[2]=O>>8&255,_[3]=O&255,_.set(M,4),I=0,O=8;I<L;I++)_.set(S[I],O),O+=S[I].byteLength;return _},p.hdlr=function(M){return p.box(p.types.hdlr,p.HDLR_TYPES[M])},p.mdat=function(M){return p.box(p.types.mdat,M)},p.mdhd=function(M,O){O*=M;var C=Math.floor(O/(D+1)),S=Math.floor(O%(D+1));return p.box(p.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,M>>24&255,M>>16&255,M>>8&255,M&255,C>>24,C>>16&255,C>>8&255,C&255,S>>24,S>>16&255,S>>8&255,S&255,85,196,0,0]))},p.mdia=function(M){return p.box(p.types.mdia,p.mdhd(M.timescale,M.duration),p.hdlr(M.type),p.minf(M))},p.mfhd=function(M){return p.box(p.types.mfhd,new Uint8Array([0,0,0,0,M>>24,M>>16&255,M>>8&255,M&255]))},p.minf=function(M){return M.type==="audio"?p.box(p.types.minf,p.box(p.types.smhd,p.SMHD),p.DINF,p.stbl(M)):p.box(p.types.minf,p.box(p.types.vmhd,p.VMHD),p.DINF,p.stbl(M))},p.moof=function(M,O,C){return p.box(p.types.moof,p.mfhd(M),p.traf(C,O))},p.moov=function(M){for(var O=M.length,C=[];O--;)C[O]=p.trak(M[O]);return p.box.apply(null,[p.types.moov,p.mvhd(M[0].timescale,M[0].duration)].concat(C).concat(p.mvex(M)))},p.mvex=function(M){for(var O=M.length,C=[];O--;)C[O]=p.trex(M[O]);return p.box.apply(null,[p.types.mvex].concat(C))},p.mvhd=function(M,O){O*=M;var C=Math.floor(O/(D+1)),S=Math.floor(O%(D+1)),b=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,M>>24&255,M>>16&255,M>>8&255,M&255,C>>24,C>>16&255,C>>8&255,C&255,S>>24,S>>16&255,S>>8&255,S&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return p.box(p.types.mvhd,b)},p.sdtp=function(M){var O=M.samples||[],C=new Uint8Array(4+O.length),S,b;for(S=0;S<O.length;S++)b=O[S].flags,C[S+4]=b.dependsOn<<4|b.isDependedOn<<2|b.hasRedundancy;return p.box(p.types.sdtp,C)},p.stbl=function(M){return p.box(p.types.stbl,p.stsd(M),p.box(p.types.stts,p.STTS),p.box(p.types.stsc,p.STSC),p.box(p.types.stsz,p.STSZ),p.box(p.types.stco,p.STCO))},p.avc1=function(M){var O=[],C=[],S,b,I;for(S=0;S<M.sps.length;S++)b=M.sps[S],I=b.byteLength,O.push(I>>>8&255),O.push(I&255),O=O.concat(Array.prototype.slice.call(b));for(S=0;S<M.pps.length;S++)b=M.pps[S],I=b.byteLength,C.push(I>>>8&255),C.push(I&255),C=C.concat(Array.prototype.slice.call(b));var L=p.box(p.types.avcC,new Uint8Array([1,O[3],O[4],O[5],255,224|M.sps.length].concat(O).concat([M.pps.length]).concat(C))),_=M.width,x=M.height,l=M.pixelRatio[0],a=M.pixelRatio[1];return p.box(p.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,_>>8&255,_&255,x>>8&255,x&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),L,p.box(p.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),p.box(p.types.pasp,new Uint8Array([l>>24,l>>16&255,l>>8&255,l&255,a>>24,a>>16&255,a>>8&255,a&255])))},p.esds=function(M){var O=M.config.length;return new Uint8Array([0,0,0,0,3,23+O,0,1,0,4,15+O,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([O]).concat(M.config).concat([6,1,2]))},p.mp4a=function(M){var O=M.samplerate;return p.box(p.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,M.channelCount,0,16,0,0,0,0,O>>8&255,O&255,0,0]),p.box(p.types.esds,p.esds(M)))},p.mp3=function(M){var O=M.samplerate;return p.box(p.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,M.channelCount,0,16,0,0,0,0,O>>8&255,O&255,0,0]))},p.stsd=function(M){return M.type==="audio"?M.segmentCodec==="mp3"&&M.codec==="mp3"?p.box(p.types.stsd,p.STSD,p.mp3(M)):p.box(p.types.stsd,p.STSD,p.mp4a(M)):p.box(p.types.stsd,p.STSD,p.avc1(M))},p.tkhd=function(M){var O=M.id,C=M.duration*M.timescale,S=M.width,b=M.height,I=Math.floor(C/(D+1)),L=Math.floor(C%(D+1));return p.box(p.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,O>>24&255,O>>16&255,O>>8&255,O&255,0,0,0,0,I>>24,I>>16&255,I>>8&255,I&255,L>>24,L>>16&255,L>>8&255,L&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,S>>8&255,S&255,0,0,b>>8&255,b&255,0,0]))},p.traf=function(M,O){var C=p.sdtp(M),S=M.id,b=Math.floor(O/(D+1)),I=Math.floor(O%(D+1));return p.box(p.types.traf,p.box(p.types.tfhd,new Uint8Array([0,0,0,0,S>>24,S>>16&255,S>>8&255,S&255])),p.box(p.types.tfdt,new Uint8Array([1,0,0,0,b>>24,b>>16&255,b>>8&255,b&255,I>>24,I>>16&255,I>>8&255,I&255])),p.trun(M,C.length+16+20+8+16+8+8),C)},p.trak=function(M){return M.duration=M.duration||4294967295,p.box(p.types.trak,p.tkhd(M),p.mdia(M))},p.trex=function(M){var O=M.id;return p.box(p.types.trex,new Uint8Array([0,0,0,0,O>>24,O>>16&255,O>>8&255,O&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},p.trun=function(M,O){var C=M.samples||[],S=C.length,b=12+16*S,I=new Uint8Array(b),L,_,x,l,a,d;for(O+=8+b,I.set([M.type==="video"?1:0,0,15,1,S>>>24&255,S>>>16&255,S>>>8&255,S&255,O>>>24&255,O>>>16&255,O>>>8&255,O&255],0),L=0;L<S;L++)_=C[L],x=_.duration,l=_.size,a=_.flags,d=_.cts,I.set([x>>>24&255,x>>>16&255,x>>>8&255,x&255,l>>>24&255,l>>>16&255,l>>>8&255,l&255,a.isLeading<<2|a.dependsOn,a.isDependedOn<<6|a.hasRedundancy<<4|a.paddingValue<<1|a.isNonSync,a.degradPrio&240<<8,a.degradPrio&15,d>>>24&255,d>>>16&255,d>>>8&255,d&255],12+16*L);return p.box(p.types.trun,I)},p.initSegment=function(M){p.types||p.init();var O=p.moov(M),C=new Uint8Array(p.FTYP.byteLength+O.byteLength);return C.set(p.FTYP),C.set(O,p.FTYP.byteLength),C},p}();c.types=void 0,c.HDLR_TYPES=void 0,c.STTS=void 0,c.STSC=void 0,c.STCO=void 0,c.STSZ=void 0,c.VMHD=void 0,c.SMHD=void 0,c.STSD=void 0,c.FTYP=void 0,c.DINF=void 0,i.default=c},"./src/remux/mp4-remuxer.ts":function(n,i,r){r.r(i),r.d(i,"default",function(){return a}),r.d(i,"normalizePts",function(){return d}),r.d(i,"flushTextTrackMetadataCueSamples",function(){return E}),r.d(i,"flushTextTrackUserdataCueSamples",function(){return u});var D=r("./src/polyfills/number.ts"),c=r("./src/remux/aac-helper.ts"),p=r("./src/remux/mp4-generator.ts"),w=r("./src/events.ts"),M=r("./src/errors.ts"),O=r("./src/utils/logger.ts"),C=r("./src/types/loader.ts"),S=r("./src/utils/timescale-conversion.ts");function b(){return b=Object.assign?Object.assign.bind():function(g){for(var f=1;f<arguments.length;f++){var v=arguments[f];for(var T in v)Object.prototype.hasOwnProperty.call(v,T)&&(g[T]=v[T])}return g},b.apply(this,arguments)}var I=10*1e3,L=1024,_=1152,x=null,l=null,a=function(){function g(v,T,m,h){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=v,this.config=T,this.typeSupported=m,this.ISGenerated=!1,x===null){var A=navigator.userAgent||"",R=A.match(/Chrome\/(\d+)/i);x=R?parseInt(R[1]):0}if(l===null){var P=navigator.userAgent.match(/Safari\/(\d+)/i);l=P?parseInt(P[1]):0}}var f=g.prototype;return f.destroy=function(){},f.resetTimeStamp=function(T){O.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=T},f.resetNextTimestamp=function(){O.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},f.resetInitSegment=function(){O.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},f.getVideoStartPts=function(T){var m=!1,h=T.reduce(function(A,R){var P=R.pts-A;return P<-4294967296?(m=!0,d(A,R.pts)):P>0?A:R.pts},T[0].pts);return m&&O.logger.debug("PTS rollover detected"),h},f.remux=function(T,m,h,A,R,P,k,j){var K,W,H,$,z,J,ee=R,re=R,ne=T.pid>-1,ae=m.pid>-1,ce=m.samples.length,fe=T.samples.length>0,se=k&&ce>0||ce>1,ve=(!ne||fe)&&(!ae||se)||this.ISGenerated||k;if(ve){this.ISGenerated||(H=this.generateIS(T,m,R));var le=this.isVideoContiguous,ue=-1,Ce;if(se&&(ue=y(m.samples),!le&&this.config.forceKeyFrameOnDiscontinuity))if(J=!0,ue>0){O.logger.warn("[mp4-remuxer]: Dropped "+ue+" out of "+ce+" video samples due to a missing keyframe");var be=this.getVideoStartPts(m.samples);m.samples=m.samples.slice(ue),m.dropped+=ue,re+=(m.samples[0].pts-be)/m.inputTimeScale,Ce=re}else ue===-1&&(O.logger.warn("[mp4-remuxer]: No keyframe found out of "+ce+" video samples"),J=!1);if(this.ISGenerated){if(fe&&se){var Le=this.getVideoStartPts(m.samples),Ue=d(T.samples[0].pts,Le)-Le,we=Ue/m.inputTimeScale;ee+=Math.max(0,we),re+=Math.max(0,-we)}if(fe){if(T.samplerate||(O.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),H=this.generateIS(T,m,R)),W=this.remuxAudio(T,ee,this.isAudioContiguous,P,ae||se||j===C.PlaylistLevelType.AUDIO?re:void 0),se){var Ke=W?W.endPTS-W.startPTS:0;m.inputTimeScale||(O.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),H=this.generateIS(T,m,R)),K=this.remuxVideo(m,re,le,Ke)}}else se&&(K=this.remuxVideo(m,re,le,0));K&&(K.firstKeyFrame=ue,K.independent=ue!==-1,K.firstKeyFramePTS=Ce)}}return this.ISGenerated&&(h.samples.length&&(z=E(h,R,this._initPTS,this._initDTS)),A.samples.length&&($=u(A,R,this._initPTS))),{audio:W,video:K,initSegment:H,independent:J,text:$,id3:z}},f.generateIS=function(T,m,h){var A=T.samples,R=m.samples,P=this.typeSupported,k={},j=!Object(D.isFiniteNumber)(this._initPTS),K="audio/mp4",W,H,$;if(j&&(W=H=1/0),T.config&&A.length){switch(T.timescale=T.samplerate,T.segmentCodec){case"mp3":P.mpeg?(K="audio/mpeg",T.codec=""):P.mp3&&(T.codec="mp3");break}k.audio={id:"audio",container:K,codec:T.codec,initSegment:T.segmentCodec==="mp3"&&P.mpeg?new Uint8Array(0):p.default.initSegment([T]),metadata:{channelCount:T.channelCount}},j&&($=T.inputTimeScale,W=H=A[0].pts-Math.round($*h))}if(m.sps&&m.pps&&R.length&&(m.timescale=m.inputTimeScale,k.video={id:"main",container:"video/mp4",codec:m.codec,initSegment:p.default.initSegment([m]),metadata:{width:m.width,height:m.height}},j)){$=m.inputTimeScale;var z=this.getVideoStartPts(R),J=Math.round($*h);H=Math.min(H,d(R[0].dts,z)-J),W=Math.min(W,z-J)}if(Object.keys(k).length)return this.ISGenerated=!0,j&&(this._initPTS=W,this._initDTS=H),{tracks:k,initPTS:W,timescale:$}},f.remuxVideo=function(T,m,h,A){var R=T.inputTimeScale,P=T.samples,k=[],j=P.length,K=this._initPTS,W=this.nextAvcDts,H=8,$=this.videoSampleDuration,z,J,ee=Number.POSITIVE_INFINITY,re=Number.NEGATIVE_INFINITY,ne=!1;if(!h||W===null){var ae=m*R,ce=P[0].pts-d(P[0].dts,P[0].pts);W=ae-ce}for(var fe=0;fe<j;fe++){var se=P[fe];se.pts=d(se.pts-K,W),se.dts=d(se.dts-K,W),se.dts<P[fe>0?fe-1:fe].dts&&(ne=!0)}ne&&P.sort(function(jr,mn){var ni=jr.dts-mn.dts,Bt=jr.pts-mn.pts;return ni||Bt}),z=P[0].dts,J=P[P.length-1].dts;var ve=J-z,le=ve?Math.round(ve/(j-1)):$||T.inputTimeScale/30;if(h){var ue=z-W,Ce=ue>le,be=ue<-1;if(Ce||be){Ce?O.logger.warn("AVC: "+Object(S.toMsFromMpegTsClock)(ue,!0)+" ms ("+ue+"dts) hole between fragments detected, filling it"):O.logger.warn("AVC: "+Object(S.toMsFromMpegTsClock)(-ue,!0)+" ms ("+ue+"dts) overlapping between fragments detected"),z=W;var Le=P[0].pts-ue;P[0].dts=z,P[0].pts=Le,O.logger.log("Video: First PTS/DTS adjusted: "+Object(S.toMsFromMpegTsClock)(Le,!0)+"/"+Object(S.toMsFromMpegTsClock)(z,!0)+", delta: "+Object(S.toMsFromMpegTsClock)(ue,!0)+" ms")}}z=Math.max(0,z);for(var Ue=0,we=0,Ke=0;Ke<j;Ke++){for(var ze=P[Ke],je=ze.units,Qe=je.length,ct=0,Et=0;Et<Qe;Et++)ct+=je[Et].data.length;we+=ct,Ue+=Qe,ze.length=ct,ze.dts=Math.max(ze.dts,z),ee=Math.min(ze.pts,ee),re=Math.max(ze.pts,re)}J=P[j-1].dts;var ot=we+4*Ue+8,lt;try{lt=new Uint8Array(ot)}catch{this.observer.emit(w.Events.ERROR,w.Events.ERROR,{type:M.ErrorTypes.MUX_ERROR,details:M.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ot,reason:"fail allocating video mdat "+ot});return}var yt=new DataView(lt.buffer);yt.setUint32(0,ot),lt.set(p.default.types.mdat,4);for(var ut=!1,kt=Number.POSITIVE_INFINITY,Be=Number.POSITIVE_INFINITY,We=Number.NEGATIVE_INFINITY,ft=Number.NEGATIVE_INFINITY,Fe=0;Fe<j;Fe++){for(var Ge=P[Fe],ht=Ge.units,Ut=0,Wt=0,tr=ht.length;Wt<tr;Wt++){var Ct=ht[Wt],pr=Ct.data,Qt=Ct.data.byteLength;yt.setUint32(H,Qt),H+=4,lt.set(pr,H),H+=Qt,Ut+=4+Qt}var Ft=void 0;if(Fe<j-1)$=P[Fe+1].dts-Ge.dts,Ft=P[Fe+1].pts-Ge.pts;else{var Zt=this.config,Jt=Fe>0?Ge.dts-P[Fe-1].dts:le;if(Ft=Fe>0?Ge.pts-P[Fe-1].pts:le,Zt.stretchShortVideoTrack&&this.nextAudioPts!==null){var fr=Math.floor(Zt.maxBufferHole*R),Er=(A?ee+A*R:this.nextAudioPts)-Ge.pts;Er>fr?($=Er-Jt,$<0?$=Jt:ut=!0,O.logger.log("[mp4-remuxer]: It is approximately "+Er/90+" ms to the next segment; using duration "+$/90+" ms for the last video frame.")):$=Jt}else $=Jt}var hn=Math.round(Ge.pts-Ge.dts);kt=Math.min(kt,$),We=Math.max(We,$),Be=Math.min(Be,Ft),ft=Math.max(ft,Ft),k.push(new s(Ge.key,$,Ut,hn))}if(k.length){if(x){if(x<70){var Ur=k[0].flags;Ur.dependsOn=2,Ur.isNonSync=0}}else if(l&&ft-Be<We-kt&&le/We<.025&&k[0].cts===0){O.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var Fr=z,Dt=0,Br=k.length;Dt<Br;Dt++){var Nr=Fr+k[Dt].duration,ti=Fr+k[Dt].cts;if(Dt<Br-1){var ri=Nr+k[Dt+1].cts;k[Dt].duration=ri-ti}else k[Dt].duration=Dt?k[Dt-1].duration:le;k[Dt].cts=0,Fr=Nr}}}console.assert($!==null,"mp4SampleDuration must be computed"),$=ut||!$?le:$,this.nextAvcDts=W=J+$,this.videoSampleDuration=$,this.isVideoContiguous=!0;var vn=p.default.moof(T.sequenceNumber++,z,b({},T,{samples:k})),gn="video",Kr={data1:vn,data2:lt,startPTS:ee/R,endPTS:(re+$)/R,startDTS:z/R,endDTS:W/R,type:gn,hasAudio:!1,hasVideo:!0,nb:k.length,dropped:T.dropped};return T.samples=[],T.dropped=0,console.assert(lt.length,"MDAT length must not be zero"),Kr},f.remuxAudio=function(T,m,h,A,R){var P=T.inputTimeScale,k=T.samplerate?T.samplerate:P,j=P/k,K=T.segmentCodec==="aac"?L:_,W=K*j,H=this._initPTS,$=T.segmentCodec==="mp3"&&this.typeSupported.mpeg,z=[],J=R!==void 0,ee=T.samples,re=$?0:8,ne=this.nextAudioPts||-1,ae=m*P;if(this.isAudioContiguous=h=h||ee.length&&ne>0&&(A&&Math.abs(ae-ne)<9e3||Math.abs(d(ee[0].pts-H,ae)-ne)<20*W),ee.forEach(function(Ct){Ct.pts=d(Ct.pts-H,ae)}),!h||ne<0){if(ee=ee.filter(function(Ct){return Ct.pts>=0}),!ee.length)return;R===0?ne=0:A&&!J?ne=Math.max(0,ae):ne=ee[0].pts}if(T.segmentCodec==="aac")for(var ce=this.config.maxAudioFramesDrift,fe=0,se=ne;fe<ee.length;fe++){var ve=ee[fe],le=ve.pts,ue=le-se,Ce=Math.abs(1e3*ue/P);if(ue<=-ce*W&&J)fe===0&&(O.logger.warn("Audio frame @ "+(le/P).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*ue/P)+" ms."),this.nextAudioPts=ne=se=le);else if(ue>=ce*W&&Ce<I&&J){var be=Math.round(ue/W);se=le-be*W,se<0&&(be--,se+=W),fe===0&&(this.nextAudioPts=ne=se),O.logger.warn("[mp4-remuxer]: Injecting "+be+" audio frame @ "+(se/P).toFixed(3)+"s due to "+Math.round(1e3*ue/P)+" ms gap.");for(var Le=0;Le<be;Le++){var Ue=Math.max(se,0),we=c.default.getSilentFrame(T.manifestCodec||T.codec,T.channelCount);we||(O.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),we=ve.unit.subarray()),ee.splice(fe,0,{unit:we,pts:Ue}),se+=W,fe++}}ve.pts=se,se+=W}for(var Ke=null,ze=null,je,Qe=0,ct=ee.length;ct--;)Qe+=ee[ct].unit.byteLength;for(var Et=0,ot=ee.length;Et<ot;Et++){var lt=ee[Et],yt=lt.unit,ut=lt.pts;if(ze!==null){var kt=z[Et-1];kt.duration=Math.round((ut-ze)/j)}else if(h&&T.segmentCodec==="aac"&&(ut=ne),Ke=ut,Qe>0){Qe+=re;try{je=new Uint8Array(Qe)}catch{this.observer.emit(w.Events.ERROR,w.Events.ERROR,{type:M.ErrorTypes.MUX_ERROR,details:M.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Qe,reason:"fail allocating audio mdat "+Qe});return}if(!$){var Be=new DataView(je.buffer);Be.setUint32(0,Qe),je.set(p.default.types.mdat,4)}}else return;je.set(yt,re);var We=yt.byteLength;re+=We,z.push(new s(!0,K,We,0)),ze=ut}var ft=z.length;if(!!ft){var Fe=z[z.length-1];this.nextAudioPts=ne=ze+j*Fe.duration;var Ge=$?new Uint8Array(0):p.default.moof(T.sequenceNumber++,Ke/j,b({},T,{samples:z}));T.samples=[];var ht=Ke/P,Ut=ne/P,Wt="audio",tr={data1:Ge,data2:je,startPTS:ht,endPTS:Ut,startDTS:ht,endDTS:Ut,type:Wt,hasAudio:!0,hasVideo:!1,nb:ft};return this.isAudioContiguous=!0,console.assert(je.length,"MDAT length must not be zero"),tr}},f.remuxEmptyAudio=function(T,m,h,A){var R=T.inputTimeScale,P=T.samplerate?T.samplerate:R,k=R/P,j=this.nextAudioPts,K=(j!==null?j:A.startDTS*R)+this._initDTS,W=A.endDTS*R+this._initDTS,H=k*L,$=Math.ceil((W-K)/H),z=c.default.getSilentFrame(T.manifestCodec||T.codec,T.channelCount);if(O.logger.warn("[mp4-remuxer]: remux empty Audio"),!z){O.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var J=[],ee=0;ee<$;ee++){var re=K+ee*H;J.push({unit:z,pts:re,dts:re})}return T.samples=J,this.remuxAudio(T,m,h,!1)},g}();function d(g,f){var v;if(f===null)return g;for(f<g?v=-8589934592:v=8589934592;Math.abs(g-f)>4294967296;)g+=v;return g}function y(g){for(var f=0;f<g.length;f++)if(g[f].key)return f;return-1}function E(g,f,v,T){var m=g.samples.length;if(!!m){for(var h=g.inputTimeScale,A=0;A<m;A++){var R=g.samples[A];R.pts=d(R.pts-v,f*h)/h,R.dts=d(R.dts-T,f*h)/h}var P=g.samples;return g.samples=[],{samples:P}}}function u(g,f,v){var T=g.samples.length;if(!!T){for(var m=g.inputTimeScale,h=0;h<T;h++){var A=g.samples[h];A.pts=d(A.pts-v,f*m)/m}g.samples.sort(function(P,k){return P.pts-k.pts});var R=g.samples;return g.samples=[],{samples:R}}}var s=function(f,v,T,m){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=v,this.size=T,this.cts=m,this.flags=new o(f)},o=function(f){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=f?2:1,this.isNonSync=f?0:1}},"./src/remux/passthrough-remuxer.ts":function(n,i,r){r.r(i);var D=r("./src/polyfills/number.ts"),c=r("./src/remux/mp4-remuxer.ts"),p=r("./src/utils/mp4-tools.ts"),w=r("./src/loader/fragment.ts"),M=r("./src/utils/logger.ts"),O=function(){function S(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var b=S.prototype;return b.destroy=function(){},b.resetTimeStamp=function(L){this.initPTS=L,this.lastEndTime=null},b.resetNextTimestamp=function(){this.lastEndTime=null},b.resetInitSegment=function(L,_,x){this.audioCodec=_,this.videoCodec=x,this.generateInitSegment(L),this.emitInitSegment=!0},b.generateInitSegment=function(L){var _=this.audioCodec,x=this.videoCodec;if(!L||!L.byteLength){this.initTracks=void 0,this.initData=void 0;return}var l=this.initData=Object(p.parseInitSegment)(L);_||(_=C(l.audio,w.ElementaryStreamTypes.AUDIO)),x||(x=C(l.video,w.ElementaryStreamTypes.VIDEO));var a={};l.audio&&l.video?a.audiovideo={container:"video/mp4",codec:_+","+x,initSegment:L,id:"main"}:l.audio?a.audio={container:"audio/mp4",codec:_,initSegment:L,id:"audio"}:l.video?a.video={container:"video/mp4",codec:x,initSegment:L,id:"main"}:M.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=a},b.remux=function(L,_,x,l,a){var d,y=this.initPTS,E=this.lastEndTime,u={audio:void 0,video:void 0,text:l,id3:x,initSegment:void 0};Object(D.isFiniteNumber)(E)||(E=this.lastEndTime=a||0);var s=_.samples;if(!s||!s.length)return u;var o={initPTS:void 0,timescale:1},g=this.initData;if((!g||!g.length)&&(this.generateInitSegment(s),g=this.initData),!g||!g.length)return M.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),u;this.emitInitSegment&&(o.tracks=this.initTracks,this.emitInitSegment=!1);var f=Object(p.getStartDTS)(g,s);Object(D.isFiniteNumber)(y)||(this.initPTS=o.initPTS=y=f-a);var v=Object(p.getDuration)(s,g),T=L?f-y:E,m=T+v;Object(p.offsetStartDTS)(g,s,y),v>0?this.lastEndTime=m:(M.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var h=!!g.audio,A=!!g.video,R="";h&&(R+="audio"),A&&(R+="video");var P={data1:s,startPTS:T,startDTS:T,endPTS:m,endDTS:m,type:R,hasAudio:h,hasVideo:A,nb:1,dropped:0};u.audio=P.type==="audio"?P:void 0,u.video=P.type!=="audio"?P:void 0,u.initSegment=o;var k=(d=this.initPTS)!=null?d:0;return u.id3=Object(c.flushTextTrackMetadataCueSamples)(x,a,k,k),l.samples.length&&(u.text=Object(c.flushTextTrackUserdataCueSamples)(l,a,k)),u},S}();function C(S,b){var I=S==null?void 0:S.codec;return I&&I.length>4?I:I==="hvc1"||I==="hev1"?"hvc1.1.c.L120.90":I==="av01"?"av01.0.04M.08":I==="avc1"||b===w.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}i.default=O},"./src/task-loop.ts":function(n,i,r){r.r(i),r.d(i,"default",function(){return D});var D=function(){function c(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var p=c.prototype;return p.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},p.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},p.onHandlerDestroyed=function(){},p.hasInterval=function(){return!!this._tickInterval},p.hasNextTick=function(){return!!this._tickTimer},p.setInterval=function(M){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,M),!0)},p.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},p.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},p.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},p.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},p.doTick=function(){},c}()},"./src/types/cmcd.ts":function(n,i,r){r.r(i),r.d(i,"CMCDVersion",function(){return D}),r.d(i,"CMCDObjectType",function(){return c}),r.d(i,"CMCDStreamingFormat",function(){return p}),r.d(i,"CMCDStreamType",function(){return w});var D=1,c;(function(M){M.MANIFEST="m",M.AUDIO="a",M.VIDEO="v",M.MUXED="av",M.INIT="i",M.CAPTION="c",M.TIMED_TEXT="tt",M.KEY="k",M.OTHER="o"})(c||(c={}));var p;(function(M){M.DASH="d",M.HLS="h",M.SMOOTH="s",M.OTHER="o"})(p||(p={}));var w;(function(M){M.VOD="v",M.LIVE="l"})(w||(w={}))},"./src/types/demuxer.ts":function(n,i,r){r.r(i),r.d(i,"MetadataSchema",function(){return D});var D;(function(c){c.audioId3="org.id3",c.dateRange="com.apple.quicktime.HLS",c.emsg="https://aomedia.org/emsg/ID3"})(D||(D={}))},"./src/types/level.ts":function(n,i,r){r.r(i),r.d(i,"HlsSkip",function(){return p}),r.d(i,"getSkipValue",function(){return w}),r.d(i,"HlsUrlParameters",function(){return M}),r.d(i,"Level",function(){return O});function D(C,S){for(var b=0;b<S.length;b++){var I=S[b];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(C,I.key,I)}}function c(C,S,b){return S&&D(C.prototype,S),b&&D(C,b),Object.defineProperty(C,"prototype",{writable:!1}),C}var p;(function(C){C.No="",C.Yes="YES",C.v2="v2"})(p||(p={}));function w(C,S){var b=C.canSkipUntil,I=C.canSkipDateRanges,L=C.endSN,_=S!==void 0?S-L:0;return b&&_<b?I?p.v2:p.Yes:p.No}var M=function(){function C(b,I,L){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=b,this.part=I,this.skip=L}var S=C.prototype;return S.addDirectives=function(I){var L=new self.URL(I);return this.msn!==void 0&&L.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&L.searchParams.set("_HLS_part",this.part.toString()),this.skip&&L.searchParams.set("_HLS_skip",this.skip),L.toString()},C}(),O=function(){function C(S){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[S.url],this.attrs=S.attrs,this.bitrate=S.bitrate,S.details&&(this.details=S.details),this.id=S.id||0,this.name=S.name,this.width=S.width||0,this.height=S.height||0,this.audioCodec=S.audioCodec,this.videoCodec=S.videoCodec,this.unknownCodecs=S.unknownCodecs,this.codecSet=[S.videoCodec,S.audioCodec].filter(function(b){return b}).join(",").replace(/\.[^.,]+/g,"")}return c(C,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(b){var I=b%this.url.length;this._urlId!==I&&(this.details=void 0,this._urlId=I)}}]),C}()},"./src/types/loader.ts":function(n,i,r){r.r(i),r.d(i,"PlaylistContextType",function(){return D}),r.d(i,"PlaylistLevelType",function(){return c});var D;(function(p){p.MANIFEST="manifest",p.LEVEL="level",p.AUDIO_TRACK="audioTrack",p.SUBTITLE_TRACK="subtitleTrack"})(D||(D={}));var c;(function(p){p.MAIN="main",p.AUDIO="audio",p.SUBTITLE="subtitle"})(c||(c={}))},"./src/types/transmuxer.ts":function(n,i,r){r.r(i),r.d(i,"ChunkMetadata",function(){return D});var D=function(w,M,O,C,S,b){C===void 0&&(C=0),S===void 0&&(S=-1),b===void 0&&(b=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=c(),this.buffering={audio:c(),video:c(),audiovideo:c()},this.level=w,this.sn=M,this.id=O,this.size=C,this.part=S,this.partial=b};function c(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(n,i,r){r.r(i),r.d(i,"AttrList",function(){return p});var D=/^(\d+)x(\d+)$/,c=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,p=function(){function w(O){typeof O=="string"&&(O=w.parseAttrList(O));for(var C in O)O.hasOwnProperty(C)&&(this[C]=O[C])}var M=w.prototype;return M.decimalInteger=function(C){var S=parseInt(this[C],10);return S>Number.MAX_SAFE_INTEGER?1/0:S},M.hexadecimalInteger=function(C){if(this[C]){var S=(this[C]||"0x").slice(2);S=(S.length&1?"0":"")+S;for(var b=new Uint8Array(S.length/2),I=0;I<S.length/2;I++)b[I]=parseInt(S.slice(I*2,I*2+2),16);return b}else return null},M.hexadecimalIntegerAsNumber=function(C){var S=parseInt(this[C],16);return S>Number.MAX_SAFE_INTEGER?1/0:S},M.decimalFloatingPoint=function(C){return parseFloat(this[C])},M.optionalFloat=function(C,S){var b=this[C];return b?parseFloat(b):S},M.enumeratedString=function(C){return this[C]},M.bool=function(C){return this[C]==="YES"},M.decimalResolution=function(C){var S=D.exec(this[C]);if(S!==null)return{width:parseInt(S[1],10),height:parseInt(S[2],10)}},w.parseAttrList=function(C){var S,b={},I='"';for(c.lastIndex=0;(S=c.exec(C))!==null;){var L=S[2];L.indexOf(I)===0&&L.lastIndexOf(I)===L.length-1&&(L=L.slice(1,-1)),b[S[1]]=L}return b},w}()},"./src/utils/binary-search.ts":function(n,i,r){r.r(i);var D={search:function(p,w){for(var M=0,O=p.length-1,C=null,S=null;M<=O;){C=(M+O)/2|0,S=p[C];var b=w(S);if(b>0)M=C+1;else if(b<0)O=C-1;else return S}return null}};i.default=D},"./src/utils/buffer-helper.ts":function(n,i,r){r.r(i),r.d(i,"BufferHelper",function(){return p});var D=r("./src/utils/logger.ts"),c={length:0,start:function(){return 0},end:function(){return 0}},p=function(){function w(){}return w.isBuffered=function(O,C){try{if(O){for(var S=w.getBuffered(O),b=0;b<S.length;b++)if(C>=S.start(b)&&C<=S.end(b))return!0}}catch{}return!1},w.bufferInfo=function(O,C,S){try{if(O){var b=w.getBuffered(O),I=[],L;for(L=0;L<b.length;L++)I.push({start:b.start(L),end:b.end(L)});return this.bufferedInfo(I,C,S)}}catch{}return{len:0,start:C,end:C,nextStart:void 0}},w.bufferedInfo=function(O,C,S){C=Math.max(0,C),O.sort(function(s,o){var g=s.start-o.start;return g||o.end-s.end});var b=[];if(S)for(var I=0;I<O.length;I++){var L=b.length;if(L){var _=b[L-1].end;O[I].start-_<S?O[I].end>_&&(b[L-1].end=O[I].end):b.push(O[I])}else b.push(O[I])}else b=O;for(var x=0,l,a=C,d=C,y=0;y<b.length;y++){var E=b[y].start,u=b[y].end;if(C+S>=E&&C<u)a=E,d=u,x=d-C;else if(C+S<E){l=E;break}}return{len:x,start:a||0,end:d||0,nextStart:l}},w.getBuffered=function(O){try{return O.buffered}catch(C){return D.logger.log("failed to get media.buffered",C),c}},w}()},"./src/utils/cea-608-parser.ts":function(n,i,r){r.r(i),r.d(i,"Row",function(){return d}),r.d(i,"CaptionScreen",function(){return y});var D=r("./src/utils/logger.ts"),c={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},p=function(v){var T=v;return c.hasOwnProperty(v)&&(T=c[v]),String.fromCharCode(T)},w=15,M=100,O={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},C={17:2,18:4,21:6,22:8,23:10,19:13,20:15},S={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},b={25:2,26:4,29:6,30:8,31:10,27:13,28:15},I=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],L;(function(f){f[f.ERROR=0]="ERROR",f[f.TEXT=1]="TEXT",f[f.WARNING=2]="WARNING",f[f.INFO=2]="INFO",f[f.DEBUG=3]="DEBUG",f[f.DATA=3]="DATA"})(L||(L={}));var _=function(){function f(){this.time=null,this.verboseLevel=L.ERROR}var v=f.prototype;return v.log=function(m,h){this.verboseLevel>=m&&D.logger.log(this.time+" ["+m+"] "+h)},f}(),x=function(v){for(var T=[],m=0;m<v.length;m++)T.push(v[m].toString(16));return T},l=function(){function f(T,m,h,A,R){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=T||"white",this.underline=m||!1,this.italics=h||!1,this.background=A||"black",this.flash=R||!1}var v=f.prototype;return v.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},v.setStyles=function(m){for(var h=["foreground","underline","italics","background","flash"],A=0;A<h.length;A++){var R=h[A];m.hasOwnProperty(R)&&(this[R]=m[R])}},v.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},v.equals=function(m){return this.foreground===m.foreground&&this.underline===m.underline&&this.italics===m.italics&&this.background===m.background&&this.flash===m.flash},v.copy=function(m){this.foreground=m.foreground,this.underline=m.underline,this.italics=m.italics,this.background=m.background,this.flash=m.flash},v.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},f}(),a=function(){function f(T,m,h,A,R,P){this.uchar=void 0,this.penState=void 0,this.uchar=T||" ",this.penState=new l(m,h,A,R,P)}var v=f.prototype;return v.reset=function(){this.uchar=" ",this.penState.reset()},v.setChar=function(m,h){this.uchar=m,this.penState.copy(h)},v.setPenState=function(m){this.penState.copy(m)},v.equals=function(m){return this.uchar===m.uchar&&this.penState.equals(m.penState)},v.copy=function(m){this.uchar=m.uchar,this.penState.copy(m.penState)},v.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},f}(),d=function(){function f(T){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var m=0;m<M;m++)this.chars.push(new a);this.logger=T,this.pos=0,this.currPenState=new l}var v=f.prototype;return v.equals=function(m){for(var h=!0,A=0;A<M;A++)if(!this.chars[A].equals(m.chars[A])){h=!1;break}return h},v.copy=function(m){for(var h=0;h<M;h++)this.chars[h].copy(m.chars[h])},v.isEmpty=function(){for(var m=!0,h=0;h<M;h++)if(!this.chars[h].isEmpty()){m=!1;break}return m},v.setCursor=function(m){this.pos!==m&&(this.pos=m),this.pos<0?(this.logger.log(L.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>M&&(this.logger.log(L.DEBUG,"Too large cursor position "+this.pos),this.pos=M)},v.moveCursor=function(m){var h=this.pos+m;if(m>1)for(var A=this.pos+1;A<h+1;A++)this.chars[A].setPenState(this.currPenState);this.setCursor(h)},v.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},v.insertChar=function(m){m>=144&&this.backSpace();var h=p(m);if(this.pos>=M){this.logger.log(L.ERROR,"Cannot insert "+m.toString(16)+" ("+h+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(h,this.currPenState),this.moveCursor(1)},v.clearFromPos=function(m){var h;for(h=m;h<M;h++)this.chars[h].reset()},v.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},v.clearToEndOfRow=function(){this.clearFromPos(this.pos)},v.getTextString=function(){for(var m=[],h=!0,A=0;A<M;A++){var R=this.chars[A].uchar;R!==" "&&(h=!1),m.push(R)}return h?"":m.join("")},v.setPenStyles=function(m){this.currPenState.setStyles(m);var h=this.chars[this.pos];h.setPenState(this.currPenState)},f}(),y=function(){function f(T){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var m=0;m<w;m++)this.rows.push(new d(T));this.logger=T,this.currRow=w-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var v=f.prototype;return v.reset=function(){for(var m=0;m<w;m++)this.rows[m].clear();this.currRow=w-1},v.equals=function(m){for(var h=!0,A=0;A<w;A++)if(!this.rows[A].equals(m.rows[A])){h=!1;break}return h},v.copy=function(m){for(var h=0;h<w;h++)this.rows[h].copy(m.rows[h])},v.isEmpty=function(){for(var m=!0,h=0;h<w;h++)if(!this.rows[h].isEmpty()){m=!1;break}return m},v.backSpace=function(){var m=this.rows[this.currRow];m.backSpace()},v.clearToEndOfRow=function(){var m=this.rows[this.currRow];m.clearToEndOfRow()},v.insertChar=function(m){var h=this.rows[this.currRow];h.insertChar(m)},v.setPen=function(m){var h=this.rows[this.currRow];h.setPenStyles(m)},v.moveCursor=function(m){var h=this.rows[this.currRow];h.moveCursor(m)},v.setCursor=function(m){this.logger.log(L.INFO,"setCursor: "+m);var h=this.rows[this.currRow];h.setCursor(m)},v.setPAC=function(m){this.logger.log(L.INFO,"pacData = "+JSON.stringify(m));var h=m.row-1;if(this.nrRollUpRows&&h<this.nrRollUpRows-1&&(h=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==h){for(var A=0;A<w;A++)this.rows[A].clear();var R=this.currRow+1-this.nrRollUpRows,P=this.lastOutputScreen;if(P){var k=P.rows[R].cueStartTime,j=this.logger.time;if(k&&j!==null&&k<j)for(var K=0;K<this.nrRollUpRows;K++)this.rows[h-this.nrRollUpRows+K+1].copy(P.rows[R+K])}}this.currRow=h;var W=this.rows[this.currRow];if(m.indent!==null){var H=m.indent,$=Math.max(H-1,0);W.setCursor(m.indent),m.color=W.chars[$].penState.foreground}var z={foreground:m.color,underline:m.underline,italics:m.italics,background:"black",flash:!1};this.setPen(z)},v.setBkgData=function(m){this.logger.log(L.INFO,"bkgData = "+JSON.stringify(m)),this.backSpace(),this.setPen(m),this.insertChar(32)},v.setRollUpRows=function(m){this.nrRollUpRows=m},v.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(L.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(L.TEXT,this.getDisplayText());var m=this.currRow+1-this.nrRollUpRows,h=this.rows.splice(m,1)[0];h.clear(),this.rows.splice(this.currRow,0,h),this.logger.log(L.INFO,"Rolling up")},v.getDisplayText=function(m){m=m||!1;for(var h=[],A="",R=-1,P=0;P<w;P++){var k=this.rows[P].getTextString();k&&(R=P+1,m?h.push("Row "+R+": '"+k+"'"):h.push(k.trim()))}return h.length>0&&(m?A="["+h.join(" | ")+"]":A=h.join(`
`)),A},v.getTextAndFormat=function(){return this.rows},f}(),E=function(){function f(T,m,h){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=T,this.outputFilter=m,this.mode=null,this.verbose=0,this.displayedMemory=new y(h),this.nonDisplayedMemory=new y(h),this.lastOutputScreen=new y(h),this.currRollUpRow=this.displayedMemory.rows[w-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=h}var v=f.prototype;return v.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[w-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},v.getHandler=function(){return this.outputFilter},v.setHandler=function(m){this.outputFilter=m},v.setPAC=function(m){this.writeScreen.setPAC(m)},v.setBkgData=function(m){this.writeScreen.setBkgData(m)},v.setMode=function(m){m!==this.mode&&(this.mode=m,this.logger.log(L.INFO,"MODE="+m),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=m)},v.insertChars=function(m){for(var h=0;h<m.length;h++)this.writeScreen.insertChar(m[h]);var A=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(L.INFO,A+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(L.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},v.ccRCL=function(){this.logger.log(L.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},v.ccBS=function(){this.logger.log(L.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},v.ccAOF=function(){},v.ccAON=function(){},v.ccDER=function(){this.logger.log(L.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},v.ccRU=function(m){this.logger.log(L.INFO,"RU("+m+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(m)},v.ccFON=function(){this.logger.log(L.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},v.ccRDC=function(){this.logger.log(L.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},v.ccTR=function(){this.logger.log(L.INFO,"TR"),this.setMode("MODE_TEXT")},v.ccRTD=function(){this.logger.log(L.INFO,"RTD"),this.setMode("MODE_TEXT")},v.ccEDM=function(){this.logger.log(L.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},v.ccCR=function(){this.logger.log(L.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},v.ccENM=function(){this.logger.log(L.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},v.ccEOC=function(){if(this.logger.log(L.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var m=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=m,this.writeScreen=this.nonDisplayedMemory,this.logger.log(L.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},v.ccTO=function(m){this.logger.log(L.INFO,"TO("+m+") - Tab Offset"),this.writeScreen.moveCursor(m)},v.ccMIDROW=function(m){var h={flash:!1};if(h.underline=m%2===1,h.italics=m>=46,h.italics)h.foreground="white";else{var A=Math.floor(m/2)-16,R=["white","green","blue","cyan","red","yellow","magenta"];h.foreground=R[A]}this.logger.log(L.INFO,"MIDROW: "+JSON.stringify(h)),this.writeScreen.setPen(h)},v.outputDataUpdate=function(m){m===void 0&&(m=!1);var h=this.logger.time;h!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=h:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,h,this.lastOutputScreen),m&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:h),this.lastOutputScreen.copy(this.displayedMemory))},v.cueSplitAtTime=function(m){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,m,this.displayedMemory),this.cueStartTime=m))},f}(),u=function(){function f(T,m,h){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var A=new _;this.channels=[null,new E(T,m,A),new E(T+1,h,A)],this.cmdHistory=g(),this.logger=A}var v=f.prototype;return v.getHandler=function(m){return this.channels[m].getHandler()},v.setHandler=function(m,h){this.channels[m].setHandler(h)},v.addData=function(m,h){var A,R,P,k=!1;this.logger.time=m;for(var j=0;j<h.length;j+=2)if(R=h[j]&127,P=h[j+1]&127,!(R===0&&P===0)){if(this.logger.log(L.DATA,"["+x([h[j],h[j+1]])+"] -> ("+x([R,P])+")"),A=this.parseCmd(R,P),A||(A=this.parseMidrow(R,P)),A||(A=this.parsePAC(R,P)),A||(A=this.parseBackgroundAttributes(R,P)),!A&&(k=this.parseChars(R,P),k)){var K=this.currentChannel;if(K&&K>0){var W=this.channels[K];W.insertChars(k)}else this.logger.log(L.WARNING,"No channel found yet. TEXT-MODE?")}!A&&!k&&this.logger.log(L.WARNING,"Couldn't parse cleaned data "+x([R,P])+" orig: "+x([h[j],h[j+1]]))}},v.parseCmd=function(m,h){var A=this.cmdHistory,R=(m===20||m===28||m===21||m===29)&&h>=32&&h<=47,P=(m===23||m===31)&&h>=33&&h<=35;if(!(R||P))return!1;if(o(m,h,A))return s(null,null,A),this.logger.log(L.DEBUG,"Repeated command ("+x([m,h])+") is dropped"),!0;var k=m===20||m===21||m===23?1:2,j=this.channels[k];return m===20||m===21||m===28||m===29?h===32?j.ccRCL():h===33?j.ccBS():h===34?j.ccAOF():h===35?j.ccAON():h===36?j.ccDER():h===37?j.ccRU(2):h===38?j.ccRU(3):h===39?j.ccRU(4):h===40?j.ccFON():h===41?j.ccRDC():h===42?j.ccTR():h===43?j.ccRTD():h===44?j.ccEDM():h===45?j.ccCR():h===46?j.ccENM():h===47&&j.ccEOC():j.ccTO(h-32),s(m,h,A),this.currentChannel=k,!0},v.parseMidrow=function(m,h){var A=0;if((m===17||m===25)&&h>=32&&h<=47){if(m===17?A=1:A=2,A!==this.currentChannel)return this.logger.log(L.ERROR,"Mismatch channel in midrow parsing"),!1;var R=this.channels[A];return R?(R.ccMIDROW(h),this.logger.log(L.DEBUG,"MIDROW ("+x([m,h])+")"),!0):!1}return!1},v.parsePAC=function(m,h){var A,R=this.cmdHistory,P=(m>=17&&m<=23||m>=25&&m<=31)&&h>=64&&h<=127,k=(m===16||m===24)&&h>=64&&h<=95;if(!(P||k))return!1;if(o(m,h,R))return s(null,null,R),!0;var j=m<=23?1:2;h>=64&&h<=95?A=j===1?O[m]:S[m]:A=j===1?C[m]:b[m];var K=this.channels[j];return K?(K.setPAC(this.interpretPAC(A,h)),s(m,h,R),this.currentChannel=j,!0):!1},v.interpretPAC=function(m,h){var A,R={color:null,italics:!1,indent:null,underline:!1,row:m};return h>95?A=h-96:A=h-64,R.underline=(A&1)===1,A<=13?R.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(A/2)]:A<=15?(R.italics=!0,R.color="white"):R.indent=Math.floor((A-16)/2)*4,R},v.parseChars=function(m,h){var A,R=null,P=null;if(m>=25?(A=2,P=m-8):(A=1,P=m),P>=17&&P<=19){var k;P===17?k=h+80:P===18?k=h+112:k=h+144,this.logger.log(L.INFO,"Special char '"+p(k)+"' in channel "+A),R=[k]}else m>=32&&m<=127&&(R=h===0?[m]:[m,h]);if(R){var j=x(R);this.logger.log(L.DEBUG,"Char codes =  "+j.join(",")),s(m,h,this.cmdHistory)}return R},v.parseBackgroundAttributes=function(m,h){var A=(m===16||m===24)&&h>=32&&h<=47,R=(m===23||m===31)&&h>=45&&h<=47;if(!(A||R))return!1;var P,k={};m===16||m===24?(P=Math.floor((h-32)/2),k.background=I[P],h%2===1&&(k.background=k.background+"_semi")):h===45?k.background="transparent":(k.foreground="black",h===47&&(k.underline=!0));var j=m<=23?1:2,K=this.channels[j];return K.setBkgData(k),s(m,h,this.cmdHistory),!0},v.reset=function(){for(var m=0;m<Object.keys(this.channels).length;m++){var h=this.channels[m];h&&h.reset()}this.cmdHistory=g()},v.cueSplitAtTime=function(m){for(var h=0;h<this.channels.length;h++){var A=this.channels[h];A&&A.cueSplitAtTime(m)}},f}();function s(f,v,T){T.a=f,T.b=v}function o(f,v,T){return T.a===f&&T.b===v}function g(){return{a:null,b:null}}i.default=u},"./src/utils/codecs.ts":function(n,i,r){r.r(i),r.d(i,"isCodecType",function(){return c}),r.d(i,"isCodecSupportedInMp4",function(){return p});var D={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function c(w,M){var O=D[M];return!!O&&O[w.slice(0,4)]===!0}function p(w,M){return MediaSource.isTypeSupported((M||"video")+'/mp4;codecs="'+w+'"')}},"./src/utils/cues.ts":function(n,i,r){r.r(i);var D=r("./src/utils/vttparser.ts"),c=r("./src/utils/webvtt-parser.ts"),p=r("./src/utils/texttrack-utils.ts"),w=/\s/,M={newCue:function(C,S,b,I){for(var L=[],_,x,l,a,d,y=self.VTTCue||self.TextTrackCue,E=0;E<I.rows.length;E++)if(_=I.rows[E],l=!0,a=0,d="",!_.isEmpty()){for(var u=0;u<_.chars.length;u++)w.test(_.chars[u].uchar)&&l?a++:(d+=_.chars[u].uchar,l=!1);_.cueStartTime=S,S===b&&(b+=1e-4),a>=16?a--:a++;var s=Object(D.fixLineBreaks)(d.trim()),o=Object(c.generateCueId)(S,b,s);(!C||!C.cues||!C.cues.getCueById(o))&&(x=new y(S,b,s),x.id=o,x.line=E+1,x.align="left",x.position=10+Math.min(80,Math.floor(a*8/32)*10),L.push(x))}return C&&L.length&&(L.sort(function(g,f){return g.line==="auto"||f.line==="auto"?0:g.line>8&&f.line>8?f.line-g.line:g.line-f.line}),L.forEach(function(g){return Object(p.addCueToTrack)(C,g)})),L}};i.default=M},"./src/utils/discontinuities.ts":function(n,i,r){r.r(i),r.d(i,"findFirstFragWithCC",function(){return w}),r.d(i,"shouldAlignOnDiscontinuities",function(){return M}),r.d(i,"findDiscontinuousReferenceFrag",function(){return O}),r.d(i,"adjustSlidingStart",function(){return S}),r.d(i,"alignStream",function(){return b}),r.d(i,"alignPDT",function(){return L}),r.d(i,"alignFragmentByPDTDelta",function(){return _}),r.d(i,"alignMediaPlaylistByPDT",function(){return x});var D=r("./src/polyfills/number.ts"),c=r("./src/utils/logger.ts"),p=r("./src/controller/level-helper.ts");function w(l,a){for(var d=null,y=0,E=l.length;y<E;y++){var u=l[y];if(u&&u.cc===a){d=u;break}}return d}function M(l,a,d){return!!(a.details&&(d.endCC>d.startCC||l&&l.cc<d.startCC))}function O(l,a){var d=l.fragments,y=a.fragments;if(!y.length||!d.length){c.logger.log("No fragments to align");return}var E=w(d,y[0].cc);if(!E||E&&!E.startPTS){c.logger.log("No frag in previous level to align on");return}return E}function C(l,a){if(l){var d=l.start+a;l.start=l.startPTS=d,l.endPTS=d+l.duration}}function S(l,a){for(var d=a.fragments,y=0,E=d.length;y<E;y++)C(d[y],l);a.fragmentHint&&C(a.fragmentHint,l),a.alignedSliding=!0}function b(l,a,d){!a||(I(l,d,a),!d.alignedSliding&&a.details&&L(d,a.details),!d.alignedSliding&&a.details&&!d.skippedSegments&&Object(p.adjustSliding)(a.details,d))}function I(l,a,d){if(M(l,d,a)){var y=O(d.details,a);y&&Object(D.isFiniteNumber)(y.start)&&(c.logger.log("Adjusting PTS using last level due to CC increase within current level "+a.url),S(y.start,a))}}function L(l,a){if(!(!a.fragments.length||!l.hasProgramDateTime||!a.hasProgramDateTime)){var d=a.fragments[0].programDateTime,y=l.fragments[0].programDateTime,E=(y-d)/1e3+a.fragments[0].start;E&&Object(D.isFiniteNumber)(E)&&(c.logger.log("Adjusting PTS using programDateTime delta "+(y-d)+"ms, sliding:"+E.toFixed(3)+" "+l.url+" "),S(E,l))}}function _(l,a){var d=l.programDateTime;if(!!d){var y=(d-a)/1e3;l.start=l.startPTS=y,l.endPTS=y+l.duration}}function x(l,a){if(!(!a.fragments.length||!l.hasProgramDateTime||!a.hasProgramDateTime)){var d=a.fragments[0].programDateTime,y=a.fragments[0].start,E=d-y*1e3;l.fragments.forEach(function(u){_(u,E)}),l.fragmentHint&&_(l.fragmentHint,E),l.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(n,i,r){r.r(i);var D=r("./src/utils/ewma.ts"),c=function(){function p(M,O,C){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=C,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new D.default(M),this.fast_=new D.default(O)}var w=p.prototype;return w.update=function(O,C){var S=this.slow_,b=this.fast_;this.slow_.halfLife!==O&&(this.slow_=new D.default(O,S.getEstimate(),S.getTotalWeight())),this.fast_.halfLife!==C&&(this.fast_=new D.default(C,b.getEstimate(),b.getTotalWeight()))},w.sample=function(O,C){O=Math.max(O,this.minDelayMs_);var S=8*C,b=O/1e3,I=S/b;this.fast_.sample(b,I),this.slow_.sample(b,I)},w.canEstimate=function(){var O=this.fast_;return O&&O.getTotalWeight()>=this.minWeight_},w.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},w.destroy=function(){},p}();i.default=c},"./src/utils/ewma.ts":function(n,i,r){r.r(i);var D=function(){function c(w,M,O){M===void 0&&(M=0),O===void 0&&(O=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=w,this.alpha_=w?Math.exp(Math.log(.5)/w):0,this.estimate_=M,this.totalWeight_=O}var p=c.prototype;return p.sample=function(M,O){var C=Math.pow(this.alpha_,M);this.estimate_=O*(1-C)+C*this.estimate_,this.totalWeight_+=M},p.getTotalWeight=function(){return this.totalWeight_},p.getEstimate=function(){if(this.alpha_){var M=1-Math.pow(this.alpha_,this.totalWeight_);if(M)return this.estimate_/M}return this.estimate_},c}();i.default=D},"./src/utils/fetch-loader.ts":function(n,i,r){r.r(i),r.d(i,"fetchSupported",function(){return _});var D=r("./src/polyfills/number.ts"),c=r("./src/loader/load-stats.ts"),p=r("./src/demux/chunk-cache.ts");function w(y,E){y.prototype=Object.create(E.prototype),y.prototype.constructor=y,b(y,E)}function M(y){var E=typeof Map=="function"?new Map:void 0;return M=function(s){if(s===null||!S(s))return s;if(typeof s!="function")throw new TypeError("Super expression must either be null or a function");if(typeof E<"u"){if(E.has(s))return E.get(s);E.set(s,o)}function o(){return O(s,arguments,I(this).constructor)}return o.prototype=Object.create(s.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),b(o,s)},M(y)}function O(y,E,u){return C()?O=Reflect.construct.bind():O=function(o,g,f){var v=[null];v.push.apply(v,g);var T=Function.bind.apply(o,v),m=new T;return f&&b(m,f.prototype),m},O.apply(null,arguments)}function C(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function S(y){return Function.toString.call(y).indexOf("[native code]")!==-1}function b(y,E){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,o){return s.__proto__=o,s},b(y,E)}function I(y){return I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(u){return u.__proto__||Object.getPrototypeOf(u)},I(y)}function L(){return L=Object.assign?Object.assign.bind():function(y){for(var E=1;E<arguments.length;E++){var u=arguments[E];for(var s in u)Object.prototype.hasOwnProperty.call(u,s)&&(y[s]=u[s])}return y},L.apply(this,arguments)}function _(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var x=function(){function y(u){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=u.fetchSetup||a,this.controller=new self.AbortController,this.stats=new c.LoadStats}var E=y.prototype;return E.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},E.abortInternal=function(){var s=this.response;(!s||!s.ok)&&(this.stats.aborted=!0,this.controller.abort())},E.abort=function(){var s;this.abortInternal(),(s=this.callbacks)!==null&&s!==void 0&&s.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},E.load=function(s,o,g){var f=this,v=this.stats;if(v.loading.start)throw new Error("Loader can only be used once.");v.loading.start=self.performance.now();var T=l(s,this.controller.signal),m=g.onProgress,h=s.responseType==="arraybuffer",A=h?"byteLength":"length";this.context=s,this.config=o,this.callbacks=g,this.request=this.fetchSetup(s,T),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){f.abortInternal(),g.onTimeout(v,s,f.response)},o.timeout),self.fetch(this.request).then(function(R){if(f.response=f.loader=R,!R.ok){var P=R.status,k=R.statusText;throw new d(k||"fetch, bad network response",P,R)}return v.loading.first=Math.max(self.performance.now(),v.loading.start),v.total=parseInt(R.headers.get("Content-Length")||"0"),m&&Object(D.isFiniteNumber)(o.highWaterMark)?f.loadProgressively(R,v,s,o.highWaterMark,m):h?R.arrayBuffer():R.text()}).then(function(R){var P=f.response;self.clearTimeout(f.requestTimeout),v.loading.end=Math.max(self.performance.now(),v.loading.first),v.loaded=v.total=R[A];var k={url:P.url,data:R};m&&!Object(D.isFiniteNumber)(o.highWaterMark)&&m(v,s,R,P),g.onSuccess(k,v,s,P)}).catch(function(R){if(self.clearTimeout(f.requestTimeout),!v.aborted){var P=R&&R.code||0,k=R?R.message:null;g.onError({code:P,text:k},s,R?R.details:null)}})},E.getCacheAge=function(){var s=null;if(this.response){var o=this.response.headers.get("age");s=o?parseFloat(o):null}return s},E.loadProgressively=function(s,o,g,f,v){f===void 0&&(f=0);var T=new p.default,m=s.body.getReader(),h=function A(){return m.read().then(function(R){if(R.done)return T.dataLength&&v(o,g,T.flush(),s),Promise.resolve(new ArrayBuffer(0));var P=R.value,k=P.length;return o.loaded+=k,k<f||T.dataLength?(T.push(P),T.dataLength>=f&&v(o,g,T.flush(),s)):v(o,g,P,s),A()}).catch(function(){return Promise.reject()})};return h()},y}();function l(y,E){var u={method:"GET",mode:"cors",credentials:"same-origin",signal:E,headers:new self.Headers(L({},y.headers))};return y.rangeEnd&&u.headers.set("Range","bytes="+y.rangeStart+"-"+String(y.rangeEnd-1)),u}function a(y,E){return new self.Request(y.url,E)}var d=function(y){w(E,y);function E(u,s,o){var g;return g=y.call(this,u)||this,g.code=void 0,g.details=void 0,g.code=s,g.details=o,g}return E}(M(Error));i.default=x},"./src/utils/imsc1-ttml-parser.ts":function(n,i,r){r.r(i),r.d(i,"IMSC1_CODEC",function(){return S}),r.d(i,"parseIMSC1",function(){return _});var D=r("./src/utils/mp4-tools.ts"),c=r("./src/utils/vttparser.ts"),p=r("./src/utils/vttcue.ts"),w=r("./src/demux/id3.ts"),M=r("./src/utils/timescale-conversion.ts"),O=r("./src/utils/webvtt-parser.ts");function C(){return C=Object.assign?Object.assign.bind():function(f){for(var v=1;v<arguments.length;v++){var T=arguments[v];for(var m in T)Object.prototype.hasOwnProperty.call(T,m)&&(f[m]=T[m])}return f},C.apply(this,arguments)}var S="stpp.ttml.im1t",b=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,I=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,L={left:"start",center:"center",right:"end",start:"start",end:"end"};function _(f,v,T,m,h){var A=Object(D.findBox)(new Uint8Array(f),["mdat"]);if(A.length===0){h(new Error("Could not parse IMSC1 mdat"));return}var R=A.map(function(k){return Object(w.utf8ArrayToStr)(k)}),P=Object(M.toTimescaleFromScale)(v,1,T);try{R.forEach(function(k){return m(x(k,P))})}catch(k){h(k)}}function x(f,v){var T=new DOMParser,m=T.parseFromString(f,"text/xml"),h=m.getElementsByTagName("tt")[0];if(!h)throw new Error("Invalid ttml");var A={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},R=Object.keys(A).reduce(function(W,H){return W[H]=h.getAttribute("ttp:"+H)||A[H],W},{}),P=h.getAttribute("xml:space")!=="preserve",k=a(l(h,"styling","style")),j=a(l(h,"layout","region")),K=l(h,"body","[begin]");return[].map.call(K,function(W){var H=d(W,P);if(!H||!W.hasAttribute("begin"))return null;var $=s(W.getAttribute("begin"),R),z=s(W.getAttribute("dur"),R),J=s(W.getAttribute("end"),R);if($===null)throw u(W);if(J===null){if(z===null)throw u(W);J=$+z}var ee=new p.default($-v,J-v,H);ee.id=Object(O.generateCueId)(ee.startTime,ee.endTime,ee.text);var re=j[W.getAttribute("region")],ne=k[W.getAttribute("style")];ee.position=10,ee.size=80;var ae=y(re,ne,k),ce=ae.textAlign;if(ce){var fe=L[ce];fe&&(ee.lineAlign=fe),ee.align=ce}return C(ee,ae),ee}).filter(function(W){return W!==null})}function l(f,v,T){var m=f.getElementsByTagName(v)[0];return m?[].slice.call(m.querySelectorAll(T)):[]}function a(f){return f.reduce(function(v,T){var m=T.getAttribute("xml:id");return m&&(v[m]=T),v},{})}function d(f,v){return[].slice.call(f.childNodes).reduce(function(T,m,h){var A;return m.nodeName==="br"&&h?T+`
`:(A=m.childNodes)!==null&&A!==void 0&&A.length?d(m,v):v?T+m.textContent.trim().replace(/\s+/g," "):T+m.textContent},"")}function y(f,v,T){var m="http://www.w3.org/ns/ttml#styling",h=null,A=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],R=f!=null&&f.hasAttribute("style")?f.getAttribute("style"):null;return R&&T.hasOwnProperty(R)&&(h=T[R]),A.reduce(function(P,k){var j=E(v,m,k)||E(f,m,k)||E(h,m,k);return j&&(P[k]=j),P},{})}function E(f,v,T){return f&&f.hasAttributeNS(v,T)?f.getAttributeNS(v,T):null}function u(f){return new Error("Could not parse ttml timestamp "+f)}function s(f,v){if(!f)return null;var T=Object(c.parseTimeStamp)(f);return T===null&&(b.test(f)?T=o(f,v):I.test(f)&&(T=g(f,v))),T}function o(f,v){var T=b.exec(f),m=(T[4]|0)+(T[5]|0)/v.subFrameRate;return(T[1]|0)*3600+(T[2]|0)*60+(T[3]|0)+m/v.frameRate}function g(f,v){var T=I.exec(f),m=Number(T[1]),h=T[2];switch(h){case"h":return m*3600;case"m":return m*60;case"ms":return m*1e3;case"f":return m/v.frameRate;case"t":return m/v.tickRate}return m}},"./src/utils/logger.ts":function(n,i,r){r.r(i),r.d(i,"enableLogs",function(){return O}),r.d(i,"logger",function(){return C});var D=function(){},c={trace:D,debug:D,log:D,warn:D,info:D,error:D},p=c;function w(S){var b=self.console[S];return b?b.bind(self.console,"["+S+"] >"):D}function M(S){for(var b=arguments.length,I=new Array(b>1?b-1:0),L=1;L<b;L++)I[L-1]=arguments[L];I.forEach(function(_){p[_]=S[_]?S[_].bind(S):w(_)})}function O(S){if(self.console&&S===!0||typeof S=="object"){M(S,"debug","log","info","warn","error");try{p.log()}catch{p=c}}else p=c}var C=p},"./src/utils/mediakeys-helper.ts":function(n,i,r){r.r(i),r.d(i,"KeySystems",function(){return D}),r.d(i,"requestMediaKeySystemAccess",function(){return c});var D;(function(p){p.WIDEVINE="com.widevine.alpha",p.PLAYREADY="com.microsoft.playready"})(D||(D={}));var c=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(n,i,r){r.r(i),r.d(i,"getMediaSource",function(){return D});function D(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(n,i,r){r.r(i),r.d(i,"RemuxerTrackIdConfig",function(){return O}),r.d(i,"bin2str",function(){return C}),r.d(i,"readUint16",function(){return S}),r.d(i,"readUint32",function(){return b}),r.d(i,"readSint32",function(){return I}),r.d(i,"writeUint32",function(){return L}),r.d(i,"findBox",function(){return _}),r.d(i,"parseSegmentIndex",function(){return x}),r.d(i,"parseInitSegment",function(){return l}),r.d(i,"getStartDTS",function(){return a}),r.d(i,"getDuration",function(){return d}),r.d(i,"computeRawDurationFromSamples",function(){return y}),r.d(i,"offsetStartDTS",function(){return E}),r.d(i,"segmentValidRange",function(){return u}),r.d(i,"appendUint8Array",function(){return s}),r.d(i,"parseSamples",function(){return o}),r.d(i,"parseSEIMessageFromNALu",function(){return v}),r.d(i,"parseEmsg",function(){return m});var D=r("./src/utils/typed-array.ts"),c=r("./src/loader/fragment.ts"),p=r("./src/demux/id3.ts"),w=Math.pow(2,32)-1,M=[].push,O={video:1,audio:2,id3:3,text:4};function C(h){return String.fromCharCode.apply(null,h)}function S(h,A){var R=h[A]<<8|h[A+1];return R<0?65536+R:R}function b(h,A){var R=I(h,A);return R<0?4294967296+R:R}function I(h,A){return h[A]<<24|h[A+1]<<16|h[A+2]<<8|h[A+3]}function L(h,A,R){h[A]=R>>24,h[A+1]=R>>16&255,h[A+2]=R>>8&255,h[A+3]=R&255}function _(h,A){var R=[];if(!A.length)return R;for(var P=h.byteLength,k=0;k<P;){var j=b(h,k),K=C(h.subarray(k+4,k+8)),W=j>1?k+j:P;if(K===A[0])if(A.length===1)R.push(h.subarray(k+8,W));else{var H=_(h.subarray(k+8,W),A.slice(1));H.length&&M.apply(R,H)}k=W}return R}function x(h){var A=[],R=h[0],P=8,k=b(h,P);P+=4;var j=0,K=0;R===0?P+=8:P+=16,P+=2;var W=h.length+K,H=S(h,P);P+=2;for(var $=0;$<H;$++){var z=P,J=b(h,z);z+=4;var ee=J&2147483647,re=(J&2147483648)>>>31;if(re===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var ne=b(h,z);z+=4,A.push({referenceSize:ee,subsegmentDuration:ne,info:{duration:ne/k,start:W,end:W+ee-1}}),W+=ee,z+=4,P=z}return{earliestPresentationTime:j,timescale:k,version:R,referencesCount:H,references:A}}function l(h){for(var A=[],R=_(h,["moov","trak"]),P=0;P<R.length;P++){var k=R[P],j=_(k,["tkhd"])[0];if(j){var K=j[0],W=K===0?12:20,H=b(j,W),$=_(k,["mdia","mdhd"])[0];if($){K=$[0],W=K===0?12:20;var z=b($,W),J=_(k,["mdia","hdlr"])[0];if(J){var ee=C(J.subarray(8,12)),re={soun:c.ElementaryStreamTypes.AUDIO,vide:c.ElementaryStreamTypes.VIDEO}[ee];if(re){var ne=_(k,["mdia","minf","stbl","stsd"])[0],ae=void 0;ne&&(ae=C(ne.subarray(12,16))),A[H]={timescale:z,type:re},A[re]={timescale:z,id:H,codec:ae}}}}}}var ce=_(h,["moov","mvex","trex"]);return ce.forEach(function(fe){var se=b(fe,4),ve=A[se];ve&&(ve.default={duration:b(fe,12),flags:b(fe,20)})}),A}function a(h,A){return _(A,["moof","traf"]).reduce(function(R,P){var k=_(P,["tfdt"])[0],j=k[0],K=_(P,["tfhd"]).reduce(function(W,H){var $=b(H,4),z=h[$];if(z){var J=b(k,4);j===1&&(J*=Math.pow(2,32),J+=b(k,8));var ee=z.timescale||9e4,re=J/ee;if(isFinite(re)&&(W===null||re<W))return re}return W},null);return K!==null&&isFinite(K)&&(R===null||K<R)?K:R},null)||0}function d(h,A){for(var R=0,P=0,k=0,j=_(h,["moof","traf"]),K=0;K<j.length;K++){var W=j[K],H=_(W,["tfhd"])[0],$=b(H,4),z=A[$];if(!!z){var J=z.default,ee=b(H,0)|(J==null?void 0:J.flags),re=J==null?void 0:J.duration;ee&8&&(ee&2?re=b(H,12):re=b(H,8));for(var ne=z.timescale||9e4,ae=_(W,["trun"]),ce=0;ce<ae.length;ce++){if(R=y(ae[ce]),!R&&re){var fe=b(ae[ce],4);R=re*fe}z.type===c.ElementaryStreamTypes.VIDEO?P+=R/ne:z.type===c.ElementaryStreamTypes.AUDIO&&(k+=R/ne)}}}if(P===0&&k===0){for(var se=0,ve=_(h,["sidx"]),le=0;le<ve.length;le++){var ue=x(ve[le]);ue!=null&&ue.references&&(se+=ue.references.reduce(function(Ce,be){return Ce+be.info.duration||0},0))}return se}return P||k}function y(h){var A=b(h,0),R=8;A&1&&(R+=4),A&4&&(R+=4);for(var P=0,k=b(h,4),j=0;j<k;j++){if(A&256){var K=b(h,R);P+=K,R+=4}A&512&&(R+=4),A&1024&&(R+=4),A&2048&&(R+=4)}return P}function E(h,A,R){_(A,["moof","traf"]).forEach(function(P){_(P,["tfhd"]).forEach(function(k){var j=b(k,4),K=h[j];if(!!K){var W=K.timescale||9e4;_(P,["tfdt"]).forEach(function(H){var $=H[0],z=b(H,4);if($===0)z-=R*W,z=Math.max(z,0),L(H,4,z);else{z*=Math.pow(2,32),z+=b(H,8),z-=R*W,z=Math.max(z,0);var J=Math.floor(z/(w+1)),ee=Math.floor(z%(w+1));L(H,4,J),L(H,8,ee)}})}})})}function u(h){var A={valid:null,remainder:null},R=_(h,["moof"]);if(R){if(R.length<2)return A.remainder=h,A}else return A;var P=R[R.length-1];return A.valid=Object(D.sliceUint8)(h,0,P.byteOffset-8),A.remainder=Object(D.sliceUint8)(h,P.byteOffset-8),A}function s(h,A){var R=new Uint8Array(h.length+A.length);return R.set(h),R.set(A,h.length),R}function o(h,A){var R=[],P=A.samples,k=A.timescale,j=A.id,K=!1,W=_(P,["moof"]);return W.map(function(H){var $=H.byteOffset-8,z=_(H,["traf"]);z.map(function(J){var ee=_(J,["tfdt"]).map(function(re){var ne=re[0],ae=b(re,4);return ne===1&&(ae*=Math.pow(2,32),ae+=b(re,8)),ae/k})[0];return ee!==void 0&&(h=ee),_(J,["tfhd"]).map(function(re){var ne=b(re,4),ae=b(re,0)&16777215,ce=(ae&1)!==0,fe=(ae&2)!==0,se=(ae&8)!==0,ve=0,le=(ae&16)!==0,ue=0,Ce=(ae&32)!==0,be=8;ne===j&&(ce&&(be+=8),fe&&(be+=4),se&&(ve=b(re,be),be+=4),le&&(ue=b(re,be),be+=4),Ce&&(be+=4),A.type==="video"&&(K=g(A.codec)),_(J,["trun"]).map(function(Le){var Ue=Le[0],we=b(Le,0)&16777215,Ke=(we&1)!==0,ze=0,je=(we&4)!==0,Qe=(we&256)!==0,ct=0,Et=(we&512)!==0,ot=0,lt=(we&1024)!==0,yt=(we&2048)!==0,ut=0,kt=b(Le,4),Be=8;Ke&&(ze=b(Le,Be),Be+=4),je&&(Be+=4);for(var We=ze+$,ft=0;ft<kt;ft++){if(Qe?(ct=b(Le,Be),Be+=4):ct=ve,Et?(ot=b(Le,Be),Be+=4):ot=ue,lt&&(Be+=4),yt&&(Ue===0?ut=b(Le,Be):ut=I(Le,Be),Be+=4),A.type===c.ElementaryStreamTypes.VIDEO)for(var Fe=0;Fe<ot;){var Ge=b(P,We);We+=4;var ht=P[We]&31;if(f(K,ht)){var Ut=P.subarray(We,We+Ge);v(Ut,h+ut/k,R)}We+=Ge,Fe+=Ge+4}h+=ct/k}}))})})}),R}function g(h){if(!h)return!1;var A=h.indexOf("."),R=A<0?h:h.substring(0,A);return R==="hvc1"||R==="hev1"||R==="dvh1"||R==="dvhe"}function f(h,A){return h?A===39||A===40:A===6}function v(h,A,R){var P=T(h),k=0;k++;for(var j=0,K=0,W=!1,H=0;k<P.length;){j=0;do{if(k>=P.length)break;H=P[k++],j+=H}while(H===255);K=0;do{if(k>=P.length)break;H=P[k++],K+=H}while(H===255);var $=P.length-k;if(!W&&j===4&&k<P.length){W=!0;var z=P[k++];if(z===181){var J=S(P,k);if(k+=2,J===49){var ee=b(P,k);if(k+=4,ee===1195456820){var re=P[k++];if(re===3){var ne=P[k++],ae=31&ne,ce=64&ne,fe=ce?2+ae*3:0,se=new Uint8Array(fe);if(ce){se[0]=ne;for(var ve=1;ve<fe;ve++)se[ve]=P[k++]}R.push({type:re,payloadType:j,pts:A,bytes:se})}}}}}else if(j===5&&K<$){if(W=!0,K>16){for(var le=[],ue=0;ue<16;ue++){var Ce=P[k++].toString(16);le.push(Ce.length==1?"0"+Ce:Ce),(ue===3||ue===5||ue===7||ue===9)&&le.push("-")}for(var be=K-16,Le=new Uint8Array(be),Ue=0;Ue<be;Ue++)Le[Ue]=P[k++];R.push({payloadType:j,pts:A,uuid:le.join(""),userData:Object(p.utf8ArrayToStr)(Le),userDataBytes:Le})}}else if(K<$)k+=K;else if(K>$)break}}function T(h){for(var A=h.byteLength,R=[],P=1;P<A-2;)h[P]===0&&h[P+1]===0&&h[P+2]===3?(R.push(P+2),P+=2):P++;if(R.length===0)return h;var k=A-R.length,j=new Uint8Array(k),K=0;for(P=0;P<k;K++,P++)K===R[0]&&(K++,R.shift()),j[P]=h[K];return j}function m(h){var A=h[0],R="",P="",k=0,j=0,K=0,W=0,H=0,$=0;if(A===0){for(;C(h.subarray($,$+1))!=="\0";)R+=C(h.subarray($,$+1)),$+=1;for(R+=C(h.subarray($,$+1)),$+=1;C(h.subarray($,$+1))!=="\0";)P+=C(h.subarray($,$+1)),$+=1;P+=C(h.subarray($,$+1)),$+=1,k=b(h,12),j=b(h,16),W=b(h,20),H=b(h,24),$=28}else if(A===1){$+=4,k=b(h,$),$+=4;var z=b(h,$);$+=4;var J=b(h,$);for($+=4,K=Math.pow(2,32)*z+J,Number.isSafeInteger(K)||(K=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),W=b(h,$),$+=4,H=b(h,$),$+=4;C(h.subarray($,$+1))!=="\0";)R+=C(h.subarray($,$+1)),$+=1;for(R+=C(h.subarray($,$+1)),$+=1;C(h.subarray($,$+1))!=="\0";)P+=C(h.subarray($,$+1)),$+=1;P+=C(h.subarray($,$+1)),$+=1}var ee=h.subarray($,h.byteLength);return{schemeIdUri:R,value:P,timeScale:k,presentationTime:K,presentationTimeDelta:j,eventDuration:W,id:H,payload:ee}}},"./src/utils/output-filter.ts":function(n,i,r){r.r(i),r.d(i,"default",function(){return D});var D=function(){function c(w,M){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=w,this.trackName=M}var p=c.prototype;return p.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},p.newCue=function(M,O,C){(this.startTime===null||this.startTime>M)&&(this.startTime=M),this.endTime=O,this.screen=C,this.timelineController.createCaptionsTrack(this.trackName)},p.reset=function(){this.cueRanges=[],this.startTime=null},c}()},"./src/utils/texttrack-utils.ts":function(n,i,r){r.r(i),r.d(i,"sendAddTrackEvent",function(){return c}),r.d(i,"addCueToTrack",function(){return p}),r.d(i,"clearCurrentCues",function(){return w}),r.d(i,"removeCuesInRange",function(){return M}),r.d(i,"getCuesInRange",function(){return C});var D=r("./src/utils/logger.ts");function c(S,b){var I;try{I=new Event("addtrack")}catch{I=document.createEvent("Event"),I.initEvent("addtrack",!1,!1)}I.track=S,b.dispatchEvent(I)}function p(S,b){var I=S.mode;if(I==="disabled"&&(S.mode="hidden"),S.cues&&!S.cues.getCueById(b.id))try{if(S.addCue(b),!S.cues.getCueById(b.id))throw new Error("addCue is failed for: "+b)}catch(_){D.logger.debug("[texttrack-utils]: "+_);var L=new self.TextTrackCue(b.startTime,b.endTime,b.text);L.id=b.id,S.addCue(L)}I==="disabled"&&(S.mode=I)}function w(S){var b=S.mode;if(b==="disabled"&&(S.mode="hidden"),S.cues)for(var I=S.cues.length;I--;)S.removeCue(S.cues[I]);b==="disabled"&&(S.mode=b)}function M(S,b,I,L){var _=S.mode;if(_==="disabled"&&(S.mode="hidden"),S.cues&&S.cues.length>0)for(var x=C(S.cues,b,I),l=0;l<x.length;l++)(!L||L(x[l]))&&S.removeCue(x[l]);_==="disabled"&&(S.mode=_)}function O(S,b){if(b<S[0].startTime)return 0;var I=S.length-1;if(b>S[I].endTime)return-1;for(var L=0,_=I;L<=_;){var x=Math.floor((_+L)/2);if(b<S[x].startTime)_=x-1;else if(b>S[x].startTime&&L<I)L=x+1;else return x}return S[L].startTime-b<b-S[_].startTime?L:_}function C(S,b,I){var L=[],_=O(S,b);if(_>-1)for(var x=_,l=S.length;x<l;x++){var a=S[x];if(a.startTime>=b&&a.endTime<=I)L.push(a);else if(a.startTime>I)return L}return L}},"./src/utils/time-ranges.ts":function(n,i,r){r.r(i);var D={toString:function(p){for(var w="",M=p.length,O=0;O<M;O++)w+="["+p.start(O).toFixed(3)+","+p.end(O).toFixed(3)+"]";return w}};i.default=D},"./src/utils/timescale-conversion.ts":function(n,i,r){r.r(i),r.d(i,"toTimescaleFromBase",function(){return c}),r.d(i,"toTimescaleFromScale",function(){return p}),r.d(i,"toMsFromMpegTsClock",function(){return w}),r.d(i,"toMpegTsClockFromTimescale",function(){return M});var D=9e4;function c(O,C,S,b){S===void 0&&(S=1),b===void 0&&(b=!1);var I=O*C*S;return b?Math.round(I):I}function p(O,C,S,b){return S===void 0&&(S=1),b===void 0&&(b=!1),c(O,C,1/S,b)}function w(O,C){return C===void 0&&(C=!1),c(O,1e3,1/D,C)}function M(O,C){return C===void 0&&(C=1),c(O,D,1/C)}},"./src/utils/typed-array.ts":function(n,i,r){r.r(i),r.d(i,"sliceUint8",function(){return D});function D(c,p,w){return Uint8Array.prototype.slice?c.slice(p,w):new Uint8Array(Array.prototype.slice.call(c,p,w))}},"./src/utils/vttcue.ts":function(n,i,r){r.r(i),i.default=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var D=["","lr","rl"],c=["start","middle","end","left","right"];function p(S,b){if(typeof b!="string"||!Array.isArray(S))return!1;var I=b.toLowerCase();return~S.indexOf(I)?I:!1}function w(S){return p(D,S)}function M(S){return p(c,S)}function O(S){for(var b=arguments.length,I=new Array(b>1?b-1:0),L=1;L<b;L++)I[L-1]=arguments[L];for(var _=1;_<arguments.length;_++){var x=arguments[_];for(var l in x)S[l]=x[l]}return S}function C(S,b,I){var L=this,_={enumerable:!0};L.hasBeenReset=!1;var x="",l=!1,a=S,d=b,y=I,E=null,u="",s=!0,o="auto",g="start",f=50,v="middle",T=50,m="middle";Object.defineProperty(L,"id",O({},_,{get:function(){return x},set:function(A){x=""+A}})),Object.defineProperty(L,"pauseOnExit",O({},_,{get:function(){return l},set:function(A){l=!!A}})),Object.defineProperty(L,"startTime",O({},_,{get:function(){return a},set:function(A){if(typeof A!="number")throw new TypeError("Start time must be set to a number.");a=A,this.hasBeenReset=!0}})),Object.defineProperty(L,"endTime",O({},_,{get:function(){return d},set:function(A){if(typeof A!="number")throw new TypeError("End time must be set to a number.");d=A,this.hasBeenReset=!0}})),Object.defineProperty(L,"text",O({},_,{get:function(){return y},set:function(A){y=""+A,this.hasBeenReset=!0}})),Object.defineProperty(L,"region",O({},_,{get:function(){return E},set:function(A){E=A,this.hasBeenReset=!0}})),Object.defineProperty(L,"vertical",O({},_,{get:function(){return u},set:function(A){var R=w(A);if(R===!1)throw new SyntaxError("An invalid or illegal string was specified.");u=R,this.hasBeenReset=!0}})),Object.defineProperty(L,"snapToLines",O({},_,{get:function(){return s},set:function(A){s=!!A,this.hasBeenReset=!0}})),Object.defineProperty(L,"line",O({},_,{get:function(){return o},set:function(A){if(typeof A!="number"&&A!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");o=A,this.hasBeenReset=!0}})),Object.defineProperty(L,"lineAlign",O({},_,{get:function(){return g},set:function(A){var R=M(A);if(!R)throw new SyntaxError("An invalid or illegal string was specified.");g=R,this.hasBeenReset=!0}})),Object.defineProperty(L,"position",O({},_,{get:function(){return f},set:function(A){if(A<0||A>100)throw new Error("Position must be between 0 and 100.");f=A,this.hasBeenReset=!0}})),Object.defineProperty(L,"positionAlign",O({},_,{get:function(){return v},set:function(A){var R=M(A);if(!R)throw new SyntaxError("An invalid or illegal string was specified.");v=R,this.hasBeenReset=!0}})),Object.defineProperty(L,"size",O({},_,{get:function(){return T},set:function(A){if(A<0||A>100)throw new Error("Size must be between 0 and 100.");T=A,this.hasBeenReset=!0}})),Object.defineProperty(L,"align",O({},_,{get:function(){return m},set:function(A){var R=M(A);if(!R)throw new SyntaxError("An invalid or illegal string was specified.");m=R,this.hasBeenReset=!0}})),L.displayState=void 0}return C.prototype.getCueAsHTML=function(){var S=self.WebVTT;return S.convertCueToDOMTree(self,this.text)},C}()},"./src/utils/vttparser.ts":function(n,i,r){r.r(i),r.d(i,"parseTimeStamp",function(){return p}),r.d(i,"fixLineBreaks",function(){return b}),r.d(i,"VTTParser",function(){return I});var D=r("./src/utils/vttcue.ts"),c=function(){function L(){}var _=L.prototype;return _.decode=function(l,a){if(!l)return"";if(typeof l!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(l))},L}();function p(L){function _(l,a,d,y){return(l|0)*3600+(a|0)*60+(d|0)+parseFloat(y||0)}var x=L.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return x?parseFloat(x[2])>59?_(x[2],x[3],0,x[4]):_(x[1],x[2],x[3],x[4]):null}var w=function(){function L(){this.values=Object.create(null)}var _=L.prototype;return _.set=function(l,a){!this.get(l)&&a!==""&&(this.values[l]=a)},_.get=function(l,a,d){return d?this.has(l)?this.values[l]:a[d]:this.has(l)?this.values[l]:a},_.has=function(l){return l in this.values},_.alt=function(l,a,d){for(var y=0;y<d.length;++y)if(a===d[y]){this.set(l,a);break}},_.integer=function(l,a){/^-?\d+$/.test(a)&&this.set(l,parseInt(a,10))},_.percent=function(l,a){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(a)){var d=parseFloat(a);if(d>=0&&d<=100)return this.set(l,d),!0}return!1},L}();function M(L,_,x,l){var a=l?L.split(l):[L];for(var d in a)if(typeof a[d]=="string"){var y=a[d].split(x);if(y.length===2){var E=y[0],u=y[1];_(E,u)}}}var O=new D.default(0,0,""),C=O.align==="middle"?"middle":"center";function S(L,_,x){var l=L;function a(){var E=p(L);if(E===null)throw new Error("Malformed timestamp: "+l);return L=L.replace(/^[^\sa-zA-Z-]+/,""),E}function d(E,u){var s=new w;M(E,function(f,v){var T;switch(f){case"region":for(var m=x.length-1;m>=0;m--)if(x[m].id===v){s.set(f,x[m].region);break}break;case"vertical":s.alt(f,v,["rl","lr"]);break;case"line":T=v.split(","),s.integer(f,T[0]),s.percent(f,T[0])&&s.set("snapToLines",!1),s.alt(f,T[0],["auto"]),T.length===2&&s.alt("lineAlign",T[1],["start",C,"end"]);break;case"position":T=v.split(","),s.percent(f,T[0]),T.length===2&&s.alt("positionAlign",T[1],["start",C,"end","line-left","line-right","auto"]);break;case"size":s.percent(f,v);break;case"align":s.alt(f,v,["start",C,"end","left","right"]);break}},/:/,/\s/),u.region=s.get("region",null),u.vertical=s.get("vertical","");var o=s.get("line","auto");o==="auto"&&O.line===-1&&(o=-1),u.line=o,u.lineAlign=s.get("lineAlign","start"),u.snapToLines=s.get("snapToLines",!0),u.size=s.get("size",100),u.align=s.get("align",C);var g=s.get("position","auto");g==="auto"&&O.position===50&&(g=u.align==="start"||u.align==="left"?0:u.align==="end"||u.align==="right"?100:50),u.position=g}function y(){L=L.replace(/^\s+/,"")}if(y(),_.startTime=a(),y(),L.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+l);L=L.slice(3),y(),_.endTime=a(),y(),d(L,_)}function b(L){return L.replace(/<br(?: \/)?>/gi,`
`)}var I=function(){function L(){this.state="INITIAL",this.buffer="",this.decoder=new c,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var _=L.prototype;return _.parse=function(l){var a=this;l&&(a.buffer+=a.decoder.decode(l,{stream:!0}));function d(){var g=a.buffer,f=0;for(g=b(g);f<g.length&&g[f]!=="\r"&&g[f]!==`
`;)++f;var v=g.slice(0,f);return g[f]==="\r"&&++f,g[f]===`
`&&++f,a.buffer=g.slice(f),v}function y(g){M(g,function(f,v){},/:/)}try{var E="";if(a.state==="INITIAL"){if(!/\r\n|\n/.test(a.buffer))return this;E=d();var u=E.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!u||!u[0])throw new Error("Malformed WebVTT signature.");a.state="HEADER"}for(var s=!1;a.buffer;){if(!/\r\n|\n/.test(a.buffer))return this;switch(s?s=!1:E=d(),a.state){case"HEADER":/:/.test(E)?y(E):E||(a.state="ID");continue;case"NOTE":E||(a.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(E)){a.state="NOTE";break}if(!E)continue;if(a.cue=new D.default(0,0,""),a.state="CUE",E.indexOf("-->")===-1){a.cue.id=E;continue}case"CUE":if(!a.cue){a.state="BADCUE";continue}try{S(E,a.cue,a.regionList)}catch{a.cue=null,a.state="BADCUE";continue}a.state="CUETEXT";continue;case"CUETEXT":{var o=E.indexOf("-->")!==-1;if(!E||o&&(s=!0)){a.oncue&&a.cue&&a.oncue(a.cue),a.cue=null,a.state="ID";continue}if(a.cue===null)continue;a.cue.text&&(a.cue.text+=`
`),a.cue.text+=E}continue;case"BADCUE":E||(a.state="ID")}}}catch{a.state==="CUETEXT"&&a.cue&&a.oncue&&a.oncue(a.cue),a.cue=null,a.state=a.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},_.flush=function(){var l=this;try{if((l.cue||l.state==="HEADER")&&(l.buffer+=`

`,l.parse()),l.state==="INITIAL"||l.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(a){l.onparsingerror&&l.onparsingerror(a)}return l.onflush&&l.onflush(),this},L}()},"./src/utils/webvtt-parser.ts":function(n,i,r){r.r(i),r.d(i,"generateCueId",function(){return I}),r.d(i,"parseWebVTT",function(){return _});var D=r("./src/polyfills/number.ts"),c=r("./src/utils/vttparser.ts"),p=r("./src/demux/id3.ts"),w=r("./src/utils/timescale-conversion.ts"),M=r("./src/remux/mp4-remuxer.ts"),O=/\r\n|\n\r|\n|\r/g,C=function(l,a,d){return d===void 0&&(d=0),l.slice(d,d+a.length)===a},S=function(l){var a=parseInt(l.slice(-3)),d=parseInt(l.slice(-6,-4)),y=parseInt(l.slice(-9,-7)),E=l.length>9?parseInt(l.substring(0,l.indexOf(":"))):0;if(!Object(D.isFiniteNumber)(a)||!Object(D.isFiniteNumber)(d)||!Object(D.isFiniteNumber)(y)||!Object(D.isFiniteNumber)(E))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+l);return a+=1e3*d,a+=60*1e3*y,a+=60*60*1e3*E,a},b=function(l){for(var a=5381,d=l.length;d;)a=a*33^l.charCodeAt(--d);return(a>>>0).toString()};function I(x,l,a){return b(x.toString())+b(l.toString())+b(a)}var L=function(l,a,d){var y=l[a],E=l[y.prevCC];if(!E||!E.new&&y.new){l.ccOffset=l.presentationOffset=y.start,y.new=!1;return}for(;(u=E)!==null&&u!==void 0&&u.new;){var u;l.ccOffset+=y.start-E.start,y.new=!1,y=E,E=l[y.prevCC]}l.presentationOffset=d};function _(x,l,a,d,y,E,u,s){var o=new c.VTTParser,g=Object(p.utf8ArrayToStr)(new Uint8Array(x)).trim().replace(O,`
`).split(`
`),f=[],v=Object(w.toMpegTsClockFromTimescale)(l,a),T="00:00.000",m=0,h=0,A,R=!0;o.oncue=function(P){var k=d[y],j=d.ccOffset,K=(m-v)/9e4;k!=null&&k.new&&(h!==void 0?j=d.ccOffset=k.start:L(d,y,K)),K&&(j=K-d.presentationOffset);var W=P.endTime-P.startTime,H=Object(M.normalizePts)((P.startTime+j-h)*9e4,E*9e4)/9e4;P.startTime=Math.max(H,0),P.endTime=Math.max(H+W,0);var $=P.text.trim();P.text=decodeURIComponent(encodeURIComponent($)),P.id||(P.id=I(P.startTime,P.endTime,$)),P.endTime>0&&f.push(P)},o.onparsingerror=function(P){A=P},o.onflush=function(){if(A){s(A);return}u(f)},g.forEach(function(P){if(R)if(C(P,"X-TIMESTAMP-MAP=")){R=!1,P.slice(16).split(",").forEach(function(k){C(k,"LOCAL:")?T=k.slice(6):C(k,"MPEGTS:")&&(m=parseInt(k.slice(7)))});try{h=S(T)/1e3}catch(k){A=k}return}else P===""&&(R=!1);o.parse(P+`
`)}),o.flush()}},"./src/utils/xhr-loader.ts":function(n,i,r){r.r(i);var D=r("./src/utils/logger.ts"),c=r("./src/loader/load-stats.ts"),p=/^age:\s*[\d.]+\s*$/m,w=function(){function M(C){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=C?C.xhrSetup:null,this.stats=new c.LoadStats,this.retryDelay=0}var O=M.prototype;return O.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},O.abortInternal=function(){var S=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),S&&(S.onreadystatechange=null,S.onprogress=null,S.readyState!==4&&(this.stats.aborted=!0,S.abort()))},O.abort=function(){var S;this.abortInternal(),(S=this.callbacks)!==null&&S!==void 0&&S.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},O.load=function(S,b,I){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=S,this.config=b,this.callbacks=I,this.retryDelay=b.retryDelay,this.loadInternal()},O.loadInternal=function(){var S=this.config,b=this.context;if(!!S){var I=this.loader=new self.XMLHttpRequest,L=this.stats;L.loading.first=0,L.loaded=0;var _=this.xhrSetup;try{if(_)try{_(I,b.url)}catch{I.open("GET",b.url,!0),_(I,b.url)}I.readyState||I.open("GET",b.url,!0);var x=this.context.headers;if(x)for(var l in x)I.setRequestHeader(l,x[l])}catch(a){this.callbacks.onError({code:I.status,text:a.message},b,I);return}b.rangeEnd&&I.setRequestHeader("Range","bytes="+b.rangeStart+"-"+(b.rangeEnd-1)),I.onreadystatechange=this.readystatechange.bind(this),I.onprogress=this.loadprogress.bind(this),I.responseType=b.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),S.timeout),I.send()}},O.readystatechange=function(){var S=this.context,b=this.loader,I=this.stats;if(!(!S||!b)){var L=b.readyState,_=this.config;if(!I.aborted&&L>=2)if(self.clearTimeout(this.requestTimeout),I.loading.first===0&&(I.loading.first=Math.max(self.performance.now(),I.loading.start)),L===4){b.onreadystatechange=null,b.onprogress=null;var x=b.status;if(x>=200&&x<300){I.loading.end=Math.max(self.performance.now(),I.loading.first);var l,a;if(S.responseType==="arraybuffer"?(l=b.response,a=l.byteLength):(l=b.responseText,a=l.length),I.loaded=I.total=a,!this.callbacks)return;var d=this.callbacks.onProgress;if(d&&d(I,S,l,b),!this.callbacks)return;var y={url:b.responseURL,data:l};this.callbacks.onSuccess(y,I,S,b)}else I.retry>=_.maxRetry||x>=400&&x<499?(D.logger.error(x+" while loading "+S.url),this.callbacks.onError({code:x,text:b.statusText},S,b)):(D.logger.warn(x+" while loading "+S.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,_.maxRetryDelay),I.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),_.timeout)}},O.loadtimeout=function(){D.logger.warn("timeout while loading "+this.context.url);var S=this.callbacks;S&&(this.abortInternal(),S.onTimeout(this.stats,this.context,this.loader))},O.loadprogress=function(S){var b=this.stats;b.loaded=S.loaded,S.lengthComputable&&(b.total=S.total)},O.getCacheAge=function(){var S=null;if(this.loader&&p.test(this.loader.getAllResponseHeaders())){var b=this.loader.getResponseHeader("age");S=b?parseFloat(b):null}return S},M}();i.default=w}}).default})})(Bo);const Nt=Ks(Bo.exports);var Ga=(t,e,n,i)=>{t.addEventListener(e,n,i),t.addEventListener("teardown",()=>{t.removeEventListener(e,n)},{once:!0})},No=(t,e)=>t in e;function pf(t,e,n){e&&n>e&&(n=e);for(let i=0;i<t.length;i++)if(t.start(i)<=n&&t.end(i)>=n)return!0;return!1}var Ef={ANY:"any",MUTED:"muted"};Object.values(Ef);var Yr=class extends Error{constructor(t,e=Yr.MEDIA_ERR_CUSTOM,n){var i;super(t),this.name="MediaError",this.code=e,this.fatal=n!=null?n:e>=Yr.MEDIA_ERR_NETWORK&&e<=Yr.MEDIA_ERR_ENCRYPTED,this.message||(this.message=(i=Yr.defaultMessages[this.code])!=null?i:"")}},It=Yr;It.MEDIA_ERR_ABORTED=1,It.MEDIA_ERR_NETWORK=2,It.MEDIA_ERR_DECODE=3,It.MEDIA_ERR_SRC_NOT_SUPPORTED=4,It.MEDIA_ERR_ENCRYPTED=5,It.MEDIA_ERR_CUSTOM=100,It.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail.",3:"A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format.",4:"An unsupported error occurred. The server or network failed, or your browser does not support this format.",5:"The media is encrypted and there are no keys to decrypt it."};function yf(t,e){e.on(Nt.Events.NON_NATIVE_TEXT_TRACKS_FOUND,(r,{tracks:D})=>{D.forEach(c=>{var p;let w=(p=c.subtitleTrack)!=null?p:c.closedCaptions,M=e.subtitleTracks.findIndex(({lang:O,name:C,type:S})=>O==(w==null?void 0:w.lang)&&C===c.label&&S.toLowerCase()===c.kind);Tf(t,c.kind,c.label,w==null?void 0:w.lang,`${c.kind}${M}`)})});let n=()=>{var r;if(!e.subtitleTracks.length)return;let D=Array.from(t.textTracks).find(p=>p.id&&p.mode==="showing"&&["subtitles","captions"].includes(p.kind)),c=`${(r=e.subtitleTracks[e.subtitleTrack])==null?void 0:r.type.toLowerCase()}${e.subtitleTrack}`;if(D&&(e.subtitleTrack<0||(D==null?void 0:D.id)!==c)){let p=e.subtitleTracks.findIndex(({lang:w,name:M,type:O})=>w==D.language&&M===D.label&&O.toLowerCase()===D.kind);e.subtitleTrack=p}D&&(D==null?void 0:D.id)===c&&D.cues&&Array.from(D.cues).forEach(p=>{D.addCue(p)})};t.textTracks.addEventListener("change",n),e.on(Nt.Events.CUES_PARSED,(r,{track:D,type:c,cues:p})=>{let w=t.textTracks.getTrackById(D);if(!w)return;let M=w.mode==="disabled";M&&(w.mode="hidden"),p.forEach(O=>{var C;(C=w.cues)!=null&&C.getCueById(O.id)||w.addCue(O)}),M&&(w.mode="disabled")}),e.once(Nt.Events.DESTROYING,()=>{t.textTracks.removeEventListener("change",n),t.querySelectorAll("track[data-removeondestroy]").forEach(r=>{r.remove()})});let i=()=>{Array.from(t.textTracks).forEach(r=>{var D,c;if(!["subtitles","caption"].includes(r.kind)&&r.label==="thumbnails"){if(!((D=r.cues)!=null&&D.length)){let p=t.querySelector('track[label="thumbnails"]'),w=(c=p==null?void 0:p.getAttribute("src"))!=null?c:"";p==null||p.removeAttribute("src"),setTimeout(()=>{p==null||p.setAttribute("src",w)},0)}r.mode!=="hidden"&&(r.mode="hidden")}})};e.once(Nt.Events.MANIFEST_LOADED,i),e.once(Nt.Events.MEDIA_ATTACHED,i)}function Tf(t,e,n,i,r){let D=document.createElement("track");return D.kind=e,D.label=n,i&&(D.srclang=i),r&&(D.id=r),D.track.mode="disabled",D.setAttribute("data-removeondestroy",""),t.append(D),D.track}var Ha,Va,bf=(Va=(Ha=globalThis==null?void 0:globalThis.navigator)==null?void 0:Ha.userAgent)!=null?Va:"",Sf=bf.toLowerCase().indexOf("android")!==-1,Af="mux.com",$a,za,Ni=(za=($a=Nt).isSupported)==null?void 0:za.call($a),Ko=Sf,_f=()=>Fo.utils.now(),Ti={VOD:"on-demand",ON_DEMAND:"on-demand",LIVE:"live",LL_LIVE:"ll-live",DVR:"live:dvr",LL_DVR:"ll-live:dvr"},Pr={M3U8:"application/vnd.apple.mpegurl",MP4:"video/mp4"},Ya={HLS:Pr.M3U8};[...Object.values(Pr)];var xf=t=>{let e="";try{e=new URL(t).pathname}catch{console.error("invalid url")}let n=e.lastIndexOf(".");if(n<0)return"";let i=e.slice(n+1).toUpperCase();return No(i,Pr)?Pr[i]:""},jo=t=>{let e=t.type;if(e){let i=e.toUpperCase();return No(i,Ya)?Ya[i]:e}let{src:n}=t;return n?xf(n):""},Df=t=>{if([Ti.LIVE,Ti.LL_LIVE].includes(t)){let e={backBufferLength:12};return t===Ti.LL_LIVE?{...e,maxFragLookUpTolerance:.001}:e}return{}},dn=new WeakMap,If=(t,e)=>{e&&(e.detachMedia(),e.destroy()),(t==null?void 0:t.mux)&&!t.mux.deleted&&(t.mux.destroy(),delete t.mux),t&&(t.removeAttribute("src"),t.load(),t.removeEventListener("error",Go),t.removeEventListener("error",Ki),t.removeEventListener("durationchange",Wo),dn.delete(t),t.dispatchEvent(new Event("teardown")))},Lf=(t,e)=>{var n;let{debug:i,preferMse:r,streamType:D,startTime:c=-1}=t,p=jo(t),w=p===Pr.M3U8,M=!p||((n=e==null?void 0:e.canPlayType(p))!=null?n:!0);if(w&&!(!w||M&&!((r||Ko)&&Ni))&&Ni){let O={backBufferLength:30,renderTextTracksNatively:!1,liveDurationInfinity:!0},C=Df(D);return new Nt({debug:i,startPosition:c,...O,...C})}},Rf=({playbackId:t,src:e,customDomain:n})=>{if(t)return!0;if(typeof e!="string")return!1;let i=new URL(e).hostname.toLocaleLowerCase();return i.includes(Af)||!!n&&i.includes(n.toLocaleLowerCase())},Cf=(t,e,n)=>{let{envKey:i}=t,r=Rf(t);if((i||r)&&e){let{playerInitTime:D,playerSoftwareName:c,playerSoftwareVersion:p,beaconCollectionDomain:w,metadata:M,debug:O}=t,C=S=>typeof S.player_error_code=="string"?!1:typeof t.errorTranslator=="function"?t.errorTranslator(S):S;Fo.monitor(e,{debug:O,beaconCollectionDomain:w,hlsjs:n,Hls:n?Nt:void 0,automaticErrorTracking:!1,errorTranslator:C,data:{...i?{env_key:i}:{},player_software_name:c,player_software:c,player_software_version:p,player_init_time:D,...M}})}},Of=(t,e,n)=>{var i,r;if(!e){console.warn("attempting to load media before mediaEl exists");return}let{preferMse:D,streamType:c}=t,p=jo(t),w=p===Pr.M3U8,M=!p||((i=e==null?void 0:e.canPlayType(p))!=null?i:!0),O=!w||M&&!((D||Ko)&&Ni),{src:C}=t;if(e&&M&&O)typeof C=="string"?(e.setAttribute("src",C),t.startTime&&(((r=dn.get(e))!=null?r:{}).startTime=t.startTime,e.addEventListener("durationchange",Wo,{once:!0}))):e.removeAttribute("src"),e.addEventListener("error",Go),e.addEventListener("error",Ki);else if(n&&C){switch(n.on(Nt.Events.ERROR,(S,b)=>{let I={[Nt.ErrorTypes.NETWORK_ERROR]:It.MEDIA_ERR_NETWORK,[Nt.ErrorTypes.MEDIA_ERROR]:It.MEDIA_ERR_DECODE},L=new It("",I[b.type]);L.fatal=b.fatal,L.data=b,e.dispatchEvent(new CustomEvent("error",{detail:L}))}),e.addEventListener("error",Ki),yf(e,n),e.preload){case"none":Ga(e,"play",()=>n.loadSource(C),{once:!0});break;case"metadata":let S=n.config.maxBufferLength,b=n.config.maxBufferSize;n.config.maxBufferLength=1,n.config.maxBufferSize=1,Ga(e,"play",()=>{n.config.maxBufferLength=S,n.config.maxBufferSize=b},{once:!0}),n.loadSource(C);break;default:n.loadSource(C)}n.attachMedia(e)}else console.error("It looks like the video you're trying to play will not work on this system! If possible, try upgrading to the newest versions of your browser or software.")};function Wo(t){var e;let n=t.target,i=(e=dn.get(n))==null?void 0:e.startTime;if(!!i&&pf(n.seekable,n.duration,i)){let r=n.preload==="auto";r&&(n.preload="none"),n.currentTime=i,r&&(n.preload="auto")}}async function Go(t){if(!t.isTrusted)return;t.stopImmediatePropagation();let e=t.target;if(!(e!=null&&e.error))return;let{message:n,code:i}=e.error,r=new It(n,i);if(e.src&&(i!==It.MEDIA_ERR_DECODE||i!==void 0)){let{status:D}=await fetch(e.src);r.data={response:{code:D}}}e.dispatchEvent(new CustomEvent("error",{detail:r}))}function Ki(t){var e,n;if(!(t instanceof CustomEvent)||!(t.detail instanceof It))return;let i=t.target,r=t.detail;!r||!r.fatal||(((e=dn.get(i))!=null?e:{}).error=r,(n=i.mux)==null||n.emit("error",{player_error_code:r.code,player_error_message:r.message}))}var Mf=(t,e,n)=>{If(e,n),dn.set(e,{});let i=Lf(t,e);return Cf(t,e,i),Of(t,e,i),i};const Ae={MEDIA_PLAY_REQUEST:"mediaplayrequest",MEDIA_PAUSE_REQUEST:"mediapauserequest",MEDIA_MUTE_REQUEST:"mediamuterequest",MEDIA_UNMUTE_REQUEST:"mediaunmuterequest",MEDIA_VOLUME_REQUEST:"mediavolumerequest",MEDIA_SEEK_REQUEST:"mediaseekrequest",MEDIA_AIRPLAY_REQUEST:"mediaairplayrequest",MEDIA_ENTER_FULLSCREEN_REQUEST:"mediaenterfullscreenrequest",MEDIA_EXIT_FULLSCREEN_REQUEST:"mediaexitfullscreenrequest",MEDIA_PREVIEW_REQUEST:"mediapreviewrequest",MEDIA_ENTER_PIP_REQUEST:"mediaenterpiprequest",MEDIA_EXIT_PIP_REQUEST:"mediaexitpiprequest",MEDIA_ENTER_CAST_REQUEST:"mediaentercastrequest",MEDIA_EXIT_CAST_REQUEST:"mediaexitcastrequest",MEDIA_SHOW_TEXT_TRACKS_REQUEST:"mediashowtexttracksrequest",MEDIA_HIDE_TEXT_TRACKS_REQUEST:"mediahidetexttracksrequest",MEDIA_SHOW_CAPTIONS_REQUEST:"mediashowcaptionsrequest",MEDIA_SHOW_SUBTITLES_REQUEST:"mediashowsubtitlesrequest",MEDIA_DISABLE_CAPTIONS_REQUEST:"mediadisablecaptionsrequest",MEDIA_DISABLE_SUBTITLES_REQUEST:"mediadisablesubtitlesrequest",MEDIA_PLAYBACK_RATE_REQUEST:"mediaplaybackraterequest",REGISTER_MEDIA_STATE_RECEIVER:"registermediastatereceiver",UNREGISTER_MEDIA_STATE_RECEIVER:"unregistermediastatereceiver"},Hn={MEDIA_AIRPLAY_UNAVAILABLE:"mediaairplayunavailablechange",MEDIA_PIP_UNAVAILABLE:"mediapipunavailablechange",MEDIA_PAUSED:"mediapausedchange",MEDIA_HAS_PLAYED:"mediahasplayedchange",MEDIA_MUTED:"mediamutedchange",MEDIA_VOLUME_LEVEL:"mediavolumelevelchange",MEDIA_VOLUME:"mediavolumechange",MEDIA_VOLUME_UNAVAILABLE:"mediavolumeunavailablechange",MEDIA_IS_PIP:"mediaispipchange",MEDIA_IS_CASTING:"mediaiscastingchange",MEDIA_CAPTIONS_LIST:"mediacaptionslistchange",MEDIA_SUBTITLES_LIST:"mediasubtitleslistchange",MEDIA_CAPTIONS_SHOWING:"mediacaptionsshowingchange",MEDIA_SUBTITLES_SHOWING:"mediasubtitlesshowingchange",MEDIA_IS_FULLSCREEN:"mediaisfullscreenchange",MEDIA_PLAYBACK_RATE:"mediaplaybackratechange",MEDIA_CURRENT_TIME:"mediacurrenttimechange",MEDIA_DURATION:"mediadurationchange",MEDIA_SEEKABLE:"mediaseekablechange",MEDIA_PREVIEW_IMAGE:"mediapreviewimagechange",MEDIA_PREVIEW_COORDS:"mediapreviewcoordschange",MEDIA_LOADING:"medialoadingchange",USER_INACTIVE:"userinactivechange"},Me={MEDIA_CHROME_ATTRIBUTES:"media-chrome-attributes",MEDIA_CONTROLLER:"media-controller"},X={MEDIA_AIRPLAY_UNAVAILABLE:"media-airplay-unavailable",MEDIA_FULLSCREEN_UNAVAILABLE:"media-fullscreen-unavailable",MEDIA_PIP_UNAVAILABLE:"media-pip-unavailable",MEDIA_CAST_UNAVAILABLE:"media-cast-unavailable",MEDIA_PAUSED:"media-paused",MEDIA_HAS_PLAYED:"media-has-played",MEDIA_MUTED:"media-muted",MEDIA_VOLUME_LEVEL:"media-volume-level",MEDIA_VOLUME:"media-volume",MEDIA_VOLUME_UNAVAILABLE:"media-volume-unavailable",MEDIA_IS_PIP:"media-is-pip",MEDIA_IS_CASTING:"media-is-casting",MEDIA_CAPTIONS_LIST:"media-captions-list",MEDIA_SUBTITLES_LIST:"media-subtitles-list",MEDIA_CAPTIONS_SHOWING:"media-captions-showing",MEDIA_SUBTITLES_SHOWING:"media-subtitles-showing",MEDIA_IS_FULLSCREEN:"media-is-fullscreen",MEDIA_PLAYBACK_RATE:"media-playback-rate",MEDIA_CURRENT_TIME:"media-current-time",MEDIA_DURATION:"media-duration",MEDIA_SEEKABLE:"media-seekable",MEDIA_PREVIEW_TIME:"media-preview-time",MEDIA_PREVIEW_IMAGE:"media-preview-image",MEDIA_PREVIEW_COORDS:"media-preview-coords",MEDIA_LOADING:"media-loading",MEDIA_BUFFERED:"media-buffered",MEDIA_STREAM_TYPE:"media-stream-type"};Object.entries(Hn).reduce((t,[e,n])=>{const i=X[e];return i&&(t[n]=i),t},{userinactivechange:"user-inactive"});const Pf=Object.entries(X).reduce((t,[e,n])=>{const i=Hn[e];return i&&(t[n]=i),t},{"user-inactive":"userinactivechange"}),cn={SUBTITLES:"subtitles",CAPTIONS:"captions",DESCRIPTIONS:"descriptions",CHAPTERS:"chapters",METADATA:"metadata"},Dr={DISABLED:"disabled",HIDDEN:"hidden",SHOWING:"showing"},Xa={MOUSE:"mouse",PEN:"pen",TOUCH:"touch"},Vt={UNAVAILABLE:"unavailable",UNSUPPORTED:"unsupported"},ji={LIVE:"live",ON_DEMAND:"on-demand"},cr={AUDIO_PLAYER:()=>"audio player",VIDEO_PLAYER:()=>"video player",VOLUME:()=>"volume",SEEK:()=>"seek",CLOSED_CAPTIONS:()=>"closed captions",PLAYBACK_RATE:({playbackRate:t=1}={})=>`current playback rate ${t}`,PLAYBACK_TIME:()=>"playback time",MEDIA_LOADING:()=>"media loading"},Rt={PLAY:()=>"play",PAUSE:()=>"pause",MUTE:()=>"mute",UNMUTE:()=>"unmute",AIRPLAY:()=>"air play",ENTER_CAST:()=>"start casting",EXIT_CAST:()=>"stop casting",ENTER_FULLSCREEN:()=>"enter fullscreen mode",EXIT_FULLSCREEN:()=>"exit fullscreen mode",ENTER_PIP:()=>"enter picture in picture mode",EXIT_PIP:()=>"exit picture in picture mode",SEEK_FORWARD_N_SECS:({seekOffset:t=30}={})=>`seek forward ${t} seconds`,SEEK_BACK_N_SECS:({seekOffset:t=30}={})=>`seek back ${t} seconds`};function bi(t,e=!1){return t.split("_").map(function(n,i){return(i||e?n[0].toUpperCase():n[0].toLowerCase())+n.slice(1).toLowerCase()}).join("")}function wf(t){return typeof t=="number"&&!Number.isNaN(t)&&Number.isFinite(t)}const Qa=[{singular:"hour",plural:"hours"},{singular:"minute",plural:"minutes"},{singular:"second",plural:"seconds"}],kf=(t,e)=>{const n=t===1?Qa[e].singular:Qa[e].plural;return`${t} ${n}`},tn=t=>{if(!wf(t))return"";const e=Math.abs(t),n=e!==t,i=new Date(0,0,0,0,0,e,0);return`${[i.getHours(),i.getMinutes(),i.getSeconds()].map((p,w)=>p&&kf(p,w)).filter(p=>p).join(", ")}${n?" remaining":""}`};function Cr(t,e){let n=!1;t<0&&(n=!0,t=0-t),t=t<0?0:t;let i=Math.floor(t%60),r=Math.floor(t/60%60),D=Math.floor(t/3600);const c=Math.floor(e/60%60),p=Math.floor(e/3600);return(isNaN(t)||t===1/0)&&(D=r=i="-"),D=D>0||p>0?D+":":"",r=((D||c>=10)&&r<10?"0"+r:r)+":",i=i<10?"0"+i:i,(n?"-":"")+D+r+i}class Za{addEventListener(){}removeEventListener(){}dispatchEvent(){return!0}}const Ho={HTMLElement:class extends Za{},DocumentFragment:class extends Za{},customElements:{get:function(){},define:function(){},whenDefined:function(){}},CustomEvent:function(){}},Uf={createElement:function(){return new Ho.HTMLElement}},Vo=typeof window>"u"||typeof window.customElements>"u",me=Vo?Ho:window,de=Vo?Uf:window.document;function ke(t,e){me.customElements.get(t)||(me.customElements.define(t,e),me[e.name]=e)}var Ff=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)},hr=(t,e,n)=>(Ff(t,e,"read from private field"),n?n.call(t):e.get(t)),Si=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},Cn,Sr,Wi;const $o=de.createElement("template");$o.innerHTML=`
<style>
  :host {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    vertical-align: middle;
    box-sizing: border-box;
    background: var(--media-control-background, rgba(20,20,30, 0.7));

    padding: var(--media-control-padding, 10px);

    
    font-size: 14px;
    line-height: var(--media-text-content-height, var(--media-control-height, 24px));
    font-weight: bold;
    color: #fff;

    transition: background 0.15s linear;

    pointer-events: auto;
    cursor: pointer;
    font-family: Arial, sans-serif;
  }

  
  :host(:focus-visible) {
    box-shadow: inset 0 0 0 2px rgba(27, 127, 204, 0.9);
    outline: 0;
  }
  
  :host(:where(:focus)) {
    box-shadow: none;
    outline: 0;
  }

  :host(:hover) {
    background: var(--media-control-hover-background, rgba(50,50,70, 0.7));
  }

  svg, img, ::slotted(svg), ::slotted(img) {
    width: var(--media-button-icon-width);
    height: var(--media-button-icon-height, var(--media-control-height, 24px));
    transform: var(--media-button-icon-transform);
    transition: var(--media-button-icon-transition);
    fill: var(--media-icon-color, #eee);
    vertical-align: middle;
    max-width: 100%;
    max-height: 100%;
    min-width: 100%;
  }
</style>
`;class zo extends me.HTMLElement{constructor(e={}){super(),Si(this,Cn,D=>{this.handleClick(D)}),Si(this,Sr,D=>{const{key:c}=D;if(!this.keysUsed.includes(c)){this.removeEventListener("keyup",hr(this,Sr));return}this.handleClick(D)}),Si(this,Wi,D=>{const{metaKey:c,altKey:p,key:w}=D;if(c||p||!this.keysUsed.includes(w)){this.removeEventListener("keyup",hr(this,Sr));return}this.addEventListener("keyup",hr(this,Sr),{once:!0})});const n=this.attachShadow({mode:"open"}),i=$o.content.cloneNode(!0);this.nativeEl=i;let r=e.slotTemplate;r||(r=de.createElement("template"),r.innerHTML=`<slot>${e.defaultContent||""}</slot>`),this.nativeEl.appendChild(r.content.cloneNode(!0)),n.appendChild(i)}static get observedAttributes(){return["disabled",Me.MEDIA_CONTROLLER]}enable(){this.addEventListener("click",hr(this,Cn)),this.addEventListener("keydown",hr(this,Wi)),this.setAttribute("tabindex","0")}disable(){this.removeEventListener("click",hr(this,Cn)),this.removeEventListener("keyup",hr(this,Sr)),this.removeAttribute("tabindex")}attributeChangedCallback(e,n,i){var r,D;if(e===Me.MEDIA_CONTROLLER){if(n){const c=de.getElementById(n);(r=c==null?void 0:c.unassociateElement)==null||r.call(c,this)}if(i){const c=de.getElementById(i);(D=c==null?void 0:c.associateElement)==null||D.call(c,this)}}else e==="disabled"&&i!==n&&(i==null?this.enable():this.disable())}connectedCallback(){var e;this.hasAttribute("disabled")||this.enable(),this.setAttribute("role","button");const n=this.getAttribute(Me.MEDIA_CONTROLLER);if(n){const i=de.getElementById(n);(e=i==null?void 0:i.associateElement)==null||e.call(i,this)}}disconnectedCallback(){var e;this.disable();const n=this.getAttribute(Me.MEDIA_CONTROLLER);if(n){const i=de.getElementById(n);(e=i==null?void 0:i.unassociateElement)==null||e.call(i,this)}}get keysUsed(){return["Enter"," "]}handleClick(e){}}Cn=new WeakMap;Sr=new WeakMap;Wi=new WeakMap;ke("media-chrome-button",zo);var Xt=zo;const Bf=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M22.13 3H3.87a.87.87 0 0 0-.87.87v13.26a.87.87 0 0 0 .87.87h3.4L9 16H5V5h16v11h-4l1.72 2h3.4a.87.87 0 0 0 .87-.87V3.87a.87.87 0 0 0-.86-.87Zm-8.75 11.44a.5.5 0 0 0-.76 0l-4.91 5.73a.5.5 0 0 0 .38.83h9.82a.501.501 0 0 0 .38-.83l-4.91-5.73Z"/>
</svg>
`,Yo=de.createElement("template");Yo.innerHTML=`
  <slot name="airplay">${Bf}</slot>
`;class Nf extends Xt{static get observedAttributes(){return[...super.observedAttributes,X.MEDIA_AIRPLAY_UNAVAILABLE]}constructor(e={}){super({slotTemplate:Yo,...e})}connectedCallback(){this.setAttribute("aria-label",Rt.AIRPLAY()),super.connectedCallback()}handleClick(){const e=new me.CustomEvent(Ae.MEDIA_AIRPLAY_REQUEST,{composed:!0,bubbles:!0});this.dispatchEvent(e)}}ke("media-airplay-button",Nf);const Kf='<svg aria-hidden="true" viewBox="0 0 24 24"><g><path class="cast_caf_icon_arch0" d="M1,18 L1,21 L4,21 C4,19.3 2.66,18 1,18 L1,18 Z"/><path class="cast_caf_icon_arch1" d="M1,14 L1,16 C3.76,16 6,18.2 6,21 L8,21 C8,17.13 4.87,14 1,14 L1,14 Z"/><path class="cast_caf_icon_arch2" d="M1,10 L1,12 C5.97,12 10,16.0 10,21 L12,21 C12,14.92 7.07,10 1,10 L1,10 Z"/><path class="cast_caf_icon_box" d="M21,3 L3,3 C1.9,3 1,3.9 1,5 L1,8 L3,8 L3,5 L21,5 L21,19 L14,19 L14,21 L21,21 C22.1,21 23,20.1 23,19 L23,5 C23,3.9 22.1,3 21,3 L21,3 Z"/></g></svg>',jf='<svg aria-hidden="true" viewBox="0 0 24 24"><g><path class="cast_caf_icon_arch0" d="M1,18 L1,21 L4,21 C4,19.3 2.66,18 1,18 L1,18 Z"/><path class="cast_caf_icon_arch1" d="M1,14 L1,16 C3.76,16 6,18.2 6,21 L8,21 C8,17.13 4.87,14 1,14 L1,14 Z"/><path class="cast_caf_icon_arch2" d="M1,10 L1,12 C5.97,12 10,16.0 10,21 L12,21 C12,14.92 7.07,10 1,10 L1,10 Z"/><path class="cast_caf_icon_box" d="M21,3 L3,3 C1.9,3 1,3.9 1,5 L1,8 L3,8 L3,5 L21,5 L21,19 L14,19 L14,21 L21,21 C22.1,21 23,20.1 23,19 L23,5 C23,3.9 22.1,3 21,3 L21,3 Z"/><path class="cast_caf_icon_boxfill" d="M5,7 L5,8.63 C8,8.6 13.37,14 13.37,17 L19,17 L19,7 Z"/></g></svg>',Xo=de.createElement("template");Xo.innerHTML=`
  <style>
  :host([${X.MEDIA_IS_CASTING}]) slot:not([name=exit]) > *,
  :host([${X.MEDIA_IS_CASTING}]) ::slotted(:not([slot=exit])) {
    display: none !important;
  }

  
  :host(:not([${X.MEDIA_IS_CASTING}])) slot:not([name=enter]) > *,
  :host(:not([${X.MEDIA_IS_CASTING}])) ::slotted(:not([slot=enter])) {
    display: none !important;
  }
  </style>

  <slot name="enter">${Kf}</slot>
  <slot name="exit">${jf}</slot>
`;const Ja=t=>{const n=t.getAttribute(X.MEDIA_IS_CASTING)!=null?Rt.EXIT_CAST():Rt.ENTER_CAST();t.setAttribute("aria-label",n)};class Wf extends Xt{static get observedAttributes(){return[...super.observedAttributes,X.MEDIA_IS_CASTING,X.MEDIA_CAST_UNAVAILABLE]}constructor(e={}){super({slotTemplate:Xo,...e})}connectedCallback(){Ja(this),super.connectedCallback()}attributeChangedCallback(e,n,i){e===X.MEDIA_IS_CASTING&&Ja(this),super.attributeChangedCallback(e,n,i)}handleClick(){const e=this.getAttribute(X.MEDIA_IS_CASTING)!=null?Ae.MEDIA_EXIT_CAST_REQUEST:Ae.MEDIA_ENTER_CAST_REQUEST;this.dispatchEvent(new me.CustomEvent(e,{composed:!0,bubbles:!0}))}}ke("media-cast-button",Wf);const Qo=(t,e,n=".value")=>{const i=t.querySelector(n);!i||(i.textContent=e)},Gf=(t,e)=>{const n=`slot[name="${e}"]`,i=t.shadowRoot.querySelector(n);return i?i.children:[]},Zo=(t,e)=>Gf(t,e)[0],On=(t,e)=>!t||!e?!1:t.contains(e)?!0:On(t,e.getRootNode().host),la=(t,e)=>{if(!t)return null;const n=t.closest(e);return n||la(t.getRootNode().host,e)};function wr(t,e){var n;let i;for(i of t.querySelectorAll("style")){let r;try{r=(n=i.sheet)==null?void 0:n.cssRules}catch{continue}for(let D of r!=null?r:[])if(D.selectorText===e)return D}return i!=null&&i.sheet?(i.sheet.insertRule(`${e}{}`,i.sheet.cssRules.length),i.sheet.cssRules[i.sheet.cssRules.length-1]):{style:{setProperty:()=>{}}}}const Jo=de.createElement("template");Jo.innerHTML=`
<style>
  :host {
    display: inline-block;
    box-sizing: border-box;
  }
</style>
`;class Hf extends me.HTMLElement{static get observedAttributes(){return[Me.MEDIA_CONTROLLER,X.MEDIA_PAUSED]}constructor(e={}){super();const n=this.attachShadow({mode:"open"}),i=Jo.content.cloneNode(!0);this.nativeEl=i;let r=e.slotTemplate;r||(r=de.createElement("template"),r.innerHTML=`<slot>${e.defaultContent||""}</slot>`),this.nativeEl.appendChild(r.content.cloneNode(!0)),n.appendChild(i)}attributeChangedCallback(e,n,i){var r,D;if(e===Me.MEDIA_CONTROLLER){if(n){const c=de.getElementById(n);(r=c==null?void 0:c.unassociateElement)==null||r.call(c,this)}if(i){const c=de.getElementById(i);(D=c==null?void 0:c.associateElement)==null||D.call(c,this)}}}connectedCallback(){var e;this.setAttribute("tabindex",-1),this.setAttribute("aria-hidden",!0);const n=qa(this);this.getAttribute(Me.MEDIA_CONTROLLER)&&((e=n==null?void 0:n.associateElement)==null||e.call(n,this)),n==null||n.addEventListener("pointerdown",this),n==null||n.addEventListener("click",this)}disconnectedCallback(){var e;const n=qa(this);this.getAttribute(Me.MEDIA_CONTROLLER)&&((e=n==null?void 0:n.unassociateElement)==null||e.call(n,this)),n==null||n.removeEventListener("pointerdown",this),n==null||n.removeEventListener("click",this)}handleEvent(e){var n;const i=(n=e.composedPath())==null?void 0:n[0];if(!!["video","media-controller"].includes(i==null?void 0:i.localName)){if(e.type==="pointerdown")this._pointerType=e.pointerType;else if(e.type==="click"){const{clientX:D,clientY:c}=e,{left:p,top:w,width:M,height:O}=this.getBoundingClientRect(),C=D-p,S=c-w;if(C<0||S<0||C>M||S>O||M===0&&O===0)return;const{pointerType:b=this._pointerType}=e;if(this._pointerType=void 0,b===Xa.TOUCH){this.handleTap(e);return}else if(b===Xa.MOUSE){this.handleMouseClick(e);return}}}}handleTap(e){}handleMouseClick(e){const n=this.getAttribute(X.MEDIA_PAUSED)!=null?Ae.MEDIA_PLAY_REQUEST:Ae.MEDIA_PAUSE_REQUEST;this.dispatchEvent(new me.CustomEvent(n,{composed:!0,bubbles:!0}))}}function qa(t){const e=t.getAttribute(Me.MEDIA_CONTROLLER);return e?de.getElementById(e):la(t,"media-controller")}ke("media-gesture-receiver",Hf);const qo=de.createElement("template");qo.innerHTML=`
  <style>
    
    :host([media-is-fullscreen])  ::slotted([slot=media]) {
      outline: none;
    }

    :host {
      box-sizing: border-box;
      position: relative;
      display: inline-block;
      line-height: 0;
      background-color: var(--media-background-color, #000);
    }

    :host(:not([audio])) [part~=layer]:not([part~=media-layer]) {
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      display: flex;
      flex-flow: column nowrap;
      align-items: start;
      pointer-events: none;
      background: none;
    }

    
    :host([audio]) [part~=layer][part~=gesture-layer] {
      height: 0;
      display: block;
    }

    
    :host(:not([audio])[gestures-disabled]) ::slotted([slot=gestures-chrome]),
    :host(:not([audio])[gestures-disabled]) media-gesture-receiver[slot=gestures-chrome] {
      display: none;
    }

    
    ::slotted(:not([slot=media]):not([slot=poster]):not(media-loading-indicator)) {
      pointer-events: auto;
    }

    :host(:not([audio])) *[part~=layer][part~=centered-layer] {
      align-items: center;
      justify-content: center;
    }

    :host(:not([audio])) ::slotted(media-gesture-receiver[slot=gestures-chrome]),
    :host(:not([audio])) media-gesture-receiver[slot=gestures-chrome] {
      align-self: stretch;
      flex-grow: 1;
    }

    slot[name=middle-chrome] {
      display: inline;
      flex-grow: 1;
      pointer-events: none;
      background: none;
    }

    
    ::slotted([slot=media]),
    ::slotted([slot=poster]) {
      width: 100%;
      height: 100%;
    }

    
    :host(:not([audio])) .spacer {
      flex-grow: 1;
    }

    
    :host(:-webkit-full-screen) {
      
      width: 100% !important;
      height: 100% !important;
    }

    
    ::slotted(:not([slot=media]):not([no-auto-hide])) {
      opacity: 1;
      transition: opacity 0.25s;
    }

    
    :host([user-inactive]:not([${X.MEDIA_PAUSED}]):not([${X.MEDIA_IS_CASTING}]):not([audio])) ::slotted(:not([slot=media]):not([no-auto-hide])) {
      opacity: 0;
      transition: opacity 1s;
    }

    ::slotted(media-control-bar)  {
      align-self: stretch;
    }
  </style>

  <slot name="media" part="layer media-layer"></slot>
  <slot name="poster" part="layer poster-layer"></slot>
  <slot name="gestures-chrome" part="layer gesture-layer">
    <media-gesture-receiver slot="gestures-chrome"></media-gesture-receiver>
  </slot>
  <span part="layer vertical-layer">
    <slot name="top-chrome" part="top chrome"></slot>
    <slot name="middle-chrome" part="middle chrome"></slot>
    <slot name="centered-chrome" part="layer centered-layer center centered chrome"></slot>
    
    <slot part="bottom chrome"></slot>
  </span>
`;const Vf=Object.values(X);class el extends me.HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(qo.content.cloneNode(!0));const e=D=>{const c=this.media;for(let p of D)p.type==="childList"&&(p.removedNodes.forEach(w=>{if(w.slot=="media"&&p.target==this){let M=p.previousSibling&&p.previousSibling.previousElementSibling;if(!M||!c)this.mediaUnsetCallback(w);else{let O=M.slot!=="media";for(;(M=M.previousSibling)!==null;)M.slot=="media"&&(O=!1);O&&this.mediaUnsetCallback(w)}}}),c&&p.addedNodes.forEach(w=>{w==c&&this.handleMediaUpdated(c).then(M=>this.mediaSetCallback(M))}))};new MutationObserver(e).observe(this,{childList:!0,subtree:!0});let i=this.media,r=this.querySelector(":scope > slot[slot=media]");r&&r.addEventListener("slotchange",()=>{if(!r.assignedElements({flatten:!0}).length){this.mediaUnsetCallback(i);return}this.media&&(i=this.media,this.handleMediaUpdated(this.media).then(c=>this.mediaSetCallback(c)))})}static get observedAttributes(){return["autohide","gestures-disabled"].concat(Vf)}attributeChangedCallback(e,n,i){e.toLowerCase()=="autohide"&&(this.autohide=i)}get media(){let e=this.querySelector(":scope > [slot=media]");return(e==null?void 0:e.nodeName)=="SLOT"&&(e=e.assignedElements({flatten:!0})[0]),e}mediaSetCallback(e){this._mediaClickPlayToggle=()=>{const n=e.paused?Ae.MEDIA_PLAY_REQUEST:Ae.MEDIA_PAUSE_REQUEST;this.dispatchEvent(new me.CustomEvent(n,{composed:!0,bubbles:!0}))}}handleMediaUpdated(e){const n=D=>Promise.resolve(D),i=D=>(console.error('<media-chrome>: Media element set with slot="media" does not appear to be compatible.',D),Promise.reject(D));if(!e)return i(e);const r=e.nodeName.toLowerCase();return r.includes("-")?me.customElements.whenDefined(r).then(()=>n(e)):n(e)}mediaUnsetCallback(e){}connectedCallback(){const n=this.getAttribute("audio")!=null?cr.AUDIO_PLAYER():cr.VIDEO_PLAYER();this.setAttribute("role","region"),this.setAttribute("aria-label",n),this.media&&this.handleMediaUpdated(this.media).then(c=>this.mediaSetCallback(c)),this.setAttribute("user-inactive","user-inactive");const i=()=>{if(this.autohide<0)return;this.setAttribute("user-inactive","user-inactive");const c=new me.CustomEvent(Hn.USER_INACTIVE,{composed:!0,bubbles:!0,detail:!0});this.dispatchEvent(c)},r=()=>{this.removeAttribute("user-inactive");const c=new me.CustomEvent(Hn.USER_INACTIVE,{composed:!0,bubbles:!0,detail:!1});this.dispatchEvent(c)},D=()=>{r(),me.clearTimeout(this._inactiveTimeout),!(this.autohide<0)&&(this._inactiveTimeout=me.setTimeout(()=>{i()},this.autohide*1e3))};this.addEventListener("keyup",()=>{D()}),this.addEventListener("pointerup",c=>{c.pointerType==="touch"?[this,this.media].includes(c.target)&&!this.hasAttribute("user-inactive")?i():D():c.composedPath().some(p=>{var w;return["media-play-button","media-fullscreen-button"].includes((w=p==null?void 0:p.nodeName)==null?void 0:w.toLowerCase())})&&D()}),this.addEventListener("pointermove",c=>{c.pointerType==="mouse"&&c.target!==this&&(r(),me.clearTimeout(this._inactiveTimeout),[this,this.media].includes(c.target)&&D())}),this.addEventListener("mouseleave",()=>{i()}),this.addEventListener("keyup",()=>{this.setAttribute("media-keyboard-control","")}),this.addEventListener("mouseup",()=>{this.removeAttribute("media-keyboard-control")})}set autohide(e){e=Number(e),this._autohide=isNaN(e)?0:e}get autohide(){return this._autohide===void 0?2:this._autohide}}ke("media-container-temp",el);var $f=el,tl=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)},st=(t,e,n)=>(tl(t,e,"read from private field"),n?n.call(t):e.get(t)),Ai=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},_i=(t,e,n,i)=>(tl(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n),Ar,_r,At;class zf{constructor(e,n){Ai(this,Ar,void 0),Ai(this,_r,void 0),Ai(this,At,[]),_i(this,Ar,e),_i(this,_r,n)}[Symbol.iterator](){return st(this,At).values()}get length(){return st(this,At).length}get value(){var e;return(e=st(this,At).join(" "))!=null?e:""}set value(e){var n;e!==this.value&&(_i(this,At,[]),this.add(...(n=e==null?void 0:e.split(" "))!=null?n:[]))}toString(){return this.value}item(e){return st(this,At)[e]}values(){return st(this,At).values()}keys(){return st(this,At).keys()}forEach(e){st(this,At).forEach(e)}add(...e){var n,i;e.forEach(r=>{this.contains(r)||st(this,At).push(r)}),!(this.value===""&&!((n=st(this,Ar))!=null&&n.hasAttribute(`${st(this,_r)}`)))&&((i=st(this,Ar))==null||i.setAttribute(`${st(this,_r)}`,`${this.value}`))}remove(...e){var n;e.forEach(i=>{st(this,At).splice(st(this,At).indexOf(i),1)}),(n=st(this,Ar))==null||n.setAttribute(`${st(this,_r)}`,`${this.value}`)}contains(e){return st(this,At).includes(e)}toggle(e,n){return typeof n<"u"?n?(this.add(e),!0):(this.remove(e),!1):this.contains(e)?(this.remove(e),!1):(this.add(e),!0)}replace(e,n){this.remove(e),this.add(n)}}Ar=new WeakMap;_r=new WeakMap;At=new WeakMap;const nt={enter:"requestFullscreen",exit:"exitFullscreen",event:"fullscreenchange",element:"fullscreenElement",error:"fullscreenerror",enabled:"fullscreenEnabled"};de.fullscreenElement===void 0&&(nt.enter="webkitRequestFullScreen",nt.exit=de.webkitExitFullscreen!=null?"webkitExitFullscreen":"webkitCancelFullScreen",nt.event="webkitfullscreenchange",nt.element="webkitFullscreenElement",nt.error="webkitfullscreenerror",nt.enabled="webkitFullscreenEnabled");const Gi=(t="")=>t.split(/\s+/),rl=(t="")=>{const[e,n]=t.split(":"),i=n?decodeURIComponent(n):void 0;return{language:e,label:i}},Yf=(t="",e={})=>Gi(t).map(n=>{const i=rl(n);return{...e,...i}}),Xf=t=>Array.isArray(t)?t.map(e=>typeof e=="string"?rl(e):e):typeof t=="string"?Yf(t):[t],Qf=({label:t,language:e}={})=>t?`${e}:${encodeURIComponent(t)}`:e,$t=(t=[])=>Array.prototype.map.call(t,Qf).join(" "),Zf=(t,e)=>n=>n[t]===e,nl=t=>{const e=Object.entries(t).map(([n,i])=>Zf(n,i));return n=>e.every(i=>i(n))},_n=(t,e=[],n=[])=>{const i=Xf(n).map(nl),r=D=>i.some(c=>c(D));Array.from(e).filter(r).forEach(D=>{D.mode=t})},fn=(t,e=()=>!0)=>{if(!(t!=null&&t.textTracks))return[];const n=typeof e=="function"?e:nl(e);return Array.from(t.textTracks).filter(n)},il=t=>{const e=!!t.getAttribute(X.MEDIA_CAPTIONS_SHOWING),n=!t.hasAttribute("no-subtitles-fallback")&&!!t.getAttribute(X.MEDIA_SUBTITLES_SHOWING);return e||n},al=t=>{var e,n,i,r;if(il(t)){const c=t.getAttribute(X.MEDIA_CAPTIONS_SHOWING);if(c){const w=new window.CustomEvent(Ae.MEDIA_DISABLE_CAPTIONS_REQUEST,{composed:!0,bubbles:!0,detail:c});t.dispatchEvent(w)}const p=t.getAttribute(X.MEDIA_SUBTITLES_SHOWING);if(p&&!t.hasAttribute("no-subtitles-fallback")){const w=new window.CustomEvent(Ae.MEDIA_DISABLE_SUBTITLES_REQUEST,{composed:!0,bubbles:!0,detail:p});t.dispatchEvent(w)}}else{const[c]=(n=Gi((e=t.getAttribute(X.MEDIA_CAPTIONS_LIST))!=null?e:""))!=null?n:[];if(c){const p=new window.CustomEvent(Ae.MEDIA_SHOW_CAPTIONS_REQUEST,{composed:!0,bubbles:!0,detail:c});t.dispatchEvent(p)}else if(t.hasAttribute("no-subtitles-fallback"))console.error("Attempting to enable closed captions but none are available! Please verify your media content if this is unexpected.");else{const[p]=(r=Gi((i=t.getAttribute(X.MEDIA_SUBTITLES_LIST))!=null?i:""))!=null?r:[];if(p){const w=new window.CustomEvent(Ae.MEDIA_SHOW_SUBTITLES_REQUEST,{composed:!0,bubbles:!0,detail:p});t.dispatchEvent(w)}}}};var sl=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)},Ir=(t,e,n)=>(sl(t,e,"read from private field"),n?n.call(t):e.get(t)),xi=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},Or=(t,e,n)=>(sl(t,e,"access private method"),n),ar,kr,ln,Mn,Hi;const Jf=Object.values(ji),ol=["ArrowLeft","ArrowRight","Enter"," ","f","m","k","c"],qf=10,es=0;class ll extends $f{constructor(){super(),xi(this,kr),xi(this,Mn),xi(this,ar,new zf(this,"hotkeys")),lh||(this._airplayUnavailable=Vt.UNSUPPORTED),rs||(this._fullscreenUnavailable=Vt.UNAVAILABLE),uh||(this._castUnavailable=Vt.UNSUPPORTED),sh||(this._pipUnavailable=Vt.UNSUPPORTED),nn!==void 0?nn||(this._volumeUnavailable=Vt.UNSUPPORTED):oh.then(()=>{nn||(this._volumeUnavailable=Vt.UNSUPPORTED,this.propagateMediaState(X.MEDIA_VOLUME_UNAVAILABLE,this._volumeUnavailable))}),this.mediaStateReceivers=[],this.associatedElementSubscriptions=new Map,this.associatedElements=[],this.associateElement(this);const e={MEDIA_PLAY_REQUEST:()=>this.media.play(),MEDIA_PAUSE_REQUEST:()=>this.media.pause(),MEDIA_MUTE_REQUEST:()=>this.media.muted=!0,MEDIA_UNMUTE_REQUEST:()=>{const n=this.media;n.muted=!1,n.volume===0&&(n.volume=.25)},MEDIA_VOLUME_REQUEST:n=>{const i=this.media,r=n.detail;i.volume=r,r>0&&i.muted&&(i.muted=!1);try{me.localStorage.setItem("media-chrome-pref-volume",r.toString())}catch{}},MEDIA_ENTER_FULLSCREEN_REQUEST:()=>{if(!rs){console.warn("Fullscreen support is unavailable; not entering fullscreen");return}const n=this.media;de.pictureInPictureElement&&de.exitPictureInPicture(),super[nt.enter]?super[nt.enter]():n.webkitEnterFullscreen?n.webkitEnterFullscreen():n.requestFullscreen?n.requestFullscreen():console.warn("MediaChrome: Fullscreen not supported")},MEDIA_EXIT_FULLSCREEN_REQUEST:()=>{de[nt.exit]()},MEDIA_ENTER_PIP_REQUEST:()=>{const n=this.media;if(!de.pictureInPictureEnabled){console.warn("MediaChrome: Picture-in-picture is not enabled");return}if(!n.requestPictureInPicture){console.warn("MediaChrome: The current media does not support picture-in-picture");return}de[nt.element]&&de[nt.exit]();const i=()=>{console.warn("MediaChrome: The media is not ready for picture-in-picture. It must have a readyState > 0.")};n.requestPictureInPicture().catch(r=>{if(r.code===11)if(n.readyState===0&&n.preload==="none"){const D=()=>{n.removeEventListener("loadedmetadata",c),n.preload="none"},c=()=>{n.requestPictureInPicture().catch(i),D()};n.addEventListener("loadedmetadata",c),n.preload="metadata",setTimeout(()=>{n.readyState===0&&i(),D()},1e3)}else throw r;else throw r})},MEDIA_EXIT_PIP_REQUEST:()=>{de.pictureInPictureElement&&de.exitPictureInPicture()},MEDIA_ENTER_CAST_REQUEST:()=>{var n;const i=this.media;!((n=globalThis.CastableVideoElement)!=null&&n.castEnabled)||(de[nt.element]&&de[nt.exit](),i.requestCast())},MEDIA_EXIT_CAST_REQUEST:async()=>{var n;(n=globalThis.CastableVideoElement)!=null&&n.castElement&&globalThis.CastableVideoElement.exitCast()},MEDIA_SEEK_REQUEST:n=>{const i=this.media,r=n.detail;(i.readyState>0||i.readyState===void 0)&&(i.currentTime=r)},MEDIA_PLAYBACK_RATE_REQUEST:n=>{this.media.playbackRate=n.detail},MEDIA_PREVIEW_REQUEST:n=>{var i;const r=this.media;if(!r)return;const D=n.detail;D===null&&this.propagateMediaState(X.MEDIA_PREVIEW_TIME,void 0),this.propagateMediaState(X.MEDIA_PREVIEW_TIME,D);const[c]=fn(r,{kind:cn.METADATA,label:"thumbnails"});if(!(c&&c.cues))return;if(D===null){this.propagateMediaState(X.MEDIA_PREVIEW_IMAGE,void 0),this.propagateMediaState(X.MEDIA_PREVIEW_COORDS,void 0);return}const p=Array.prototype.find.call(c.cues,C=>C.startTime>=D);if(!p)return;const w=/'^(?:[a-z]+:)?\/\//i.test(p.text)||(i=r.querySelector('track[label="thumbnails"]'))==null?void 0:i.src,M=new URL(p.text,w),O=new URLSearchParams(M.hash).get("#xywh");this.propagateMediaState(X.MEDIA_PREVIEW_IMAGE,M.href),this.propagateMediaState(X.MEDIA_PREVIEW_COORDS,O.split(",").join(" "))},MEDIA_SHOW_CAPTIONS_REQUEST:n=>{const i=Pn(this),{detail:r=[]}=n;_n(Dr.SHOWING,i,r)},MEDIA_DISABLE_CAPTIONS_REQUEST:n=>{const i=Pn(this),{detail:r=[]}=n;_n(Dr.DISABLED,i,r)},MEDIA_SHOW_SUBTITLES_REQUEST:n=>{const i=rn(this),{detail:r=[]}=n;_n(Dr.SHOWING,i,r)},MEDIA_DISABLE_SUBTITLES_REQUEST:n=>{const i=rn(this),{detail:r=[]}=n;_n(Dr.DISABLED,i,r)},MEDIA_AIRPLAY_REQUEST:()=>{const{media:n}=this;if(!!n){if(!(n.webkitShowPlaybackTargetPicker&&me.WebKitPlaybackTargetAvailabilityEvent)){console.warn("received a request to select AirPlay but AirPlay is not supported in this environment");return}n.webkitShowPlaybackTargetPicker()}}};if(Object.keys(e).forEach(n=>{const i=`_handle${bi(n,!0)}`;this[i]=r=>{if(r.stopPropagation(),!this.media){console.warn("MediaController: No media available.");return}e[n](r,this.media)},this.addEventListener(Ae[n],this[i])}),this._mediaStatePropagators={"play,pause,emptied":()=>{this.propagateMediaState(X.MEDIA_PAUSED,ul(this))},"playing,emptied":()=>{var n;this.propagateMediaState(X.MEDIA_HAS_PLAYED,!((n=this.media)!=null&&n.paused))},volumechange:()=>{this.propagateMediaState(X.MEDIA_MUTED,dl(this)),this.propagateMediaState(X.MEDIA_VOLUME,cl(this)),this.propagateMediaState(X.MEDIA_VOLUME_LEVEL,fl(this))},[nt.event]:n=>{const r=!!de[nt.element]&&(n==null?void 0:n.target),D=On(this,r);this.propagateMediaState(X.MEDIA_IS_FULLSCREEN,D)},"enterpictureinpicture,leavepictureinpicture":n=>{var i;let r;if(n)r=n.type=="enterpictureinpicture";else{const D=(i=this.getRootNode().pictureInPictureElement)!=null?i:de.pictureInPictureElement;r=this.media&&On(this.media,D)}this.propagateMediaState(X.MEDIA_IS_PIP,r)},"entercast,leavecast,castchange":n=>{var i;const r=(i=globalThis.CastableVideoElement)==null?void 0:i.castElement;let D=this.media&&On(this.media,r);(n==null?void 0:n.type)==="castchange"&&(n==null?void 0:n.detail)==="CONNECTING"&&(D="connecting"),this.propagateMediaState(X.MEDIA_IS_CASTING,D)},"timeupdate,loadedmetadata":()=>{this.propagateMediaState(X.MEDIA_CURRENT_TIME,hl(this))},"durationchange,loadedmetadata,emptied":()=>{this.propagateMediaState(X.MEDIA_DURATION,vl(this)),this.propagateMediaState(X.MEDIA_STREAM_TYPE)},"loadedmetadata,emptied,progress":()=>{var n;this.propagateMediaState(X.MEDIA_SEEKABLE,(n=gl(this))==null?void 0:n.join(":"))},"progress,emptied":()=>{var n;this.propagateMediaState(X.MEDIA_BUFFERED,fh((n=this.media)==null?void 0:n.buffered))},"ratechange,loadstart":()=>{this.propagateMediaState(X.MEDIA_PLAYBACK_RATE,ml(this))},"waiting,playing,emptied":()=>{var n;const i=((n=this.media)==null?void 0:n.readyState)<3;this.propagateMediaState(X.MEDIA_LOADING,i)}},this._airplayUnavailable!==Vt.UNSUPPORTED){const n=i=>{(i==null?void 0:i.availability)==="available"?this._airplayUnavailable=void 0:(i==null?void 0:i.availability)==="not-available"&&(this._airplayUnavailable=Vt.UNAVAILABLE),this.propagateMediaState(X.MEDIA_AIRPLAY_UNAVAILABLE,this._airplayUnavailable)};this._mediaStatePropagators.webkitplaybacktargetavailabilitychanged=n}if(this._castUnavailable!==Vt.UNSUPPORTED){const n=()=>{var i;const r=(i=globalThis.CastableVideoElement)==null?void 0:i.castState;r!=null&&r.includes("CONNECT")?this._castUnavailable=void 0:this._castUnavailable=Vt.UNAVAILABLE,this.propagateMediaState(X.MEDIA_CAST_UNAVAILABLE,this._castUnavailable)};this._mediaStatePropagators.castchange=n}this._textTrackMediaStatePropagators={"addtrack,removetrack,loadstart":()=>{this.propagateMediaState(X.MEDIA_CAPTIONS_LIST,$t(Pn(this))||void 0),this.propagateMediaState(X.MEDIA_SUBTITLES_LIST,$t(rn(this))||void 0),this.propagateMediaState(X.MEDIA_CAPTIONS_SHOWING,$t(Vi(this))||void 0),this.propagateMediaState(X.MEDIA_SUBTITLES_SHOWING,$t(ts(this))||void 0)},change:()=>{this.propagateMediaState(X.MEDIA_CAPTIONS_SHOWING,$t(Vi(this))||void 0),this.propagateMediaState(X.MEDIA_SUBTITLES_SHOWING,$t(ts(this))||void 0)}},this.enableHotkeys()}static get observedAttributes(){return super.observedAttributes.concat("nohotkeys","hotkeys","default-stream-type")}attributeChangedCallback(e,n,i){e==="nohotkeys"?i!==n&&i===""?(this.hasAttribute("hotkeys")&&console.warn("Both `hotkeys` and `nohotkeys` have been set. All hotkeys will be disabled."),this.disableHotkeys()):i!==n&&i===null&&this.enableHotkeys():e==="hotkeys"?Ir(this,ar).value=i:e==="default-stream-type"&&this.propagateMediaState(X.MEDIA_STREAM_TYPE),super.attributeChangedCallback(e,n,i)}mediaSetCallback(e){super.mediaSetCallback(e),e.hasAttribute("tabindex")||e.setAttribute("tabindex",-1),Object.keys(this._mediaStatePropagators).forEach(n=>{const i=n.split(","),r=this._mediaStatePropagators[n];i.forEach(D=>{(D==nt.event?this.getRootNode():e).addEventListener(D,r)}),r()}),Object.entries(this._textTrackMediaStatePropagators).forEach(([n,i])=>{n.split(",").forEach(D=>{e.textTracks&&e.textTracks.addEventListener(D,i)}),i()});try{const n=me.localStorage.getItem("media-chrome-pref-volume");n!==null&&(e.volume=n)}catch(n){console.debug("Error getting volume pref",n)}}mediaUnsetCallback(e){super.mediaUnsetCallback(e),Object.keys(this._mediaStatePropagators).forEach(n=>{const i=n.split(","),r=this._mediaStatePropagators[n];i.forEach(D=>{(D==nt.event?this.getRootNode():e).removeEventListener(D,r)})}),Object.entries(this._textTrackMediaStatePropagators).forEach(([n,i])=>{n.split(",").forEach(D=>{e.textTracks&&e.textTracks.removeEventListener(D,i)}),i()}),this.propagateMediaState(X.MEDIA_PAUSED,!0)}propagateMediaState(e,n){arguments.length===1&&(n=xn[e](this)),vr(this.mediaStateReceivers,e,n);const i=new me.CustomEvent(Pf[e],{composed:!0,bubbles:!0,detail:n});this.dispatchEvent(i)}associateElement(e){if(!e)return;const{associatedElementSubscriptions:n}=this;if(n.has(e))return;const i=this.registerMediaStateReceiver.bind(this),r=this.unregisterMediaStateReceiver.bind(this),D=nh(e,i,r);Object.keys(Ae).forEach(c=>{e.addEventListener(Ae[c],this[`_handle${bi(c,!0)}`])}),n.set(e,D)}unassociateElement(e){if(!e)return;const{associatedElementSubscriptions:n}=this;if(!n.has(e))return;n.get(e)(),n.delete(e),Object.keys(Ae).forEach(r=>{e.removeEventListener(Ae[r],this[`_handle${bi(r,!0)}`])})}registerMediaStateReceiver(e){if(!e)return;const n=this.mediaStateReceivers;n.indexOf(e)>-1||(n.push(e),vr([e],X.MEDIA_VOLUME_UNAVAILABLE,this._volumeUnavailable),vr([e],X.MEDIA_AIRPLAY_UNAVAILABLE,this._airplayUnavailable),vr([e],X.MEDIA_FULLSCREEN_UNAVAILABLE,this._fullscreenUnavailable),vr([e],X.MEDIA_CAST_UNAVAILABLE,this._castUnavailable),vr([e],X.MEDIA_PIP_UNAVAILABLE,this._pipUnavailable),this.media&&Object.keys(X).forEach(r=>{r.includes("UNAVAILABLE")||vr([e],X[r],xn[X[r]]?xn[X[r]](this):xn.default(this,X[r]))}))}unregisterMediaStateReceiver(e){const n=this.mediaStateReceivers,i=n.indexOf(e);i<0||n.splice(i,1)}enableHotkeys(){this.addEventListener("keydown",Or(this,Mn,Hi))}disableHotkeys(){this.removeEventListener("keydown",Or(this,Mn,Hi)),this.removeEventListener("keyup",Or(this,kr,ln))}get hotkeys(){return Ir(this,ar)}keyboardShortcutHandler(e){var n,i,r,D;if(((D=(r=(n=e.target.getAttribute("keysused"))==null?void 0:n.split(" "))!=null?r:(i=e.target)==null?void 0:i.keysUsed)!=null?D:[]).map(b=>b==="Space"?" ":b).filter(Boolean).includes(e.key))return;let p,w,M,O,C;const S=qf;if(!Ir(this,ar).contains(`no${e.key.toLowerCase()}`)&&!(e.key===" "&&Ir(this,ar).contains("nospace")))switch(e.key){case" ":case"k":p=this.getAttribute(X.MEDIA_PAUSED)!=null?Ae.MEDIA_PLAY_REQUEST:Ae.MEDIA_PAUSE_REQUEST,this.dispatchEvent(new me.CustomEvent(p,{composed:!0,bubbles:!0}));break;case"m":p=this.getAttribute(X.MEDIA_VOLUME_LEVEL)==="off"?Ae.MEDIA_UNMUTE_REQUEST:Ae.MEDIA_MUTE_REQUEST,this.dispatchEvent(new me.CustomEvent(p,{composed:!0,bubbles:!0}));break;case"f":p=this.getAttribute(X.MEDIA_IS_FULLSCREEN)!=null?Ae.MEDIA_EXIT_FULLSCREEN_REQUEST:Ae.MEDIA_ENTER_FULLSCREEN_REQUEST,this.dispatchEvent(new me.CustomEvent(p,{composed:!0,bubbles:!0}));break;case"c":al(this);break;case"ArrowLeft":w=this.getAttribute(X.MEDIA_CURRENT_TIME),M=w&&!Number.isNaN(+w)?+w:es,O=Math.max(M-S,0),C=new me.CustomEvent(Ae.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:O}),this.dispatchEvent(C);break;case"ArrowRight":w=this.getAttribute(X.MEDIA_CURRENT_TIME),M=w&&!Number.isNaN(+w)?+w:es,O=Math.max(M+S,0),C=new me.CustomEvent(Ae.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:O}),this.dispatchEvent(C);break}}}ar=new WeakMap;kr=new WeakSet;ln=function(t){const{key:e}=t;if(!ol.includes(e)){this.removeEventListener("keyup",Or(this,kr,ln));return}this.keyboardShortcutHandler(t)};Mn=new WeakSet;Hi=function(t){const{metaKey:e,altKey:n,key:i}=t;if(e||n||!ol.includes(i)){this.removeEventListener("keyup",Or(this,kr,ln));return}[" ","ArrowLeft","ArrowRight"].includes(i)&&!(Ir(this,ar).contains(`no${i.toLowerCase()}`)||i===" "&&Ir(this,ar).contains("nospace"))&&t.preventDefault(),this.addEventListener("keyup",Or(this,kr,ln),{once:!0})};const xn={default(t,e){return t.getAttribute(e)},[X.MEDIA_CAPTIONS_LIST](t){return $t(Pn(t))||void 0},[X.MEDIA_SUBTITLES_LIST](t){return $t(rn(t))||void 0},[X.MEDIA_SUBTITLES_LIST](t){return $t(rn(t))||void 0},[X.MEDIA_CAPTIONS_SHOWING](t){return $t(Vi(t))||void 0},[X.MEDIA_PAUSED](t){return ul(t)},[X.MEDIA_MUTED](t){return dl(t)},[X.MEDIA_VOLUME](t){return cl(t)},[X.MEDIA_VOLUME_LEVEL](t){return fl(t)},[X.MEDIA_CURRENT_TIME](t){return hl(t)},[X.MEDIA_DURATION](t){return vl(t)},[X.MEDIA_SEEKABLE](t){var e;return(e=gl(t))==null?void 0:e.join(":")},[X.MEDIA_PLAYBACK_RATE](t){return ml(t)},[X.MEDIA_STREAM_TYPE](t){const e=t.media;if(!e)return;const n=e.duration;if(n===1/0)return ji.LIVE;if(Number.isFinite(n))return ji.ON_DEMAND;{const i=t.getAttribute("default-stream-type");if(Jf.includes(i))return i}return null}},ul=t=>t.media?t.media.paused:!0,dl=t=>!!(t.media&&t.media.muted),cl=t=>{const e=t.media;return e?e.volume:1},fl=t=>{let e="high";if(!t.media)return e;const{muted:n,volume:i}=t.media;return i===0||n?e="off":i<.5?e="low":i<.75&&(e="medium"),e},hl=t=>{const e=t.media;return e?e.currentTime:0},vl=t=>{const e=t==null?void 0:t.media;return Number.isFinite(e==null?void 0:e.duration)?e.duration:NaN},gl=t=>{var e;const n=t==null?void 0:t.media;if(!((e=n==null?void 0:n.seekable)!=null&&e.length))return;const i=n.seekable.start(0),r=n.seekable.end(n.seekable.length-1);if(!(!i&&!r))return[Number(i.toFixed(3)),Number(r.toFixed(3))]},ml=t=>{const e=t.media;return e?e.playbackRate:1},rn=t=>fn(t.media,{kind:cn.SUBTITLES}),Pn=t=>fn(t.media,{kind:cn.CAPTIONS}),ts=t=>fn(t.media,{kind:cn.SUBTITLES,mode:Dr.SHOWING}),Vi=t=>fn(t.media,{kind:cn.CAPTIONS,mode:Dr.SHOWING}),eh=Object.values(X),pl=t=>{var e,n,i,r;let{observedAttributes:D}=t.constructor;!D&&((e=t.nodeName)==null?void 0:e.includes("-"))&&(me.customElements.upgrade(t),{observedAttributes:D}=t.constructor);const c=(r=(i=(n=t==null?void 0:t.getAttribute)==null?void 0:n.call(t,Me.MEDIA_CHROME_ATTRIBUTES))==null?void 0:i.split)==null?void 0:r.call(i,/\s+/);return Array.isArray(D||c)?(D||c).filter(p=>eh.includes(p)):[]},$i=t=>!!pl(t).length,th=async(t,e,n)=>(t.isConnected||await El(0),n==null?t.removeAttribute(e):typeof n=="boolean"?n?t.setAttribute(e,""):t.removeAttribute(e):Number.isNaN(n)?t.removeAttribute(e):t.setAttribute(e,n)),rh=t=>{var e;return!!((e=t.closest)!=null&&e.call(t,'*[slot="media"]'))},Xr=(t,e)=>{if(rh(t))return;const n=(r,D)=>{var c,p;$i(r)&&D(r);const{children:w=[]}=r!=null?r:{},M=(p=(c=r==null?void 0:r.shadowRoot)==null?void 0:c.children)!=null?p:[];[...w,...M].forEach(C=>Xr(C,D))},i=t==null?void 0:t.nodeName.toLowerCase();if(i.includes("-")&&!$i(t)){me.customElements.whenDefined(i).then(()=>{n(t,e)});return}n(t,e)},vr=(t,e,n)=>{t.forEach(i=>{!pl(i).includes(e)||th(i,e,n)})},nh=(t,e,n)=>{Xr(t,e);const i=w=>{var M;const O=(M=w==null?void 0:w.composedPath()[0])!=null?M:w.target;e(O)},r=w=>{var M;const O=(M=w==null?void 0:w.composedPath()[0])!=null?M:w.target;n(O)};t.addEventListener(Ae.REGISTER_MEDIA_STATE_RECEIVER,i),t.addEventListener(Ae.UNREGISTER_MEDIA_STATE_RECEIVER,r);const D=w=>{w.forEach(M=>{const{addedNodes:O=[],removedNodes:C=[],type:S,target:b,attributeName:I}=M;S==="childList"?(Array.prototype.forEach.call(O,L=>Xr(L,e)),Array.prototype.forEach.call(C,L=>Xr(L,n))):S==="attributes"&&I===Me.MEDIA_CHROME_ATTRIBUTES&&($i(b)?e(b):n(b))})},c=new MutationObserver(D);return c.observe(t,{childList:!0,attributes:!0,subtree:!0}),()=>{Xr(t,n),c.disconnect(),t.removeEventListener(Ae.REGISTER_MEDIA_STATE_RECEIVER,i),t.removeEventListener(Ae.UNREGISTER_MEDIA_STATE_RECEIVER,r)}};let Dn;const ua=()=>{var t,e;return Dn||(Dn=(e=(t=de)==null?void 0:t.createElement)==null?void 0:e.call(t,"video"),Dn)},ih=async(t=ua())=>{if(!t)return!1;const e=t.volume;return t.volume=e/2+.1,await El(0),t.volume!==e},El=t=>new Promise(e=>setTimeout(e,t)),ah=(t=ua())=>typeof(t==null?void 0:t.requestPictureInPicture)=="function",sh=ah();let nn;const oh=ih().then(t=>(nn=t,nn)),lh=!!me.WebKitPlaybackTargetAvailabilityEvent,uh=!!me.chrome,dh=(t=ua())=>{let e=de[nt.enabled];return!e&&t&&(e="webkitSupportsFullscreen"in t),e},rs=dh(),ch=Object.freeze({length:0,start(t){const e=t>>>0;if(e>=this.length)throw new DOMException(`Failed to execute 'start' on 'TimeRanges': The index provided (${e}) is greater than or equal to the maximum bound (${this.length}).`);return 0},end(t){const e=t>>>0;if(e>=this.length)throw new DOMException(`Failed to execute 'end' on 'TimeRanges': The index provided (${e}) is greater than or equal to the maximum bound (${this.length}).`);return 0}});function fh(t=ch){return Array.from(t).map((e,n)=>[Number(t.start(n).toFixed(3)),Number(t.end(n).toFixed(3))].join(":")).join(" ")}ke("media-controller",ll);var yl=ll,Tl=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)},hh=(t,e,n)=>(Tl(t,e,"read from private field"),n?n.call(t):e.get(t)),vh=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},gh=(t,e,n,i)=>(Tl(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n),wn;const bl=de.createElement("template"),ns=`
  height: var(--thumb-height);
  width: var(--media-range-thumb-width, 10px);
  border: var(--media-range-thumb-border, none);
  border-radius: var(--media-range-thumb-border-radius, 10px);
  background: var(--media-range-thumb-background, #fff);
  box-shadow: var(--media-range-thumb-box-shadow, 1px 1px 1px transparent);
  cursor: pointer;
  transition: var(--media-range-thumb-transition, none);
  transform: var(--media-range-thumb-transform, none);
  opacity: var(--media-range-thumb-opacity, 1);
`,Di=`
  width: var(--media-range-track-width, 100%);
  min-width: 40px;
  height: var(--track-height);
  border: var(--media-range-track-border, none);
  outline: var(--media-range-track-outline);
  outline-offset: var(--media-range-track-outline-offset);
  border-radius: var(--media-range-track-border-radius, 0);
  background: var(--media-range-track-progress-internal, var(--media-range-track-background, #eee));
  box-shadow: var(--media-range-track-box-shadow, none);
  transition: var(--media-range-track-transition, none);
  transform: translate(var(--media-range-track-translate-x, 0), var(--media-range-track-translate-y, 0));
  cursor: pointer;
`;bl.innerHTML=`
  <style>
    :host {
      --thumb-height: var(--media-range-thumb-height, 10px);
      --track-height: var(--media-range-track-height, 4px);
      --media-range-padding: var(--media-control-padding, 10px);
      --_media-range-padding: var(--media-range-padding, 10px);

      vertical-align: middle;
      box-sizing: border-box;
      display: inline-block;
      position: relative;
      background: var(--media-control-background, rgba(20,20,30, 0.7));
      transition: background 0.15s linear;
      width: 100px;
      height: calc(var(--media-control-height, 24px) + 2 * var(--_media-range-padding));
      padding-left: var(--media-range-padding-left, var(--_media-range-padding));
      padding-right: var(--media-range-padding-right, var(--_media-range-padding));
      pointer-events: auto;
      
      font-size: 0;
    }

    :host(:hover) {
      background: var(--media-control-hover-background, rgba(50,50,60, 0.7));
    }

    #container {
      position: relative;
      height: 100%;
    }

    input[type=range] {
      
      -webkit-appearance: none; 
      background: transparent; 

      
      min-height: 100%;
      width: var(--media-range-track-width, 100%); 

      box-sizing: border-box;
      padding: 0;
      margin: 0;
    }

    
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      ${ns}
      
      margin-top: calc(calc(0px - var(--thumb-height) + var(--track-height)) / 2);
    }

    
    input[type=range]::-moz-range-thumb {
      ${ns}
      translate: var(--media-range-track-translate-x, 0) var(--media-range-track-translate-y, 0);
    }

    input[type=range]::-webkit-slider-runnable-track { ${Di} }
    input[type=range]::-moz-range-track { ${Di} }
    input[type=range]::-ms-track {
      
      width: 100%;
      cursor: pointer;
      
      background: transparent;
      border-color: transparent;
      color: transparent;

      ${Di}
    }

    #background,
    #pointer {
      min-width: 40px;
      width: var(--media-range-track-width, 100%);
      height: var(--track-height);
      border-radius: var(--media-range-track-border-radius, 0);
      position: absolute;
      top: 50%;
      transform: translate(var(--media-range-track-translate-x, 0px), calc(var(--media-range-track-translate-y, 0px) - 50%));
      background: var(--media-range-track-background, #333);
    }

    #pointer {
      min-width: auto;
      background: var(--media-range-track-pointer-background);
      border-right: var(--media-range-track-pointer-border-right);
      transition: visibility .25s, opacity .25s;
      visibility: hidden;
      opacity: 0;
    }

    :host(:hover) #pointer {
      transition: visibility .5s, opacity .5s;
      visibility: visible;
      opacity: 1;
    }

    #hoverzone {
      
      z-index: 1;
      display: var(--media-time-range-hover-display, none);
      position: absolute;
      width: 100%;
      bottom: var(--media-time-range-hover-bottom, -5px);
      height: var(--media-time-range-hover-height, max(calc(100% + 5px), 20px));
    }

    #range {
      z-index: 2;
      position: relative;
      height: var(--media-range-track-height, 4px);
    }

    
    :host-context([media-keyboard-control]):host(:focus),
    :host-context([media-keyboard-control]):host(:focus-within) {
      box-shadow: inset 0 0 0 2px rgba(27, 127, 204, 0.9);
    }
    :host-context([media-keyboard-control]) input[type=range]:focus-visible {
      box-shadow: none;
    }
    input[type=range]:focus-visible {
      box-shadow: inset 0 0 0 2px rgba(27, 127, 204, 0.9);
    }
    input[type=range]:focus {
      outline: 0;
    }
    input[type=range]:focus::-webkit-slider-runnable-track {
      outline: 0;
    }

    input[type=range]:disabled::-webkit-slider-thumb {
      background-color: #777;
    }

    input[type=range]:disabled::-webkit-slider-runnable-track {
      background-color: #777;
    }
  </style>
  <div id="container">
    <div id="background"></div>
    <div id="pointer"></div>
    <div id="hoverzone"></div>
    <input id="range" type="range" min="0" max="1000" step="any" value="0">
  </div>
`;class Sl extends me.HTMLElement{constructor(){super(),vh(this,wn,void 0),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(bl.content.cloneNode(!0)),this.container=this.shadowRoot.querySelector("#container"),this.range=this.shadowRoot.querySelector("#range"),this.range.addEventListener("input",this.updateBar.bind(this)),gh(this,wn,parseInt(getComputedStyle(this).getPropertyValue("--media-range-thumb-width")||"10",10))}static get observedAttributes(){return["disabled","aria-disabled",Me.MEDIA_CONTROLLER]}attributeChangedCallback(e,n,i){var r,D;if(e===Me.MEDIA_CONTROLLER){if(n){const c=de.getElementById(n);(r=c==null?void 0:c.unassociateElement)==null||r.call(c,this)}if(i){const c=de.getElementById(i);(D=c==null?void 0:c.associateElement)==null||D.call(c,this)}}else(e==="disabled"||e==="aria-disabled"&&n!==i)&&(i==null?this.range.removeAttribute(e):this.range.setAttribute(e,i))}connectedCallback(){var e;const n=this.getAttribute(Me.MEDIA_CONTROLLER);if(n){const i=de.getElementById(n);(e=i==null?void 0:i.associateElement)==null||e.call(i,this)}this.updateBar()}disconnectedCallback(){var e;const n=this.getAttribute(Me.MEDIA_CONTROLLER);if(n){const i=de.getElementById(n);(e=i==null?void 0:i.unassociateElement)==null||e.call(i,this)}}updatePointerBar(e){const n=this.range.getBoundingClientRect();let i=(e.clientX-n.left)/n.width;i=Math.max(0,Math.min(1,i));const{style:r}=wr(this.shadowRoot,"#pointer");r.setProperty("width",`${i*n.width}px`)}updateBar(){const e=this.getBarColors();let n="linear-gradient(to right, ",i=0;e.forEach(D=>{D[1]<i||(n=n+`${D[0]} ${i}%, ${D[0]} ${D[1]}%,`,i=D[1])}),n=n.slice(0,n.length-1)+")";const{style:r}=wr(this.shadowRoot,"#range");r.setProperty("--media-range-track-progress-internal",n)}getBarColors(){const e=this.range,n=e.value-e.min,i=e.max-e.min,r=n/i*100;let D=0;return e.value>e.min&&e.value<e.max&&(D=hh(this,wn)*(.5-r/100)/e.offsetWidth*100),[["var(--media-range-bar-color, #fff)",r+D],["transparent",100]]}get keysUsed(){return["ArrowUp","ArrowRight","ArrowDown","ArrowLeft"]}}wn=new WeakMap;ke("media-chrome-range",Sl);var Al=Sl;const _l=de.createElement("template");_l.innerHTML=`
  <style>
    :host {
      
      box-sizing: border-box;
      display: inline-flex;
      color: var(--media-icon-color, #eee);
      --media-loading-icon-width: 44px;
    }

    media-time-range,
    ::slotted(media-time-range),
    ::slotted(media-progress-range),
    ::slotted(media-clip-selector) {
      flex-grow: 1;
    }
  </style>

  <slot></slot>
`;class mh extends me.HTMLElement{static get observedAttributes(){return[Me.MEDIA_CONTROLLER]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(_l.content.cloneNode(!0))}attributeChangedCallback(e,n,i){var r,D;if(e===Me.MEDIA_CONTROLLER){if(n){const c=de.getElementById(n);(r=c==null?void 0:c.unassociateElement)==null||r.call(c,this)}if(i){const c=de.getElementById(i);(D=c==null?void 0:c.associateElement)==null||D.call(c,this)}}}connectedCallback(){var e;const n=this.getAttribute(Me.MEDIA_CONTROLLER);if(n){const i=de.getElementById(n);(e=i==null?void 0:i.associateElement)==null||e.call(i,this)}}disconnectedCallback(){var e;const n=this.getAttribute(Me.MEDIA_CONTROLLER);if(n){const i=de.getElementById(n);(e=i==null?void 0:i.unassociateElement)==null||e.call(i,this)}}}ke("media-control-bar",mh);const xl=de.createElement("template");xl.innerHTML=`
  <style>
    :host {
      display: inline-flex;
      justify-content: center;
      align-items: center;
      vertical-align: middle;
      box-sizing: border-box;
      background: var(--media-control-background, rgba(20,20,30, 0.7));
  
      padding: var(--media-control-padding, 10px);

      font-size: 14px;
      line-height: var(--media-text-content-height, var(--media-control-height, 24px));
      font-family: Arial, sans-serif;
      text-align: center;
      color: #ffffff;
      pointer-events: auto;
    }

    
    :host(:focus-visible) {
      box-shadow: inset 0 0 0 2px rgba(27, 127, 204, 0.9);
      outline: 0;
    }

    
    :host(:where(:focus)) {
      box-shadow: none;
      outline: 0;
    }
  </style>
  <span id="container">
  <slot></slot>
  </span>
`;class Dl extends me.HTMLElement{static get observedAttributes(){return[Me.MEDIA_CONTROLLER]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(xl.content.cloneNode(!0)),this.container=this.shadowRoot.querySelector("#container")}attributeChangedCallback(e,n,i){var r,D;if(e===Me.MEDIA_CONTROLLER){if(n){const c=de.getElementById(n);(r=c==null?void 0:c.unassociateElement)==null||r.call(c,this)}if(i){const c=de.getElementById(i);(D=c==null?void 0:c.associateElement)==null||D.call(c,this)}}}connectedCallback(){var e;const n=this.getAttribute(Me.MEDIA_CONTROLLER);if(n){const i=de.getElementById(n);(e=i==null?void 0:i.associateElement)==null||e.call(i,this)}}disconnectedCallback(){var e;const n=this.getAttribute(Me.MEDIA_CONTROLLER);if(n){const i=de.getElementById(n);(e=i==null?void 0:i.unassociateElement)==null||e.call(i,this)}}}ke("media-text-display",Dl);var qn=Dl;class ph extends qn{static get observedAttributes(){return[...super.observedAttributes,X.MEDIA_CURRENT_TIME]}attributeChangedCallback(e,n,i){e===X.MEDIA_CURRENT_TIME&&(this.container.innerHTML=Cr(i)),super.attributeChangedCallback(e,n,i)}}ke("media-current-time-display",ph);class Eh extends qn{static get observedAttributes(){return[...super.observedAttributes,X.MEDIA_DURATION]}attributeChangedCallback(e,n,i){e===X.MEDIA_DURATION&&(this.container.innerHTML=Cr(i)),super.attributeChangedCallback(e,n,i)}}ke("media-duration-display",Eh);const yh="&nbsp;/&nbsp;",Th=(t,{timesSep:e=yh}={})=>{var n,i,r;const D=t.getAttribute("remaining")!=null,c=t.getAttribute("show-duration")!=null,p=(n=t.mediaCurrentTime)!=null?n:0,w=(r=(i=t.mediaDuration)!=null?i:t.mediaSeekableEnd)!=null?r:0,M=Cr(D?0-(w-p):p);return c?`${M}${e}${Cr(w)}`:M},bh="video not loaded, unknown time.",Sh=t=>{const e=t.mediaCurrentTime,n=t.mediaDuration||t.mediaSeekableEnd;if(e==null||n==null){t.setAttribute("aria-valuetext",bh);return}const i=t.hasAttribute("remaining"),r=t.hasAttribute("show-duration"),D=tn(i?0-(n-e):e);if(!r){t.setAttribute("aria-valuetext",D);return}const c=tn(n),p=`${D} of ${c}`;t.setAttribute("aria-valuetext",p)};class Ah extends qn{static get observedAttributes(){return[...super.observedAttributes,X.MEDIA_CURRENT_TIME,X.MEDIA_DURATION,X.MEDIA_SEEKABLE,"remaining","show-duration","disabled"]}constructor(){super()}connectedCallback(){this.hasAttribute("disabled")||this.enable(),this.setAttribute("role","progressbar"),this.setAttribute("aria-label",cr.PLAYBACK_TIME()),super.connectedCallback()}disconnectedCallback(){this.disable()}attributeChangedCallback(e,n,i){if([X.MEDIA_CURRENT_TIME,X.MEDIA_DURATION,X.MEDIA_SEEKABLE,"remaining","show-duration"].includes(e)){const r=Th(this);Sh(this),this.container.innerHTML=r}else e==="disabled"&&i!==n&&(i==null?this.enable():this.disable());super.attributeChangedCallback(e,n,i)}enable(){this.setAttribute("tabindex",0)}disable(){this.removeAttribute("tabindex")}get mediaDuration(){const e=this.getAttribute(X.MEDIA_DURATION);return e!=null?+e:void 0}get mediaCurrentTime(){const e=this.getAttribute(X.MEDIA_CURRENT_TIME);return e!=null?+e:void 0}get mediaSeekable(){const e=this.getAttribute(X.MEDIA_SEEKABLE);if(!!e)return e.split(":").map(n=>+n)}get mediaSeekableEnd(){var e;const[,n]=(e=this.mediaSeekable)!=null?e:[];return n}get mediaSeekableStart(){var e;const[n]=(e=this.mediaSeekable)!=null?e:[];return n}}ke("media-time-display",Ah);const _h=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M22.83 5.68a2.58 2.58 0 0 0-2.3-2.5c-3.62-.24-11.44-.24-15.06 0a2.58 2.58 0 0 0-2.3 2.5c-.23 4.21-.23 8.43 0 12.64a2.58 2.58 0 0 0 2.3 2.5c3.62.24 11.44.24 15.06 0a2.58 2.58 0 0 0 2.3-2.5c.23-4.21.23-8.43 0-12.64Zm-11.39 9.45a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.92 3.92 0 0 1 .92-2.77 3.18 3.18 0 0 1 2.43-1 2.94 2.94 0 0 1 2.13.78c.364.359.62.813.74 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.17 1.61 1.61 0 0 0-1.29.58 2.79 2.79 0 0 0-.5 1.89 3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.48 1.48 0 0 0 1-.37 2.1 2.1 0 0 0 .59-1.14l1.4.44a3.23 3.23 0 0 1-1.07 1.69Zm7.22 0a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.88 3.88 0 0 1 .93-2.77 3.14 3.14 0 0 1 2.42-1 3 3 0 0 1 2.16.82 2.8 2.8 0 0 1 .73 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.21 1.61 1.61 0 0 0-1.29.58A2.79 2.79 0 0 0 15 12a3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.44 1.44 0 0 0 1-.37 2.1 2.1 0 0 0 .6-1.15l1.4.44a3.17 3.17 0 0 1-1.1 1.7Z"/>
</svg>`,xh=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M17.73 14.09a1.4 1.4 0 0 1-1 .37 1.579 1.579 0 0 1-1.27-.58A3 3 0 0 1 15 12a2.8 2.8 0 0 1 .5-1.85 1.63 1.63 0 0 1 1.29-.57 1.47 1.47 0 0 1 1.51 1.2l1.43-.34A2.89 2.89 0 0 0 19 9.07a3 3 0 0 0-2.14-.78 3.14 3.14 0 0 0-2.42 1 3.91 3.91 0 0 0-.93 2.78 3.74 3.74 0 0 0 .92 2.66 3.07 3.07 0 0 0 2.34 1 3.07 3.07 0 0 0 1.91-.57 3.17 3.17 0 0 0 1.07-1.74l-1.4-.45c-.083.43-.3.822-.62 1.12Zm-7.22 0a1.43 1.43 0 0 1-1 .37 1.58 1.58 0 0 1-1.27-.58A3 3 0 0 1 7.76 12a2.8 2.8 0 0 1 .5-1.85 1.63 1.63 0 0 1 1.29-.57 1.47 1.47 0 0 1 1.51 1.2l1.43-.34a2.81 2.81 0 0 0-.74-1.32 2.94 2.94 0 0 0-2.13-.78 3.18 3.18 0 0 0-2.43 1 4 4 0 0 0-.92 2.78 3.74 3.74 0 0 0 .92 2.66 3.07 3.07 0 0 0 2.34 1 3.07 3.07 0 0 0 1.91-.57 3.23 3.23 0 0 0 1.07-1.74l-1.4-.45a2.06 2.06 0 0 1-.6 1.07Zm12.32-8.41a2.59 2.59 0 0 0-2.3-2.51C18.72 3.05 15.86 3 13 3c-2.86 0-5.72.05-7.53.17a2.59 2.59 0 0 0-2.3 2.51c-.23 4.207-.23 8.423 0 12.63a2.57 2.57 0 0 0 2.3 2.5c1.81.13 4.67.19 7.53.19 2.86 0 5.72-.06 7.53-.19a2.57 2.57 0 0 0 2.3-2.5c.23-4.207.23-8.423 0-12.63Zm-1.49 12.53a1.11 1.11 0 0 1-.91 1.11c-1.67.11-4.45.18-7.43.18-2.98 0-5.76-.07-7.43-.18a1.11 1.11 0 0 1-.91-1.11c-.21-4.14-.21-8.29 0-12.43a1.11 1.11 0 0 1 .91-1.11C7.24 4.56 10 4.49 13 4.49s5.76.07 7.43.18a1.11 1.11 0 0 1 .91 1.11c.21 4.14.21 8.29 0 12.43Z"/>
</svg>`,Il=de.createElement("template");Il.innerHTML=`
  <style>
  :host([aria-checked="true"]) slot:not([name=on]) > *,
  :host([aria-checked="true"]) ::slotted(:not([slot=on])) {
    display: none !important;
  }

  
  :host(:not([aria-checked="true"])) slot:not([name=off]) > *, 
  :host(:not([aria-checked="true"])) ::slotted(:not([slot=off])) {
    display: none !important;
  }
  </style>

  <slot name="on">${_h}</slot>
  <slot name="off">${xh}</slot>
`;const is=t=>{t.setAttribute("aria-checked",il(t))};class Dh extends Xt{static get observedAttributes(){return[...super.observedAttributes,"no-subtitles-fallback","default-showing",X.MEDIA_CAPTIONS_LIST,X.MEDIA_CAPTIONS_SHOWING,X.MEDIA_SUBTITLES_LIST,X.MEDIA_SUBTITLES_SHOWING]}constructor(e={}){super({slotTemplate:Il,...e}),this._captionsReady=!1}connectedCallback(){super.connectedCallback(),this.setAttribute("role","switch"),this.setAttribute("aria-label",cr.CLOSED_CAPTIONS()),is(this)}attributeChangedCallback(e,n,i){if([X.MEDIA_CAPTIONS_SHOWING,X.MEDIA_SUBTITLES_SHOWING].includes(e)&&is(this),this.hasAttribute("default-showing")&&this.getAttribute("aria-checked")!=="true"){const r=!this.hasAttribute("no-subtitles-fallback");if((r?[X.MEDIA_CAPTIONS_LIST,X.MEDIA_SUBTITLES_LIST]:[X.MEDIA_CAPTIONS_LIST]).includes(e)){const c=!!this.getAttribute(X.MEDIA_CAPTIONS_LIST)||!!(r&&this.getAttribute(X.MEDIA_SUBTITLES_LIST));this._captionsReady!==c&&(this._captionsReady=c,this._captionsReady&&this.handleClick())}}super.attributeChangedCallback(e,n,i)}handleClick(){al(this)}}ke("media-captions-button",Dh);const zi="30",Ih=`<svg aria-hidden="true" viewBox="0 0 20 24"><defs><style>.text{font-size:8px;font-family:Arial-BoldMT, Arial;font-weight:700;}</style></defs><text class="text value" transform="translate(8.9 19.87)">${zi}</text><path d="M10 6V3l5.61 4L10 10.94V8a5.54 5.54 0 0 0-1.9 10.48v2.12A7.5 7.5 0 0 1 10 6Z"/></svg>`,Ll=de.createElement("template");Ll.innerHTML=`  
  <slot name="forward">${Ih}</slot>
`;const Lh=0,as=t=>{const e=Math.abs(+t.getAttribute("seek-offset")),n=Rt.SEEK_FORWARD_N_SECS({seekOffset:e});t.setAttribute("aria-label",n)},ss=t=>{const e=Zo(t,"forward"),n=t.getAttribute("seek-offset");Qo(e,n)};class Rh extends Xt{static get observedAttributes(){return[...super.observedAttributes,X.MEDIA_CURRENT_TIME,"seek-offset"]}constructor(e={}){super({slotTemplate:Ll,...e})}connectedCallback(){this.hasAttribute("seek-offset")||this.setAttribute("seek-offset",zi),as(this),ss(this),super.connectedCallback()}attributeChangedCallback(e,n,i){e==="seek-offset"&&(i==null&&this.setAttribute("seek-offset",zi),ss(this),as(this)),super.attributeChangedCallback(e,n,i)}handleClick(){const e=this.getAttribute(X.MEDIA_CURRENT_TIME),n=+this.getAttribute("seek-offset"),r=(e&&!Number.isNaN(+e)?+e:Lh)+n,D=new me.CustomEvent(Ae.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:r});this.dispatchEvent(D)}}ke("media-seek-forward-button",Rh);const Ch=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M16 3v2.5h3.5V9H22V3h-6ZM4 9h2.5V5.5H10V3H4v6Zm15.5 9.5H16V21h6v-6h-2.5v3.5ZM6.5 15H4v6h6v-2.5H6.5V15Z"/>
</svg>`,Oh=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M18.5 6.5V3H16v6h6V6.5h-3.5ZM16 21h2.5v-3.5H22V15h-6v6ZM4 17.5h3.5V21H10v-6H4v2.5Zm3.5-11H4V9h6V3H7.5v3.5Z"/>
</svg>`,Rl=de.createElement("template");Rl.innerHTML=`
  <style>
  :host([${X.MEDIA_IS_FULLSCREEN}]) slot:not([name=exit]) > *,
  :host([${X.MEDIA_IS_FULLSCREEN}]) ::slotted(:not([slot=exit])) {
    display: none !important;
  }

  
  :host(:not([${X.MEDIA_IS_FULLSCREEN}])) slot:not([name=enter]) > *,
  :host(:not([${X.MEDIA_IS_FULLSCREEN}])) ::slotted(:not([slot=enter])) {
    display: none !important;
  }
  </style>

  <slot name="enter">${Ch}</slot>
  <slot name="exit">${Oh}</slot>
`;const os=t=>{const n=t.getAttribute(X.MEDIA_IS_FULLSCREEN)!=null?Rt.EXIT_FULLSCREEN():Rt.ENTER_FULLSCREEN();t.setAttribute("aria-label",n)};class Mh extends Xt{static get observedAttributes(){return[...super.observedAttributes,X.MEDIA_IS_FULLSCREEN,X.MEDIA_FULLSCREEN_UNAVAILABLE]}constructor(e={}){super({slotTemplate:Rl,...e})}connectedCallback(){os(this),super.connectedCallback()}attributeChangedCallback(e,n,i){e===X.MEDIA_IS_FULLSCREEN&&os(this),super.attributeChangedCallback(e,n,i)}handleClick(){const e=this.getAttribute(X.MEDIA_IS_FULLSCREEN)!=null?Ae.MEDIA_EXIT_FULLSCREEN_REQUEST:Ae.MEDIA_ENTER_FULLSCREEN_REQUEST;this.dispatchEvent(new me.CustomEvent(e,{composed:!0,bubbles:!0}))}}ke("media-fullscreen-button",Mh);const Ph=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M16.5 12A4.5 4.5 0 0 0 14 8v2.18l2.45 2.45a4.22 4.22 0 0 0 .05-.63Zm2.5 0a6.84 6.84 0 0 1-.54 2.64L20 16.15A8.8 8.8 0 0 0 21 12a9 9 0 0 0-7-8.77v2.06A7 7 0 0 1 19 12ZM4.27 3 3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25A6.92 6.92 0 0 1 14 18.7v2.06A9 9 0 0 0 17.69 19l2 2.05L21 19.73l-9-9L4.27 3ZM12 4 9.91 6.09 12 8.18V4Z"/>
</svg>`,ls=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M3 9v6h4l5 5V4L7 9H3Zm13.5 3A4.5 4.5 0 0 0 14 8v8a4.47 4.47 0 0 0 2.5-4Z"/>
</svg>`,wh=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M3 9v6h4l5 5V4L7 9H3Zm13.5 3A4.5 4.5 0 0 0 14 8v8a4.47 4.47 0 0 0 2.5-4ZM14 3.23v2.06a7 7 0 0 1 0 13.42v2.06a9 9 0 0 0 0-17.54Z"/>
</svg>`,Cl=de.createElement("template");Cl.innerHTML=`
  <style>
  
  :host(:not([${X.MEDIA_VOLUME_LEVEL}])) slot:not([name=high]) > *, 
  :host(:not([${X.MEDIA_VOLUME_LEVEL}])) ::slotted(:not([slot=high])),
  :host([${X.MEDIA_VOLUME_LEVEL}=high]) slot:not([name=high]) > *, 
  :host([${X.MEDIA_VOLUME_LEVEL}=high]) ::slotted(:not([slot=high])) {
    display: none !important;
  }

  :host([${X.MEDIA_VOLUME_LEVEL}=off]) slot:not([name=off]) > *, 
  :host([${X.MEDIA_VOLUME_LEVEL}=off]) ::slotted(:not([slot=off])) {
    display: none !important;
  }

  :host([${X.MEDIA_VOLUME_LEVEL}=low]) slot:not([name=low]) > *, 
  :host([${X.MEDIA_VOLUME_LEVEL}=low]) ::slotted(:not([slot=low])) {
    display: none !important;
  }

  :host([${X.MEDIA_VOLUME_LEVEL}=medium]) slot:not([name=medium]) > *, 
  :host([${X.MEDIA_VOLUME_LEVEL}=medium]) ::slotted(:not([slot=medium])) {
    display: none !important;
  }
  </style>

  <slot name="off">${Ph}</slot>
  <slot name="low">${ls}</slot>
  <slot name="medium">${ls}</slot>
  <slot name="high">${wh}</slot>
`;const us=t=>{const n=t.getAttribute(X.MEDIA_VOLUME_LEVEL)==="off"?Rt.UNMUTE():Rt.MUTE();t.setAttribute("aria-label",n)};class kh extends Xt{static get observedAttributes(){return[...super.observedAttributes,X.MEDIA_VOLUME_LEVEL]}constructor(e={}){super({slotTemplate:Cl,...e})}connectedCallback(){us(this),super.connectedCallback()}attributeChangedCallback(e,n,i){e===X.MEDIA_VOLUME_LEVEL&&us(this),super.attributeChangedCallback(e,n,i)}handleClick(){const e=this.getAttribute(X.MEDIA_VOLUME_LEVEL)==="off"?Ae.MEDIA_UNMUTE_REQUEST:Ae.MEDIA_MUTE_REQUEST;this.dispatchEvent(new me.CustomEvent(e,{composed:!0,bubbles:!0}))}}ke("media-mute-button",kh);const ds=`<svg aria-hidden="true" viewBox="0 0 28 24">
  <path d="M24 3H4a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h20a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1Zm-1 16H5V5h18v14Zm-3-8h-7v5h7v-5Z"/>
</svg>`,Ol=de.createElement("template");Ol.innerHTML=`
  <style>
  :host([${X.MEDIA_IS_PIP}]) slot:not([name=exit]) > *, 
  :host([${X.MEDIA_IS_PIP}]) ::slotted(:not([slot=exit])) {
    display: none !important;
  }

  
  :host(:not([${X.MEDIA_IS_PIP}])) slot:not([name=enter]) > *, 
  :host(:not([${X.MEDIA_IS_PIP}])) ::slotted(:not([slot=enter])) {
    display: none !important;
  }
  </style>

  <slot name="enter">${ds}</slot>
  <slot name="exit">${ds}</slot>
`;const cs=t=>{const n=t.getAttribute(X.MEDIA_IS_PIP)!=null?Rt.EXIT_PIP():Rt.ENTER_PIP();t.setAttribute("aria-label",n)};class Uh extends Xt{static get observedAttributes(){return[...super.observedAttributes,X.MEDIA_IS_PIP,X.MEDIA_PIP_UNAVAILABLE]}constructor(e={}){super({slotTemplate:Ol,...e})}connectedCallback(){cs(this),super.connectedCallback()}attributeChangedCallback(e,n,i){e===X.MEDIA_IS_PIP&&cs(this),super.attributeChangedCallback(e,n,i)}handleClick(){const e=this.getAttribute(X.MEDIA_IS_PIP)!=null?Ae.MEDIA_EXIT_PIP_REQUEST:Ae.MEDIA_ENTER_PIP_REQUEST;this.dispatchEvent(new me.CustomEvent(e,{composed:!0,bubbles:!0}))}}ke("media-pip-button",Uh);const Fh=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="m6 21 15-9L6 3v18Z"/>
</svg>`,Bh=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M6 20h4V4H6v16Zm8-16v16h4V4h-4Z"/>
</svg>`,Ml=de.createElement("template");Ml.innerHTML=`
  <style>
  :host([${X.MEDIA_PAUSED}]) slot[name=pause] > *, 
  :host([${X.MEDIA_PAUSED}]) ::slotted([slot=pause]) {
    display: none !important;
  }

  :host(:not([${X.MEDIA_PAUSED}])) slot[name=play] > *, 
  :host(:not([${X.MEDIA_PAUSED}])) ::slotted([slot=play]) {
    display: none !important;
  }
  </style>

  <slot name="play">${Fh}</slot>
  <slot name="pause">${Bh}</slot>
`;const fs=t=>{const n=t.getAttribute(X.MEDIA_PAUSED)!=null?Rt.PLAY():Rt.PAUSE();t.setAttribute("aria-label",n)};class Nh extends Xt{static get observedAttributes(){return[...super.observedAttributes,X.MEDIA_PAUSED]}constructor(e={}){super({slotTemplate:Ml,...e})}connectedCallback(){fs(this),super.connectedCallback()}attributeChangedCallback(e,n,i){e===X.MEDIA_PAUSED&&fs(this),super.attributeChangedCallback(e,n,i)}handleClick(){const e=this.getAttribute(X.MEDIA_PAUSED)!=null?Ae.MEDIA_PLAY_REQUEST:Ae.MEDIA_PAUSE_REQUEST;this.dispatchEvent(new me.CustomEvent(e,{composed:!0,bubbles:!0}))}}ke("media-play-button",Nh);const hs=[1,1.25,1.5,1.75,2],In=1,Pl=de.createElement("template");Pl.innerHTML=`
  <span id="container"></span>
`;class Kh extends Xt{static get observedAttributes(){return[...super.observedAttributes,X.MEDIA_PLAYBACK_RATE,"rates"]}constructor(e={}){super({slotTemplate:Pl,...e}),this._rates=hs,this.container=this.shadowRoot.querySelector("#container"),this.container.innerHTML=`${In}x`}attributeChangedCallback(e,n,i){if(e==="rates"){const r=(i!=null?i:"").trim().split(/\s*,?\s+/).map(D=>Number(D)).filter(D=>!Number.isNaN(D)).sort((D,c)=>D-c);this._rates=r.length?r:hs;return}if(e===X.MEDIA_PLAYBACK_RATE){const r=i?+i:Number.NaN,D=Number.isNaN(r)?In:r;this.container.innerHTML=`${D}x`,this.setAttribute("aria-label",cr.PLAYBACK_RATE({playbackRate:D}));return}super.attributeChangedCallback(e,n,i)}handleClick(){var e,n;const i=+this.getAttribute(X.MEDIA_PLAYBACK_RATE)||In,r=(n=(e=this._rates.find(c=>c>i))!=null?e:this._rates[0])!=null?n:In,D=new me.CustomEvent(Ae.MEDIA_PLAYBACK_RATE_REQUEST,{composed:!0,bubbles:!0,detail:r});this.dispatchEvent(D)}}ke("media-playback-rate-button",Kh);const wl=de.createElement("template");wl.innerHTML=`
  <style>
    :host {
      pointer-events: none;
      display: inline-block;
      box-sizing: border-box;
    }

    img {
      max-width: 100%;
      max-height: 100%;
      min-width: 100%;
      min-height: 100%;
      background-repeat: no-repeat;
      background-position: var(--media-background-position, var(--media-object-position, center));
      background-size: var(--media-background-size, var(--media-object-fit, contain));
      object-fit: var(--media-object-fit, contain);
      object-position: var(--media-object-position, center);
    }

    :host([${X.MEDIA_HAS_PLAYED}]) img {
      display: none;
    }
  </style>

  <img aria-hidden="true" id="image"/>
`;const jh=t=>{t.style.removeProperty("background-image")},Wh=(t,e)=>{t.style["background-image"]=`url('${e}')`};class Gh extends me.HTMLElement{static get observedAttributes(){return[X.MEDIA_HAS_PLAYED,"placeholder-src","src"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(wl.content.cloneNode(!0)),this.image=this.shadowRoot.querySelector("#image")}attributeChangedCallback(e,n,i){e==="src"&&(i==null?this.image.removeAttribute("src"):this.image.setAttribute("src",i)),e==="placeholder-src"&&(i==null?jh(this.image):Wh(this.image,i))}}ke("media-poster-image",Gh);var da=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)},rt=(t,e,n)=>(da(t,e,"read from private field"),n?n.call(t):e.get(t)),St=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},rr=(t,e,n,i)=>(da(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n),$r=(t,e,n)=>(da(t,e,"access private method"),n),Qr,kn,Zr,Vn,$n,Un,Yi,Fn,Lr,an,Xi,zn,ei,Bn,Qi,Zi,kl;const Hh="video not loaded, unknown time.",Ii=t=>{const e=t.range,n=tn(+e.value),i=tn(+e.max),r=n&&i?`${n} of ${i}`:Hh;e.setAttribute("aria-valuetext",r)},Ul=de.createElement("template");Ul.innerHTML=`
  <style>
    :host {
      --media-preview-background-color: rgba(20,20,30, .5);
      --media-preview-background: var(--media-control-background,
        var(--media-preview-background-color));
      --media-preview-border-radius: 3px;
      --media-box-padding-left: 10px;
      --media-box-padding-right: 10px;
      color: #fff;
    }

    #preview-rail,
    #current-rail {
      
      width: 1%;
      position: absolute;
      left: 0;
      bottom: 100%;
      pointer-events: none;
    }

    [part~="box"] {
      
      position: absolute;
      bottom: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      transform: translateX(-50%);
    }

    [part~="preview-box"] {
      transition: visibility .25s, opacity .25s;
      visibility: hidden;
      opacity: 0;
    }

    media-preview-thumbnail,
    ::slotted(media-preview-thumbnail) {
      visibility: hidden;
      transition: visibility 0s .25s;
      background: var(--media-preview-time-background, var(--media-preview-background));
      box-shadow: var(--media-preview-thumbnail-box-shadow, 0 0 4px rgba(0,0,0, .2));
      max-width: var(--media-preview-thumbnail-max-width, 180px);
      max-height: var(--media-preview-thumbnail-max-height, 160px);
      min-width: var(--media-preview-thumbnail-min-width, 120px);
      min-height: var(--media-preview-thumbnail-min-height, 80px);
      border: var(--media-preview-thumbnail-border);
      border-radius: var(--media-preview-thumbnail-border-radius,
        var(--media-preview-border-radius) var(--media-preview-border-radius) 0 0);
    }

    :host([${X.MEDIA_PREVIEW_IMAGE}]:hover) media-preview-thumbnail,
    :host([${X.MEDIA_PREVIEW_IMAGE}]:hover) ::slotted(media-preview-thumbnail) {
      transition-delay: 0s;
      visibility: visible;
    }

    media-preview-time-display,
    ::slotted(media-preview-time-display) {
      color: unset;
      min-width: 0;
      
      transition: min-width 0s .25s, border-radius 0s .25s;
      background: var(--media-preview-time-background, var(--media-preview-background));
      border-radius: var(--media-preview-time-border-radius,
        var(--media-preview-border-radius) var(--media-preview-border-radius)
        var(--media-preview-border-radius) var(--media-preview-border-radius));
      padding: var(--media-preview-time-padding, 1px 10px 0);
      margin: var(--media-preview-time-margin, 0 0 10px);
      text-shadow: var(--media-preview-time-text-shadow, 0 0 4px rgba(0,0,0, .75));
    }

    :host([${X.MEDIA_PREVIEW_IMAGE}]) media-preview-time-display,
    :host([${X.MEDIA_PREVIEW_IMAGE}]) ::slotted(media-preview-time-display) {
      transition-delay: 0s;
      min-width: 100%;
      border-radius: var(--media-preview-time-border-radius,
        0 0 var(--media-preview-border-radius) var(--media-preview-border-radius));
    }

    :host([${X.MEDIA_PREVIEW_IMAGE}]:hover) [part~="preview-box"],
    :host([${X.MEDIA_PREVIEW_TIME}]:hover) [part~="preview-box"] {
      transition: visibility .5s, opacity .5s;
      visibility: visible;
      opacity: 1;
    }

    :host([${X.MEDIA_PREVIEW_TIME}]:hover) {
      --media-time-range-hover-display: block;
    }
  </style>
  <div id="preview-rail">
    <slot name="preview" part="box preview-box">
      <media-preview-thumbnail></media-preview-thumbnail>
      <media-preview-time-display></media-preview-time-display>
    </slot>
  </div>
  <div id="current-rail">
    <slot name="current" part="box current-box">
      
    </slot>
  </div>
`;class Fl extends Al{constructor(){super(),St(this,Un),St(this,Bn),St(this,Zi),St(this,Qr,void 0),St(this,kn,void 0),St(this,Zr,void 0),St(this,Vn,void 0),St(this,$n,void 0),St(this,Fn,n=>{if([...rt(this,Qr)].some(O=>n.composedPath().includes(O)))return;this.updatePointerBar(n);const i=+this.getAttribute(X.MEDIA_DURATION);if(!i)return;const r=this.range.getBoundingClientRect();let D=(n.clientX-r.left)/r.width;D=Math.max(0,Math.min(1,D));const c=$r(this,Un,Yi).call(this,rt(this,kn),D),{style:p}=wr(this.shadowRoot,"#preview-rail");p.transform=`translateX(${c})`;const w=D*i,M=new me.CustomEvent(Ae.MEDIA_PREVIEW_REQUEST,{composed:!0,bubbles:!0,detail:w});this.dispatchEvent(M)}),St(this,Lr,!1),St(this,an,n=>{(!n.composedPath().includes(this)||[...rt(this,Qr)].some(i=>n.composedPath().includes(i)))&&(me.removeEventListener("pointermove",rt(this,an)),rr(this,Lr,!1),rt(this,zn).call(this))}),St(this,Xi,()=>{me.addEventListener("pointermove",rt(this,Fn),!1)}),St(this,zn,()=>{me.removeEventListener("pointermove",rt(this,Fn));const n=new me.CustomEvent(Ae.MEDIA_PREVIEW_REQUEST,{composed:!0,bubbles:!0,detail:null});this.dispatchEvent(n)}),St(this,ei,()=>{const n=this.getAttribute(X.MEDIA_DURATION);!rt(this,Lr)&&n&&(rr(this,Lr,!0),rt(this,Xi).call(this),me.addEventListener("pointermove",rt(this,an),!1))}),this.container.appendChild(Ul.content.cloneNode(!0)),this.range.addEventListener("input",()=>{cancelAnimationFrame(this._refreshId);const i=this.range.value,r=new me.CustomEvent(Ae.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:i});this.dispatchEvent(r)}),this._refreshBar=()=>{const n=(performance.now()-this._updateTimestamp)/1e3;this.range.value=this.mediaCurrentTime+n*this.mediaPlaybackRate,this.updateBar(),this.updateCurrentBox(),this._refreshId=requestAnimationFrame(this._refreshBar)},rr(this,Qr,this.shadowRoot.querySelectorAll('[part~="box"]')),rr(this,kn,this.shadowRoot.querySelector('[part~="preview-box"]')),rr(this,Zr,this.shadowRoot.querySelector('[part~="current-box"]'));const e=getComputedStyle(this);rr(this,Vn,parseInt(e.getPropertyValue("--media-box-padding-left"))),rr(this,$n,parseInt(e.getPropertyValue("--media-box-padding-right"))),$r(this,Bn,Qi).call(this)}static get observedAttributes(){return[...super.observedAttributes,"thumbnails","disabled",X.MEDIA_PAUSED,X.MEDIA_DURATION,X.MEDIA_SEEKABLE,X.MEDIA_CURRENT_TIME,X.MEDIA_PREVIEW_IMAGE,X.MEDIA_PREVIEW_TIME,X.MEDIA_BUFFERED,X.MEDIA_PLAYBACK_RATE,X.MEDIA_LOADING]}connectedCallback(){this.range.setAttribute("aria-label",cr.SEEK()),super.connectedCallback()}disconnectedCallback(){cancelAnimationFrame(this._refreshId),super.disconnectedCallback()}attributeChangedCallback(e,n,i){var r,D,c,p,w;(e===X.MEDIA_CURRENT_TIME||e===X.MEDIA_PAUSED||e===X.MEDIA_LOADING)&&(this._updateTimestamp=performance.now(),this.range.value=this.mediaCurrentTime,Ii(this),this.updateBar(),this.updateCurrentBox(),cancelAnimationFrame(this._refreshId),!this.mediaPaused&&!this.mediaLoading&&(this._refreshId=requestAnimationFrame(this._refreshBar))),e===X.MEDIA_DURATION&&(this.range.max=Math.floor((D=(r=this.mediaSeekableEnd)!=null?r:this.mediaDuration)!=null?D:1e3),Ii(this),this.updateBar(),this.updateCurrentBox()),e===X.MEDIA_SEEKABLE&&(this.range.min=(c=this.mediaSeekableStart)!=null?c:0,this.range.max=Math.floor((w=(p=this.mediaSeekableEnd)!=null?p:this.mediaDuration)!=null?w:1e3),Ii(this),this.updateBar()),e===X.MEDIA_BUFFERED&&this.updateBar(),e==="disabled"&&(i==null?$r(this,Bn,Qi).call(this):$r(this,Zi,kl).call(this)),super.attributeChangedCallback(e,n,i)}get mediaPaused(){return this.hasAttribute(X.MEDIA_PAUSED)}get mediaLoading(){return this.hasAttribute(X.MEDIA_LOADING)}get mediaDuration(){const e=this.getAttribute(X.MEDIA_DURATION);return e!=null?+e:void 0}get mediaCurrentTime(){const e=this.getAttribute(X.MEDIA_CURRENT_TIME);return e!=null?+e:void 0}get mediaPlaybackRate(){const e=this.getAttribute(X.MEDIA_PLAYBACK_RATE);return e!=null?+e:1}get mediaBuffered(){const e=this.getAttribute(X.MEDIA_BUFFERED);return e?e.split(" ").map(n=>n.split(":").map(i=>+i)):[]}get mediaSeekable(){const e=this.getAttribute(X.MEDIA_SEEKABLE);if(!!e)return e.split(":").map(n=>+n)}get mediaSeekableEnd(){var e;const[,n]=(e=this.mediaSeekable)!=null?e:[];return n}get mediaSeekableStart(){var e;const[n]=(e=this.mediaSeekable)!=null?e:[];return n}getBarColors(){var e;let n=super.getBarColors();const{range:i}=this,r=i.max-i.min,D=this.mediaBuffered;if(!D.length||!Number.isFinite(r)||r<=0)return n;const c=this.mediaCurrentTime,[,p=i.min]=(e=D.find(([O,C])=>O<=c&&c<=C))!=null?e:[],M=(p-i.min)/r*100;return n.splice(1,0,["var(--media-time-buffered-color, rgba(255,255,255, .4))",M]),n}updateCurrentBox(){if(!rt(this,Zr).assignedElements().length)return;const e=this.range.value/(this.range.max-this.range.min),n=$r(this,Un,Yi).call(this,rt(this,Zr),e),{style:i}=wr(this.shadowRoot,"#current-rail");i.transform=`translateX(${n})`}}Qr=new WeakMap;kn=new WeakMap;Zr=new WeakMap;Vn=new WeakMap;$n=new WeakMap;Un=new WeakSet;Yi=function(t,e){var n;let i=`${e*100*100}%`;const r=t.offsetWidth;if(!r)return i;const D=(n=this.getAttribute("bounds")?la(this,`#${this.getAttribute("bounds")}`):this.parentElement)!=null?n:this,c=this.range.getBoundingClientRect(),p=D.getBoundingClientRect(),w=(rt(this,Vn)-(c.left-p.left-r/2))/c.width*100,M=(p.right-c.left-r/2-rt(this,$n))/c.width*100;return Number.isNaN(w)||(i=`max(${w*100}%, ${i})`),Number.isNaN(M)||(i=`min(${i}, ${M*100}%)`),i};Fn=new WeakMap;Lr=new WeakMap;an=new WeakMap;Xi=new WeakMap;zn=new WeakMap;ei=new WeakMap;Bn=new WeakSet;Qi=function(){this.addEventListener("pointermove",rt(this,ei),!1)};Zi=new WeakSet;kl=function(){me.removeEventListener("pointermove",rt(this,an)),this.removeEventListener("pointermove",rt(this,ei)),rr(this,Lr,!1),rt(this,zn).call(this)};ke("media-time-range",Fl);var Vh=Fl;class $h extends Vh{constructor(){super(),console.warn("MediaChrome: <media-progress-range> is deprecated. Use <media-time-range> instead.")}}ke("media-progress-range",$h);const Ji="30",zh=`<svg aria-hidden="true" viewBox="0 0 20 24"><defs><style>.text{font-size:8px;font-family:Arial-BoldMT, Arial;font-weight:700;}</style></defs><text class="text value" transform="translate(2.18 19.87)">${Ji}</text><path d="M10 6V3L4.37 7 10 10.94V8a5.54 5.54 0 0 1 1.9 10.48v2.12A7.5 7.5 0 0 0 10 6Z"/></svg>`,Bl=de.createElement("template");Bl.innerHTML=`  
  <slot name="backward">${zh}</slot>
`;const Yh=0,vs=t=>{const e=Math.abs(+t.getAttribute("seek-offset")),n=Rt.SEEK_BACK_N_SECS({seekOffset:e});t.setAttribute("aria-label",n)},gs=t=>{const e=Zo(t,"backward"),n=t.getAttribute("seek-offset");Qo(e,n)};class Xh extends Xt{static get observedAttributes(){return[...super.observedAttributes,X.MEDIA_CURRENT_TIME]}constructor(e={}){super({slotTemplate:Bl,...e})}connectedCallback(){this.hasAttribute("seek-offset")||this.setAttribute("seek-offset",Ji),vs(this),gs(this),super.connectedCallback()}attributeChangedCallback(e,n,i){e==="seek-offset"&&(i==null&&this.setAttribute("seek-offset",Ji),gs(this),vs(this)),super.attributeChangedCallback(e,n,i)}handleClick(){const e=this.getAttribute(X.MEDIA_CURRENT_TIME),n=+this.getAttribute("seek-offset"),i=e&&!Number.isNaN(+e)?+e:Yh,r=Math.max(i-n,0),D=new me.CustomEvent(Ae.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:r});this.dispatchEvent(D)}}ke("media-seek-backward-button",Xh);class Qh extends qn{static get observedAttributes(){return[...super.observedAttributes,X.MEDIA_PREVIEW_TIME]}attributeChangedCallback(e,n,i){e===X.MEDIA_PREVIEW_TIME&&i!=null&&(this.container.textContent=Cr(i)),super.attributeChangedCallback(e,n,i)}}ke("media-preview-time-display",Qh);const Nl=de.createElement("template");Nl.innerHTML=`
  <style>
    :host {
      box-sizing: border-box;
      display: inline-block;
      overflow: hidden;
    }

    img {
      display: none;
      position: relative;
    }
  </style>
  <img crossorigin loading="eager" decoding="async" />
`;class Zh extends me.HTMLElement{static get observedAttributes(){return[Me.MEDIA_CONTROLLER,"time",X.MEDIA_PREVIEW_IMAGE,X.MEDIA_PREVIEW_COORDS]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Nl.content.cloneNode(!0))}connectedCallback(){var e;const n=this.getAttribute(Me.MEDIA_CONTROLLER);if(n){const i=de.getElementById(n);(e=i==null?void 0:i.associateElement)==null||e.call(i,this)}}disconnectedCallback(){var e;const n=this.getAttribute(Me.MEDIA_CONTROLLER);if(n){const i=de.getElementById(n);(e=i==null?void 0:i.unassociateElement)==null||e.call(i,this)}}attributeChangedCallback(e,n,i){var r,D;if(["time",X.MEDIA_PREVIEW_IMAGE,X.MEDIA_PREVIEW_COORDS].includes(e)&&this.update(),e===Me.MEDIA_CONTROLLER){if(n){const c=de.getElementById(n);(r=c==null?void 0:c.unassociateElement)==null||r.call(c,this)}if(i){const c=de.getElementById(i);(D=c==null?void 0:c.associateElement)==null||D.call(c,this)}}}update(){const e=this.getAttribute(X.MEDIA_PREVIEW_COORDS),n=this.getAttribute(X.MEDIA_PREVIEW_IMAGE);if(!(e&&n))return;const[i,r,D,c]=e.split(/\s+/).map(E=>+E),p=n.split("#")[0],w=getComputedStyle(this),{maxWidth:M,maxHeight:O,minWidth:C,minHeight:S}=w,b=Math.min(parseInt(M)/D,parseInt(O)/c),I=Math.max(parseInt(C)/D,parseInt(S)/c),L=b<1,_=L?b:I>1?I:1,{style:x}=wr(this.shadowRoot,":host"),l=wr(this.shadowRoot,"img").style,a=this.shadowRoot.querySelector("img"),d=L?"min":"max";x.setProperty(`${d}-width`,"initial","important"),x.setProperty(`${d}-height`,"initial","important"),x.width=`${D*_}px`,x.height=`${c*_}px`;const y=()=>{l.width=`${this.imgWidth*_}px`,l.height=`${this.imgHeight*_}px`,l.display="block"};a.src!==p&&(a.onload=()=>{this.imgWidth=a.naturalWidth,this.imgHeight=a.naturalHeight,y()},a.src=p,y()),y(),l.transform=`translate(-${i*_}px, -${r*_}px)`}}ke("media-preview-thumbnail",Zh);const Kl=de.createElement("template"),Jh=`
<svg aria-hidden="true" viewBox="0 0 100 100">
  <path d="M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50">
    <animateTransform
       attributeName="transform"
       attributeType="XML"
       type="rotate"
       dur="1s"
       from="0 50 50"
       to="360 50 50"
       repeatCount="indefinite" />
  </path>
</svg>
`;Kl.innerHTML=`
<style>
:host {
  display: inline-block;
  vertical-align: middle;
  box-sizing: border-box;
}

#status {
  color: rgba(0,0,0,0);
  width: 0px;
  height: 0px;
}

:host slot[name=loading] > *,
:host ::slotted([slot=loading]) {
  opacity: 1;
  transition: opacity 0.15s;
}

:host(:not([is-loading])) slot[name=loading] > *, 
:host(:not([is-loading])) ::slotted([slot=loading]) {
  opacity: 0;
}

:host(:not([is-loading])) #status {
  display: none;
}

svg, img, ::slotted(svg), ::slotted(img) {
  width: var(--media-loading-icon-width, 100px);
  height: var(--media-loading-icon-height);
  fill: var(--media-icon-color, #fff);
  vertical-align: middle;
}
</style>

<slot name="loading">${Jh}</slot>
<div id="status" role="status" aria-live="polite">${cr.MEDIA_LOADING()}</div>
`;const qh=500;class ev extends me.HTMLElement{static get observedAttributes(){return[Me.MEDIA_CONTROLLER,X.MEDIA_PAUSED,X.MEDIA_LOADING,"loading-delay"]}constructor(){super();const e=this.attachShadow({mode:"open"}),n=Kl.content.cloneNode(!0);e.appendChild(n)}attributeChangedCallback(e,n,i){var r,D,c;if(e===X.MEDIA_LOADING||e===X.MEDIA_PAUSED){const p=this.getAttribute(X.MEDIA_PAUSED)!=null,w=this.getAttribute(X.MEDIA_LOADING)!=null,M=!p&&w;if(!M)this.loadingDelayHandle&&(clearTimeout(this.loadingDelayHandle),this.loadingDelayHandle=void 0),this.removeAttribute("is-loading");else if(!this.loadingDelayHandle&&M){const O=+((r=this.getAttribute("loading-delay"))!=null?r:qh);this.loadingDelayHandle=setTimeout(()=>{this.setAttribute("is-loading",""),this.loadingDelayHandle=void 0},O)}}else if(e===Me.MEDIA_CONTROLLER){if(n){const p=de.getElementById(n);(D=p==null?void 0:p.unassociateElement)==null||D.call(p,this)}if(i){const p=de.getElementById(i);(c=p==null?void 0:p.associateElement)==null||c.call(p,this)}}}connectedCallback(){var e;const n=this.getAttribute(Me.MEDIA_CONTROLLER);if(n){const i=de.getElementById(n);(e=i==null?void 0:i.associateElement)==null||e.call(i,this)}}disconnectedCallback(){var e;this.loadingDelayHandle&&(clearTimeout(this.loadingDelayHandle),this.loadingDelayHandle=void 0);const n=this.getAttribute(Me.MEDIA_CONTROLLER);if(n){const i=de.getElementById(n);(e=i==null?void 0:i.unassociateElement)==null||e.call(i,this)}}}ke("media-loading-indicator",ev);const jl=de.createElement("template");jl.innerHTML=`
  <style>
    :host {
    }
  </style>
  <slot></slot>
`;class tv extends me.HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(jl.content.cloneNode(!0))}}ke("media-title-bar",tv);const rv=100,nv=t=>{var e;if(t.getAttribute(X.MEDIA_MUTED)!=null)return 0;const i=+((e=t.getAttribute(X.MEDIA_VOLUME))!=null?e:1);return Math.round(i*t.range.max)},iv=({value:t,max:e})=>`${Math.round(t/e*100)}%`;class av extends Al{static get observedAttributes(){return[...super.observedAttributes,X.MEDIA_VOLUME,X.MEDIA_MUTED,X.MEDIA_VOLUME_UNAVAILABLE]}constructor(){super(),this.range.max=rv,this.range.addEventListener("input",()=>{const n=this.range.value/this.range.max,i=new me.CustomEvent(Ae.MEDIA_VOLUME_REQUEST,{composed:!0,bubbles:!0,detail:n});this.dispatchEvent(i)})}connectedCallback(){this.range.setAttribute("aria-label",cr.VOLUME()),super.connectedCallback()}attributeChangedCallback(e,n,i){if(e===X.MEDIA_VOLUME||e===X.MEDIA_MUTED){const r=nv(this);this.range.value=r,this.range.setAttribute("aria-valuetext",iv(this.range)),this.updateBar()}super.attributeChangedCallback(e,n,i)}}ke("media-volume-range",av);var sv=Object.defineProperty,ov=(t,e,n)=>e in t?sv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,lv=(t,e,n)=>(ov(t,typeof e!="symbol"?e+"":e,n),n);class Wl extends me.HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.render()}render(){this.shadowRoot.textContent="";const e=de.createElement("template");e.innerHTML=this.constructor.template,this.shadowRoot.append(e.content.cloneNode(!0))}get mediaController(){return this.shadowRoot.querySelector("media-controller")}}lv(Wl,"template","");ke("media-theme-base",Wl);class uv extends yl{}me.customElements.get("media-chrome")||me.customElements.define("media-chrome",uv);class dv extends yl{constructor(){super(),console.warn("MediaChrome: <media-container> is deprecated. Use <media-controller>.")}}me.customElements.get("media-container")||me.customElements.define("media-container",dv);const ms={className:"class",classname:"class",htmlFor:"for",crossOrigin:"crossorigin",viewBox:"viewBox"},cv=t=>t.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`),fv=(t,e)=>{if(ms[t])return ms[t];if(typeof e!=null&&!(typeof e=="boolean"&&!e))return/[A-Z]/.test(t)?cv(t):t},hv=(t,e)=>typeof t=="boolean"?"":t,Pe=(t={})=>Object.entries(t).reduce((e,[n,i])=>{const r=fv(n,i);if(!r)return e;const D=hv(i);return e[r]=D,e},{});Oe.forwardRef(({children:t,...e},n)=>Y("media-chrome-button",{...Pe({...e,ref:n}),children:t}));Oe.forwardRef(({children:t,...e},n)=>Y("media-airplay-button",{...Pe({...e,ref:n}),children:t}));Oe.forwardRef(({children:t,...e},n)=>Y("media-cast-button",{...Pe({...e,ref:n}),children:t}));Oe.forwardRef(({children:t,...e},n)=>Y("media-gesture-receiver",{...Pe({...e,ref:n}),children:t}));Oe.forwardRef(({children:t,...e},n)=>Y("media-container-temp",{...Pe({...e,ref:n}),children:t}));const vv=Oe.forwardRef(({children:t,...e},n)=>Y("media-controller",{...Pe({...e,ref:n}),children:t}));Oe.forwardRef(({children:t,...e},n)=>Y("media-chrome-range",{...Pe({...e,ref:n}),children:t}));const Gl=Oe.forwardRef(({children:t,...e},n)=>Y("media-control-bar",{...Pe({...e,ref:n}),children:t}));Oe.forwardRef(({children:t,...e},n)=>Y("media-text-display",{...Pe({...e,ref:n}),children:t}));Oe.forwardRef(({children:t,...e},n)=>Y("media-current-time-display",{...Pe({...e,ref:n}),children:t}));const gv=Oe.forwardRef(({children:t,...e},n)=>Y("media-duration-display",{...Pe({...e,ref:n}),children:t})),mv=Oe.forwardRef(({children:t,...e},n)=>Y("media-time-display",{...Pe({...e,ref:n}),children:t}));Oe.forwardRef(({children:t,...e},n)=>Y("media-captions-button",{...Pe({...e,ref:n}),children:t}));Oe.forwardRef(({children:t,...e},n)=>Y("media-seek-forward-button",{...Pe({...e,ref:n}),children:t}));const pv=Oe.forwardRef(({children:t,...e},n)=>Y("media-fullscreen-button",{...Pe({...e,ref:n}),children:t})),Ev=Oe.forwardRef(({children:t,...e},n)=>Y("media-mute-button",{...Pe({...e,ref:n}),children:t}));Oe.forwardRef(({children:t,...e},n)=>Y("media-pip-button",{...Pe({...e,ref:n}),children:t}));const yv=Oe.forwardRef(({children:t,...e},n)=>Y("media-play-button",{...Pe({...e,ref:n}),children:t}));Oe.forwardRef(({children:t,...e},n)=>Y("media-playback-rate-button",{...Pe({...e,ref:n}),children:t}));const Tv=Oe.forwardRef(({children:t,...e},n)=>Y("media-poster-image",{...Pe({...e,ref:n}),children:t})),bv=Oe.forwardRef(({children:t,...e},n)=>Y("media-time-range",{...Pe({...e,ref:n}),children:t}));Oe.forwardRef(({children:t,...e},n)=>Y("media-progress-range",{...Pe({...e,ref:n}),children:t}));Oe.forwardRef(({children:t,...e},n)=>Y("media-seek-backward-button",{...Pe({...e,ref:n}),children:t}));Oe.forwardRef(({children:t,...e},n)=>Y("media-preview-time-display",{...Pe({...e,ref:n}),children:t}));Oe.forwardRef(({children:t,...e},n)=>Y("media-preview-thumbnail",{...Pe({...e,ref:n}),children:t}));const Sv=Oe.forwardRef(({children:t,...e},n)=>Y("media-loading-indicator",{...Pe({...e,ref:n}),children:t}));Oe.forwardRef(({children:t,...e},n)=>Y("media-title-bar",{...Pe({...e,ref:n}),children:t}));Oe.forwardRef(({children:t,...e},n)=>Y("media-volume-range",{...Pe({...e,ref:n}),children:t}));Oe.forwardRef(({children:t,...e},n)=>Y("media-theme-base",{...Pe({...e,ref:n}),children:t}));Oe.forwardRef(({children:t,...e},n)=>Y("media-chrome",{...Pe({...e,ref:n}),children:t}));Oe.forwardRef(({children:t,...e},n)=>Y("media-container",{...Pe({...e,ref:n}),children:t}));const Av=["icon","id","accept","capture","fontSize","multiple","onSelect","padding","space","textAlign","text","disabled"],_v=["onSelect"];var ps,Es,ys,Ts,bs,Ss,As,_s,xs,Ds,Is,Ls,Rs,Cs,Os,Ms,Ps,ws,ks;function Hl(t,e){if(t==null)return{};var n,i,r=function(c,p){if(c==null)return{};var w,M,O={},C=Object.keys(c);for(M=0;M<C.length;M++)w=C[M],p.indexOf(w)>=0||(O[w]=c[w]);return O}(t,e);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(t);for(i=0;i<D.length;i++)n=D[i],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function Xe(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}function Us(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function mt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Us(Object(n),!0).forEach(function(i){xv(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Us(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function xv(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const Dv=["token","secretKey","enableSignedUrls","signingKeyId","signingKeyPrivate"];function Iv(t,e,n){return new dd(i=>{const r=vf({endpoint:e,file:n,dynamicChunkSize:!0});return r.on("success",()=>{i.next({type:"success",id:t}),i.complete()}),r.on("error",D=>i.error(new Error(D.detail.message))),r.on("progress",D=>i.next({type:"progress",percent:D.detail})),r.on("offline",()=>{r.pause(),i.next({type:"pause",id:t})}),r.on("online",()=>{r.resume(),i.next({type:"resume",id:t})}),()=>r.abort()})}function Vl(t,e){const{dataset:n}=t.config();return t.request({url:"/addons/mux/assets/".concat(n,"/").concat(e),withCredentials:!0,method:"DELETE"})}function Fs(t,e,n,i,r,D){const c={_id:"secrets.mux",_type:"mux.apiKey",token:e,secretKey:n,enableSignedUrls:i,signingKeyId:r,signingKeyPrivate:D};return t.createOrReplace(c)}function Bs(t){const{dataset:e}=t.config();return Ci(()=>t.observable.request({url:"/addons/mux/secrets/".concat(e,"/test"),withCredentials:!0,method:"GET"}))}function Lv(t,e){return t.observable.request({url:"/addons/mux/uploads/".concat(t.clientConfig.dataset,"/").concat(e),withCredentials:!0,method:"DELETE"})}async function Rv(t,e){let n,i;try{n=await function(D,c){let p,w,M,O=0;return new Promise((C,S)=>{p=setInterval(async()=>{try{M=await function(b,I){const{dataset:L}=b.config();return b.request({url:"/addons/mux/uploads/".concat(L,"/").concat(I),withCredentials:!0,method:"GET"})}(D,c)}catch(b){return void S(b)}w=M&&M.data&&M.data.asset_id,w&&(clearInterval(p),C(M)),O>10&&(clearInterval(p),S(new Error("Upload did not finish"))),O++},2e3)})}(t,e)}catch(D){return Promise.reject(D)}try{i=await function(D,c){const{dataset:p}=D.config();return D.request({url:"/addons/mux/assets/".concat(p,"/data/").concat(c),withCredentials:!0,method:"GET"})}(t,n.data.asset_id)}catch(D){return Promise.reject(D)}const r={_id:e,_type:"mux.videoAsset",status:i.data.status,data:i.data,assetId:i.data.id,playbackId:i.data.playback_ids[0].id,uploadId:n.data.id};return t.createOrReplace(r).then(()=>r)}function Cv(t){if(typeof window<"u"&&t instanceof window.File){const e=function(n,i){return typeof window>"u"||!(i instanceof window.File)?n:{name:n.preserveFilename===!1?void 0:i.name,type:i.type}}({},t);return nr(e)}return sr(new Error("Invalid file"))}function Ov(t){const e=new Error("Invalid URL");if(typeof t!="string")return sr(e);let n;try{n=new URL(t)}catch{return sr(e)}return n&&!n.protocol.match(/http:|https:/)?sr(e):nr(t)}function Mv(t){const e=Array.from(t.files||[]),n=Array.from(t.items||[]);return e&&e.length>0?Promise.resolve(e):function(i){return Promise.all(i.map(r=>{if(r.kind==="file"&&r.webkitGetAsEntry){let D;try{D=r.webkitGetAsEntry()}catch{return[r.getAsFile()]}return D?D.isDirectory?$l(D):[r.getAsFile()]:[]}if(r.kind==="file"){const D=r.getAsFile();return Promise.resolve(D?[D]:[])}return new Promise(D=>r.getAsString(D)).then(D=>D?[new File([D],"unknown.txt",{type:r.type})]:[])}))}(n).then(i=>i.flat())}function $l(t){if(function(e){return e.isFile}(t))return new Promise(e=>t.file(e)).then(e=>[e]);if(function(e){return e.isDirectory}(t)){const e=t.createReader();return new Promise(n=>e.readEntries(n)).then(n=>n.filter(i=>!i.name.startsWith("."))).then(n=>Promise.all(n.map($l)).then(i=>i.flat()))}return Promise.resolve([])}function Pv(t){const{asset:e}=t,n=te.exports.useId(),[i,r]=te.exports.useState(),[D,c]=te.exports.useState(!1),[p,w]=te.exports.useState(null),M=te.exports.useCallback(()=>r("confirm-delete"),[]),O=te.exports.useCallback(()=>{r(!1),c(!0)},[r]),C=te.exports.useCallback(()=>{r(!1),c(!1)},[r]);return te.exports.useEffect(()=>{D&&i&&c(!1)},[i,D]),Hs(te.exports.useCallback(()=>c(!1),[]),[p]),ge(ur,{children:[Y(qu,{id:"".concat(n,"-asset-menu"),button:Y(pt,{icon:Ys,mode:"ghost",onClick:O,padding:2}),menu:Y(Vs,{ref:w,children:Y(Jr,{tone:"critical",icon:Xs,text:"Delete",onClick:M})}),portal:!0,placement:"right"}),i==="confirm-delete"&&Y(wv,{asset:e,onClose:C})]})}function wv(t){const{asset:e,onClose:n}=t,i=Yt(),{push:r}=ed(),[D,c]=te.exports.useState(!1),[p,w]=te.exports.useState(!1),M=te.exports.useId(),O=200*ea({maxDpr:2}),C=te.exports.useCallback(async()=>{var S,b,I;c(!0);try{e!=null&&e._id&&await i.delete(e._id),p&&(e==null?void 0:e.assetId)&&await Vl(i,e.assetId),(I=(b=(S=document.querySelector('[data-id="'.concat(e._id,'"]')))==null?void 0:S.parentElement)==null?void 0:b.setAttribute)==null||I.call(b,"hidden","true")}catch(L){console.error("Failed during delete",L),r({closable:!0,description:L==null?void 0:L.message,duration:5e3,title:"Uncaught error",status:"error"})}finally{c(!1),n()}},[e._id,e.assetId,i,p,n,r]);return Y(Xn,{onClose:n,id:"".concat(M,"-confirm-delete"),header:"Delete video",footer:ge(Ri,{padding:2,gap:2,columns:2,children:[Y(pt,{mode:"bleed",text:"Cancel",onClick:n}),Y(pt,{text:"Delete",tone:"critical",icon:Xs,onClick:C,loading:D})]}),width:1,children:Y(Lt,{paddingX:0,paddingY:0,space:1,children:Y(xt,{paddingX:[2,3,4],paddingY:[3,3,3,4],children:ge(Ri,{columns:3,gap:3,children:[Y(dt,{style:{gridColumn:"span 2"},align:"center",children:Y(jt,{padding:4,children:ge(Lt,{space:4,children:[ge(dt,{align:"center",as:"label",children:[Y(Li,{checked:p,onChange:()=>w(S=>!S)}),Y($e,{style:{margin:"0 10px"},children:"Delete asset on Mux"})]}),ge(dt,{align:"center",as:"label",children:[Y(Li,{disabled:!0,checked:!0}),Y($e,{style:{margin:"0 10px"},children:"Delete video from dataset"})]})]})})}),Y(Nn,{asset:e,width:O,showTip:!0})]})})})})}function kv(t){let{assets:e,isLoading:n,isLastPage:i,onSelect:r,onLoadMore:D}=t;const c=te.exports.useCallback(M=>r(M.currentTarget.dataset.id),[r]),p=te.exports.useCallback(M=>{M.key==="Enter"&&r(M.currentTarget.dataset.id)},[r]),w=200*ea({maxDpr:2});return ge(ur,{children:[ge(jt,{padding:4,children:[Y(pd,{gap:2,children:e.map(M=>Y(Uv,{asset:M,onClick:c,onKeyPress:p,width:w},M._id))}),n&&e.length===0&&Y(dt,{justify:"center",children:Y(fd,{muted:!0})}),!n&&e.length===0&&Y($e,{align:"center",muted:!0,children:"No videos"})]}),e.length>0&&!i&&Y(Ed,{tone:"default",padding:4,children:Y(dt,{direction:"column",children:Y(pt,{type:"button",icon:hd,loading:n,onClick:D,text:"Load more",tone:"primary"})})})]})}const Uv=te.exports.memo(t=>{let{asset:e,onClick:n,onKeyPress:i,width:r}=t;const[D,c]=te.exports.useState(null),p=te.exports.useRef(null);return te.exports.useLayoutEffect(()=>{p.current&&D!==null&&mf(p.current,D?{opacity:1}:{opacity:0})},[D]),ge(jt,{height:"fill",style:{position:"relative"},children:[ge(xt,{as:"button","data-id":e._id,onClick:n,onKeyPress:i,tabIndex:0,radius:2,padding:1,style:{lineHeight:0,position:"relative"},__unstable_focusRing:!0,onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:[Y(Nn,{asset:e,width:r,showTip:!0}),(e==null?void 0:e.playbackId)&&Y(Fv,{tone:"transparent",ref:p,margin:1,radius:1,children:D!==null&&Y(vd,{asset:e,width:r})})]}),Y(Bv,{children:Y(Pv,{asset:e})})]})}),Fv=Ye(xt)(ps||(ps=Xe([`
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  will-change: opacity;
  background: transparent;
  background-color: hsl(0deg 0% 0% / 33%);
  opacity: 0;
  pointer-events: none;
`]))),Bv=Ye.div(Es||(Es=Xe([`
  box-sizing: border-box;
  position: absolute;
  z-index: 300;
  opacity: 0;
  top: 7px;
  right: 7px;

  button:hover + &,
  button:focus-visible + &,
  &:hover,
  &:focus-visible {
    opacity: 1;
  }
`])));function Nv(t){let{asset:e,onChange:n,setDialogState:i}=t;const r=Yt(),D=te.exports.useRef(0),[c,p]=te.exports.useState(!1),[w,M]=te.exports.useState(!1),[O,C]=te.exports.useState([]),S=te.exports.useCallback(L=>{const _=200*L,x=_+200;return M(!0),r.fetch(function(){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return'*[_type == "mux.videoAsset"] | order(_updatedAt desc) ['.concat(arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,"...").concat(l,"]")}(_,x)).then(l=>{p(l.length<200),C(a=>a.concat(l))}).finally(()=>M(!1))},[r]),b=te.exports.useCallback(L=>{const _=O.find(x=>x._id===L);if(!_)throw new TypeError("Failed to find video asset with id: ".concat(L));n(Yn.from([Qs({asset:{}}),Zs({_type:"reference",_weak:!0,_ref:_._id},["asset"])])),i(!1)},[O,n,i]),I=te.exports.useCallback(()=>{S(++D.current)},[S]);return te.exports.useEffect(()=>{S(D.current)},[S]),Y(kv,{onSelect:b,assets:O,isLastPage:c,isLoading:w,onLoadMore:I})}function Kv(t){let{setDialogState:e,asset:n,onChange:i}=t;const r="InputBrowser".concat(te.exports.useId()),D=te.exports.useCallback(()=>e(!1),[e]);return Y(Xn,{scheme:"dark",__unstable_autoFocus:!0,header:"Select video",id:r,onClose:D,width:2,children:Y(Nv,{asset:n,onChange:i,setDialogState:e})})}function jv(t){let{asset:e,getCurrentTime:n,setDialogState:i}=t;const r=Yt(),D="EditThumbnailDialog".concat(te.exports.useId()),c=te.exports.useMemo(()=>n(),[n]),p=te.exports.useMemo(()=>mt(mt({},e),{},{thumbTime:c}),[e,c]),[w,M]=te.exports.useState(!1),[O,C]=te.exports.useState(null),S=te.exports.useCallback(()=>{M(!0),r.patch(e._id).set({thumbTime:c}).commit({returnDocuments:!1}).then(()=>{i(!1)}).catch(C).finally(()=>{M(!1)})},[r,e._id,c,i]),b=300*ea({maxDpr:2});if(O)throw O;return Y(Xn,{id:D,header:"Edit thumbnail",onClose:()=>i(!1),footer:Y(Lt,{padding:3,children:Y(pt,{mode:"ghost",tone:"primary",loading:w,onClick:S,text:"Set new thumbnail"},"thumbnail")}),children:ge(Lt,{space:3,padding:3,children:[ge(Lt,{space:2,children:[Y($e,{size:1,weight:"semibold",children:"Current:"}),Y(Nn,{asset:e,width:b})]}),ge(Lt,{space:2,children:[Y($e,{size:1,weight:"semibold",children:"New:"}),Y(Nn,{asset:p,width:b})]})]})})}const Wv=Ye(xt)(ys||(ys=Xe([`
  position: relative;
  min-height: 150px;
  aspect-ratio: 16 / 9;
  overflow: hidden;
  border-radius: 1px;
  media-airplay-button[media-airplay-unavailable] {
    display: none;
  }
  media-volume-range[media-volume-unavailable] {
    display: none;
  }
  media-pip-button[media-pip-unavailable] {
    display: none;
  }
  media-controller {
    --media-control-background: transparent;
    --media-control-hover-background: transparent;
    --media-range-track-background-color: rgba(255, 255, 255, 0.5);
    --media-range-track-border-radius: 3px;
    width: 100%;
    height: 100%;
    background-color: transparent;
  }
  media-control-bar {
    --media-button-icon-width: 18px;
    --media-preview-time-margin: 0px;
  }
  media-control-bar:not([slot]) :is([role='button'], [role='switch'], button) {
    height: 44px;
  }
  .size-extra-small media-control-bar [role='button'],
  .size-extra-small media-control-bar [role='switch'] {
    height: auto;
    padding: 4.4% 3.2%;
  }
  .mxp-spacer {
    flex-grow: 1;
    height: 100%;
    background-color: var(--media-control-background, rgba(20, 20, 30, 0.7));
  }
  media-controller::part(vertical-layer) {
    transition: background-color 1s;
  }
  media-controller:is([media-paused], :not([user-inactive]))::part(vertical-layer) {
    background-color: rgba(0, 0, 0, 0.6);
    transition: background-color 0.25s;
  }
  .mxp-center-controls {
    --media-background-color: transparent;
    --media-button-icon-width: 100%;
    --media-button-icon-height: auto;
    pointer-events: none;
    width: 100%;
    display: flex;
    flex-flow: row;
    align-items: center;
    justify-content: center;
  }
  .mxp-center-controls media-play-button {
    --media-control-background: transparent;
    --media-control-hover-background: transparent;
    padding: 0;
    width: max(27px, min(9%, 90px));
  }
  .mxp-center-controls media-seek-backward-button,
  .mxp-center-controls media-seek-forward-button {
    --media-control-background: transparent;
    --media-control-hover-background: transparent;
    padding: 0;
    margin: 0 10%;
    width: min(7%, 70px);
  }
  media-loading-indicator {
    --media-loading-icon-width: 100%;
    --media-button-icon-height: auto;
    pointer-events: none;
    position: absolute;
    width: min(15%, 150px);
    display: flex;
    flex-flow: row;
    align-items: center;
    justify-content: center;
  }
  /* Intentionally don't target the div for transition but the children
 of the div. Prevents messing with media-chrome's autohide feature. */
  media-loading-indicator + div * {
    transition: opacity 0.15s;
    opacity: 1;
  }
  media-loading-indicator[media-loading]:not([media-paused]) ~ div > * {
    opacity: 0;
    transition-delay: 400ms;
  }
  media-volume-range {
    width: min(100%, 100px);
  }
  media-time-display {
    white-space: nowrap;
  }
  :is(media-time-display, media-text-display, media-playback-rate-button) {
    color: inherit;
  }
  media-controller:fullscreen media-control-bar[slot='top-chrome'] {
    /* Hide menus and buttons that trigger modals when in full-screen */
    display: none;
  }
  video {
    background: transparent;
  }
  media-controller:not(:fullscreen) video {
    aspect-ratio: 16 / 9;
  }
  media-controller:not(:-webkit-full-screen) video {
    aspect-ratio: 16 / 9;
  }
`]))),Gv=Ye.div(Ts||(Ts=Xe([`
  && {
    --media-background-color: transparent;
    --media-button-icon-width: 100%;
    --media-button-icon-height: auto;
    pointer-events: none;
    width: 100%;
    display: flex;
    flex-flow: row;
    align-items: center;
    justify-content: center;
    media-play-button {
      --media-control-background: transparent;
      --media-control-hover-background: transparent;
      padding: 0;
      width: max(27px, min(9%, 90px));
    }
  }
`]))),Hv=Ye(Gl)(bs||(bs=Xe([`
  justify-content: flex-end;
  button {
    height: auto;
  }
`])));function Vv(t){let{asset:e}=t;const n=Yt(),i=te.exports.useRef(null),r=te.exports.useMemo(()=>md({client:n,asset:e,width:1920,height:1080}),[n,e]);return te.exports.useEffect(()=>{var D;if(i.current){const c=document.createElement("style");c.innerHTML="img { object-fit: contain; }",(D=i.current)!=null&&D.shadowRoot&&i.current.shadowRoot.appendChild(c)}},[]),Y(Tv,{ref:i,slot:"poster",src:r})}function $v(t){let{asset:e}=t;const n=Yt(),[i]=te.exports.useState(()=>function(r){let{asset:D,client:c}=r;const p=Js(D),w=new URLSearchParams;if(ta(D)==="signed"){const M=qs(c,p,"s");w.set("token",M)}return"https://image.mux.com/".concat(p,"/storyboard.vtt?").concat(w)}({asset:e,client:n}));return Y("track",{label:"thumbnails",default:!0,kind:"metadata",src:i})}const zv=Ye(xt)(Ss||(Ss=Xe([`
  min-height: 82px;
  box-sizing: border-box;
`]))),Yv=Ye(dt)(As||(As=Xe([`
  text-overflow: ellipsis;
  overflow: hidden;
`]))),Xv=Ye(Lt)(_s||(_s=Xe([`
  position: relative;
  width: 60%;
`]))),Qv=Ye(js)(xs||(xs=Xe([`
  position: relative;
  width: 100%;

  code {
    overflow: hidden;
    text-overflow: ellipsis;
    position: relative;
    max-width: 200px;
  }
`]))),zl=t=>{let{progress:e=100,onCancel:n,filename:i,text:r="Uploading"}=t;return Y(zv,{tone:"primary",padding:4,border:!0,height:"fill",children:ge(Yv,{align:"center",justify:"space-between",height:"fill",direction:"row",gap:2,children:[ge(Xv,{children:[Y(dt,{justify:"center",gap:[3,3,2,2],direction:["column","column","row"],children:Y($e,{size:1,children:ge(mr,{space:2,children:[r,Y(Qv,{size:1,children:i||"..."})]})})}),Y(xt,{marginTop:3,radius:5,shadow:1,children:Y(sd,{value:e})})]}),n?Y(pt,{fontSize:2,text:"Cancel upload",mode:"ghost",tone:"critical",onClick:n}):null]})})},Zv=t=>{let{asset:e,buttons:n,readOnly:i,onChange:r,dialogState:D,setDialogState:c}=t;var p,w,M,O;const C=Yt(),S=te.exports.useMemo(()=>(e==null?void 0:e.status)==="preparing"?"Preparing the video":(e==null?void 0:e.status)==="waiting_for_upload"?"Waiting for upload to start":(e==null?void 0:e.status)==="waiting"?"Processing upload":(e==null?void 0:e.status)!=="ready"&&(e==null?void 0:e.status)!==void 0,[e]),b=te.exports.useMemo(()=>{var o,g,f,v;return((g=(o=e==null?void 0:e.data)==null?void 0:o.static_renditions)==null?void 0:g.status)==="preparing"||((v=(f=e==null?void 0:e.data)==null?void 0:f.static_renditions)==null||v.status,!1)},[(w=(p=e==null?void 0:e.data)==null?void 0:p.static_renditions)==null?void 0:w.status]),I=te.exports.useMemo(()=>e.playbackId&&function(o){let{asset:g,client:f}=o;const v=Js(g),T=new URLSearchParams;if(ta(g)==="signed"){const m=qs(f,v,"v");T.set("token",m)}return"https://stream.mux.com/".concat(v,".m3u8?").concat(T)}({client:C,asset:e}),[e,C]),[L,_]=te.exports.useState(null),x=te.exports.useCallback(o=>_(o.currentTarget.error),[]),l=te.exports.useRef(null),a=te.exports.useRef(null),d=te.exports.useRef(null),y=te.exports.useCallback(()=>{var o,g;return(g=(o=d.current)==null?void 0:o.currentTime)!=null?g:0},[d]),E=((o,g)=>{const f=Yt();return te.exports.useCallback(()=>{o&&(g(Yn.from(Gs())),o.assetId&&Vl(f,o.assetId),o._id&&f.delete(o._id))},[o,f,g])})(e,r);te.exports.useEffect(()=>{var o,g;const f=document.createElement("style");f.innerHTML="button svg { vertical-align: middle; }",(o=l.current)!=null&&o.shadowRoot&&l.current.shadowRoot.appendChild(f),(g=a==null?void 0:a.current)!=null&&g.shadowRoot&&a.current.shadowRoot.appendChild(f.cloneNode(!0))},[]);const[u]=te.exports.useState(()=>_f()),s=te.exports.useRef(void 0);if(te.exports.useEffect(()=>{if(S||!I)return;const o=Mf({src:I,playerInitTime:u,playerSoftwareName:"sanity-plugin-mux-input",playerSoftwareVersion:"dev-preview"},d.current,s.current);s.current=o},[I,S,u]),te.exports.useEffect(()=>{var o,g,f;if((e==null?void 0:e.status)==="errored")throw E(),new Error((f=(g=(o=e.data)==null?void 0:o.errors)==null?void 0:g.messages)==null?void 0:f.join(" "))},[(O=(M=e.data)==null?void 0:M.errors)==null?void 0:O.messages,e==null?void 0:e.status,E]),L)throw L;return e&&e.status?S?Y(zl,{progress:100,filename:e==null?void 0:e.filename,text:S!==!0&&S||"Waiting for Mux to complete the file",onCancel:i?void 0:()=>E()}):ge(ur,{children:[ge(Wv,{shadow:1,tone:"transparent",scheme:"dark",children:[ge(vv,{children:[Y("video",{playsInline:!0,ref:d,onError:x,slot:"media",preload:"metadata",crossOrigin:"anonomous",children:Y($v,{asset:e})}),Y(Vv,{asset:e}),Y(Sv,{slot:"centered-chrome",noAutoHide:!0}),Y(Gv,{slot:"centered-chrome",children:Y(yv,{})}),n&&Y(Hv,{slot:"top-chrome",children:n}),ge(Gl,{children:[Y(Ev,{}),Y(mv,{}),Y(bv,{}),Y(gv,{}),Y(pv,{})]})]}),b&&Y(xt,{padding:2,radius:1,style:{background:"var(--card-fg-color)",position:"absolute",top:"0.5em",left:"0.5em"},children:Y($e,{size:1,style:{color:"var(--card-bg-color)"},children:"MUX is preparing static renditions, please stand by"})})]}),D==="edit-thumbnail"&&Y(jv,{asset:e,getCurrentTime:y,setDialogState:c})]}):null};function Yl(t){return"inset 0 0 0 ".concat(t.width,"px ").concat(t.color)}function Xl(t){const{base:e,border:n,focusRing:i}=t,r=i.offset+i.width,D=0-i.offset,c=e?e.bg:"var(--card-bg-color)";return[D>0&&"inset 0 0 0 ".concat(D,"px var(--card-focus-ring-color)"),n&&Yl(n),D<0&&"0 0 0 ".concat(0-D,"px ").concat(c),r>0&&"0 0 0 ".concat(r,"px var(--card-focus-ring-color)")].filter(Boolean).join(",")}const Jv=Ye(Jr)(t=>{let{theme:e}=t;const{focusRing:n}=e.sanity,i=e.sanity.color.base;return Ws(Ds||(Ds=Xe([`
    position: relative;

    &:not([data-disabled='true']) {
      &:focus-within {
        box-shadow: `,`;
      }
    }

    & input {
      overflow: hidden;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      position: absolute;
      min-width: 0;
      display: block;
      appearance: none;
      padding: 0;
      margin: 0;
      border: 0;
      opacity: 0;
    }
  `])),Xl({base:i,border:{width:1,color:"var(--card-border-color)"},focusRing:n}))}),qv=Oe.forwardRef(function(t,e){const{icon:n,id:i,accept:r,capture:D,fontSize:c,multiple:p,onSelect:w,padding:M=3,space:O=3,textAlign:C,text:S,disabled:b}=t,I=Hl(t,Av),L=te.exports.useId(),_=i||L,x=Oe.useCallback(a=>{w&&a.target.files&&w(Array.from(a.target.files))},[w]),l=ge(dt,{align:"center",justify:"flex-start",padding:M,children:[n&&Y(jt,{marginRight:S?O:void 0,children:ge($e,{size:c,children:[te.exports.isValidElement(n)&&n,Nu.exports.isValidElementType(n)&&te.exports.createElement(n)]})}),S&&Y($e,{align:C,size:c,textOverflow:"ellipsis",children:S})]});return ge(Jv,mt(mt({},I),{},{htmlFor:_,padding:0,fontSize:2,disabled:b,ref:e,children:[l,Y("input",{"data-testid":"file-button-input",accept:r,capture:D,id:_,multiple:p,onChange:x,type:"file",value:"",disabled:b})]}))}),eg=Ye(xt)(Is||(Is=Xe([`
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0.6;
  mix-blend-mode: screen;
  background: transparent;
`]))),tg=Ye(pt)(Ls||(Ls=Xe([`
  background: transparent;
  color: white;
`])));var rg=te.exports.memo(function(t){const{asset:e,readOnly:n,dialogState:i,setDialogState:r,onChange:D,onUpload:c}=t,[p,w]=te.exports.useState(!1),[M,O]=te.exports.useState(null),C=te.exports.useMemo(()=>ta(e)==="signed",[e]),S=te.exports.useCallback(()=>D(Yn.from(Gs([]))),[D]);return te.exports.useEffect(()=>{p&&i&&w(!1)},[i,p]),Hs(te.exports.useCallback(()=>w(!1),[]),[M]),ge(mr,{space:1,padding:2,children:[C&&Y(Ku,{content:Y(jt,{padding:2,children:Y($e,{muted:!0,size:1,children:"Signed playback policy"})}),placement:"right",portal:!0,children:Y(eg,{radius:2,margin:2,scheme:"dark",tone:"positive",children:Y(tg,{icon:ju,mode:"bleed",tone:"positive"})})}),!n&&Y(pt,{icon:Wu,mode:"ghost",onClick:()=>r("edit-thumbnail")}),Y(Gu,{content:ge(Vs,{ref:O,children:[Y(jt,{padding:2,children:Y(Hu,{muted:!0,size:1,children:"Replace"})}),Y(qv,{accept:"video/*",icon:$s,mode:"bleed",onSelect:c,text:"Upload",disabled:n,fontSize:2}),Y(Jr,{icon:zs,text:"Browse",onClick:()=>r("select-video")}),Y(ba,{}),Y(Jr,{icon:qi,text:"Configure API",onClick:()=>r("secrets")}),Y(ba,{}),Y(Jr,{tone:"critical",icon:Vu,text:"Clear field",onClick:S,disabled:n})]}),portal:!0,open:p,children:Y(pt,{icon:Ys,mode:"ghost",onClick:()=>{r(!1),w(!0)}})})]})});const ng=Ye(xt)(t=>{const e={width:t.$border?1:0,color:"var(--card-border-color)"};return Ws(Rs||(Rs=Xe([`
        --card-focus-box-shadow: `,`;

        border-radius: `,`;
        outline: none;
        box-shadow: var(--card-focus-box-shadow);

        &:focus {
          --card-focus-box-shadow: `,`;
        }
      `])),Yl(e),$u(t.theme.sanity.radius[1]),Xl({base:t.theme.sanity.color.base,border:e,focusRing:t.theme.sanity.focusRing}))}),ig=te.exports.forwardRef((t,e)=>{let{children:n,tone:i,onPaste:r,onDrop:D,onDragEnter:c,onDragLeave:p,onDragOver:w}=t;const M=te.exports.useRef(!1),O=te.exports.useRef(null),C=te.exports.useCallback(b=>{b.keyCode!=17&&b.keyCode!=91||(M.current=!0),M.current&&b.keyCode==86&&O.current.focus()},[]),S=te.exports.useCallback(b=>{b.keyCode!=17&&b.keyCode!=91||(M.current=!1)},[]);return ge(ng,{tone:i,height:"fill",ref:e,padding:0,radius:2,shadow:0,tabIndex:0,onKeyDown:C,onKeyUp:S,onPaste:r,onDrop:D,onDragEnter:c,onDragLeave:p,onDragOver:w,children:[Y(ag,{ref:O,onPaste:r}),n]})}),ag=Ye.input.attrs({type:"text"})(Cs||(Cs=Xe([`
  position: absolute;
  border: 0;
  color: white;
  opacity: 0;

  &:focus {
    outline: none;
  }
`]))),sg=Ye.input(Os||(Os=Xe([`
  overflow: hidden;
  width: 0.1px;
  height: 0.1px;
  opacity: 0;
  position: absolute;
  z-index: -1;
`]))),og=Ye.label(Ms||(Ms=Xe([`
  position: relative;
`]))),lg=t=>{let{onSelect:e}=t,n=Hl(t,_v);const i="FileSelect".concat(te.exports.useId()),r=te.exports.useRef(null),D=te.exports.useCallback(p=>{e&&e(p.target.files)},[e]),c=te.exports.useCallback(()=>{var p;return(p=r.current)==null?void 0:p.click()},[]);return ge(og,{htmlFor:i,children:[Y(sg,{accept:"video/*",ref:r,tabIndex:0,type:"file",id:i,onChange:D,value:""}),Y(pt,mt({onClick:c,mode:"default",tone:"primary",style:{width:"100%"}},n))]})},ug=Ye(xt)(Ps||(Ps=Xe([`
  && {
    border-style: dashed;
  }
`]))),dg=Ye(jt)(ws||(ws=Xe([`
  position: absolute;
  top: 0;
  right: 0;
`])));function cg(t){const{setDialogState:e,readOnly:n,onSelect:i,hovering:r,needsSetup:D}=t,c=te.exports.useCallback(()=>e("select-video"),[e]),p=te.exports.useCallback(()=>e("secrets"),[e]);return Y(jt,{style:{padding:1,position:"relative"},height:"stretch",children:ge(ug,{sizing:"border",height:"fill",tone:n?"transparent":"inherit",border:!0,padding:3,style:r?{borderColor:"transparent"}:void 0,children:[Y(dg,{padding:3,children:Y(pt,{padding:3,radius:3,tone:D?"critical":void 0,onClick:p,icon:qi,mode:"bleed"})}),ge(dt,{align:"center",justify:"space-between",gap:4,direction:["column","column","row"],paddingY:[2,2,0],sizing:"border",height:"fill",children:[ge(dt,{align:"center",justify:"center",gap:2,flex:1,children:[Y(dt,{justify:"center",children:Y($e,{muted:!0,children:Y(od,{})})}),Y(dt,{justify:"center",children:Y($e,{size:1,muted:!0,children:"Drag video or paste URL here"})})]}),ge(mr,{space:2,children:[Y(lg,{mode:"ghost",tone:"default",icon:$s,text:"Upload",onSelect:i}),Y(pt,{mode:"ghost",icon:zs,text:"Select",onClick:c})]})]})]})})}class fg extends te.exports.Component{constructor(){super(...arguments),this.state={isDraggingOver:!1,invalidPaste:!1,invalidFile:!1,uploadProgress:null,fileInfo:null,uuid:null,error:null,url:null},this.dragEnteredEls=[],this.ctrlDown=!1,this.upload=null,this.container=Oe.createRef(),this.handleProgress=e=>{this.setState({uploadProgress:e.percent})},this.onUpload=e=>{this.setState({uploadProgress:0,fileInfo:null,uuid:null}),this.upload=function(n,i,r){let D=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Cv(r).pipe(Tn(c=>di(nr({type:"file",file:c}),Bs(i).pipe(Tn(p=>{if(!p||!p.status)return sr(new Error("Invalid credentials"));const w=_a(),{enableSignedUrls:M}=D,O={mp4_support:n.mp4_support,playback_policy:[M?"signed":"public"]};return di(nr({type:"uuid",uuid:w}),Ci(()=>i.observable.request({url:"/addons/mux/uploads/".concat(i.clientConfig.dataset),withCredentials:!0,method:"POST",headers:{"MUX-Proxy-UUID":w,"Content-Type":"application/json"},body:O})).pipe(bn(C=>Iv(w,C.upload.url,r).pipe(bn(S=>S.type!=="success"?nr(S):ld(Rv(i,w)).pipe(bn(b=>nr(mt(mt({},S),{},{asset:b}))))),ud(S=>Lv(i,w).pipe(cd(sr(S))))))))})))))}(this.props.config,this.props.client,e[0],{enableSignedUrls:this.props.secrets.enableSignedUrls}).pipe(td(this.onCancelUploadButtonClick$.pipe(rd(()=>{this.state.uuid&&this.props.client.delete(this.state.uuid)})))).subscribe({complete:()=>{this.setState({error:null,uploadProgress:null,uuid:null})},next:n=>{this.handleUploadEvent(n)},error:n=>{this.setState({error:n,uploadProgress:null,uuid:null})}})},this.handleUploadEvent=e=>{switch(e.type){case"success":return this.handleUploadSuccess(e.asset);case"progress":return this.handleProgress(e);case"file":return this.setState({fileInfo:e.file});case"uuid":return this.setState({uuid:e.uuid});case"url":return this.setState({url:e.url,uploadProgress:100});default:return null}},this.handleUploadSuccess=e=>{this.setState({uploadProgress:100}),this.props.onChange(Yn.from([Qs({asset:{}}),Zs({_type:"reference",_weak:!0,_ref:e._id},["asset"])]))},this.handlePaste=e=>{const n=(e.clipboardData||window.clipboardData).getData("text"),i={enableSignedUrls:this.props.secrets.enableSignedUrls};this.upload=function(r,D,c){let p=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Ov(c).pipe(Tn(w=>di(nr({type:"url",url:w}),Bs(D).pipe(Tn(M=>{if(!M||!M.status)return sr(new Error("Invalid credentials"));const O=_a(),{enableSignedUrls:C}=p,S={input:w,playback_policy:[C?"signed":"public"],mp4_support:r.mp4_support},b={muxBody:JSON.stringify(S),filename:w.split("/").slice(-1)[0]},I=D.clientConfig.dataset;return Ci(()=>D.observable.request({url:"/addons/mux/assets/".concat(I),withCredentials:!0,method:"POST",headers:{"MUX-Proxy-UUID":O,"Content-Type":"application/json"},query:b})).pipe(bn(L=>{const _=L&&L.results&&L.results[0]&&L.results[0].document||null;return _?nr({type:"success",id:O,asset:_}):sr(new Error("No asset document returned"))}))})))))}(this.props.config,this.props.client,n,i).subscribe({complete:()=>{this.setState({error:null,uploadProgress:null,url:null})},next:r=>{this.handleUploadEvent(r)},error:r=>{let D;r.message.toLowerCase().match("invalid url")||(D=r),this.setState({invalidPaste:!0,error:D},()=>{setTimeout(()=>{this.setState({invalidPaste:!1,uploadProgress:null})},2e3)})}})},this.handleDrop=e=>{this.setState({isDraggingOver:!1}),e.preventDefault(),e.stopPropagation(),Mv(e.nativeEvent.dataTransfer).then(n=>{n&&this.onUpload(n)})},this.handleDragOver=e=>{e.preventDefault(),e.stopPropagation()},this.handleDragEnter=e=>{var n,i;e.stopPropagation(),this.dragEnteredEls.push(e.target),this.setState({isDraggingOver:!0});const r=(i=(n=e.dataTransfer.items)==null?void 0:n[0])==null?void 0:i.type;this.setState({invalidFile:!r.startsWith("video/")})},this.handleDragLeave=e=>{e.stopPropagation();const n=this.dragEnteredEls.indexOf(e.target);n>-1&&this.dragEnteredEls.splice(n,1),this.dragEnteredEls.length===0&&this.setState({isDraggingOver:!1})}}componentWillUnmount(){this.unSubscribeToUpload()}componentDidMount(){const e=new nd;this.onCancelUploadButtonClick$=e.asObservable(),this.handleCancelUploadButtonClick=n=>e.next(n)}unSubscribeToUpload(){this.upload&&!this.upload.closed&&this.upload.unsubscribe()}render(){var e;if(this.state.uploadProgress!==null)return Y(zl,{onCancel:this.handleCancelUploadButtonClick,progress:this.state.uploadProgress,filename:((e=this.state.fileInfo)==null?void 0:e.name)||this.state.url});if(this.state.error)throw this.state.error;return ge(ur,{children:[Y(ig,{tone:this.state.isDraggingOver&&(this.state.invalidPaste||this.state.invalidFile)?"critical":this.state.isDraggingOver?"positive":void 0,onDrop:this.handleDrop,onDragOver:this.handleDragOver,onDragLeave:this.handleDragLeave,onDragEnter:this.handleDragEnter,onPaste:this.handlePaste,ref:this.container,children:this.props.asset?Y(Zv,{readOnly:this.props.readOnly,asset:this.props.asset,onChange:this.props.onChange,dialogState:this.props.dialogState,setDialogState:this.props.setDialogState,buttons:Y(rg,{asset:this.props.asset,dialogState:this.props.dialogState,setDialogState:this.props.setDialogState,onChange:this.props.onChange,onUpload:this.onUpload,readOnly:this.props.readOnly})}):Y(cg,{hovering:this.state.isDraggingOver,onSelect:this.onUpload,readOnly:this.props.readOnly,setDialogState:this.props.setDialogState,needsSetup:this.props.needsSetup})}),this.props.dialogState==="select-video"&&Y(Kv,{asset:this.props.asset,onChange:this.props.onChange,setDialogState:this.props.setDialogState})]})}}const hg=(t,e)=>te.exports.useCallback(async n=>{let{token:i,secretKey:r,enableSignedUrls:D}=n,{signingKeyId:c,signingKeyPrivate:p}=e;try{await Fs(t,i,r,D,c,p);const w=await function(M){const{dataset:O}=M.config();return M.request({url:"/addons/mux/secrets/".concat(O,"/test"),withCredentials:!0,method:"GET"})}(t);if(!(w!=null&&w.status)&&i&&r)throw new Error("Invalid secrets")}catch(w){throw console.error("Error while trying to save secrets:",w),w}if(D&&!await async function(M,O,C){if(!O||!C)return!1;const{dataset:S}=M.config();try{const b=await M.request({url:"/addons/mux/signing-keys/".concat(S,"/").concat(O),withCredentials:!0,method:"GET"});return!(!b.data||!b.data.id)}catch{return console.error("Error fetching signingKeyId",O,"assuming it is not valid"),!1}}(t,c,p))try{const{data:M}=await function(O){const{dataset:C}=O.config();return O.request({url:"/addons/mux/signing-keys/".concat(C),withCredentials:!0,method:"POST"})}(t);c=M.id,p=M.private_key,await Fs(t,i,r,D,c,p)}catch(M){throw console.log("Error while creating and saving signing key:",M==null?void 0:M.message),M}return{token:i,secretKey:r,enableSignedUrls:D,signingKeyId:c,signingKeyPrivate:p}},[t,e]);function Ql(t){let{token:e,secretKey:n,enableSignedUrls:i}=t;return{submitting:!1,error:null,token:e!=null?e:"",secretKey:n!=null?n:"",enableSignedUrls:i!=null&&i}}function vg(t,e){switch(e==null?void 0:e.type){case"submit":return mt(mt({},t),{},{submitting:!0,error:null});case"error":return mt(mt({},t),{},{submitting:!1,error:e.payload});case"reset":return Ql(e.payload);case"change":return mt(mt({},t),{},{[e.payload.name]:e.payload.value});default:throw new Error("Unknown action type: ".concat(e==null?void 0:e.type))}}const gg=["title","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r"];function Zl(t){let{height:e=26}=t;const n=te.exports.useId(),[i,r,D,c,p,w,M,O,C,S,b,I,L,_,x,l,a,d,y]=te.exports.useMemo(()=>gg.map(E=>"".concat(n,"-").concat(E)),[n]);return ge("svg",{"aria-labelledby":i,role:"img",xmlns:"http://www.w3.org/2000/svg",xmlSpace:"preserve",viewBox:"92.08878326416016 102.66712188720703 692.76123046875 219.99948120117188",style:{height:"".concat(e,"px")},children:[Y("title",{id:i,children:"Mux Logo"}),ge("defs",{children:[ge("linearGradient",{id:c,spreadMethod:"pad",gradientTransform:"matrix(528.38055 0 0 -528.38055 63.801 159.5)",gradientUnits:"userSpaceOnUse",y2:0,x2:1,y1:0,x1:0,children:[Y("stop",{offset:0,style:{stopOpacity:1,stopColor:"#ff4e00"}}),Y("stop",{offset:1,style:{stopOpacity:1,stopColor:"#ff1791"}})]}),ge("linearGradient",{id:p,spreadMethod:"pad",gradientTransform:"matrix(523.66766 0 0 -523.66766 67.897 159.5)",gradientUnits:"userSpaceOnUse",y2:0,x2:1,y1:0,x1:0,children:[Y("stop",{offset:0,style:{stopOpacity:1,stopColor:"#ff4e00"}}),Y("stop",{offset:1,style:{stopOpacity:1,stopColor:"#ff1791"}})]}),ge("linearGradient",{id:O,spreadMethod:"pad",gradientTransform:"rotate(180 296.075 79.75) scale(524.84045)",gradientUnits:"userSpaceOnUse",y2:0,x2:1,y1:0,x1:0,children:[Y("stop",{offset:0,style:{stopOpacity:1,stopColor:"#ff4e00"}}),Y("stop",{offset:1,style:{stopOpacity:1,stopColor:"#ff1791"}})]}),ge("linearGradient",{id:S,spreadMethod:"pad",gradientTransform:"matrix(524.84045 0 0 -524.84045 63.801 159.5)",gradientUnits:"userSpaceOnUse",y2:0,x2:1,y1:0,x1:0,children:[Y("stop",{offset:0,style:{stopOpacity:1,stopColor:"#ff4e00"}}),Y("stop",{offset:1,style:{stopOpacity:1,stopColor:"#ff1791"}})]}),ge("linearGradient",{id:b,spreadMethod:"pad",gradientTransform:"matrix(523.08514 0 0 -523.08514 67.897 224.446)",gradientUnits:"userSpaceOnUse",y2:0,x2:1,y1:0,x1:0,children:[Y("stop",{offset:0,style:{stopOpacity:1,stopColor:"#ff4e00"}}),Y("stop",{offset:1,style:{stopOpacity:1,stopColor:"#ff1791"}})]}),ge("linearGradient",{id:I,spreadMethod:"pad",gradientTransform:"matrix(524.84045 0 0 -524.84045 63.801 94.553)",gradientUnits:"userSpaceOnUse",y2:0,x2:1,y1:0,x1:0,children:[Y("stop",{offset:0,style:{stopOpacity:1,stopColor:"#ff4e00"}}),Y("stop",{offset:1,style:{stopOpacity:1,stopColor:"#ff1791"}})]}),ge("linearGradient",{id:L,spreadMethod:"pad",gradientTransform:"matrix(524.84045 0 0 -524.84045 63.801 159.5)",gradientUnits:"userSpaceOnUse",y2:0,x2:1,y1:0,x1:0,children:[Y("stop",{offset:0,style:{stopOpacity:1,stopColor:"#ff4e00"}}),Y("stop",{offset:1,style:{stopOpacity:1,stopColor:"#ff1791"}})]}),ge("linearGradient",{id:_,spreadMethod:"pad",gradientTransform:"matrix(524.84045 0 0 -524.84045 63.801 94.554)",gradientUnits:"userSpaceOnUse",y2:0,x2:1,y1:0,x1:0,children:[Y("stop",{offset:0,style:{stopOpacity:1,stopColor:"#ff4e00"}}),Y("stop",{offset:1,style:{stopOpacity:1,stopColor:"#ff1791"}})]}),ge("linearGradient",{id:a,spreadMethod:"pad",gradientTransform:"matrix(521.97632 0 0 -521.97632 69.067 191.973)",gradientUnits:"userSpaceOnUse",y2:0,x2:1,y1:0,x1:0,children:[Y("stop",{offset:0,style:{stopOpacity:1,stopColor:"#ff4e00"}}),Y("stop",{offset:1,style:{stopOpacity:1,stopColor:"#ff1791"}})]}),ge("linearGradient",{id:d,spreadMethod:"pad",gradientTransform:"matrix(523.09039 0 0 -523.09039 67.312 191.973)",gradientUnits:"userSpaceOnUse",y2:0,x2:1,y1:0,x1:0,children:[Y("stop",{offset:0,style:{stopOpacity:1,stopColor:"#ff4e00"}}),Y("stop",{offset:1,style:{stopOpacity:1,stopColor:"#ff1791"}})]}),ge("linearGradient",{id:y,spreadMethod:"pad",gradientTransform:"matrix(524.84045 0 0 -524.84045 63.801 159.5)",gradientUnits:"userSpaceOnUse",y2:0,x2:1,y1:0,x1:0,children:[Y("stop",{offset:0,style:{stopOpacity:1,stopColor:"#ff4e00"}}),Y("stop",{offset:1,style:{stopOpacity:1,stopColor:"#ff1791"}})]}),Y("clipPath",{id:r,clipPathUnits:"userSpaceOnUse",children:Y("path",{d:"M0 319h657.706V0H0Z"})}),Y("clipPath",{id:D,clipPathUnits:"userSpaceOnUse",children:Y("path",{d:"M423.64 242h164.999V77H423.64Z"})}),Y("clipPath",{id:w,clipPathUnits:"userSpaceOnUse",children:Y("path",{d:"M0 319h657.706V0H0Z"})}),Y("clipPath",{id:M,clipPathUnits:"userSpaceOnUse",children:Y("path",{d:"M311.3 242h93.031V77H311.3Z"})}),Y("clipPath",{id:C,clipPathUnits:"userSpaceOnUse",children:Y("path",{d:"M198.96 242h35.106V77H198.96Z"})}),Y("clipPath",{id:x,clipPathUnits:"userSpaceOnUse",children:Y("path",{d:"M0 319h657.706V0H0Z"})}),Y("clipPath",{id:l,clipPathUnits:"userSpaceOnUse",children:Y("path",{d:"M69.067 242H169.12V141.947H69.067Z"})})]}),Y("g",{clipPath:"url(#".concat(r,")"),transform:"matrix(1.33333 0 0 -1.33333 0 425.333)",children:Y("g",{style:{opacity:.69999701},clipPath:"url(#".concat(D,")"),children:Y("path",{style:{fill:"url(#".concat(c,")"),stroke:"none"},d:"M558.674 82.142c6.855-6.855 17.969-6.855 24.824 0 6.854 6.855 6.854 17.969 0 24.823L453.605 236.858c-6.855 6.855-17.969 6.855-24.824 0s-6.855-17.969 0-24.823z"})})}),Y("path",{style:{fill:"url(#".concat(p,")"),stroke:"none"},d:"M558.674 236.858 428.781 106.966c-6.855-6.855-6.855-17.969 0-24.825 6.855-6.854 17.969-6.854 24.823 0l129.894 129.894c6.854 6.855 6.854 17.968 0 24.823A17.498 17.498 0 0 1 571.086 242a17.495 17.495 0 0 1-12.412-5.142",transform:"matrix(1.33333 0 0 -1.33333 0 425.333)"}),ge("g",{clipPath:"url(#".concat(w,")"),transform:"matrix(1.33333 0 0 -1.33333 0 425.333)",children:[Y("g",{style:{opacity:.69999701},clipPath:"url(#".concat(M,")"),children:Y("path",{style:{fill:"url(#".concat(O,")"),stroke:"none"},d:"M328.853 112.107c22.297 0 40.372 18.075 40.372 40.372v71.315c0 10.054 7.505 18.206 17.554 18.206 10.048 0 17.552-8.152 17.552-18.206v-71.315c0-41.686-33.793-75.479-75.478-75.479-9.694 0-17.553 7.859-17.553 17.554 0 9.694 7.859 17.553 17.553 17.553"})}),Y("g",{style:{opacity:.69999701},clipPath:"url(#".concat(C,")"),children:Y("path",{style:{fill:"url(#".concat(S,")"),stroke:"none"},d:"M216.513 242c-10.049 0-17.553-8.152-17.553-18.206V95.206c0-10.054 7.504-18.206 17.553-18.206 10.048 0 17.553 8.152 17.553 18.206v128.588c0 10.054-7.505 18.206-17.553 18.206"})})]}),Y("path",{style:{fill:"url(#".concat(b,")"),stroke:"none"},d:"M369.225 224.447c0-9.694 7.859-17.553 17.553-17.553 9.695 0 17.553 7.859 17.553 17.553s-7.858 17.552-17.553 17.552c-9.694 0-17.553-7.858-17.553-17.552",transform:"matrix(1.33333 0 0 -1.33333 0 425.333)"}),Y("path",{style:{fill:"url(#".concat(I,")"),stroke:"none"},d:"M553.532 94.554c0-9.695 7.859-17.554 17.553-17.554 9.695 0 17.554 7.859 17.554 17.554 0 9.694-7.859 17.552-17.554 17.552-9.694 0-17.553-7.858-17.553-17.552",transform:"matrix(1.33333 0 0 -1.33333 0 425.333)"}),Y("path",{style:{fill:"url(#".concat(L,")"),stroke:"none"},d:"M69.067 223.794V95.206C69.067 85.152 76.571 77 86.62 77c10.048 0 17.553 8.152 17.553 18.206v128.588c0 10.055-7.505 18.205-17.553 18.205-10.049 0-17.553-8.15-17.553-18.205",transform:"matrix(1.33333 0 0 -1.33333 0 425.333)"}),Y("path",{style:{fill:"url(#".concat(_,")"),stroke:"none"},d:"M198.96 94.554c0-9.695 7.859-17.554 17.553-17.554 9.695 0 17.554 7.859 17.554 17.554 0 9.694-7.859 17.553-17.554 17.553-9.694 0-17.553-7.859-17.553-17.553",transform:"matrix(1.33333 0 0 -1.33333 0 425.333)"}),Y("g",{clipPath:"url(#".concat(x,")"),transform:"matrix(1.33333 0 0 -1.33333 0 425.333)",children:Y("g",{style:{opacity:.69999701},clipPath:"url(#".concat(l,")"),children:Y("path",{style:{fill:"url(#".concat(a,")"),stroke:"none"},d:"M139.155 147.088c6.855-6.855 17.969-6.855 24.824 0s6.855 17.969 0 24.824l-64.947 64.946c-6.855 6.855-17.969 6.855-24.824 0s-6.855-17.969 0-24.823z"})})}),Y("path",{style:{fill:"url(#".concat(d,")"),stroke:"none"},d:"m204.101 236.858-64.947-64.946c-6.854-6.855-6.854-17.969 0-24.824 6.856-6.855 17.97-6.855 24.824 0l64.947 64.947c6.855 6.855 6.855 17.968 0 24.823A17.495 17.495 0 0 1 216.513 242a17.498 17.498 0 0 1-12.412-5.142",transform:"matrix(1.33333 0 0 -1.33333 0 425.333)"}),Y("path",{style:{fill:"url(#".concat(y,")"),stroke:"none"},d:"M253.374 223.794v-71.315c0-41.685 33.793-75.479 75.479-75.479 9.695 0 17.553 7.859 17.553 17.554 0 9.694-7.858 17.553-17.553 17.553-22.297 0-40.372 18.075-40.372 40.372v71.315c0 10.055-7.505 18.205-17.554 18.205s-17.553-8.15-17.553-18.205",transform:"matrix(1.33333 0 0 -1.33333 0 425.333)"})]})}const mg=Ye.span(ks||(ks=Xe([`
  display: inline-block;
  height: 0.8em;
  margin-right: 1em;
  transform: translate(0.3em, -0.2em);
`]))),pg=()=>ge(ur,{children:[Y(mg,{children:Y(Zl,{height:13})}),"API Credentials"]});var Ns=te.exports.memo(function(t){const{children:e,title:n,description:i,inputId:r}=t;return ge(Lt,{space:1,children:[Y(dt,{align:"flex-end",children:Y(jt,{flex:1,paddingY:2,children:Y(Lt,{space:2,children:ge(dt,{children:[Y($e,{as:"label",htmlFor:r,weight:"semibold",size:1,children:n||Y("em",{children:"Untitled"})}),i&&Y($e,{muted:!0,size:1,children:i})]})})})}),Y("div",{children:e})]})});const Eg=["token","secretKey","enableSignedUrls"];var yg=te.exports.memo(function(t){let{secrets:e,setDialogState:n}=t;var i,r;const D=Yt(),[c,p]=(E=>te.exports.useReducer(vg,E,Ql))(e),w=te.exports.useMemo(()=>e.token&&e.secretKey,[e]),M=te.exports.useCallback(()=>n(!1),[n]),O=te.exports.useMemo(()=>e.token!==c.token||e.secretKey!==c.secretKey||e.enableSignedUrls!==c.enableSignedUrls,[e,c]),C="ConfigureApi".concat(te.exports.useId()),[S,b,I]=te.exports.useMemo(()=>Eg.map(E=>"".concat(C,"-").concat(E)),[C]),L=te.exports.useRef(null),_=hg(D,e),x=te.exports.useRef(!1),l=te.exports.useCallback(E=>{if(E.preventDefault(),!x.current&&E.currentTarget.reportValidity()){x.current=!0,p({type:"submit"});const{token:u,secretKey:s,enableSignedUrls:o}=c;_({token:u,secretKey:s,enableSignedUrls:o}).then(g=>{const{projectId:f,dataset:v}=D.config();zu([Aa,xa,f,v]),Yu(()=>Promise.resolve(g),[Aa,xa,f,v]),n(!1)}).catch(g=>p({type:"error",payload:g.message})).finally(()=>{x.current=!1})}},[D,p,_,n,c]),a=te.exports.useCallback(E=>{p({type:"change",payload:{name:"token",value:E.currentTarget.value}})},[p]),d=te.exports.useCallback(E=>{p({type:"change",payload:{name:"secretKey",value:E.currentTarget.value}})},[p]),y=te.exports.useCallback(E=>{p({type:"change",payload:{name:"enableSignedUrls",value:E.currentTarget.checked}})},[p]);return te.exports.useEffect(()=>{L.current&&L.current.focus()},[L]),Y(Xn,{id:C,onClose:M,header:Y(pg,{}),width:0,children:Y(jt,{padding:4,style:{position:"relative"},children:Y("form",{onSubmit:l,noValidate:!0,children:ge(Lt,{space:4,children:[!w&&Y(xt,{padding:[3,3,3],radius:2,shadow:1,tone:"primary",children:ge(Lt,{space:3,children:[ge($e,{size:1,children:["To set up a new access token, go to your"," ",Y("a",{href:"https://dashboard.mux.com/settings/access-tokens",target:"_blank",rel:"noreferrer noopener",children:"account on mux.com"}),"."]}),ge($e,{size:1,children:["The access token needs permissions: ",Y("strong",{children:"Mux Video "}),"(Full Access) and ",Y("strong",{children:"Mux Data"})," (Read)",Y("br",{}),"The credentials will be stored safely in a hidden document only available to editors."]})]})}),Y(Ns,{title:"Access Token",inputId:S,children:Y(Sa,{id:S,ref:L,onChange:a,type:"text",value:(i=c.token)!=null?i:"",required:!!c.secretKey||c.enableSignedUrls})}),Y(Ns,{title:"Secret Key",inputId:b,children:Y(Sa,{id:b,onChange:d,type:"text",value:(r=c.secretKey)!=null?r:"",required:!!c.token||c.enableSignedUrls})}),ge(Lt,{space:4,children:[ge(dt,{align:"center",children:[Y(Li,{id:I,onChange:y,checked:c.enableSignedUrls,style:{display:"block"}}),Y(jt,{flex:1,paddingLeft:3,children:Y($e,{children:Y("label",{htmlFor:I,children:"Enable Signed Urls"})})})]}),e.signingKeyId&&c.enableSignedUrls?Y(xt,{padding:[3,3,3],radius:2,shadow:1,tone:"caution",children:ge(Lt,{space:3,children:[Y($e,{size:1,children:"The signing key ID that Sanity will use is:"}),Y(js,{size:1,children:e.signingKeyId}),ge($e,{size:1,children:["This key is only used for previewing content in the Sanity UI.",Y("br",{}),"You should generate a different key to use in your application server."]})]})}):null]}),ge(mr,{space:2,children:[Y(pt,{text:"Save",disabled:!O,loading:c.submitting,tone:"primary",mode:"default",type:"submit"}),Y(pt,{disabled:c.submitting,text:"Cancel",mode:"bleed",onClick:M})]}),c.error&&Y(xt,{padding:[3,3,3],radius:2,shadow:1,tone:"critical",children:Y($e,{children:c.error})})]})})})})});function Tg(t){const{setDialogState:e}=t,n=te.exports.useCallback(()=>e("secrets"),[e]);return Y(ur,{children:Y("div",{style:{padding:2},children:Y(xt,{display:"flex",sizing:"border",style:{aspectRatio:"16/9",width:"100%",boxShadow:"var(--card-bg-color) 0 0 0 2px"},paddingX:[2,3,4,4],radius:1,tone:"transparent",children:Y(dt,{justify:"flex-start",align:"center",children:ge(Ri,{columns:1,gap:[2,3,4,4],children:[Y(mr,{paddingY:1,children:Y("div",{style:{height:"32px"},children:Y(Zl,{})})}),Y(mr,{paddingY:1,children:Y(id,{size:[0,1,2,2],children:"Upload and preview videos directly from your studio."})}),Y(mr,{paddingY:1,children:Y(pt,{mode:"ghost",icon:qi,text:"Configure API",onClick:n})})]})})})})})}var xg=te.exports.memo(t=>{var e;const n=Yt(),i=(()=>{const{error:O,isLoading:C,value:S}=Xu(ad,Dv);return{error:O,isLoading:C,value:te.exports.useMemo(()=>{const b=Boolean(S),I={token:(S==null?void 0:S.token)||null,secretKey:(S==null?void 0:S.secretKey)||null,enableSignedUrls:(S==null?void 0:S.enableSignedUrls)||!1,signingKeyId:(S==null?void 0:S.signingKeyId)||null,signingKeyPrivate:(S==null?void 0:S.signingKeyPrivate)||null};return{isInitialSetup:!b,needsSetup:!(I!=null&&I.token)||!(I!=null&&I.secretKey),secrets:I}},[S])}})(),r=gd((e=t.value)==null?void 0:e.asset),D=(O=>{var C,S;const b=Yt(),I=Qu(),L=Zu(),_=te.exports.useMemo(()=>{var x,l;return!!(O!=null&&O.assetId)&&((O==null?void 0:O.status)==="preparing"||((l=(x=O==null?void 0:O.data)==null?void 0:x.static_renditions)==null?void 0:l.status)==="preparing")},[O==null?void 0:O.assetId,(S=(C=O==null?void 0:O.data)==null?void 0:C.static_renditions)==null?void 0:S.status,O==null?void 0:O.status]);return Rc(_?"/".concat(I,"/addons/mux/assets/").concat(L,"/data/").concat(O==null?void 0:O.assetId):null,async()=>{const{data:x}=await b.request({url:"/addons/mux/assets/".concat(L,"/data/").concat(O.assetId),withCredentials:!0,method:"GET"});b.patch(O._id).set({status:x.status,data:x}).commit({returnDocuments:!1})},{refreshInterval:2e3,refreshWhenHidden:!0,dedupingInterval:1e3})})(t.readOnly?void 0:(r==null?void 0:r.value)||void 0),[c,p]=te.exports.useState(!1),w=i.error||r.error||D.error;if(w)throw w;const M=i.isLoading||r.isLoading;return Y(ur,{children:M?Y(Ju,{}):ge(ur,{children:[i.value.needsSetup&&!r.value?Y(Tg,{setDialogState:p}):Y(fg,mt(mt({},t),{},{config:t.config,onChange:t.onChange,client:n,secrets:i.value.secrets,asset:r.value,dialogState:c,setDialogState:p,needsSetup:i.value.needsSetup})),c==="secrets"&&Y(yg,{setDialogState:p,secrets:i.value.secrets})]})})});export{xg as default};
